# 🚀 მოდულების ინიციალიზაციის დონეები (Initialization Levels)

**სტატუსი:** მკაცრი რეკომენდაცია (Strongly Recommended)  
**ავტორი:** Synapse Framework Team

## 🎯 მიზანი

ეს დოკუმენტი განსაზღვრავს **სტანდარტიზებულ სტრატეგიას** `init_level` პარამეტრის გამოყენებისთვის Synapse Framework-ის მოდულებში. `init_level` არის რიცხვითი მნიშვნელობა, რომელიც განსაზღვრავს, რა თანმიმდევრობით უნდა მოხდეს მოდულების ინიციალიზაცია სისტემის გაშვებისას.

**სწორი `init_level`-ების გამოყენება კრიტიკულად მნიშვნელოვანია სისტემის სტაბილურობისთვის**, რადგან ის უზრუნველყოფს, რომ მოდული-მომხმარებელი (Consumer) არ შეეცდება გამოიყენოს სერვისი, რომელიც ჯერ არ არის ინიციალიზებული და დარეგისტრირებული მოდული-მომწოდებლის (Provider) მიერ.

## ⚙️ როგორ მუშაობს?

`System Manager` კომპონენტი სისტემის გაშვებისას (`fmw_system_start`) ყველა რეგისტრირებულ მოდულს ალაგებს `init_level`-ის **ზრდადობის მიხედვით** (დაბალიდან მაღლისკენ) და შემდეგ ამ თანმიმდევრობით იძახებს მათ `init()` ფუნქციებს.

- **დაბალი `init_level`** = ადრეული ინიციალიზაცია
- **მაღალი `init_level`** = გვიანი ინიციალიზაცია

## 📜 ოქროს წესი

> 💡 **სერვისის მომწოდებელ (Provider) მოდულს ყოველთვის უნდა ჰქონდეს უფრო დაბალი `init_level`, ვიდრე სერვისის მომხმარებელ (Consumer) მოდულს.**

**მაგალითი:**
`rgb_led_indicator` მოდული იყენებს `command_router`-ის სერვისს. შესაბამისად:

- `command_router.init_level` (მაგ: `50`) **<** `rgb_led_indicator.init_level` (მაგ: `60`)

## 📊 ინიციალიზაციის დონეების რეკომენდებული დიაპაზონები

იმისათვის, რომ შევინარჩუნოთ წესრიგი და თავიდან ავიცილოთ კონფლიქტები, გთავაზობთ `init_level`-ების შემდეგ სტრუქტურას. ახალი მოდულის დამატებისას, შეარჩიეთ შესაბამისი დიაპაზონი მისი როლიდან გამომდინარე.

---

### 📦 **დონე 1: ფუნდამენტური დრაივერები და რესურსები (0-19)**

ესენი არიან ყველაზე დაბალი დონის მოდულები, რომლებზეც შეიძლება დამოკიდებული იყოს თითქმის ყველა სხვა მოდული. ისინი, როგორც წესი, არ იყენებენ სხვა მოდულების სერვისებს.

- **`init_level: 0-9`**
  - 💧 **`resource_manager`**: უნდა იყოს ერთ-ერთი პირველი, რადგან სხვა დრაივერებმა შეიძლება დაიკავონ რესურსები.
- **`init_level: 10-19`**
  - 🚌 **`i2c_bus_module`, `spi_bus_module`**: აპარატურული ავტობუსების დრაივერები.
  - 🔌 **`gpio_manager`** (თუ არსებობს).

---

### 🛠️ **დონე 2: საბაზისო სისტემური სერვისები (20-39)**

ეს მოდულები უზრუნველყოფენ ფონურ, სისტემურ სერვისებს. ისინი შეიძლება დამოკიდებული იყვნენ 1-ლი დონის დრაივერებზე.

- **`init_level: 20-29`**
  - 💾 **`storage_manager` / `nvs_module`**: მეხსიერებასთან მუშაობა.
  - 📝 **`logger_module`**: ლოგირების სერვისი.
- **`init_level: 30-39`**
  - ❤️ **`health_monitor`**: სისტემის ჯანმრთელობის მონიტორინგი.
  - 🐶 **`watchdog_manager`**: Watchdog-ის მართვა.

---

### 📡 **დონე 3: ქსელი, კონტროლი და კომუნიკაცია (40-59)**

ეს არის ძირითადი საკომუნიკაციო და მართვის მოდულები, რომლებიც ხშირად წარმოადგენენ სერვისების მომწოდებლებს აპლიკაციის დონის მოდულებისთვის.

- **`init_level: 40-49`**
  - 📶 **`wifi_manager`**: WiFi კავშირის მართვა.
  - ⏱️ **`time_sync_module`**: დროის სინქრონიზაცია.
- **`init_level: 50-59`**
  - ⌨️ **`command_router`**: ბრძანებების ცენტრალიზებული მართვა. (კარგი საწყისი წერტილი: `50`)
  - ☁️ **`mqtt_module`**: MQTT ბროკერთან კავშირი.
  - 🔄 **`ota_update_manager`**: Over-the-Air განახლებები.
  - 🌐 **`http_server_module`**: ლოკალური ვებ-სერვერი.

---

### 💡 **დონე 4: აპლიკაციის ლოგიკა და პერიფერია (60-79)**

ეს არის მოდულების ყველაზე გავრცელებული დონე. ისინი, როგორც წესი, არიან 1-3 დონის სერვისების **მომხმარებლები (Consumers)**.

- **`init_level: 60-69`**
  - 🌡️ **სენსორების მოდულები** (`dht22_module`, `bme280_module` და ა.შ.): იყენებენ I2C/SPI დრაივერებს.
  - 💡 **აქტუატორების მოდულები** (`relay_module`, `motor_driver` და ა.შ.): იყენებენ `resource_manager`-ს.
- **`init_level: 70-79`**
  - 🎨 **`rgb_led_indicator`**: იყენებს `command_router`-ს, `resource_manager`-ს და რეაგირებს `wifi_manager`-ის ივენთებზე. (კარგი საწყისი წერტილი: `70`)
  - 📺 **დისპლეის მოდულები** (`ssd1306_module`): იყენებენ I2C/SPI დრაივერებს.

---

### 🧩 **დონე 5: მაღალი დონის კომპოზიტური მოდულები (80-100)**

ეს მოდულები შეიძლება დამოკიდებული იყვნენ მე-4 დონის მოდულების სერვისებზე.

- **`init_level: 80-89`**
  - 🤖 **`automation_engine`**: მოდული, რომელიც კითხულობს სენსორის მონაცემებს (დონე 4) და მართავს რელეს (დონე 4).
- **`init_level: 90-100`**
  - 📱 **`ble_provisioning`**: მოდული, რომელიც შეიძლება საჭიროებდეს WiFi-ს, სერვისების და სხვა კომპონენტების მართვას.

---

## 📝 როგორ განვსაზღვროთ `init_level` ახალი მოდულისთვის?

1. **დაადგინეთ დამოკიდებულებები:** რომელ სხვა მოდულების **სერვისებს** იყენებს თქვენი ახალი მოდული?
2. **იპოვეთ მომწოდებლების `init_level`-ები:** შეამოწმეთ იმ მოდულების `module.json` ფაილები, რომლებზეც ხართ დამოკიდებული.
3. **აირჩიეთ უფრო მაღალი `init_level`:** თქვენი მოდულის `init_level` უნდა იყოს ყველა იმ მოდულის `init_level`-ზე მაღალი, რომლის სერვისსაც იყენებთ.
4. **დატოვეთ "სივრცე":** ნუ აირჩევთ პირდაპირ მომდევნო რიცხვს (მაგ., 50-ის შემდეგ 51). დატოვეთ 5-10 ერთეულიანი შუალედი, რათა მომავალში სხვა მოდულების ჩამატება გამარტივდეს.
5. **განაახლეთ `module.json`:** ჩაწერეთ არჩეული `init_level` თქვენი მოდულის `module.json` ფაილში.

ამ სტრუქტურის დაცვა უზრუნველყოფს, რომ Synapse Framework-ის ეკოსისტემა დარჩეს ორგანიზებული, პროგნოზირებადი და მარტივად გასაფართოებელი.
