# ðŸ©º áƒ›áƒáƒ“áƒ£áƒšáƒ˜: Health Monitor

**ðŸ—‚ï¸ áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ:** `system`  
**âœ’ï¸ áƒáƒ•áƒ¢áƒáƒ áƒ˜:** Synapse Framework Team  
**ðŸ”– áƒ•áƒ”áƒ áƒ¡áƒ˜áƒ:** 2.0.0

## 1. ðŸ“œ áƒ›áƒ˜áƒ›áƒáƒ®áƒ˜áƒšáƒ•áƒ

`Health Monitor` áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ áƒ˜áƒ¡ Synapse Framework-áƒ˜áƒ¡ **áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ›áƒ“áƒ’áƒ áƒáƒ“áƒáƒ‘áƒ˜áƒ¡ áƒ›áƒªáƒ•áƒ”áƒšáƒ˜**. áƒ›áƒ˜áƒ¡áƒ˜ áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒáƒ›áƒáƒªáƒáƒœáƒáƒ, áƒ¤áƒáƒœáƒ£áƒ  áƒ áƒ”áƒŸáƒ˜áƒ›áƒ¨áƒ˜, áƒ áƒ”áƒáƒšáƒ£áƒ  áƒ“áƒ áƒáƒ¨áƒ˜ áƒáƒ™áƒáƒœáƒ¢áƒ áƒáƒšáƒáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜, áƒáƒ¦áƒ›áƒáƒáƒ©áƒ˜áƒœáƒáƒ¡ áƒžáƒáƒ¢áƒ”áƒœáƒªáƒ˜áƒ£áƒ áƒ˜ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ”áƒ‘áƒ˜ (áƒ áƒáƒ’áƒáƒ áƒ˜áƒªáƒáƒ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒŸáƒáƒœáƒ•áƒ áƒáƒœ áƒ¢áƒáƒ¡áƒ™áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ¢áƒ”áƒ™áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ•áƒ¡áƒ”áƒ‘áƒ) áƒ›áƒáƒ— áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒš áƒ¤áƒáƒ–áƒáƒ¨áƒ˜ áƒ’áƒáƒ“áƒáƒ¡áƒ•áƒšáƒáƒ›áƒ“áƒ” áƒ“áƒ áƒ¨áƒ”áƒáƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ¡áƒ®áƒ•áƒ áƒœáƒáƒ¬áƒ˜áƒšáƒ”áƒ‘áƒ¡ áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒ˜áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘.

áƒ”áƒ¡ áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ áƒ˜áƒ¡ áƒžáƒ áƒ”áƒ•áƒ”áƒœáƒªáƒ˜áƒ£áƒšáƒ˜ áƒ“áƒ˜áƒáƒ’áƒœáƒáƒ¡áƒ¢áƒ˜áƒ™áƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ“áƒáƒ›áƒ”áƒœáƒ¢áƒ£áƒ áƒ˜ áƒ˜áƒœáƒ¡áƒ¢áƒ áƒ£áƒ›áƒ”áƒœáƒ¢áƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒœáƒáƒ“ áƒ–áƒ áƒ“áƒ˜áƒ¡ áƒ›áƒáƒ¬áƒ§áƒáƒ‘áƒ˜áƒšáƒáƒ‘áƒ˜áƒ¡ áƒ¡áƒáƒ˜áƒ›áƒ”áƒ“áƒáƒáƒ‘áƒáƒ¡ áƒ’áƒ áƒ«áƒ”áƒšáƒ•áƒáƒ“áƒ˜áƒáƒœ áƒžáƒ”áƒ áƒ¡áƒžáƒ”áƒ¥áƒ¢áƒ˜áƒ•áƒáƒ¨áƒ˜.

## 2. â— áƒ¬áƒ˜áƒœáƒáƒžáƒ˜áƒ áƒáƒ‘áƒ”áƒ‘áƒ˜ áƒ“áƒ `menuconfig`

áƒáƒ› áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡, áƒ’áƒáƒœáƒ¡áƒáƒ™áƒ£áƒ—áƒ áƒ”áƒ‘áƒ˜áƒ— áƒ¢áƒáƒ¡áƒ™áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜áƒ¡ áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡, áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ ESP-IDF-áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒáƒ¨áƒ˜ (`menuconfig`) áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜ áƒáƒ¤áƒªáƒ˜áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ:

1. áƒ’áƒáƒ£áƒ¨áƒ•áƒ˜áƒ— `idf.py menuconfig`.
2. áƒ’áƒáƒ“áƒáƒ“áƒ˜áƒ— `Component config` ---> `FreeRTOS` --->
3. áƒ©áƒáƒ áƒ—áƒ”áƒ— (`[y]`) áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜ áƒáƒ¤áƒªáƒ˜áƒ:
    * `Enable generation of run time stats`

**áƒ’áƒáƒ¤áƒ áƒ—áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ:** áƒáƒ› áƒáƒ¤áƒªáƒ˜áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ’áƒáƒ áƒ”áƒ¨áƒ”, `uxTaskGetSystemState` áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ áƒáƒ  áƒ˜áƒ¥áƒœáƒ”áƒ‘áƒ áƒ®áƒ”áƒšáƒ›áƒ˜áƒ¡áƒáƒ¬áƒ•áƒ“áƒáƒ›áƒ˜ áƒ“áƒ áƒžáƒ áƒáƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ™áƒáƒ›áƒžáƒ˜áƒšáƒáƒªáƒ˜áƒ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ”áƒ‘áƒ `undefined reference` áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ˜áƒ—.

## 3. ðŸ›ï¸ áƒáƒ áƒ¥áƒ˜áƒ¢áƒ”áƒ¥áƒ¢áƒ£áƒ áƒ£áƒšáƒ˜ áƒžáƒ áƒ˜áƒœáƒªáƒ˜áƒžáƒ”áƒ‘áƒ˜

* **áƒ áƒ”áƒ¡áƒ£áƒ áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒžáƒ¢áƒ˜áƒ›áƒ˜áƒ–áƒáƒªáƒ˜áƒ:** áƒ›áƒáƒ“áƒ£áƒšáƒ˜ **áƒáƒ  áƒ¥áƒ›áƒœáƒ˜áƒ¡ áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ  áƒ¢áƒáƒ¡áƒ™áƒ¡**. áƒáƒ›áƒ˜áƒ¡ áƒœáƒáƒªáƒ•áƒšáƒáƒ“, áƒ˜áƒ¡ áƒ—áƒáƒ•áƒ˜áƒ¡ áƒžáƒ”áƒ áƒ˜áƒáƒ“áƒ£áƒš áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒáƒ’áƒ˜áƒ™áƒáƒ¡ áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ¡ `core`-áƒ˜áƒ¡ **`Task Pool Manager`**-áƒ¨áƒ˜, áƒ áƒáƒ’áƒáƒ áƒª "áƒ“áƒáƒ•áƒáƒšáƒ”áƒ‘áƒ" (`Job`). áƒ”áƒ¡ áƒ›áƒ˜áƒ“áƒ’áƒáƒ›áƒ áƒ–áƒáƒ’áƒáƒ•áƒ¡ ~3KB áƒáƒžáƒ”áƒ áƒáƒ¢áƒ˜áƒ£áƒš áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒáƒ¡ áƒ“áƒ áƒáƒ›áƒªáƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ¡áƒáƒ”áƒ áƒ—áƒ áƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒáƒ¡.
* **áƒ–áƒ¦áƒ•áƒ áƒ£áƒšáƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ”áƒ‘áƒ˜ (Thresholds):** áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ¨ áƒ›áƒ§áƒáƒ¤ áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ¡ áƒáƒ¥áƒ•áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒ˜áƒ áƒ”áƒ‘áƒáƒ“áƒ˜ áƒ–áƒ¦áƒ•áƒ áƒ£áƒšáƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ.
* **áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ–áƒ” áƒ“áƒáƒ¤áƒ£áƒ«áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ áƒ”áƒáƒ’áƒ˜áƒ áƒ”áƒ‘áƒ:** áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ˜áƒ¡ áƒáƒ¦áƒ›áƒáƒ©áƒ”áƒœáƒ˜áƒ¡áƒáƒ¡, áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ¡ `SYSTEM_HEALTH_ALERT` áƒ˜áƒ•áƒ”áƒœáƒ—áƒ¡ `Event Bus`-áƒ–áƒ”, áƒ áƒáƒ–áƒ”áƒª áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡ (áƒ›áƒáƒ’., `alarms_manager`) áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒáƒ— áƒ áƒ”áƒáƒ’áƒ˜áƒ áƒ”áƒ‘áƒ.
* **áƒ’áƒáƒ¤áƒáƒ áƒ—áƒáƒ”áƒ‘áƒáƒ“áƒáƒ‘áƒ:** áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒáƒ—, áƒ“áƒáƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒáƒœ áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ áƒ˜ "áƒ¯áƒáƒœáƒ›áƒ áƒ—áƒ”áƒšáƒáƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡" áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜ `Service API`-áƒ¡ áƒ›áƒ”áƒ¨áƒ•áƒ”áƒáƒ‘áƒ˜áƒ—.
* **áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ–áƒ”-áƒ“áƒáƒ›áƒáƒ™áƒ˜áƒ“áƒ”áƒ‘áƒ£áƒšáƒ”áƒ‘áƒ:** áƒ›áƒáƒ“áƒ£áƒšáƒ˜ "áƒ­áƒ™áƒ•áƒ˜áƒáƒœáƒ˜áƒ" áƒ“áƒ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒ, áƒ“áƒ áƒáƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒ—áƒ˜áƒ¨áƒáƒ¡ áƒ’áƒáƒ áƒ™áƒ•áƒ”áƒ£áƒšáƒ˜ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ”áƒ‘áƒ˜ (áƒ›áƒáƒ’., áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¢áƒ áƒáƒšáƒ˜ `provisioning`-áƒ˜áƒ¡ áƒ“áƒ áƒáƒ¡), áƒ áƒáƒ—áƒ áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒáƒ˜áƒªáƒ˜áƒšáƒáƒ¡ áƒªáƒ áƒ£ áƒ’áƒáƒœáƒ’áƒáƒ¨áƒ”áƒ‘áƒ˜.

## 4. âš™ï¸ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ

áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ áƒ®áƒ“áƒ”áƒ‘áƒ áƒ›áƒ˜áƒ¡áƒ˜ `config.json` áƒ¤áƒáƒ˜áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ”áƒ‘áƒ˜áƒ—.

**áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜:**

```json
[
    {
        "type": "health_monitor",
        "enabled": true,
        "config": {
            "instance_name": "health_monitor",
            "check_interval_sec": 60,
            "thresholds": {
                "min_free_heap_kb": 20,
                "min_task_stack_hwm_bytes": 256
            }
        }
    }
]
```

**áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜:**

| áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜ | áƒ¢áƒ˜áƒžáƒ˜ | áƒáƒ¦áƒ¬áƒ”áƒ áƒ | áƒ¡áƒáƒ•áƒáƒšáƒ“áƒ”áƒ‘áƒ£áƒšáƒ | Default |
|:---|:---|:---|:---:|:---|
| `instance_name` | áƒ¡áƒ¢áƒ áƒ˜áƒ¥áƒáƒœáƒ˜ | áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ˜áƒœáƒ¡áƒ¢áƒáƒœáƒªáƒ˜áƒ˜áƒ¡ áƒ£áƒœáƒ˜áƒ™áƒáƒšáƒ£áƒ áƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜. | âœ… | - |
| `check_interval_sec` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ˜áƒœáƒ¢áƒ”áƒ áƒ•áƒáƒšáƒ˜ áƒ¬áƒáƒ›áƒ”áƒ‘áƒ¨áƒ˜. | âŒ | `60` |
| `thresholds` | áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜ | áƒ–áƒ¦áƒ•áƒ áƒ£áƒšáƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¢áƒ”áƒ˜áƒœáƒ”áƒ áƒ˜. | âŒ | - |
| `thresholds.min_free_heap_kb` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒáƒšáƒ˜ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ˜áƒœáƒ˜áƒ›áƒáƒšáƒ£áƒ áƒ˜ áƒ–áƒ¦áƒ•áƒáƒ áƒ˜ áƒ™áƒ˜áƒšáƒáƒ‘áƒáƒ˜áƒ¢áƒ”áƒ‘áƒ¨áƒ˜. | âŒ | `20` |
| `thresholds.min_task_stack_hwm_bytes` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ¢áƒáƒ¡áƒ™áƒ˜áƒ¡ áƒ¡áƒ¢áƒ”áƒ™áƒ˜áƒ¡ áƒ“áƒáƒ áƒ©áƒ”áƒœáƒ˜áƒšáƒ˜ áƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒáƒšáƒ˜ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒ¡ áƒ›áƒ˜áƒœáƒ˜áƒ›áƒáƒšáƒ£áƒ áƒ˜ áƒ–áƒ¦áƒ•áƒáƒ áƒ˜ áƒ‘áƒáƒ˜áƒ¢áƒ”áƒ‘áƒ¨áƒ˜. | âŒ | `256` |

## 5. ðŸ”Œ Service API (`health_api_t`)

áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒáƒ— áƒ›áƒ˜áƒ˜áƒ¦áƒáƒœ áƒ¬áƒ•áƒ“áƒáƒ›áƒ `Health Monitor`-áƒ˜áƒ¡ API-áƒ–áƒ” `Service Locator`-áƒ˜áƒ¡ áƒ›áƒ”áƒ¨áƒ•áƒ”áƒáƒ‘áƒ˜áƒ—. áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ áƒ¢áƒ˜áƒžáƒ˜: `SYNAPSE_SERVICE_TYPE_HEALTH_API`.

**API áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜:**

* **`esp_err_t get_system_health_report(cJSON **report);`**  
    áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ¯áƒáƒœáƒ›áƒ áƒ—áƒ”áƒšáƒáƒ‘áƒ˜áƒ¡ áƒ¡áƒ áƒ£áƒš áƒ áƒ”áƒžáƒáƒ áƒ¢áƒ¡ cJSON áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ˜áƒ—. áƒ áƒ”áƒžáƒáƒ áƒ¢áƒ˜ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒáƒ¡ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡, uptime-áƒ˜áƒ¡áƒ áƒ“áƒ áƒ§áƒ•áƒ”áƒšáƒ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ¢áƒáƒ¡áƒ™áƒ˜áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘. **áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜áƒ:** áƒ’áƒáƒ›áƒáƒ›áƒ«áƒáƒ®áƒ”áƒ‘áƒ”áƒšáƒ›áƒ áƒ£áƒœáƒ“áƒ áƒ’áƒáƒáƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒšáƒáƒ¡ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ `cJSON` áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜ `cJSON_Delete()`-áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ˜áƒ—.

* **`esp_err_t register_custom_check(const char* check_name, health_check_fn_t check_fn, void* context);`**  
    áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒáƒ®áƒáƒš, áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ›áƒ˜áƒ”áƒ  áƒ’áƒáƒœáƒ¡áƒáƒ–áƒ¦áƒ•áƒ áƒ£áƒš áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ¡.

* **`esp_err_t unregister_custom_check(const char* check_name);`**  
    áƒ¨áƒšáƒ˜áƒ¡ áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒš áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒáƒ¡.

## 6. ðŸ“¢ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜

### áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜

* **`SYSTEM_HEALTH_ALERT`**
  * **áƒ áƒáƒ“áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ§áƒœáƒ“áƒ”áƒ‘áƒ:** áƒ áƒáƒ“áƒ”áƒ¡áƒáƒª áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒ›áƒ” áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ¨ áƒ›áƒ§áƒáƒ¤áƒ˜ áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜ áƒ’áƒáƒ“áƒáƒ¡áƒªáƒ“áƒ”áƒ‘áƒ áƒ“áƒáƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ£áƒš áƒ–áƒ¦áƒ•áƒáƒ áƒ¡.
  * **Payload (cJSON áƒ¡áƒ¢áƒ áƒ˜áƒ¥áƒáƒœáƒ˜):**
    * **áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ:** `{"alert_type":"LOW_HEAP_MEMORY", "value_kb":18}`
    * **áƒ¡áƒ¢áƒ”áƒ™áƒ˜áƒ¡ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ:** `{"alert_type":"LOW_STACK_SPACE", "task_name":"some_task", "remaining_bytes":200}`
    * **Custom áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ:** `{"alert_type":"CUSTOM_CHECK_FAILED", "check_name":"my_db_check"}`

### áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ˜áƒšáƒ˜ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜

* **`PROV_STARTED`**: áƒáƒ› áƒ˜áƒ•áƒ”áƒœáƒ—áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡, áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒ“áƒ áƒáƒ”áƒ‘áƒ˜áƒ— áƒ—áƒ˜áƒ¨áƒáƒ•áƒ¡ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒáƒ¡.
* **`PROV_ENDED`**: áƒáƒ› áƒ˜áƒ•áƒ”áƒœáƒ—áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡, áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ¡ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒáƒ¡.

## 7. ðŸ’¡ áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜

`ota_update_manager`-áƒ¡ áƒ¡áƒ£áƒ áƒ¡, áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒáƒ›áƒ“áƒ” áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒáƒ¡, áƒáƒ áƒ˜áƒ¡ áƒ—áƒ£ áƒáƒ áƒ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒáƒ¨áƒ˜ áƒ¡áƒáƒ™áƒ›áƒáƒ áƒ˜áƒ¡áƒ˜ áƒ áƒ”áƒ¡áƒ£áƒ áƒ¡áƒ˜.

```c
#include "synapse.h"
#include "health_interface.h"

void start_ota_if_healthy() {
    // áƒ•áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ— lookup_by_type-áƒ¡, áƒ áƒáƒ—áƒ áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒáƒ•áƒ˜áƒªáƒ˜áƒšáƒáƒ— hardcoded áƒ¡áƒáƒ®áƒ”áƒšáƒ˜
    service_handle_t handle = synapse_service_lookup_by_type(SYNAPSE_SERVICE_TYPE_HEALTH_API);
    if (!handle) {
        ESP_LOGW(TAG, "Health Monitor service not found. Skipping health check.");
        // ... áƒ’áƒáƒœáƒáƒ’áƒ áƒ«áƒ” OTA ...
        return;
    }

    health_api_t *health_api = (health_api_t *)handle;
    cJSON *report = NULL;
    
    if (health_api->get_system_health_report(&report) == ESP_OK && report) {
        const cJSON *heap = cJSON_GetObjectItem(report, "min_free_heap_bytes");
        
        // áƒ¨áƒ”áƒ•áƒáƒ›áƒáƒ¬áƒ›áƒáƒ—, áƒ—áƒ£ áƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒáƒšáƒ˜ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ 80KB-áƒ–áƒ” áƒœáƒáƒ™áƒšáƒ”áƒ‘áƒ˜áƒ
        if (cJSON_IsNumber(heap) && heap->valueint < 80000) { 
            ESP_LOGE(TAG, "Not enough free memory for OTA update. Aborting.");
            cJSON_Delete(report);
            return;
        }
        cJSON_Delete(report);
    }

    // ... áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ áƒ¯áƒáƒœáƒ›áƒ áƒ—áƒ”áƒšáƒ˜áƒ, áƒ•áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ— OTA-áƒ¡ ...
}
```
