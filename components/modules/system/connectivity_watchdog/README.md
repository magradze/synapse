# ­ЪЏ░№ИЈ рЃЏрЃЮрЃЊрЃБрЃџрЃў: Connectivity Watchdog

**­ЪЌѓ№ИЈ рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ:** `system`  
**Рюњ№ИЈ рЃљрЃЋрЃбрЃЮрЃарЃў:** Synapse Framework Team  
**­Ъћќ рЃЋрЃћрЃарЃАрЃўрЃљ:** 2.1.0

## 1. ­ЪЊю рЃЏрЃўрЃЏрЃЮрЃ«рЃўрЃџрЃЋрЃљ

`Connectivity Watchdog` рЃљрЃарЃўрЃА Synapse Framework-рЃўрЃА **рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЏрЃЊрЃњрЃарЃљрЃЊрЃЮрЃЉрЃўрЃАрЃљ рЃЊрЃљ рЃЌрЃЋрЃўрЃЌрЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃА рЃЏрЃфрЃЋрЃћрЃџрЃў**. рЃЏрЃўрЃАрЃў рЃцрЃБрЃюрЃЊрЃљрЃЏрЃћрЃюрЃбрЃБрЃарЃў рЃљрЃЏрЃЮрЃфрЃљрЃюрЃљрЃљ, рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃА, рЃарЃЮрЃЏ рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ рЃљрЃарЃљрЃАрЃЊрЃарЃЮрЃА рЃЊрЃљрЃарЃЕрЃћрЃА "рЃфрЃЮрЃфрЃ«рЃљрЃџрЃў, рЃЏрЃљрЃњрЃарЃљрЃЏ рЃўрЃќрЃЮрЃџрЃўрЃарЃћрЃЉрЃБрЃџрЃў" рЃЏрЃЊрЃњрЃЮрЃЏрЃљрЃарЃћрЃЮрЃЉрЃљрЃерЃў. рЃўрЃА рЃЏрЃБрЃЊрЃЏрЃўрЃЋрЃљрЃЊ рЃљрЃЎрЃЋрЃўрЃарЃЊрЃћрЃЉрЃљ рЃЎрЃарЃўрЃбрЃўрЃЎрЃБрЃџ рЃАрЃљрЃЎрЃЮрЃЏрЃБрЃюрЃўрЃЎрЃљрЃфрЃўрЃЮ рЃљрЃарЃ«рЃћрЃЉрЃА рЃЊрЃљ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃўрЃА рЃљрЃдрЃЏрЃЮрЃЕрЃћрЃюрЃўрЃАрЃљрЃА, рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃўрЃгрЃДрЃћрЃЉрЃА рЃЏрЃарЃљрЃЋрЃљрЃџрЃАрЃљрЃцрЃћрЃ«рЃБрЃарЃўрЃљрЃю, рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃўрЃарЃћрЃЉрЃљрЃЊ рЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃА.

рЃћрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃАрЃфрЃўрЃџрЃЊрЃћрЃЉрЃљ рЃБрЃЉрЃарЃљрЃџрЃЮ "рЃърЃўрЃюрЃњрЃА". рЃўрЃА рЃљрЃарЃўрЃА **рЃБрЃюрЃўрЃЋрЃћрЃарЃАрЃљрЃџрЃБрЃарЃў, рЃЏрЃарЃљрЃЋрЃљрЃџрЃерЃарЃўрЃљрЃюрЃў рЃЏрЃЮрЃюрЃўрЃбрЃЮрЃарЃўрЃюрЃњрЃўрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ**, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф:

- **рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА** рЃарЃЮрЃњрЃЮрЃарЃф рЃърЃљрЃАрЃўрЃБрЃа "heartbeat" рЃАрЃўрЃњрЃюрЃљрЃџрЃћрЃЉрЃА (рЃЏрЃљрЃњ., MQTT-рЃЊрЃљрЃю), рЃўрЃАрЃћ рЃљрЃЦрЃбрЃўрЃБрЃарЃљрЃЊ рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃЦрЃАрЃћрЃџрЃўрЃА рЃАрЃўрЃ»рЃљрЃюрЃАрЃљрЃдрЃћрЃА (рЃЏрЃљрЃњ., PING-рЃўрЃЌ).
- **рЃарЃћрЃљрЃњрЃўрЃарЃћрЃЉрЃА** рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃћрЃЉрЃќрЃћ рЃћрЃбрЃљрЃърЃЮрЃЉрЃарЃўрЃЋрЃљрЃЊ Рђћ рЃЏрЃљрЃарЃбрЃўрЃЋрЃў рЃњрЃљрЃцрЃарЃЌрЃ«рЃўрЃџрЃћрЃЉрЃўрЃЊрЃљрЃю рЃЊрЃљрЃгрЃДрЃћрЃЉрЃБрЃџрЃў, рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃЌ рЃЊрЃљрЃЏрЃЌрЃљрЃЋрЃарЃћрЃЉрЃБрЃџрЃў.
- **рЃљрЃарЃўрЃА рЃБрЃюрЃўрЃЋрЃћрЃарЃАрЃљрЃџрЃБрЃарЃў** рЃЊрЃљ рЃЏрЃќрЃљрЃЊ рЃљрЃарЃўрЃА рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа рЃАрЃљрЃЎрЃЮрЃЏрЃБрЃюрЃўрЃЎрЃљрЃфрЃўрЃЮ рЃърЃарЃЮрЃбрЃЮрЃЎрЃЮрЃџрЃЌрЃљрЃю (WebSocket, CoAP, HTTP) рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА.

## 2. ­ЪЈЏ№ИЈ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃърЃарЃўрЃюрЃфрЃўрЃърЃћрЃЉрЃў

- **­Ъїљ рЃБрЃюрЃўрЃЋрЃћрЃарЃАрЃљрЃџрЃБрЃарЃў "Heartbeat" рЃърЃљрЃбрЃћрЃарЃюрЃў:** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃа рЃљрЃарЃўрЃА рЃЏрЃўрЃЉрЃЏрЃБрЃџрЃў рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџ рЃърЃарЃЮрЃбрЃЮрЃЎрЃЮрЃџрЃќрЃћ. рЃўрЃА рЃБрЃАрЃЏрЃћрЃюрЃА рЃќрЃЮрЃњрЃљрЃЊ, рЃљрЃЉрЃАрЃбрЃарЃљрЃЦрЃбрЃБрЃџ `FMW_EVENT_CONNECTIVITY_ESTABLISHED` рЃўрЃЋрЃћрЃюрЃЌрЃА. рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа рЃАрЃљрЃЎрЃЮрЃЏрЃБрЃюрЃўрЃЎрЃљрЃфрЃўрЃЮ рЃЏрЃЮрЃЊрЃБрЃџрЃА рЃерЃћрЃБрЃФрЃџрЃўрЃљ рЃљрЃЏ рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃљ, рЃарЃўрЃЌрЃљрЃф Watchdog-рЃА рЃљрЃЏрЃфрЃюрЃЮрЃЉрЃА, рЃарЃЮрЃЏ "рЃЎрЃљрЃЋрЃерЃўрЃарЃў рЃфрЃЮрЃфрЃ«рЃљрЃџрЃўрЃљ".
- **­ЪДЁ рЃЏрЃарЃљрЃЋрЃљрЃџрЃерЃарЃўрЃљрЃюрЃў рЃЏрЃЮрЃюрЃўрЃбрЃЮрЃарЃўрЃюрЃњрЃў (Multi-Layered Monitoring):**
  - **рЃърЃљрЃАрЃўрЃБрЃарЃў рЃерЃарЃћ (Heartbeat):** рЃћрЃДрЃарЃЊрЃюрЃЮрЃЉрЃљ рЃАрЃ«рЃЋрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃА рЃЏрЃўрЃћрЃа рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃБрЃџ рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА.
  - **рЃљрЃЦрЃбрЃўрЃБрЃарЃў рЃерЃарЃћ (Active Probing):** рЃЌрЃљрЃЋрЃљрЃЊ рЃўрЃгрЃДрЃћрЃЉрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃЉрЃА (рЃЏрЃљрЃњ., PING), рЃарЃљрЃЌрЃљ рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃћрЃА, рЃарЃЮрЃЏ рЃЦрЃАрЃћрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃњрЃќрЃљ рЃњрЃљрЃЏрЃљрЃарЃЌрЃБрЃџрЃљрЃЊ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА.
- **РџЎ№ИЈ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃЌ рЃЏрЃљрЃарЃЌрЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ:** рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЏрЃЌрЃћрЃџрЃў рЃЦрЃфрЃћрЃЋрЃљ Рђћ рЃарЃљрЃА рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА, рЃарЃљ рЃўрЃюрЃбрЃћрЃарЃЋрЃљрЃџрЃўрЃЌ, рЃарЃљ рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљрЃЊ рЃЊрЃљ рЃарЃЮрЃњрЃЮрЃа рЃарЃћрЃљрЃњрЃўрЃарЃћрЃЉрЃА Рђћ рЃАрЃарЃБрЃџрЃљрЃЊ рЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ `system_config.json` рЃцрЃљрЃўрЃџрЃўрЃЊрЃљрЃю.
- **Рџќ№ИЈ рЃЏрЃЊрЃњрЃЮрЃЏрЃљрЃарЃћрЃЮрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ рЃЊрЃљ рЃћрЃАрЃЎрЃљрЃџрЃљрЃфрЃўрЃљ:** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃЌрЃЋрЃџрЃўрЃА рЃгрЃљрЃарЃБрЃЏрЃљрЃбрЃћрЃЉрЃћрЃџ рЃЏрЃфрЃЊрЃћрЃџрЃЮрЃЉрЃћрЃЉрЃА рЃЊрЃљ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃўрЃА рЃњрЃљрЃЏрЃгрЃЋрЃљрЃЋрЃћрЃЉрЃљрЃАрЃЌрЃљрЃю рЃћрЃарЃЌрЃљрЃЊ, рЃњрЃљрЃЊрЃљрЃЊрЃўрЃА рЃБрЃцрЃарЃЮ рЃљрЃњрЃарЃћрЃАрЃўрЃБрЃџ рЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃА рЃАрЃбрЃарЃљрЃбрЃћрЃњрЃўрЃћрЃЉрЃќрЃћ, рЃарЃљрЃф рЃўрЃфрЃљрЃЋрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃА рЃљрЃарЃљрЃАрЃљрЃГрЃўрЃарЃЮ рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃА рЃфрЃўрЃЎрЃџрЃћрЃЉрЃўрЃАрЃњрЃљрЃю.
- **­ЪцЮ рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃўрЃА рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ:** рЃўрЃА рЃљрЃарЃўрЃА рЃАрЃ«рЃЋрЃљ рЃАрЃўрЃАрЃбрЃћрЃЏрЃБрЃарЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃўрЃА рЃљрЃЦрЃбрЃўрЃБрЃарЃў рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў (`Service Consumer`), рЃарЃЮрЃњрЃЮрЃарЃўрЃфрЃљрЃљ `System Timer` (рЃърЃћрЃарЃўрЃЮрЃЊрЃБрЃџрЃў рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА) рЃЊрЃљ `System Manager` (рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃАрЃЌрЃЋрЃўрЃА).

## 3. РџЎ№ИЈ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ (`system_config.json`)

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃЦрЃфрЃћрЃЋрЃљ рЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ `layers` рЃЏрЃљрЃАрЃўрЃЋрЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃўрЃЌ. рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃў рЃљрЃЏ рЃЏрЃљрЃАрЃўрЃЋрЃерЃў рЃгрЃљрЃарЃЏрЃЮрЃљрЃЊрЃњрЃћрЃюрЃА рЃћрЃарЃЌ рЃЊрЃљрЃЏрЃЮрЃБрЃЎрЃўрЃЊрЃћрЃЉрЃћрЃџ рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљрЃА.

### 3.1. рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў

```json
{
  "type": "connectivity_watchdog",
  "enabled": true,
  "config": {
    "instance_name": "main_conn_watchdog",
    "layers": [
      {
        "type": "MQTT",
        "timeout_sec": 300,
        "actions": [
            { "on_failure_count": 1, "do": "log_warning", "message": "MQTT connection seems stale." },
            { "on_failure_count": 3, "do": "reconnect_service", "service_name": "reconnect_mqtt" },
            { "on_failure_count": 5, "do": "trigger_alarm", "alarm_name": "CriticalMQTTLost" }
        ]
      },
      {
        "type": "PING",
        "target": "8.8.8.8",
        "timeout_sec": 180,
        "actions": [
            { "on_failure_count": 2, "do": "reconnect_service", "service_name": "reconnect_wifi" },
            { "on_failure_count": 4, "do": "reboot_system", "delay_ms": 5000, "message": "Rebooting due to persistent network failure." }
        ]
      },
      {
        "type": "WEBSOCKET",
        "timeout_sec": 600,
        "actions": [
            { "on_failure_count": 2, "do": "log_warning", "message": "WebSocket connection lost." }
        ]
      }
    ]
  }
}
```

### 3.2. `layers` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ |
| :--- | :--- | :--- | :---: |
| `type` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃўрЃА рЃбрЃўрЃърЃў. рЃЏрЃ«рЃљрЃарЃЊрЃљрЃГрЃћрЃарЃўрЃџрЃўрЃљ: `MQTT`, `PING`, `WEBSOCKET` рЃЊрЃљ рЃљ.рЃе. (рЃўрЃ«рЃўрЃџрЃћрЃЌ рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ). | РюЁ |
| `timeout_sec` | рЃарЃўрЃфрЃ«рЃЋрЃў | рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃЊрЃарЃЮ рЃгрЃљрЃЏрЃћрЃЉрЃерЃў рЃЉрЃЮрЃџрЃЮ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃБрЃџ "heartbeat"-рЃАрЃљ рЃЊрЃљ рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљрЃА рЃерЃЮрЃарЃўрЃА. | РюЁ |
| `target` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃљрЃЦрЃбрЃўрЃБрЃарЃў рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА) рЃАрЃљрЃЏрЃўрЃќрЃюрЃћ рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃў, рЃЏрЃљрЃњ., IP рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃў `PING`-рЃўрЃАрЃЌрЃЋрЃўрЃА. | РЮї |
| `actions` | рЃЏрЃљрЃАрЃўрЃЋрЃў | рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃћрЃЉрЃўрЃА рЃАрЃўрЃљ, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃБрЃюрЃЊрЃљ рЃерЃћрЃАрЃарЃБрЃџрЃЊрЃћрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃАрЃљрЃА. | РюЁ |

### 3.3. `actions` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ |
| :--- | :--- | :--- | :---: |
| `on_failure_count` | рЃарЃўрЃфрЃ«рЃЋрЃў | рЃгрЃљрЃарЃБрЃЏрЃљрЃбрЃћрЃЉрЃћрЃџрЃў рЃЏрЃфрЃЊрЃћрЃџрЃЮрЃЉрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃќрЃћрЃф рЃћрЃА рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃљ рЃБрЃюрЃЊрЃљ рЃерЃћрЃАрЃарЃБрЃџрЃЊрЃћрЃА. | РюЁ |
| `do` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃерЃћрЃАрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃћрЃџрЃў рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃўрЃА рЃбрЃўрЃърЃў. | РюЁ |
| `message` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | (рЃљрЃарЃљрЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ) рЃбрЃћрЃЦрЃАрЃбрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃљрЃўрЃЉрЃћрЃГрЃЊрЃћрЃЉрЃљ `log_warning` рЃљрЃю `reboot_system` рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃўрЃАрЃљрЃА. | РЮї |
| `service_name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ `reconnect_service`-рЃЌрЃЋрЃўрЃА) рЃўрЃЏ рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃарЃЮрЃЏрЃџрЃўрЃА рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљрЃф рЃБрЃюрЃЊрЃљ рЃЏрЃЮрЃ«рЃЊрЃћрЃА. | РЮї |
| `alarm_name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ `trigger_alarm`-рЃЌрЃЋрЃўрЃА) `Alarms Manager`-рЃерЃў рЃњрЃљрЃАрЃљрЃњрЃќрЃљрЃЋрЃюрЃў рЃњрЃљрЃюрЃњрЃљрЃерЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў. | РЮї |
| `delay_ms` | рЃарЃўрЃфрЃ«рЃЋрЃў | (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ `reboot_system`-рЃЌрЃЋрЃўрЃА) рЃЊрЃљрЃДрЃЮрЃЋрЃюрЃћрЃЉрЃљ рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљрЃЏрЃЊрЃћ рЃЏрЃўрЃџрЃўрЃгрЃљрЃЏрЃћрЃЉрЃерЃў. | РЮї |

### 3.4. рЃЏрЃ«рЃљрЃарЃЊрЃљрЃГрЃћрЃарЃўрЃџрЃў `type`-рЃћрЃЉрЃў рЃЊрЃљ `do` рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃћрЃЉрЃў

| `layer.type` | рЃерЃўрЃЊрЃљ рЃџрЃЮрЃњрЃўрЃЎрЃљ | `check_name` (рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў) |
| :--- | :--- | :--- |
| `MQTT` | рЃърЃљрЃАрЃўрЃБрЃарЃў (Heartbeat) | `MQTT_Heartbeat` |
| `WEBSOCKET` | рЃърЃљрЃАрЃўрЃБрЃарЃў (Heartbeat) | `WEBSOCKET_Heartbeat` |
| `PING` | рЃљрЃЦрЃбрЃўрЃБрЃарЃў (Probing) | `PING_{target_ip}` |

| `action.do` | рЃљрЃдрЃгрЃћрЃарЃљ |
| :--- | :--- |
| `log_warning` | рЃгрЃћрЃарЃА рЃњрЃљрЃцрЃарЃЌрЃ«рЃўрЃџрЃћрЃЉрЃљрЃА рЃџрЃЮрЃњрЃерЃў. |
| `reconnect_service` | рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃА рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃЌ. |
| `trigger_alarm` | рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃА `Alarms Manager`-рЃўрЃАрЃЌрЃЋрЃўрЃА. |
| `reboot_system` | рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃљрЃЋрЃА рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃА. |

## 4. ­Ъћї Service API

рЃћрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃўрЃА рЃАрЃБрЃцрЃЌрЃљ **Service Consumer** рЃЊрЃљ рЃљрЃа рЃљрЃгрЃЋрЃЊрЃўрЃА рЃАрЃљрЃЎрЃБрЃЌрЃљрЃа Service API-рЃА рЃАрЃ«рЃЋрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃА. рЃЏрЃўрЃАрЃў рЃЏрЃљрЃарЃЌрЃЋрЃљ рЃ«рЃЊрЃћрЃЉрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃЌ рЃЊрЃљ рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃўрЃЌ.

## 5. ­ЪЊб рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃўрЃА рЃБрЃюрЃўрЃЋрЃћрЃарЃАрЃљрЃџрЃБрЃарЃў рЃЏрЃЮрЃЊрЃћрЃџрЃў

`Connectivity Watchdog`-рЃўрЃА рЃБрЃюрЃўрЃЋрЃћрЃарЃАрЃљрЃџрЃБрЃарЃЮрЃЉрЃўрЃА рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃў рЃљрЃарЃўрЃА `FMW_EVENT_CONNECTIVITY_ESTABLISHED` рЃўрЃЋрЃћрЃюрЃЌрЃў.

- **рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў:** `FMW_EVENT_CONNECTIVITY_ESTABLISHED`
- **Payload-рЃўрЃА рЃбрЃўрЃърЃў:** `fmw_connectivity_payload_t`
- **Payload-рЃўрЃА рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃў:** `char check_name[32];`

рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃЏрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃЏрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф рЃАрЃБрЃарЃА Watchdog-рЃА "рЃБрЃЌрЃ«рЃарЃљрЃА", рЃарЃЮрЃЏ рЃўрЃА "рЃфрЃЮрЃфрЃ«рЃљрЃџрЃўрЃљ", рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃљрЃЦрЃЋрЃћрЃДрЃюрЃЮрЃА рЃћрЃА рЃўрЃЋрЃћрЃюрЃЌрЃў рЃЊрЃљ `payload`-рЃерЃў рЃЏрЃўрЃБрЃЌрЃўрЃЌрЃЮрЃА рЃўрЃЏ рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљрЃерЃўрЃљ рЃњрЃљрЃюрЃАрЃљрЃќрЃдрЃЋрЃарЃБрЃџрЃў.

### 5.1. MQTT рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ

`mqtt_manager.c`-рЃерЃў, `MQTT_EVENT_CONNECTED` рЃЦрЃћрЃўрЃАрЃерЃў:

```c
// ...
fmw_connectivity_payload_t *payload = malloc(sizeof(fmw_connectivity_payload_t));
if (payload) {
    snprintf(payload->check_name, sizeof(payload->check_name), "MQTT_Heartbeat");
    // ... рЃерЃћрЃцрЃБрЃЌрЃЋрЃљ рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃљ ...
}
// ...
```

### 5.2. WebSocket рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА (рЃ░рЃўрЃърЃЮрЃЌрЃћрЃбрЃБрЃарЃў) рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ

рЃгрЃљрЃарЃЏрЃЮрЃЋрЃўрЃЊрЃњрЃўрЃюрЃЮрЃЌ, рЃњрЃЋрЃљрЃЦрЃЋрЃА `websocket_manager`. рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃўрЃА рЃЊрЃљрЃљрЃЏрЃДрЃљрЃарЃћрЃЉрЃА рЃЎрЃљрЃЋрЃерЃўрЃарЃА, рЃўрЃАрЃўрЃф рЃўрЃњрЃўрЃЋрЃћрЃА рЃњрЃљрЃљрЃЎрЃћрЃЌрЃћрЃЉрЃА:

```c
// In websocket_manager.c, on successful connection:
fmw_connectivity_payload_t *payload = malloc(sizeof(fmw_connectivity_payload_t));
if (payload) {
    snprintf(payload->check_name, sizeof(payload->check_name), "WEBSOCKET_Heartbeat");
    // ... рЃерЃћрЃцрЃБрЃЌрЃЋрЃљ рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃљ ...
}
```

### 5.3. PING рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃўрЃА рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ

`connectivity_watchdog.c`-рЃўрЃА рЃерЃўрЃњрЃюрЃўрЃЌ, `ping_check_cb` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў рЃљрЃЎрЃћрЃЌрЃћрЃЉрЃА рЃўрЃњрЃўрЃЋрЃћрЃА:

```c
// In connectivity_watchdog.c, inside ping_check_cb:
fmw_connectivity_payload_t *payload = malloc(sizeof(fmw_connectivity_payload_t));
if (payload) {
    snprintf(payload->check_name, sizeof(payload->check_name), "PING_%s", check_cfg->target);
    // ... рЃерЃћрЃцрЃБрЃЌрЃЋрЃљ рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃљ ...
}
```

## 6. РЮЌ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃћрЃЉрЃў

- **`init_level`:** рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА `init_level` (`40`) рЃЎрЃарЃўрЃбрЃўрЃЎрЃБрЃџрЃўрЃљ. рЃўрЃА рЃБрЃюрЃЊрЃљ рЃњрЃљрЃћрЃерЃЋрЃљрЃА `System Timer`-рЃўрЃА (`35`) рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃЏрЃљрЃњрЃарЃљрЃЏ рЃўрЃЏ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃљрЃЏрЃЊрЃћ, рЃарЃЮрЃЏрЃћрЃџрЃЌрЃљ рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃАрЃљрЃф рЃўрЃА рЃБрЃАрЃЏрЃћрЃюрЃА.
- **рЃЊрЃљрЃЏрЃЮрЃЎрЃўрЃЊрЃћрЃЉрЃБрЃџрЃћрЃЉрЃћрЃЉрЃў:** `CMakeLists.txt`-рЃерЃў, `REQUIRES` рЃАрЃћрЃЦрЃфрЃўрЃљрЃерЃў рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџрЃў `interfaces`, рЃарЃљрЃЌрЃљ рЃЏрЃљрЃА рЃ░рЃЦрЃЮрЃюрЃЊрЃћрЃА рЃгрЃЋрЃЊрЃЮрЃЏрЃљ рЃАрЃ«рЃЋрЃљ рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃўрЃА API рЃЎрЃЮрЃюрЃбрЃарЃљрЃЦрЃбрЃћрЃЉрЃќрЃћ.
- **рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃљ:** `reboot_system` рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЌ рЃАрЃўрЃцрЃарЃЌрЃ«рЃўрЃџрЃўрЃЌ. рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃўрЃЌ, рЃарЃЮрЃЏ `on_failure_count` рЃЊрЃљ `timeout_sec` рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў рЃАрЃгрЃЮрЃарЃљрЃЊ рЃљрЃарЃўрЃА рЃерЃћрЃарЃЕрЃћрЃБрЃџрЃў, рЃарЃљрЃЌрЃљ рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃљрЃўрЃфрЃўрЃџрЃЮрЃЌ рЃљрЃарЃљрЃАрЃљрЃАрЃБрЃарЃЋрЃћрЃџрЃў рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃА рЃфрЃўрЃЎрЃџрЃћрЃЉрЃў.
