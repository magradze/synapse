# áƒ›áƒáƒ“áƒ£áƒšáƒ˜: Health Monitor

## 1. áƒ›áƒ˜áƒ›áƒáƒ®áƒ˜áƒšáƒ•áƒ

**áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜:** `health_monitor`  
**áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ:** `system`  
**áƒ•áƒ”áƒ áƒ¡áƒ˜áƒ:** 1.0.0  
**áƒáƒ•áƒ¢áƒáƒ áƒ˜:** Synapse Framework Team

`Health Monitor` áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ áƒ˜áƒ¡ Synapse Framework-áƒ˜áƒ¡ áƒ¡áƒáƒ¡áƒ˜áƒªáƒáƒªáƒ®áƒšáƒáƒ“ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜ áƒ™áƒáƒ›áƒžáƒáƒœáƒ”áƒœáƒ¢áƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ£áƒ–áƒ áƒ£áƒœáƒ•áƒ”áƒšáƒ§áƒáƒ¤áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ›áƒ“áƒ’áƒ áƒáƒ“áƒáƒ‘áƒ˜áƒ¡, áƒ¡áƒáƒ˜áƒ›áƒ”áƒ“áƒáƒáƒ‘áƒ˜áƒ¡áƒ áƒ“áƒ áƒ—áƒ•áƒ˜áƒ—áƒ“áƒ˜áƒáƒ’áƒœáƒáƒ¡áƒ¢áƒ˜áƒ™áƒ˜áƒ¡ áƒ›áƒ”áƒ¥áƒáƒœáƒ˜áƒ–áƒ›áƒ”áƒ‘áƒ¡ áƒ áƒ”áƒáƒšáƒ£áƒ  áƒ“áƒ áƒáƒ¨áƒ˜. áƒ˜áƒ¡ áƒ›áƒ£áƒ“áƒ›áƒ˜áƒ•áƒáƒ“ áƒáƒ™áƒ•áƒ˜áƒ áƒ“áƒ”áƒ‘áƒ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒš áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ¡, áƒ áƒáƒ’áƒáƒ áƒ˜áƒªáƒáƒ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ áƒ“áƒ áƒ¢áƒáƒ¡áƒ™áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ“áƒ’áƒáƒ›áƒáƒ áƒ”áƒáƒ‘áƒ, áƒáƒ¦áƒ›áƒáƒáƒ©áƒ”áƒœáƒ¡ áƒáƒœáƒáƒ›áƒáƒšáƒ˜áƒ”áƒ‘áƒ¡ áƒ“áƒ áƒáƒ®áƒ“áƒ”áƒœáƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ‘áƒáƒ›áƒ˜áƒ¡ áƒ áƒ”áƒáƒ’áƒ˜áƒ áƒ”áƒ‘áƒáƒ¡ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ˜áƒ—.

## 2. áƒ¬áƒ˜áƒœáƒáƒžáƒ˜áƒ áƒáƒ‘áƒ”áƒ‘áƒ˜ áƒ“áƒ `menuconfig`

áƒáƒ› áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡, áƒ’áƒáƒœáƒ¡áƒáƒ™áƒ£áƒ—áƒ áƒ”áƒ‘áƒ˜áƒ— áƒ¢áƒáƒ¡áƒ™áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜áƒ¡ áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡, áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ ESP-IDF-áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒáƒ¨áƒ˜ (`menuconfig`) áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜ áƒáƒ¤áƒªáƒ˜áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ:

1. áƒ’áƒáƒ£áƒ¨áƒ•áƒ˜áƒ— `idf.py menuconfig`.
2. áƒ’áƒáƒ“áƒáƒ“áƒ˜áƒ— `Component config` ---> `FreeRTOS` ---> `Kernel`.
3. áƒ©áƒáƒ áƒ—áƒ”áƒ— (`[y]`) áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜ áƒáƒ áƒ˜ áƒáƒ¤áƒªáƒ˜áƒ:
    * `Enable FreeRTOS-specific stats formatting`
    * `Enable generation of run time stats`

**áƒ’áƒáƒ¤áƒ áƒ—áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ:** áƒáƒ› áƒáƒ¤áƒªáƒ˜áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ’áƒáƒ áƒ”áƒ¨áƒ”, `uxTaskGetSystemState` áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ áƒáƒ  áƒ˜áƒ¥áƒœáƒ”áƒ‘áƒ áƒ®áƒ”áƒšáƒ›áƒ˜áƒ¡áƒáƒ¬áƒ•áƒ“áƒáƒ›áƒ˜ áƒ“áƒ áƒžáƒ áƒáƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ™áƒáƒ›áƒžáƒ˜áƒšáƒáƒªáƒ˜áƒ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ”áƒ‘áƒ `undefined reference` áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ˜áƒ—.

## 3. áƒáƒ áƒ¥áƒ˜áƒ¢áƒ”áƒ¥áƒ¢áƒ£áƒ áƒ£áƒšáƒ˜ áƒžáƒ áƒ˜áƒœáƒªáƒ˜áƒžáƒ”áƒ‘áƒ˜

* **áƒžáƒ”áƒ áƒ˜áƒáƒ“áƒ£áƒšáƒ˜ áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜:** áƒ›áƒáƒ“áƒ£áƒšáƒ¡ áƒáƒ¥áƒ•áƒ¡ áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ áƒ˜ FreeRTOS áƒ¢áƒáƒ¡áƒ™áƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒ˜áƒ áƒ”áƒ‘áƒáƒ“áƒ˜ áƒ˜áƒœáƒ¢áƒ”áƒ áƒ•áƒáƒšáƒ˜áƒ— áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ "áƒžáƒ£áƒšáƒ¡áƒ¡".
* **áƒ–áƒ¦áƒ•áƒ áƒ£áƒšáƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ”áƒ‘áƒ˜ (Thresholds):** áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ¨ áƒ›áƒ§áƒáƒ¤ áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ¡ áƒáƒ¥áƒ•áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒ˜áƒ áƒ”áƒ‘áƒáƒ“áƒ˜ áƒ–áƒ¦áƒ•áƒ áƒ£áƒšáƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ.
* **áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ–áƒ” áƒ“áƒáƒ¤áƒ£áƒ«áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ áƒ”áƒáƒ’áƒ˜áƒ áƒ”áƒ‘áƒ:** áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ˜áƒ¡ áƒáƒ¦áƒ›áƒáƒ©áƒ”áƒœáƒ˜áƒ¡áƒáƒ¡, áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ¡ `SYSTEM_HEALTH_ALERT` áƒ˜áƒ•áƒ”áƒœáƒ—áƒ¡ Event Bus-áƒ–áƒ”.
* **áƒ’áƒáƒ¤áƒáƒ áƒ—áƒáƒ”áƒ‘áƒáƒ“áƒáƒ‘áƒ:** áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒáƒ— áƒ“áƒáƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒáƒœ áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ áƒ˜ "áƒ¯áƒáƒœáƒ›áƒ áƒ—áƒ”áƒšáƒáƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡" áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜.
* **Service-driven:** áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ¬áƒ•áƒ“áƒ˜áƒ¡ `health_api_t` áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ¡ `Service Locator`-áƒ˜áƒ¡ áƒ›áƒ”áƒ¨áƒ•áƒ”áƒáƒ‘áƒ˜áƒ—.

## 4. áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ

áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ áƒ®áƒ“áƒ”áƒ‘áƒ `system_config.json` áƒ¤áƒáƒ˜áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ”áƒ‘áƒ˜áƒ—.

**áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜:**

```json
{
    "type": "health_monitor",
    "enabled": true,
    "config": {
        "instance_name": "main_health_monitor",
        "check_interval_sec": 60,
        "thresholds": {
            "min_free_heap_kb": 40,
            "task_stack_watermark_percent": 90
        }
    }
}
```

**áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜:**

| áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜ | áƒ¢áƒ˜áƒžáƒ˜ | áƒáƒ¦áƒ¬áƒ”áƒ áƒ | áƒ¡áƒáƒ•áƒáƒšáƒ“áƒ”áƒ‘áƒ£áƒšáƒ | Default |
|:---|:---|:---|:---:|:---|
| `instance_name` | áƒ¡áƒ¢áƒ áƒ˜áƒ¥áƒáƒœáƒ˜ | áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ˜áƒœáƒ¡áƒ¢áƒáƒœáƒªáƒ˜áƒ˜áƒ¡ áƒ£áƒœáƒ˜áƒ™áƒáƒšáƒ£áƒ áƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜. | âŒ | `main_health_monitor`|
| `check_interval_sec` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ˜áƒœáƒ¢áƒ”áƒ áƒ•áƒáƒšáƒ˜ áƒ¬áƒáƒ›áƒ”áƒ‘áƒ¨áƒ˜. | âŒ | `30` |
| `thresholds` | áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜ | áƒ–áƒ¦áƒ•áƒ áƒ£áƒšáƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¢áƒ”áƒ˜áƒœáƒ”áƒ áƒ˜. | âŒ | - |
| `thresholds.min_free_heap_kb` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒáƒšáƒ˜ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ˜áƒœáƒ˜áƒ›áƒáƒšáƒ£áƒ áƒ˜ áƒ–áƒ¦áƒ•áƒáƒ áƒ˜ áƒ™áƒ˜áƒšáƒáƒ‘áƒáƒ˜áƒ¢áƒ”áƒ‘áƒ¨áƒ˜. | âŒ | `50` |
| `thresholds.task_stack_watermark_percent` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ¢áƒáƒ¡áƒ™áƒ˜áƒ¡ áƒ¡áƒ¢áƒ”áƒ™áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ¥áƒ¡áƒ˜áƒ›áƒáƒšáƒ£áƒ áƒ˜ áƒ–áƒ¦áƒ•áƒáƒ áƒ˜ áƒžáƒ áƒáƒªáƒ”áƒœáƒ¢áƒ”áƒ‘áƒ¨áƒ˜. | âŒ | `85` |

## 5. Service API (`health_api_t`)

áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒáƒ— áƒ›áƒ˜áƒ˜áƒ¦áƒáƒœ áƒ¬áƒ•áƒ“áƒáƒ›áƒ `Health Monitor`-áƒ˜áƒ¡ API-áƒ–áƒ” `Service Locator`-áƒ˜áƒ¡ áƒ›áƒ”áƒ¨áƒ•áƒ”áƒáƒ‘áƒ˜áƒ—. áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ áƒ¢áƒ˜áƒžáƒ˜: `FMW_SERVICE_TYPE_HEALTH_API`.

**API áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜:**

* **`esp_err_t get_system_health_report(cJSON **report);`**  
  áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ¯áƒáƒœáƒ›áƒ áƒ—áƒ”áƒšáƒáƒ‘áƒ˜áƒ¡ áƒ¡áƒ áƒ£áƒš áƒ áƒ”áƒžáƒáƒ áƒ¢áƒ¡ cJSON áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ˜áƒ—. áƒ áƒ”áƒžáƒáƒ áƒ¢áƒ˜ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒáƒ¡ áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡, uptime-áƒ˜áƒ¡áƒ áƒ“áƒ áƒ§áƒ•áƒ”áƒšáƒ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ¢áƒáƒ¡áƒ™áƒ˜áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘. **áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜áƒ:** áƒ’áƒáƒ›áƒáƒ›áƒ«áƒáƒ®áƒ”áƒ‘áƒ”áƒšáƒ›áƒ áƒ£áƒœáƒ“áƒ áƒ’áƒáƒáƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒšáƒáƒ¡ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ `cJSON` áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜ `cJSON_Delete()`-áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ˜áƒ—.

* **`esp_err_t register_custom_check(const char* check_name, health_check_fn_t check_fn, void* context);`**  
  áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒáƒ®áƒáƒš, áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ›áƒ˜áƒ”áƒ  áƒ’áƒáƒœáƒ¡áƒáƒ–áƒ¦áƒ•áƒ áƒ£áƒš áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ¡. áƒ”áƒ¡ áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ”áƒ‘áƒáƒ¡ áƒáƒ«áƒšáƒ”áƒ•áƒ¡ áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡, áƒ©áƒáƒ áƒ—áƒáƒœ áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ áƒ˜ áƒšáƒáƒ’áƒ˜áƒ™áƒ `Health Monitor`-áƒ˜áƒ¡ áƒžáƒ”áƒ áƒ˜áƒáƒ“áƒ£áƒš áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ”áƒ‘áƒ¨áƒ˜.

* **`esp_err_t unregister_custom_check(const char* check_name);`**  
  áƒ¨áƒšáƒ˜áƒ¡ áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒš áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒáƒ¡. (áƒáƒ›áƒŸáƒáƒ›áƒáƒ“ áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ˜áƒ›áƒžáƒšáƒ”áƒ›áƒ”áƒœáƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜).

## 6. áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜

* **`SYSTEM_HEALTH_ALERT`**
  * **áƒ áƒáƒ“áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ§áƒœáƒ“áƒ”áƒ‘áƒ:** áƒ áƒáƒ“áƒ”áƒ¡áƒáƒª áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒ›áƒ” áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ¨ áƒ›áƒ§áƒáƒ¤áƒ˜ áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜ áƒ’áƒáƒ“áƒáƒ¡áƒªáƒ“áƒ”áƒ‘áƒ áƒ“áƒáƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ£áƒš áƒ–áƒ¦áƒ•áƒáƒ áƒ¡.
  * **Payload (cJSON áƒ¡áƒ¢áƒ áƒ˜áƒ¥áƒáƒœáƒ˜):**
    * **áƒ›áƒ”áƒ®áƒ¡áƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ:** `{"alert_type":"LOW_HEAP_MEMORY", "value_kb":35}`
    * **áƒ¡áƒ¢áƒ”áƒ™áƒ˜áƒ¡ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ:** `{"alert_type":"HIGH_STACK_USAGE", "task_name":"some_task", "usage_percent":92}`
    * **Custom áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ:** `{"alert_type":"CUSTOM_CHECK_FAILED", "check_name":"my_db_check"}`

## 7. ðŸ’¡ áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜

`ota_update_module`-áƒ¡ áƒ¡áƒ£áƒ áƒ¡, áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒáƒ›áƒ“áƒ” áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒáƒ¡, áƒáƒ áƒ˜áƒ¡ áƒ—áƒ£ áƒáƒ áƒ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒáƒ¨áƒ˜ áƒ¡áƒáƒ™áƒ›áƒáƒ áƒ˜áƒ¡áƒ˜ áƒ áƒ”áƒ¡áƒ£áƒ áƒ¡áƒ˜.

```c
#include "service_locator.h"
#include "health_interface.h" // áƒžáƒ˜áƒ áƒáƒ‘áƒ˜áƒ—áƒ˜ áƒ˜áƒœáƒ¢áƒ”áƒ áƒ¤áƒ”áƒ˜áƒ¡áƒ˜áƒ¡ áƒ¤áƒáƒ˜áƒšáƒ˜

void start_ota_if_healthy() {
    service_handle_t handle = fmw_service_get("main_health_monitor");
    if (!handle) {
        ESP_LOGW(TAG, "Health Monitor service not found. Skipping health check.");
        // ... áƒ’áƒáƒœáƒáƒ’áƒ áƒ«áƒ” OTA ...
        return;
    }

    health_api_t *health_api = (health_api_t *)handle;
    cJSON *report = NULL;
    
    if (health_api->get_system_health_report(&report) == ESP_OK && report) {
        const cJSON *heap = cJSON_GetObjectItem(report, "min_free_heap_bytes");
        if (cJSON_IsNumber(heap) && heap->valueint < 80000) { // áƒ—áƒ£ 80KB-áƒ–áƒ” áƒœáƒáƒ™áƒšáƒ”áƒ‘áƒ˜áƒ
            ESP_LOGE(TAG, "Not enough memory for OTA update. Aborting.");
            cJSON_Delete(report);
            return;
        }
        cJSON_Delete(report);
    }

    // ... áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ áƒ¯áƒáƒœáƒ›áƒ áƒ—áƒ”áƒšáƒ˜áƒ, áƒ•áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ— OTA-áƒ¡ ...
}
```
