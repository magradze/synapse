# Synapse Assertions & Guards API Reference

## ­Ъј» рЃЏрЃўрЃќрЃљрЃюрЃў

рЃћрЃА рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃў рЃљрЃдрЃгрЃћрЃарЃА `synapse_assert.h` рЃЊрЃљ `synapse_utils.h`-рЃерЃў рЃњрЃљрЃюрЃАрЃљрЃќрЃдрЃЋрЃарЃБрЃџрЃў рЃЏрЃљрЃЎрЃарЃЮрЃћрЃЉрЃўрЃА API-рЃА, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃњрЃљрЃюрЃЎрЃБрЃЌрЃЋрЃюрЃўрЃџрЃўрЃљ рЃЎрЃЮрЃЊрЃўрЃА рЃЏрЃЊрЃњрЃарЃљрЃЊрЃЮрЃЉрЃўрЃА рЃњрЃљрЃАрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃџрЃљрЃЊ.

- **Assertions (`SYNAPSE_ASSERT`):** рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃўрЃАрЃбрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃўрЃА рЃљрЃдрЃЏрЃЮрЃАрЃљрЃЕрЃћрЃюрЃљрЃЊ рЃЊрЃћрЃЋрЃћрЃџрЃЮрЃърЃЏрЃћрЃюрЃбрЃўрЃА рЃцрЃљрЃќрЃљрЃерЃў.
- **Guards (`SYNAPSE_GUARD`):** рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ `runtime` рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃўрЃА рЃџрЃљрЃЎрЃЮрЃюрЃБрЃарЃў рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА.

рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃЌрЃБ **рЃарЃЮрЃЊрЃўрЃА** рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃЮрЃЌ рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЏрЃљрЃЌрЃњрЃљрЃюрЃў, рЃўрЃ«рЃўрЃџрЃћрЃЌ [Assertions рЃЊрЃљ Guard Clauses рЃЎрЃЮрЃюрЃЋрЃћрЃюрЃфрЃўрЃљ](../convention/assertion_and_guards.md).

---

## 1. Assertion API (`synapse_assert.h`)

рЃћрЃА рЃЏрЃљрЃЎрЃарЃЮ рЃљрЃЦрЃбрЃўрЃБрЃарЃўрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЏрЃљрЃерЃўрЃю, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф `menuconfig`-рЃерЃў рЃЕрЃљрЃарЃЌрЃБрЃџрЃўрЃљ `CONFIG_SYNAPSE_ENABLE_ASSERTS` рЃЮрЃцрЃфрЃўрЃљ. `release` рЃЉрЃўрЃџрЃЊрЃћрЃЉрЃерЃў рЃўрЃА рЃљрЃарЃљрЃюрЃљрЃўрЃа рЃЎрЃЮрЃЊрЃА рЃљрЃа рЃљрЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃА.

### `SYNAPSE_ASSERT(condition, format, ...)`

рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃърЃўрЃарЃЮрЃЉрЃљрЃА (`condition`). рЃЌрЃБ рЃърЃўрЃарЃЮрЃЉрЃљ рЃЏрЃфрЃЊрЃљрЃарЃўрЃљ (`false`), рЃўрЃА рЃЉрЃћрЃГрЃЊрЃљрЃЋрЃА рЃцрЃЮрЃарЃЏрЃљрЃбрЃўрЃарЃћрЃЉрЃБрЃџ рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљрЃА, рЃцрЃљрЃўрЃџрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃА, рЃ«рЃљрЃќрЃўрЃА рЃюрЃЮрЃЏрЃћрЃарЃА рЃЊрЃљ рЃЊрЃљрЃБрЃДрЃЮрЃЋрЃюрЃћрЃЉрЃџрЃўрЃЋ рЃљрЃЕрЃћрЃарЃћрЃЉрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљрЃА (`panic`).

- **`condition`**: рЃерЃћрЃАрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃњрЃљрЃЏрЃЮрЃАрЃљрЃ«рЃБрЃџрЃћрЃЉрЃљ. рЃЌрЃБ `true`-рЃљ, рЃљрЃарЃљрЃцрЃћрЃарЃў рЃ«рЃЊрЃћрЃЉрЃљ.
- **`format`**: `printf`-рЃўрЃА рЃАрЃбрЃўрЃџрЃўрЃА рЃцрЃЮрЃарЃЏрЃљрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃљрЃдрЃгрЃћрЃарЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљрЃА.
- **`...`**: (рЃљрЃарЃљрЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ) рЃфрЃЋрЃџрЃљрЃЊрЃў рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃў `format` рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА.

**рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```c
void process_user(user_t *user) {
    // рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА, рЃарЃЮрЃЏ user рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃў рЃљрЃа рЃљрЃарЃўрЃА NULL.
    // рЃЌрЃБ NULL-рЃўрЃљ, рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃњрЃљрЃЕрЃћрЃарЃЊрЃћрЃЉрЃљ рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃўрЃЌ:
    // "SYNAPSE_ASSERT FAILED: .../my_module.c:42: User pointer cannot be NULL"
    SYNAPSE_ASSERT(user != NULL, "User pointer cannot be NULL");

    // рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА, рЃарЃЮрЃЏ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА ID рЃЋрЃљрЃџрЃўрЃЊрЃБрЃарЃўрЃљ.
    SYNAPSE_ASSERT(user->id > 0, "Invalid user ID: %d", user->id);
}
```

---

## 2. Guard Clause API (`synapse_utils.h`)

рЃћрЃА рЃЏрЃљрЃЎрЃарЃЮрЃћрЃЉрЃў рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА рЃљрЃЦрЃбрЃўрЃБрЃарЃўрЃљ рЃЊрЃљ рЃгрЃљрЃарЃЏрЃЮрЃљрЃЊрЃњрЃћрЃюрЃА `if-return` рЃЉрЃџрЃЮрЃЎрЃћрЃЉрЃўрЃА рЃЎрЃЮрЃЏрЃърЃљрЃЦрЃбрЃБрЃа рЃљрЃџрЃбрЃћрЃарЃюрЃљрЃбрЃўрЃЋрЃљрЃА.

### `SYNAPSE_GUARD(condition, tag, ret_val, format, ...)`

рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃърЃўрЃарЃЮрЃЉрЃљрЃА (`condition`). рЃЌрЃБ рЃърЃўрЃарЃЮрЃЉрЃљ рЃЏрЃфрЃЊрЃљрЃарЃўрЃљ, рЃўрЃА `ESP_LOGE`-рЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ рЃЉрЃћрЃГрЃЊрЃљрЃЋрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃА рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљрЃА рЃЊрЃљ рЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА `return ret_val;`-рЃА.

- **`condition`**: рЃерЃћрЃАрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃњрЃљрЃЏрЃЮрЃАрЃљрЃ«рЃБрЃџрЃћрЃЉрЃљ.
- **`tag`**: рЃњрЃљрЃЏрЃЮрЃЏрЃФрЃљрЃ«рЃћрЃЉрЃћрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃџрЃЮрЃњрЃўрЃарЃћрЃЉрЃўрЃА `TAG`.
- **`ret_val`**: рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃБрЃюрЃЊрЃљ рЃЊрЃљрЃЉрЃарЃБрЃюрЃЊрЃћрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃЊрЃљрЃю, рЃЌрЃБ рЃърЃўрЃарЃЮрЃЉрЃљ рЃЏрЃфрЃЊрЃљрЃарЃўрЃљ (рЃЏрЃљрЃњ., `ESP_ERR_INVALID_ARG`, `NULL`, `false`).
- **`format`**: `printf`-рЃўрЃА рЃАрЃбрЃўрЃџрЃўрЃА рЃцрЃЮрЃарЃЏрЃљрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў рЃџрЃЮрЃњрЃўрЃАрЃЌрЃЋрЃўрЃА.
- **`...`**: (рЃљрЃарЃљрЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ) рЃфрЃЋрЃџрЃљрЃЊрЃў рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃў `format` рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА.

**рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```c
esp_err_t send_data(data_packet_t *packet) {
    // рЃЌрЃБ packet рЃљрЃарЃўрЃА NULL, рЃЊрЃљрЃўрЃЉрЃћрЃГрЃЊрЃћрЃЉрЃљ Error рЃџрЃЮрЃњрЃў рЃЊрЃљ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃЊрЃљрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА ESP_ERR_INVALID_ARG-рЃА.
    SYNAPSE_GUARD(packet != NULL, TAG, ESP_ERR_INVALID_ARG, "Data packet is NULL, cannot send.");

    // ... рЃЊрЃљрЃюрЃљрЃарЃЕрЃћрЃюрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ ...
    return ESP_OK;
}
```

### `SYNAPSE_GUARD_VOID(condition, tag, format, ...)`

`SYNAPSE_GUARD`-рЃўрЃА рЃЋрЃћрЃарЃАрЃўрЃљ рЃўрЃЏ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃћрЃю `void`-рЃА. рЃЌрЃБ рЃърЃўрЃарЃЮрЃЉрЃљ рЃЏрЃфрЃЊрЃљрЃарЃўрЃљ, рЃўрЃА рЃЉрЃћрЃГрЃЊрЃљрЃЋрЃА рЃџрЃЮрЃњрЃА рЃЊрЃљ рЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА `return;`-рЃА.

- **рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў:** рЃўрЃњрЃўрЃЋрЃћрЃљ, рЃарЃљрЃф `SYNAPSE_GUARD`-рЃўрЃА, `ret_val`-рЃўрЃА рЃњрЃљрЃарЃЊрЃљ.

**рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```c
void update_led(led_handle_t *led) {
    // рЃЌрЃБ led рЃљрЃарЃўрЃА NULL, рЃЊрЃљрЃўрЃЉрЃћрЃГрЃЊрЃћрЃЉрЃљ Error рЃџрЃЮрЃњрЃў рЃЊрЃљ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃЊрЃљрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљрЃА.
    SYNAPSE_GUARD_VOID(led != NULL, TAG, "LED handle is NULL, cannot update.");

    // ... рЃЊрЃљрЃюрЃљрЃарЃЕрЃћрЃюрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ ...
}
```
