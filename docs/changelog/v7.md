## [7.2.0] - 2025-08-28

### ✨ არქიტექტურული გაუმჯობესებები (Architectural Improvements)

- **feat(core):** 🚀 დაინერგა უსაფრთხო, `dependency_map`-ზე დაფუძნებული **Dependency Injection** მექანიზმი.
  - **უსაფრთხო ინექცია:** `System Manager` ახლა იყენებს მოდულის მიერ მოწოდებულ `dependency_map`-ს, რათა `offsetof()`-ის მეშვეობით ზუსტად და უსაფრთხოდ ჩაწეროს სერვისის `handle`-ი `private_data` სტრუქტურის სწორ ველში. ეს სრულად აღმოფხვრის მეხსიერების კორუფციის რისკს.
  - **გაშვების ლოგიკის ოპტიმიზაცია:** `synapse_system_start` ფუნქციის ლოგიკა დაიხვეწა, რათა ინექცია და ინიციალიზაცია ხდებოდეს ერთ, თანმიმდევრულ ციკლში, `init_level`-ის პრიორიტეტის სრული დაცვით.

### 🔄 შეცვლილი და გაუმჯობესებული (Changed & Improved)

- **refactor(ui_manager):** 🧠 `ui_manager` მოდული სრულად გადაკეთდა და ახლა იყენებს **გამოყოფილ FreeRTOS ტასკს** UI-ს ლოგიკის დასამუშავებლად.
  - **Stack Overflow-ს აღმოფხვრა:** მენიუს აგების და ეკრანის განახლების "მძიმე" ოპერაციები აღარ ეშვება `Tmr Svc` ტასკის კონტექსტიდან. ამის ნაცვლად, `Event Handler`-ი აგზავნის ბრძანებას `ui_task`-ის რიგში, რაც სრულად აგვარებს სისტემის კრახის პრობლემას.
- **refactor(wifi_manager):** 📶 `wifi_manager` მოდული, `ui_manager`-ის მსგავსად, გადაკეთდა გამოყოფილი ტასკის გამოსაყენებლად.
  - **კავშირის მართვის გაუმჯობესება:** `esp_wifi_connect` და სხვა ბლოკირებადი ოპერაციები ახლა სრულდება `wifi_task`-ის კონტექსტში, რაც აუმჯობესებს სისტემის მდგრადობას და ხსნის `Stack Overflow`-ს რისკს ხელახალი დაკავშირების ციკლის დროს.
- **perf(core, ui, wifi):** ⚡️ განხორციელდა მეხსიერების მართვის მნიშვნელოვანი ოპტიმიზაცია ხშირად გამოძახებად ფუნქციებში.
  - **Heap ფრაგმენტაციის შემცირება:** `wifi_cmd_handler`-სა და `ui_events_handle`-ში დინამიური მეხსიერების გამოყოფა ჩანაცვლდა სტატიკური ბუფერების გამოყენებით.
  - **მეხსიერების გაჟონვის აღმოფხვრა:** გასწორდა `Event Wrapper`-ის ლოგიკა, რათა მან კორექტულად დაამუშაოს სტატიკური `payload`-ები და თავიდან აიცილოს `free()`-ს არასწორი გამოძახება.

### 🐛 შესწორებები (Bug Fixes)

- **fix(core):** 🐞 აღმოიფხვრა კრიტიკული `Guru Meditation Error (LoadProhibited)` და `assert failed: heap_caps_free` შეცდომები, რომლებიც გამოწვეული იყო მეხსიერების არასწორი მართვით `System Manager`-სა და `Event Bus`-ში.
- **fix(modules):** 🔧 განახლდა ყველა მოდული, რომელიც იყენებს სერვისებზე დამოკიდებულებას (`button_input`, `relay_actuator`, `rgb_led_indicator` და ა.შ.), რათა მათ მოახდინონ `dependency_map`-ის დეკლარირება და გამოიყენონ ინექცირებული `handle`-ები.

### 📄 დოკუმენტაცია (Documentation)

- **docs(core, convention):** ✍️ განახლდა `base_module.h`, `system_manager.c`, `module_structure.md` და შეიქმნა `dependency_injection.md` დოკუმენტი, რათა სრულად აისახოს ახალი, `dependency_map`-ზე დაფუძნებული ინექციის მექანიზმი.

---

## [7.1.0] - 2025-08-27

### ✨ გაუმჯობესებები (Improvements)

- **refactor(core):** 🚀 დაინერგა უსაფრთხო, `dependency_map`-ზე დაფუძნებული **Dependency Injection** მექანიზმი.
  - **უსაფრთხო ინექცია:** `System Manager` ახლა იყენებს მოდულის მიერ მოწოდებულ `dependency_map`-ს, რათა `offsetof()`-ის მეშვეობით ზუსტად და უსაფრთხოდ ჩაწეროს სერვისის `handle`-ი `private_data` სტრუქტურის სწორ ველში. ეს სრულად აღმოფხვრის მეხსიერების კორუფციის რისკს, რომელიც წინა, კონვენციაზე დაფუძნებულმა მიდგომამ გამოიწვია.
  - **გაშვების ლოგიკის ოპტიმიზაცია:** `synapse_system_start` ფუნქციის ლოგიკა დაიხვეწა, რათა ინექცია და ინიციალიზაცია ხდებოდეს ერთ, თანმიმდევრულ ციკლში, `init_level`-ის პრიორიტეტის სრული დაცვით.

### 🐛 შესწორებები (Bug Fixes)

- **fix(core):** 🐞 აღმოიფხვრა კრიტიკული `Guru Meditation Error (LoadProhibited)`, რომელიც გამოწვეული იყო `System Manager`-ის მიერ მეხსიერების არასწორ მისამართზე წერით. ახალი, `dependency_map`-ზე დაფუძნებული ინექციის მექანიზმი ამ პრობლემას სრულად აგვარებს.
- **fix(modules):** 🔧 განახლდა ყველა მოდული, რომელიც იყენებს სერვისებზე დამოკიდებულებას (`button_input`, `relay_actuator`, `rgb_led_indicator` და ა.შ.), რათა მათ მოახდინონ `dependency_map`-ის დეკლარირება და გამოიყენონ ინექცირებული `handle`-ები.

### 📄 დოკუმენტაცია (Documentation)

- **docs(core):** ✍️ განახლდა `base_module.h` და `system_manager.c` ფაილები ახალი `dependency_map` სტრუქტურისა და ინექციის ლოგიკის დეტალური Doxygen დოკუმენტაციით.
- **docs(design):** ✍️ განახლდა `dependency_injection.md` დოკუმენტი, რათა ასახავდეს ახალ, `offsetof()`-ზე დაფუძნებულ, უსაფრთხო მიდგომას.

---

## [7.0.0] - 2025-08-26

### 💥 არქიტექტურული ცვლილებები (Breaking Changes & Refactoring)

- **refactor(core):** 🏛️ განხორციელდა ფრეიმვორქის ბირთვის API-ს სრული რეორგანიზაცია და ცენტრალიზაცია, რათა გაუმჯობესდეს კოდის სტრუქტურა, შემცირდეს დამოკიდებულებები და გამარტივდეს მოდულების წერის პროცესი.

  - **ფასადის პატერნი (`synapse.h`):** დაემატა ერთიანი, საჯარო ჰედერ ფაილი **`synapse.h`**, რომელიც აერთიანებს `core` კომპონენტის ყველა საჯარო API-ს (`Event Bus`, `Service Locator`, `Config Manager` და ა.შ.). მოდულებს ახლა შეუძლიათ, გამოიყენონ ფრეიმვორქის სრული ფუნქციონალი მხოლოდ ერთი `#include "synapse.h"` დირექტივით, რაც მნიშვნელოვნად ასუფთავებს კოდს.

  - **ინტერფეისების რეორგანიზაცია:**
    - **`core` კომპონენტში გადატანა:** ფრეიმვორქის ფუნდამენტური "კონტრაქტები" (`base_module.h`, `service_types.h`, `framework_events.h`, `event_payloads.h`) ლოგიკურად გადატანილ იქნა `core` კომპონენტში, რადგან ისინი მისი API-ს განუყოფელი ნაწილია.
    - **`interfaces` კომპონენტის როლის დაზუსტება:** `interfaces` კომპონენტი ახლა შეიცავს **მხოლოდ მოდულების მიერ მოწოდებული სერვისების** აბსტაქტულ კონტრაქტებს (`relay_interface.h`, `display_driver_interface.h` და ა.შ.), რაც ქმნის უფრო მკაფიო და ლოგიკურ საზღვრებს.

  - **`mqtt_topics_generated.h`-ის გადატანა:** მოდულებიდან ავტომატურად გენერირებული MQTT თემების ფაილი გადატანილ იქნა `interfaces` კომპონენტში, რადგან ის წარმოადგენს კონტრაქტს მოდულებსა და გარე სამყაროს (MQTT ბროკერს) შორის.

### 🔄 შეცვლილი

- **refactor(modules):** 🧹 განახლდა პროექტში არსებული ყველა მოდული, რათა გამოეყენებინათ ახალი, ერთიანი `#include "synapse.h"` ჰედერი, მრავალი `core` ჰედერის ნაცვლად.
- **refactor(scripts):** 🤖 განახლდა `create_module.py` სკრიპტი. ის ახლა აგენერირებს კოდის შაბლონებს, რომლებიც თავიდანვე იყენებენ `synapse.h`-ს და შეესაბამებიან მეხსიერების მართვის გაუმჯობესებულ პრაქტიკას.

---

#### ძველი ვერსიების ისტორია

[(v1.0.0 - v5.8.0)](docs/changelog/v5.md)
[(v6.0.0 - v6.2.0)](docs/changelog/v6.md)
