# áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ: áƒ áƒáƒ’áƒáƒ  áƒ’áƒáƒ“áƒáƒ•áƒªáƒ”áƒ— áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ API-áƒ¡ áƒ’áƒáƒ›áƒáƒ«áƒáƒ®áƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡?

## 1. â“ áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ˜áƒ¡ áƒáƒ¦áƒ¬áƒ”áƒ áƒ

áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ¥áƒ›áƒœáƒ˜áƒ— áƒ›áƒáƒ“áƒ£áƒšáƒ¡ (áƒ›áƒáƒ’., `Module A`), áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ¡ áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ (`Module B`) áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ¡ `Dependency Injection`-áƒ˜áƒ¡ (DI) áƒ›áƒ”áƒ¨áƒ•áƒ”áƒáƒ‘áƒ˜áƒ—. `Module B`-áƒ¡ Service API (`module_b_api_t`) áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜ áƒžáƒ˜áƒ áƒ•áƒ”áƒš áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒáƒ“ áƒ˜áƒ¦áƒ”áƒ‘áƒ”áƒœ `void* context`-áƒ¡, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ¡áƒ˜áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒ”áƒ¨áƒ˜ `Module B`-áƒ¡ `module_t*` áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡.

áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ `Module A`-áƒ¨áƒ˜, DI-áƒ¡ áƒ›áƒ”áƒ¨áƒ•áƒ”áƒáƒ‘áƒ˜áƒ—, áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ›áƒ˜áƒ˜áƒ¦áƒ”áƒ— `module_b_api_t*` áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜, áƒ›áƒáƒ’áƒ áƒáƒ› áƒáƒ  áƒ’áƒáƒ¥áƒ•áƒ— áƒ¬áƒ•áƒ“áƒáƒ›áƒ `Module B`-áƒ¡ `module_t*` áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ–áƒ”, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒáƒ“ áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ“áƒáƒ¡áƒªáƒ”áƒ—.

**áƒ¢áƒ˜áƒžáƒ£áƒ áƒ˜ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ:**

```c
// In Module A
// private_data->service_b_api áƒáƒ áƒ˜áƒ¡ module_b_api_t*

// áƒ áƒáƒ’áƒáƒ  áƒ›áƒ˜áƒ•áƒ˜áƒ¦áƒ "context" áƒáƒ› áƒ’áƒáƒ›áƒáƒ«áƒáƒ®áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡?
private_data->service_b_api->do_something(CONTEXT_IS_MISSING, ...);
```

## 2. âŒ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ (áƒ›áƒáƒ’áƒ áƒáƒ› áƒ›áƒáƒªáƒ“áƒ£áƒ áƒ˜) áƒ’áƒáƒ“áƒáƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ”áƒ‘áƒ˜

1. **`Hardcoded` áƒ¡áƒáƒ®áƒ”áƒšáƒ˜áƒ— áƒ›áƒáƒ«áƒ˜áƒ”áƒ‘áƒ:**

    ```c
    module_t* module_b_handle = fmw_module_registry_find_by_name("instance_name_of_b");
    private_data->service_b_api->do_something(module_b_handle, ...);
    ```

    - **áƒ áƒáƒ¢áƒáƒ› áƒáƒ áƒ˜áƒ¡ áƒªáƒ£áƒ“áƒ˜?** áƒ”áƒ¡ áƒ¥áƒ›áƒœáƒ˜áƒ¡ `hardcoded` áƒ“áƒáƒ›áƒáƒ™áƒ˜áƒ“áƒ”áƒ‘áƒ£áƒšáƒ”áƒ‘áƒáƒ¡ áƒ™áƒáƒœáƒ™áƒ áƒ”áƒ¢áƒ£áƒš `instance_name`-áƒ–áƒ”. áƒ—áƒ£ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ `config.json`-áƒ¨áƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ¡ áƒ¨áƒ”áƒ£áƒªáƒ•áƒšáƒ˜áƒ¡, áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ™áƒáƒ“áƒ˜ áƒ’áƒáƒ¢áƒ§áƒ“áƒ”áƒ‘áƒ. áƒ”áƒ¡ áƒáƒ áƒ¦áƒ•áƒ”áƒ•áƒ¡ áƒ¤áƒ áƒ”áƒ˜áƒ›áƒ•áƒáƒ áƒ¥áƒ˜áƒ¡ áƒ›áƒáƒ¥áƒœáƒ˜áƒšáƒáƒ‘áƒ˜áƒ¡ áƒžáƒ áƒ˜áƒœáƒªáƒ˜áƒžáƒ¡.

## 3. âœ… áƒ¡áƒ¬áƒáƒ áƒ˜ áƒáƒ áƒ¥áƒ˜áƒ¢áƒ”áƒ¥áƒ¢áƒ£áƒ áƒ£áƒšáƒ˜ áƒžáƒáƒ¢áƒ”áƒ áƒœáƒ˜: áƒáƒ áƒ›áƒáƒ’áƒ˜ áƒ˜áƒœáƒ”áƒ¥áƒªáƒ˜áƒ

Synapse Framework-áƒ˜áƒ¡ DI áƒ›áƒ”áƒ¥áƒáƒœáƒ˜áƒ–áƒ›áƒ˜ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜áƒ áƒáƒ› áƒžáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ˜áƒ¡ áƒ”áƒšáƒ”áƒ’áƒáƒœáƒ¢áƒ£áƒ áƒáƒ“ áƒ’áƒáƒ“áƒáƒ¡áƒáƒ­áƒ áƒ”áƒšáƒáƒ“. áƒ’áƒáƒ›áƒáƒ¡áƒáƒ•áƒáƒšáƒ˜áƒ, áƒ›áƒáƒ˜áƒ—áƒ®áƒáƒ•áƒáƒ— **áƒáƒ áƒ˜áƒ•áƒ” áƒ áƒ”áƒ¡áƒ£áƒ áƒ¡áƒ˜áƒ¡** áƒ˜áƒœáƒ”áƒ¥áƒªáƒ˜áƒ áƒ”áƒ‘áƒ: áƒ áƒáƒ’áƒáƒ áƒª áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ API-áƒ¡, áƒ˜áƒ¡áƒ” áƒ—áƒáƒ•áƒáƒ“ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ `handle`-áƒ˜áƒ¡.

### áƒ”áƒ¢áƒáƒžáƒ˜ 1: `private_data` áƒ¡áƒ¢áƒ áƒ£áƒ¥áƒ¢áƒ£áƒ áƒ˜áƒ¡ áƒ’áƒáƒ¤áƒáƒ áƒ—áƒáƒ”áƒ‘áƒ

áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ (`Module A`) `private_data` áƒ¡áƒ¢áƒ áƒ£áƒ¥áƒ¢áƒ£áƒ áƒáƒ¨áƒ˜ áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ— áƒáƒ áƒ˜áƒ•áƒ” áƒ›áƒáƒ©áƒ•áƒ”áƒœáƒ”áƒ‘áƒ”áƒšáƒ˜:

```c
// module_a.h
typedef struct {
    // ... áƒ¡áƒ®áƒ•áƒ áƒ•áƒ”áƒšáƒ”áƒ‘áƒ˜ ...
    
    // --- Injected Dependencies ---
    module_b_api_t* service_b_api;      // áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ API-áƒ¡áƒ—áƒ•áƒ˜áƒ¡
    module_t*       service_b_handle;   // áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ handle-áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ (áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜)

} module_a_private_data_t;
```

### áƒ”áƒ¢áƒáƒžáƒ˜ 2: `dependency_map`-áƒ˜áƒ¡ áƒ’áƒáƒœáƒ¡áƒáƒ–áƒ¦áƒ•áƒ áƒ

áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ `.c` áƒ¤áƒáƒ˜áƒšáƒ¨áƒ˜, áƒáƒ¦áƒ¬áƒ”áƒ áƒ”áƒ— áƒáƒ áƒ˜áƒ•áƒ” áƒ“áƒáƒ›áƒáƒ™áƒ˜áƒ“áƒ”áƒ‘áƒ£áƒšáƒ”áƒ‘áƒ `dependency_map`-áƒ¨áƒ˜:

```c
// module_a.c
static const module_dependency_t s_dependencies[] = {
    {"service_b_api_name", offsetof(module_a_private_data_t, service_b_api)},
    {"service_b_handle_name", offsetof(module_a_private_data_t, service_b_handle)},
    {NULL, 0}
};
```

### áƒ”áƒ¢áƒáƒžáƒ˜ 3: `config.json`-áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ

áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ `config.json`-áƒ¨áƒ˜, áƒ›áƒ˜áƒ£áƒ—áƒ˜áƒ—áƒ”áƒ—, áƒ—áƒ£ áƒ áƒáƒ›áƒ”áƒšáƒ˜ áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜ áƒ“áƒ áƒ áƒáƒ›áƒ”áƒšáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ¥áƒœáƒáƒ¡ áƒ˜áƒœáƒ”áƒ¥áƒªáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜. áƒ®áƒ¨áƒ˜áƒ  áƒ¨áƒ”áƒ›áƒ—áƒ®áƒ•áƒ”áƒ•áƒáƒ¨áƒ˜, áƒ›áƒáƒ—áƒ˜ `instance_name` áƒ”áƒ áƒ—áƒ›áƒáƒœáƒ”áƒ—áƒ¡ áƒ”áƒ›áƒ—áƒ®áƒ•áƒ”áƒ•áƒ.

```json
// module_a/config.json
{
    "type": "module_a",
    "config": {
        "instance_name": "main_a",
        "service_b_api_name": "main_b",
        "service_b_handle_name": "main_b"
    }
}
```

### áƒ”áƒ¢áƒáƒžáƒ˜ 4: áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ

áƒáƒ®áƒšáƒ, áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ™áƒáƒ“áƒ¨áƒ˜ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ“ áƒ“áƒ `hardcode`-áƒ˜áƒ¡ áƒ’áƒáƒ áƒ”áƒ¨áƒ” áƒ’áƒáƒ›áƒáƒ˜áƒ«áƒáƒ®áƒáƒ— áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ:

```c
// module_a.c
void do_something_with_service_b(module_a_private_data_t* private_data) {
    if (private_data->service_b_api && private_data->service_b_handle) {
        private_data->service_b_api->do_something(
            private_data->service_b_handle, // <-- áƒ’áƒáƒ“áƒáƒ•áƒ”áƒªáƒ˜áƒ— áƒ˜áƒœáƒ”áƒ¥áƒªáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜
            ...
        );
    }
}
```

## 4. ðŸ’¬ áƒ“áƒáƒ¡áƒ™áƒ•áƒœáƒ

áƒ›áƒ˜áƒ£áƒ®áƒ”áƒ“áƒáƒ•áƒáƒ“ áƒ˜áƒ›áƒ˜áƒ¡áƒ, áƒ áƒáƒ› `module_t*` áƒ¢áƒ˜áƒžáƒ˜áƒ¡ áƒžáƒ˜áƒ áƒ“áƒáƒžáƒ˜áƒ áƒ˜ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ áƒ›áƒªáƒ˜áƒ áƒ” áƒ“áƒáƒ›áƒáƒ™áƒ˜áƒ“áƒ”áƒ‘áƒ£áƒšáƒ”áƒ‘áƒáƒ¡ áƒ¥áƒ›áƒœáƒ˜áƒ¡ áƒ¤áƒ áƒ”áƒ˜áƒ›áƒ•áƒáƒ áƒ¥áƒ˜áƒ¡ áƒ¡áƒáƒ‘áƒáƒ–áƒ˜áƒ¡áƒ áƒ¡áƒ¢áƒ áƒ£áƒ¥áƒ¢áƒ£áƒ áƒáƒ–áƒ”, áƒ”áƒ¡ áƒáƒ áƒ˜áƒ¡ **áƒ’áƒáƒ›áƒáƒ áƒ—áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ“áƒ áƒžáƒ áƒáƒ’áƒ›áƒáƒ¢áƒ£áƒšáƒ˜ áƒ™áƒáƒ›áƒžáƒ áƒáƒ›áƒ˜áƒ¡áƒ˜**. áƒ˜áƒ¡ áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ”áƒ‘áƒáƒ¡ áƒ’áƒ•áƒáƒ«áƒšáƒ”áƒ•áƒ¡, áƒ¨áƒ”áƒ•áƒ˜áƒœáƒáƒ áƒ©áƒ£áƒœáƒáƒ— API-áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ¥áƒœáƒ˜áƒšáƒáƒ‘áƒ (`context`-áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒªáƒ”áƒ›áƒ˜áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ«áƒšáƒ”áƒ‘áƒšáƒáƒ‘áƒ) áƒ“áƒ áƒáƒ›áƒáƒ•áƒ“áƒ áƒáƒ£áƒšáƒáƒ“, áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒáƒ•áƒ˜áƒªáƒ˜áƒšáƒáƒ— `hardcoded` áƒ“áƒáƒ›áƒáƒ™áƒ˜áƒ“áƒ”áƒ‘áƒ£áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜, áƒ áƒáƒª áƒ¤áƒ áƒ”áƒ˜áƒ›áƒ•áƒáƒ áƒ¥áƒ˜áƒ¡ áƒ”áƒ áƒ—-áƒ”áƒ áƒ—áƒ˜ áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒžáƒ áƒ˜áƒœáƒªáƒ˜áƒžáƒ˜áƒ.
