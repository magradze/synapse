# Synapse Utils API Reference

## ­Ъј» рЃЏрЃўрЃќрЃљрЃюрЃў

рЃћрЃА рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃў рЃљрЃдрЃгрЃћрЃарЃА `synapse_utils.h`-рЃерЃў рЃЌрЃљрЃЋрЃЏрЃЮрЃДрЃарЃўрЃџрЃў рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА API-рЃА. рЃћрЃА рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃљ рЃерЃћрЃўрЃфрЃљрЃЋрЃА рЃ«рЃерЃўрЃарЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљрЃЊ, рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃА, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃћрЃЉрЃћрЃю рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃА рЃгрЃћрЃарЃљрЃА рЃЊрЃљ рЃљрЃЏрЃфрЃўрЃарЃћрЃЉрЃћрЃю рЃЎрЃЮрЃЊрЃўрЃА рЃЊрЃБрЃЉрЃџрЃўрЃарЃћрЃЉрЃљрЃА.

---

## 1. рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ

### `char* synapse_safe_strncpy(char *dest, const char *src, size_t size);`

`strncpy`-рЃўрЃА рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃЋрЃћрЃарЃАрЃўрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф **рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА** рЃЊрЃљрЃюрЃўрЃерЃюрЃБрЃџрЃћрЃЉрЃўрЃА рЃЉрЃБрЃцрЃћрЃарЃўрЃА `null-termination`-рЃА.

- **`dest`**: рЃЊрЃљрЃюрЃўрЃерЃюрЃБрЃџрЃћрЃЉрЃўрЃА рЃЉрЃБрЃцрЃћрЃарЃў.
- **`src`**: рЃгрЃДрЃљрЃарЃЮ рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў.
- **`size`**: рЃЊрЃљрЃюрЃўрЃерЃюрЃБрЃџрЃћрЃЉрЃўрЃА рЃЉрЃБрЃцрЃћрЃарЃўрЃА **рЃАрЃарЃБрЃџрЃў рЃќрЃЮрЃЏрЃљ**.
- **рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА:** рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃА `dest` рЃЉрЃБрЃцрЃћрЃарЃќрЃћ.

---

## 2. рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃърЃљрЃарЃАрЃўрЃюрЃњрЃўрЃА рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў

рЃћрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃўрЃљ `parse_config` рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃерЃў рЃњрЃљрЃЏрЃЮрЃАрЃљрЃДрЃћрЃюрЃћрЃЉрЃџрЃљрЃЊ, рЃарЃљрЃЌрЃљ рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃЊ рЃЊрЃљ рЃЏрЃљрЃарЃбрЃўрЃЋрЃљрЃЊ рЃгрЃљрЃўрЃЎрЃўрЃЌрЃ«рЃЮрЃЌ рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў `cJSON` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃЊрЃљрЃю.

### `bool synapse_config_get_string_from_node(const char* tag, const cJSON *json_node, const char *key, char *dest, size_t dest_size);`

рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃЊ рЃЎрЃўрЃЌрЃ«рЃБрЃџрЃЮрЃЉрЃА рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃА `cJSON` рЃЎрЃЋрЃљрЃюрЃФрЃўрЃЊрЃљрЃю. рЃЌрЃБ рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃў рЃљрЃа рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА рЃљрЃю рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃў рЃбрЃўрЃърЃўрЃАрЃљрЃљ, `dest` рЃЉрЃБрЃцрЃћрЃарЃў рЃБрЃфрЃЋрЃџрЃћрЃџрЃў рЃарЃЕрЃћрЃЉрЃљ.

- **`tag`**: рЃњрЃљрЃЏрЃЮрЃЏрЃФрЃљрЃ«рЃћрЃЉрЃћрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃџрЃЮрЃњрЃўрЃарЃћрЃЉрЃўрЃА `TAG`.
- **`json_node`**: `cJSON` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃў, рЃарЃЮрЃЏрЃћрЃџрЃерЃўрЃф рЃЋрЃћрЃФрЃћрЃЉрЃЌ.
- **`key`**: рЃАрЃљрЃФрЃўрЃћрЃЉрЃћрЃџрЃў рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃўрЃА рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃў.
- **`dest`**: рЃЉрЃБрЃцрЃћрЃарЃў, рЃАрЃљрЃЊрЃљрЃф рЃЕрЃљрЃўрЃгрЃћрЃарЃћрЃЉрЃљ рЃерЃћрЃЊрЃћрЃњрЃў.
- **`dest_size`**: рЃЉрЃБрЃцрЃћрЃарЃўрЃА рЃАрЃарЃБрЃџрЃў рЃќрЃЮрЃЏрЃљ.
- **рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА:** `true` рЃЌрЃБ рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ, `false` рЃгрЃўрЃюрЃљрЃљрЃдрЃЏрЃЊрЃћрЃњ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў.

### `bool synapse_config_get_int_from_node(const char* tag, const cJSON *json_node, const char *key, int *out_value);`

рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃЊ рЃЎрЃўрЃЌрЃ«рЃБрЃџрЃЮрЃЉрЃА `int` рЃбрЃўрЃърЃўрЃА рЃарЃўрЃфрЃ«рЃЋрЃА. рЃЌрЃБ рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃў рЃљрЃа рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА рЃљрЃю рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃў рЃбрЃўрЃърЃўрЃАрЃљрЃљ, `out_value` рЃљрЃа рЃўрЃфрЃЋрЃџрЃћрЃЉрЃљ.

- **`out_value`**: рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃў `int` рЃфрЃЋрЃџрЃљрЃЊрЃќрЃћ, рЃАрЃљрЃЊрЃљрЃф рЃЕрЃљрЃўрЃгрЃћрЃарЃћрЃЉрЃљ рЃерЃћрЃЊрЃћрЃњрЃў.
- **рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА:** `true` рЃЌрЃБ рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ, `false` рЃгрЃўрЃюрЃљрЃљрЃдрЃЏрЃЊрЃћрЃњ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў.

### `bool synapse_config_get_bool_from_node(const char* tag, const cJSON *json_node, const char *key, bool *out_value);`

рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃЊ рЃЎрЃўрЃЌрЃ«рЃБрЃџрЃЮрЃЉрЃА `bool` рЃбрЃўрЃърЃўрЃА рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљрЃА. рЃЌрЃБ рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃў рЃљрЃа рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА рЃљрЃю рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃў рЃбрЃўрЃърЃўрЃАрЃљрЃљ, `out_value` рЃљрЃа рЃўрЃфрЃЋрЃџрЃћрЃЉрЃљ.

- **`out_value`**: рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃў `bool` рЃфрЃЋрЃџрЃљрЃЊрЃќрЃћ, рЃАрЃљрЃЊрЃљрЃф рЃЕрЃљрЃўрЃгрЃћрЃарЃћрЃЉрЃљ рЃерЃћрЃЊрЃћрЃњрЃў.
- **рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА:** `true` рЃЌрЃБ рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ, `false` рЃгрЃўрЃюрЃљрЃљрЃдрЃЏрЃЊрЃћрЃњ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў.

## 3. Guard Clause & Validation Helpers

рЃћрЃА рЃЏрЃљрЃЎрЃарЃЮрЃћрЃЉрЃў рЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃћрЃЉрЃћрЃю рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃА рЃЊрЃљрЃАрЃљрЃгрЃДрЃўрЃАрЃерЃў рЃърЃўрЃарЃЮрЃЉрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљрЃА рЃЊрЃљ рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃЊрЃљрЃю рЃњрЃљрЃЏрЃЮрЃАрЃЋрЃџрЃљрЃА. рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃЌрЃБ **рЃарЃЮрЃЊрЃўрЃА** рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃЮрЃЌ рЃўрЃАрЃўрЃюрЃў, рЃўрЃ«рЃўрЃџрЃћрЃЌ [Assertions рЃЊрЃљ Guard Clauses рЃЎрЃЮрЃюрЃЋрЃћрЃюрЃфрЃўрЃљ](../convention/assertion_and_guards.md).

### `SYNAPSE_GUARD(condition, tag, ret_val, format, ...)`

рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃърЃўрЃарЃЮрЃЉрЃљрЃА (`condition`). рЃЌрЃБ рЃърЃўрЃарЃЮрЃЉрЃљ рЃЏрЃфрЃЊрЃљрЃарЃўрЃљ, рЃўрЃА `ESP_LOGE`-рЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ рЃЉрЃћрЃГрЃЊрЃљрЃЋрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃА рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљрЃА рЃЊрЃљ рЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА `return ret_val;`-рЃА.

- **`condition`**: рЃерЃћрЃАрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃњрЃљрЃЏрЃЮрЃАрЃљрЃ«рЃБрЃџрЃћрЃЉрЃљ.
- **`tag`**: рЃњрЃљрЃЏрЃЮрЃЏрЃФрЃљрЃ«рЃћрЃЉрЃћрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃџрЃЮрЃњрЃўрЃарЃћрЃЉрЃўрЃА `TAG`.
- **`ret_val`**: рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃБрЃюрЃЊрЃљ рЃЊрЃљрЃЉрЃарЃБрЃюрЃЊрЃћрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃЊрЃљрЃю, рЃЌрЃБ рЃърЃўрЃарЃЮрЃЉрЃљ рЃЏрЃфрЃЊрЃљрЃарЃўрЃљ (рЃЏрЃљрЃњ., `ESP_ERR_INVALID_ARG`, `NULL`, `false`).
- **`format`**: `printf`-рЃўрЃА рЃАрЃбрЃўрЃџрЃўрЃА рЃцрЃЮрЃарЃЏрЃљрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў рЃџрЃЮрЃњрЃўрЃАрЃЌрЃЋрЃўрЃА.
- **`...`**: (рЃљрЃарЃљрЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ) рЃфрЃЋрЃџрЃљрЃЊрЃў рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃў `format` рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА.

**рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```c
esp_err_t process_data(data_packet_t *packet) {
    // рЃЌрЃБ packet рЃљрЃарЃўрЃА NULL, рЃЊрЃљрЃўрЃЉрЃћрЃГрЃЊрЃћрЃЉрЃљ Error рЃџрЃЮрЃњрЃў рЃЊрЃљ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃЊрЃљрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА ESP_ERR_INVALID_ARG-рЃА.
    SYNAPSE_GUARD(packet != NULL, TAG, ESP_ERR_INVALID_ARG, "Data packet is NULL, cannot process.");

    // ... рЃЊрЃљрЃюрЃљрЃарЃЕрЃћрЃюрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ ...
    return ESP_OK;
}
```

### `SYNAPSE_GUARD_VOID(condition, tag, format, ...)`

`SYNAPSE_GUARD`-рЃўрЃА рЃЋрЃћрЃарЃАрЃўрЃљ рЃўрЃЏ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃћрЃю `void`-рЃА. рЃЌрЃБ рЃърЃўрЃарЃЮрЃЉрЃљ рЃЏрЃфрЃЊрЃљрЃарЃўрЃљ, рЃўрЃА рЃЉрЃћрЃГрЃЊрЃљрЃЋрЃА рЃџрЃЮрЃњрЃА рЃЊрЃљ рЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА `return;`-рЃА.

- **рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў:** рЃўрЃњрЃўрЃЋрЃћрЃљ, рЃарЃљрЃф `SYNAPSE_GUARD`-рЃўрЃА, `ret_val`-рЃўрЃА рЃњрЃљрЃарЃЊрЃљ.

**рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```c
void update_ui(ui_handle_t *ui) {
    // рЃЌрЃБ ui рЃљрЃарЃўрЃА NULL, рЃЊрЃљрЃўрЃЉрЃћрЃГрЃЊрЃћрЃЉрЃљ Error рЃџрЃЮрЃњрЃў рЃЊрЃљ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃЊрЃљрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљрЃА.
    SYNAPSE_GUARD_VOID(ui != NULL, TAG, "UI handle is NULL, cannot update.");

    // ... рЃЊрЃљрЃюрЃљрЃарЃЕрЃћрЃюрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ ...
}
```
