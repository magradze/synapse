# ცვლილებების ისტორია (Changelog)

## [v2.1.1] - 2025-07-01

### 🐛 შეცდომების გასწორება

- **გასწორდა NVS-დან მონაცემების წაკითხვის შეცდომა:** მოგვარდა კრიტიკული შეცდომა `wifi_manager`-ში, რომლის დროსაც WiFi-ს მონაცემები არასწორად იკითხებოდა NVS მეხსიერებიდან მოწყობილობის გადატვირთვის შემდეგ. პრობლემა გამოწვეული იყო მეხსიერების არასწორი მართვით. `load_credentials_from_nvs` ფუნქცია გადაკეთდა უფრო მტკიცე, დაცვით მექანიზმზე, რომელიც იყენებს დროებით ბუფერებს და `memcpy`-ს მონაცემთა მთლიანობის უზრუნველსაყოფად.
- **გაუმჯობესდა Reconnect-Provisioning ციკლი:** `ble_provisioning` მოდული ახლა კორექტულად ამუშავებს `PROV_START_REQUESTED` ივენთს, რაც საშუალებას აძლევს მას, ხელახლა დაიწყოს provisioning პროცესი WiFi-სთან დაკავშირების მრავალჯერადი წარუმატებელი მცდელობის შემდეგ. ამით სრულდება აღდგენის სრული და გამართული ციკლი.

### ✨ ახალი ფუნქციონალი

- **დაკავშირების მცდელობების ლიმიტი და Provisioning-ზე გადასვლა:** `wifi_manager`-ს დაემატა დაკავშირების მცდელობების კონფიგურირებადი ლიმიტი (`CONFIG_WIFI_MANAGER_MAX_RECONNECT_ATTEMPTS`). ლიმიტის ამოწურვის შემდეგ, მოდული ავტომატურად შლის არასწორ მონაცემებს NVS-დან და ითხოვს provisioning პროცესის დაწყებას, რაც მომხმარებელს საშუალებას აძლევს, მარტივად განაახლოს WiFi-ს პარამეტრები.

---

## [v2.1.0] - 2025-06-30

### ✨ ახალი ფუნქციონალი

- **მოდულების ინიციალიზაციის პრიორიტეტიზაცია:** დაინერგა მოდულების დალაგების მტკიცე მექანიზმი `init_level` პარამეტრის საფუძველზე. `Module Registry` ახლა ავტომატურად ალაგებს ყველა რეგისტრირებულ მოდულს მათი `init_level`-ის მიხედვით ინიციალიზაციამდე, რაც უზრუნველყოფს, რომ დაბალი `init_level`-ის მქონე (მაღალი პრიორიტეტის) მოდულები პირველები გაეშვან. ეს ხსნის დამოკიდებულებას `system_config.json`-ში მოდულების თანმიმდევრობაზე.
- **RGB LED ინდიკატორის გაუმჯობესება:** `rgb_led_indicator` მოდულს დაემატა `PULSE` (პულსაციის) ეფექტის მხარდაჭერა. ივენთების დამუშავება ახლა ხდება ცხრილზე დაფუძნებული მიდგომით, რაც კოდს უფრო მასშტაბირებადს და წაკითხვადს ხდის. `release_control` API ახლა კორექტულად აღადგენს სისტემის ბოლო ცნობილ მდგომარეობას.

### 🐛 შეცდომების გასწორება

- **გასწორდა Race Condition მოდულების ინიციალიზაციისას:** მოგვარდა კრიტიკული დროის ფაქტორით გამოწვეული პრობლემა, როდესაც მოდულები (მაგ., `rgb_led_indicator`) აცდენდნენ სისტემის ადრეულ ივენთებს (მაგ., `WIFI_CREDENTIALS_NOT_FOUND`), რადგან მათი ინიციალიზაცია ხდებოდა ივენთის გამომქვეყნებელი მოდულის შემდეგ. `init_level`-ზე დაფუძნებული დალაგება უზრუნველყოფს ინიციალიზაციის სწორ თანმიმდევრობას.
- **გასწორდა LEDC დრაივერის გამოყენება:** `rgb_led_indicator` მოდულის კოდი შეიცვალა ისე, რომ LEDC არხების ინიციალიზაცია ხდება მხოლოდ ერთხელ, `init` ფუნქციაში. ამან აღმოფხვრა `GPIO is not usable, maybe conflict with others` გაფრთხილება და უზრუნველყო LED ეფექტების გლუვი, უწყვეტი მუშაობა.
- **გასწორდა `qsort`-ის შედარების ფუნქციის ლოგიკა:** გასწორდა მაჩვენებლების ტიპების კონვერტაცია `compare_modules_by_init_level` ფუნქციაში, მოდულების მასივის სწორად დალაგების უზრუნველსაყოფად.

### ♻️ რეფაქტორინგი

- **`init_level`-ის მართვის ცენტრალიზაცია:** `init_level`-ის დაყენების პასუხისმგებლობა ახლა დელეგირებულია თითოეული მოდულის `_create` ფუნქციაზე, რომელიც კითხულობს მნიშვნელობას შესაბამისი `module.json`-იდან (გაერთიანებული `config` ობიექტის მეშვეობით). ეს მოდულის პრიორიტეტს ხდის თვითკმარს და დამოუკიდებელს `system_config.json`-ისგან.
- **გაუმჯობესდა ივენთების დამუშავება `rgb_led_indicator`-ში:** `if-else` ბრძანებების ჯაჭვი ჩანაცვლდა `static event_map` ცხრილით, რაც უზრუნველყოფს "ივენთი-ბრძანება" კავშირების უფრო სუფთა და ადვილად მართვად იმპლემენტაციას.
