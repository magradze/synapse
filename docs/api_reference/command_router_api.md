# Synapse Command Router API Reference

## ­Ъј» рЃЏрЃўрЃќрЃљрЃюрЃў

рЃћрЃА рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃў рЃљрЃдрЃгрЃћрЃарЃА `Command Router` рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃљрЃ»рЃљрЃарЃЮ Service API-рЃА, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃўрЃљ рЃАрЃ«рЃЋрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА `Service Locator`-рЃўрЃА рЃЏрЃћрЃерЃЋрЃћрЃЮрЃЉрЃўрЃЌ. рЃћрЃА API рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА рЃљрЃФрЃџрЃћрЃЋрЃА рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа рЃЏрЃЮрЃЊрЃБрЃџрЃА, рЃЊрЃљрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃЮрЃА рЃЊрЃљ рЃЏрЃљрЃарЃЌрЃЮрЃА рЃАрЃљрЃЎрЃБрЃЌрЃљрЃарЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃў рЃфрЃћрЃюрЃбрЃарЃљрЃџрЃўрЃќрЃћрЃЉрЃБрЃџрЃљрЃЊ рЃЊрЃљ **рЃЎрЃЮрЃюрЃцрЃџрЃўрЃЦрЃбрЃћрЃЉрЃўрЃА рЃњрЃљрЃарЃћрЃерЃћ**.

**рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў:** `main_cmd_router` (рЃљрЃю рЃарЃЮрЃњрЃЮрЃарЃф рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџрЃўрЃљ `config.json`-рЃерЃў)
**рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃбрЃўрЃърЃў:** `SYNAPSE_SERVICE_TYPE_CMD_ROUTER_API`
**рЃўрЃюрЃбрЃћрЃарЃцрЃћрЃўрЃАрЃўрЃА рЃ░рЃћрЃЊрЃћрЃарЃў:** `cmd_router_interface.h`

---

## РџЎ№ИЈ API рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ (`cmd_router_api_t`)

рЃћрЃА рЃљрЃарЃўрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃерЃћрЃўрЃфрЃљрЃЋрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃА рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃџрЃћрЃЉрЃА `Command Router`-рЃўрЃА рЃАрЃљрЃЏрЃљрЃарЃЌрЃљрЃЋрЃљрЃЊ.

```c
typedef struct
{
    esp_err_t (*register_command)(const cmd_t *command);
    esp_err_t (*unregister_command)(const char *command_name);
    bool (*is_command_registered)(const char *command_name); // <--- рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃўрЃљ
} cmd_router_api_t;
```

---

## ­ЪЊџ API рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў

### `esp_err_t register_command(const cmd_t *command)`

рЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃА рЃљрЃ«рЃљрЃџ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА `Command Router`-рЃерЃў. рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃў рЃ«рЃЊрЃћрЃЉрЃљ рЃДрЃЋрЃћрЃџрЃљ рЃгрЃДрЃљрЃарЃЮрЃЊрЃљрЃю (Serial, Event Bus рЃЊрЃљ рЃљ.рЃе.).

- **@param[in] `command`**: рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃў `const cmd_t` рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљрЃќрЃћ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃАрЃарЃБрЃџрЃљрЃЊ рЃљрЃдрЃгрЃћрЃарЃА рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА.
  - **рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃўрЃљ:** рЃљрЃЏ рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃўрЃАрЃЌрЃЋрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃЮрЃцрЃўрЃџрЃў рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃљ рЃБрЃюрЃЊрЃљ рЃЊрЃљрЃарЃЕрЃћрЃА рЃЋрЃљрЃџрЃўрЃЊрЃБрЃарЃў рЃЏрЃЌрЃћрЃџрЃў рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃўрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃўрЃА рЃњрЃљрЃюрЃЏрЃљрЃЋрЃџрЃЮрЃЉрЃљрЃерЃў. рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ рЃЏрЃўрЃАрЃў `static` рЃфрЃЋрЃџрЃљрЃЊрЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃфрЃ«рЃљрЃЊрЃћрЃЉрЃљ.
- **@return**
  - `ESP_OK`: рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃЊрЃљ.
  - `ESP_ERR_INVALID_ARG`: рЃЌрЃБ `command` рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃў рЃљрЃю рЃЏрЃўрЃАрЃў рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃў рЃЋрЃћрЃџрЃћрЃЉрЃў (`command`, `handler`) рЃљрЃарЃўрЃА `NULL`.
  - `ESP_ERR_NO_MEM`: рЃЌрЃБ рЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃАрЃўрЃљ рЃАрЃљрЃЋрЃАрЃћрЃљ (`CONFIG_COMMAND_ROUTER_MAX_COMMANDS`).
  - `ESP_ERR_INVALID_STATE`: рЃЌрЃБ рЃљрЃЏ рЃАрЃљрЃ«рЃћрЃџрЃўрЃА рЃЏрЃЦрЃЮрЃюрЃћ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃБрЃЎрЃЋрЃћ рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА.

---

### `esp_err_t unregister_command(const char *command_name)`

рЃерЃџрЃўрЃА (рЃљрЃБрЃЦрЃЏрЃћрЃЉрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљрЃА) рЃљрЃЊрЃарЃћ рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА.

- **@param[in] `command_name`**: рЃўрЃЏ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў (рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў), рЃарЃЮрЃЏрЃџрЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљрЃф рЃБрЃюрЃЊрЃљ рЃњрЃљрЃБрЃЦрЃЏрЃЊрЃћрЃА.
- **@return**
  - `ESP_OK`: рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃгрЃљрЃўрЃерЃљрЃџрЃљ.
  - `ESP_ERR_NOT_FOUND`: рЃЌрЃБ рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџрЃў рЃАрЃљрЃ«рЃћрЃџрЃўрЃА рЃЏрЃЦрЃЮрЃюрЃћ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃЋрЃћрЃа рЃЏрЃЮрЃўрЃФрЃћрЃЉрЃюрЃљ.
  - `ESP_ERR_INVALID_ARG`: рЃЌрЃБ `command_name` рЃљрЃарЃўрЃА `NULL`.

**@note** рЃћрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃџрЃљрЃЊ рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃФрЃљрЃ«рЃЮрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃЏрЃљ рЃЌрЃљрЃЋрЃўрЃА `deinit` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃерЃў, рЃарЃљрЃЌрЃљ рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў рЃљрЃа рЃЊрЃљрЃарЃЕрЃћрЃА "рЃЏрЃЮрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃљ" рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃў.

---

### `bool is_command_registered(const char *command_name)`

рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА, рЃљрЃарЃўрЃА рЃЌрЃБ рЃљрЃарЃљ рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџрЃў рЃАрЃљрЃ«рЃћрЃџрЃўрЃА рЃЏрЃЦрЃЮрЃюрЃћ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃБрЃЎрЃЋрЃћ рЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў. рЃћрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃЎрЃарЃўрЃбрЃўрЃЎрЃБрЃџрЃљрЃЊ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃўрЃљ рЃўрЃЏ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃарЃЮрЃЏрЃћрЃџрЃЌрЃљ рЃЏрЃарЃљрЃЋрЃљрЃџрЃў рЃўрЃюрЃАрЃбрЃљрЃюрЃфрЃўрЃљрЃф рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃЊрЃћрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў, рЃарЃљрЃЌрЃљ рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃљрЃўрЃфрЃўрЃџрЃЮрЃю рЃћрЃарЃЌрЃў рЃЊрЃљ рЃўрЃЏрЃљрЃЋрЃћ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃюрЃЏрЃћрЃЮрЃарЃћрЃЉрЃўрЃЌрЃў рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљ.

- **@param[in] `command_name`**: рЃерЃћрЃАрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃџрЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў.
- **@return**: `true` рЃЌрЃБ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА, `false` рЃгрЃўрЃюрЃљрЃљрЃдрЃЏрЃЊрЃћрЃњ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў.

---

## ­ЪЊќ рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ (`cmd_t`)

рЃћрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ `register_command` рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃАрЃарЃБрЃџрЃљрЃЊ рЃљрЃдрЃАрЃљрЃгрЃћрЃарЃљрЃЊ.

```c
typedef struct {
    const char *command;      // рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃЏрЃљрЃњ., "relay"
    const char *help;         // рЃЊрЃљрЃ«рЃЏрЃљрЃарЃћрЃЉрЃўрЃА рЃбрЃћрЃЦрЃАрЃбрЃў, рЃЏрЃљрЃњ., "Controls a relay actuator."
    const char *usage;        // рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃцрЃЮрЃарЃЏрЃљрЃбрЃў, рЃЏрЃљрЃњ., "relay <name> <on|off>"
    int min_args;             // рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ (рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃЕрЃљрЃЌрЃЋрЃџрЃўрЃЌ)
    int max_args;             // рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ (рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃЕрЃљрЃЌрЃЋрЃџрЃўрЃЌ)
    
    // рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃЊрЃљрЃЏрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃћрЃџрЃў callback рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ
    esp_err_t (*handler)(int argc, char **argv, void *context);
    
    // рЃЎрЃЮрЃюрЃбрЃћрЃЦрЃАрЃбрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃњрЃљрЃЊрЃљрЃћрЃфрЃћрЃЏрЃљ handler-рЃА (рЃ«рЃерЃўрЃарЃљрЃЊ, module_t* self)
    void *context;            
} cmd_t;
```

---

## ­ЪњА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃърЃљрЃбрЃћрЃарЃюрЃў: рЃЎрЃЮрЃюрЃцрЃџрЃўрЃЦрЃбрЃўрЃАрЃњрЃљрЃю рЃЊрЃљрЃфрЃБрЃџрЃў рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљ

рЃўрЃЏрЃўрЃАрЃљрЃЌрЃЋрЃўрЃА, рЃарЃЮрЃЏ рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃљрЃЋрЃўрЃфрЃўрЃџрЃЮрЃЌ рЃЎрЃЮрЃюрЃцрЃџрЃўрЃЦрЃбрЃў, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў рЃћрЃарЃЌрЃў рЃЊрЃљ рЃўрЃЏрЃљрЃЋрЃћ рЃбрЃўрЃърЃўрЃА рЃЏрЃарЃљрЃЋрЃљрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА (рЃЏрЃљрЃњ., рЃарЃљрЃЏрЃЊрЃћрЃюрЃўрЃЏрЃћ рЃарЃћрЃџрЃћ), рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЌ **"рЃърЃўрЃарЃЮрЃЉрЃўрЃЌрЃў, рЃћрЃарЃЌрЃ»рЃћрЃарЃљрЃЊрЃў рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃўрЃА"** рЃърЃљрЃбрЃћрЃарЃюрЃў.

**рЃџрЃЮрЃњрЃўрЃЎрЃљ:**

1. рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА `SYNAPSE_EVENT_SYSTEM_START_COMPLETE` рЃўрЃЋрЃћрЃюрЃЌрЃќрЃћ.
2. рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃўрЃЋрЃћрЃюрЃЌрЃў рЃЏрЃЮрЃЋрЃљ, рЃўрЃА рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА, рЃљрЃарЃўрЃА рЃЌрЃБ рЃљрЃарЃљ рЃЏрЃўрЃАрЃў рЃќрЃЮрЃњрЃљрЃЊрЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ (рЃЏрЃљрЃњ., `"relay"`) рЃБрЃЎрЃЋрЃћ рЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў `is_command_registered` рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃЌ.
3. **рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃЏ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў, рЃЌрЃБ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃљрЃа рЃљрЃарЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў**, рЃўрЃА рЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃА рЃЏрЃљрЃА рЃќрЃЮрЃњрЃљрЃЊрЃў `handler` рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃЌ.
4. рЃерЃћрЃЊрЃћрЃњрЃљрЃЊ, рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА рЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃърЃўрЃарЃЋрЃћрЃџрЃў рЃўрЃюрЃАрЃбрЃљрЃюрЃфрЃўрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃљрЃЏ рЃЎрЃЮрЃЊрЃА рЃњрЃљрЃБрЃерЃЋрЃћрЃЉрЃА.

**`relay_actuator.c`-рЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```c
// In relay_actuator.c

// 1. Handler-рЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ (рЃўрЃА рЃќрЃЮрЃњрЃљрЃЊрЃўрЃљ рЃЊрЃљ рЃљрЃа рЃљрЃарЃўрЃА рЃЊрЃљрЃЏрЃЮрЃЎрЃўрЃЊрЃћрЃЉрЃБрЃџрЃў рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџ рЃўрЃюрЃАрЃбрЃљрЃюрЃфрЃўрЃљрЃќрЃћ)
static esp_err_t generic_relay_cmd_handler(int argc, char **argv, void *context) {
    const char* instance_name = argv[1];
    const char* action = argv[2];
    
    // рЃўрЃърЃЮрЃЋрЃћ рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃарЃћрЃџрЃћрЃА рЃАрЃћрЃарЃЋрЃўрЃАрЃў Service Locator-рЃўрЃЌ
    service_handle_t handle = synapse_service_get(instance_name);
    if (!handle) {
        printf("Error: Relay with name '%s' not found.\n", instance_name);
        return ESP_ERR_NOT_FOUND;
    }
    
    // ... рЃњрЃљрЃЏрЃЮрЃўрЃФрЃљрЃ«рЃћ рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА API ...
    return ESP_OK;
}

// 2. рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА ьЋИвЊцрЃћрЃарЃерЃў рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљ
static void relay_module_handle_event(module_t *self, const char *event_name, void *event_data) {
    if (strcmp(event_name, SYNAPSE_EVENT_SYSTEM_START_COMPLETE) == 0) {
        
        service_handle_t cmd_router = synapse_service_get("main_cmd_router");
        if (cmd_router) {
            cmd_router_api_t *cmd_api = (cmd_router_api_t *)cmd_router;

            // 3. рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ, рЃ«рЃЮрЃЏ рЃљрЃа рЃЊрЃљрЃњрЃљрЃАрЃгрЃарЃЮ рЃЋрЃўрЃюрЃЏрЃћрЃЏ
            if (!cmd_api->is_command_registered("relay")) {
                ESP_LOGI(TAG, "Module '%s' is registering the generic 'relay' command.", self->name);
                
                // 4. рЃЌрЃБ рЃљрЃарЃљ, рЃЊрЃљрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћ
                static cmd_t relay_cmd = {
                    .command = "relay",
                    .help = "Controls a relay actuator.",
                    .usage = "relay <instance_name> <on|off|toggle>",
                    .min_args = 3,
                    .max_args = 3,
                    .handler = generic_relay_cmd_handler,
                    .context = NULL // рЃЎрЃЮрЃюрЃбрЃћрЃЦрЃАрЃбрЃў рЃљрЃа рЃњрЃЋрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ, рЃарЃљрЃЊрЃњрЃљрЃю handler-рЃў рЃќрЃЮрЃњрЃљрЃЊрЃўрЃљ
                };
                cmd_api->register_command(&relay_cmd);
            }
        }
    }
    // ...
}
