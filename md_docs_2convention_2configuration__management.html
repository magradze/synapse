<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Synapse ESP Framework: კონფიგურაციის მართვის წესები</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Synapse ESP Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2convention_2configuration__management.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">კონფიგურაციის მართვის წესები</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md722"></a> </p>
<h1><a class="anchor" id="autotoc_md723"></a>
ძირითადი პრინციპი</h1>
<p><b>ყველა კონფიგურაციული პარამეტრი უნდა იყოს <code>system_config.json</code>-ში, არ უნდა იყოს hardcoded კოდში.</b></p>
<h1><a class="anchor" id="autotoc_md724"></a>
system_config.json სტრუქტურა</h1>
<h2><a class="anchor" id="autotoc_md725"></a>
სტანდარტული ფორმატი</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;firmware&quot;: {</div>
<div class="line">        &quot;version&quot;: &quot;2.3.0&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Firmware description&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;global_config&quot;: {</div>
<div class="line">        &quot;device.id.prefix&quot;: &quot;MINDLAB&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;modules&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;type&quot;: &quot;module_type_name&quot;,</div>
<div class="line">            &quot;enabled&quot;: true,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;instance_name&quot;: &quot;instance_name&quot;,</div>
<div class="line">                // module-specific configuration</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md726"></a>
მაგალითი სრული კონფიგურაცია</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;firmware&quot;: {</div>
<div class="line">        &quot;version&quot;: &quot;2.3.0&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Implemented Service Locator pattern for I2C bus decoupling.&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;global_config&quot;: {</div>
<div class="line">        &quot;device.id.prefix&quot;: &quot;MINDLAB&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;modules&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;type&quot;: &quot;ssd1306_module&quot;,</div>
<div class="line">            &quot;enabled&quot;: true,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;instance_name&quot;: &quot;main_display&quot;,</div>
<div class="line">                &quot;i2c_bus_instance&quot;: &quot;i2c_bus_0&quot;,</div>
<div class="line">                &quot;i2c_addr&quot;: &quot;0x3C&quot;,</div>
<div class="line">                &quot;width&quot;: 128,</div>
<div class="line">                &quot;height&quot;: 64,</div>
<div class="line">                &quot;default_enabled&quot;: true,</div>
<div class="line">                &quot;init_text&quot;: &quot;MINDLAB&quot;</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;type&quot;: &quot;lcd1602_module&quot;,</div>
<div class="line">            &quot;enabled&quot;: true,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;instance_name&quot;: &quot;main_lcd&quot;,</div>
<div class="line">                &quot;i2c_bus_instance&quot;: &quot;i2c_bus_0&quot;,</div>
<div class="line">                &quot;i2c_addr&quot;: &quot;0x27&quot;,</div>
<div class="line">                &quot;rows&quot;: 2,</div>
<div class="line">                &quot;cols&quot;: 16,</div>
<div class="line">                &quot;backlight&quot;: true,</div>
<div class="line">                &quot;default_enabled&quot;: true,</div>
<div class="line">                &quot;init_text_line1&quot;: &quot;MINDLAB ESP32&quot;,</div>
<div class="line">                &quot;init_text_line2&quot;: &quot;Ready...&quot;</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;type&quot;: &quot;relay_module&quot;,</div>
<div class="line">            &quot;enabled&quot;: true,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;instance_name&quot;: &quot;main_light&quot;,</div>
<div class="line">                &quot;pin&quot;: 23,</div>
<div class="line">                &quot;active_low&quot;: true</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;type&quot;: &quot;dht22_module&quot;,</div>
<div class="line">            &quot;enabled&quot;: true,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;instance_name&quot;: &quot;indoor_sensor&quot;,</div>
<div class="line">                &quot;pin&quot;: 4,</div>
<div class="line">                &quot;type&quot;: &quot;DHT11&quot;,</div>
<div class="line">                &quot;update_interval_sec&quot;: 30</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;type&quot;: &quot;mqtt_module&quot;,</div>
<div class="line">            &quot;enabled&quot;: true,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;instance_name&quot;: &quot;main_broker&quot;,</div>
<div class="line">                &quot;broker_uri&quot;: &quot;mqtt://192.168.1.160:1883&quot;,</div>
<div class="line">                &quot;username&quot;: &quot;&quot;,</div>
<div class="line">                &quot;password&quot;: &quot;&quot;,</div>
<div class="line">                &quot;base_topic&quot;: &quot;/mindlab/device&quot;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md727"></a>
კონფიგურაციის ტიპები</h1>
<h2><a class="anchor" id="autotoc_md728"></a>
1. Hardware Configuration (Sensor Module)</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;dht22_module&quot;,</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;config&quot;: {</div>
<div class="line">        &quot;instance_name&quot;: &quot;indoor_sensor&quot;,</div>
<div class="line">        &quot;pin&quot;: 4,</div>
<div class="line">        &quot;type&quot;: &quot;DHT11&quot;,</div>
<div class="line">        &quot;update_interval_sec&quot;: 30</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md729"></a>
2. Display Configuration (SSD1306)</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;ssd1306_module&quot;,</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;config&quot;: {</div>
<div class="line">        &quot;instance_name&quot;: &quot;main_display&quot;,</div>
<div class="line">        &quot;i2c_bus_instance&quot;: &quot;i2c_bus_0&quot;,</div>
<div class="line">        &quot;i2c_addr&quot;: &quot;0x3C&quot;,</div>
<div class="line">        &quot;width&quot;: 128,</div>
<div class="line">        &quot;height&quot;: 64,</div>
<div class="line">        &quot;default_enabled&quot;: true,</div>
<div class="line">        &quot;init_text&quot;: &quot;MINDLAB&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md730"></a>
3. LCD Display Configuration</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;lcd1602_module&quot;,</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;config&quot;: {</div>
<div class="line">        &quot;instance_name&quot;: &quot;main_lcd&quot;,</div>
<div class="line">        &quot;i2c_bus_instance&quot;: &quot;i2c_bus_0&quot;,</div>
<div class="line">        &quot;i2c_addr&quot;: &quot;0x27&quot;,</div>
<div class="line">        &quot;rows&quot;: 2,</div>
<div class="line">        &quot;cols&quot;: 16,</div>
<div class="line">        &quot;backlight&quot;: true,</div>
<div class="line">        &quot;default_enabled&quot;: true,</div>
<div class="line">        &quot;init_text_line1&quot;: &quot;MINDLAB ESP32&quot;,</div>
<div class="line">        &quot;init_text_line2&quot;: &quot;Ready...&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md731"></a>
4. Communication Configuration (MQTT)</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;mqtt_module&quot;,</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;config&quot;: {</div>
<div class="line">        &quot;instance_name&quot;: &quot;main_broker&quot;,</div>
<div class="line">        &quot;broker_uri&quot;: &quot;mqtt://192.168.1.160:1883&quot;,</div>
<div class="line">        &quot;username&quot;: &quot;&quot;,</div>
<div class="line">        &quot;password&quot;: &quot;&quot;,</div>
<div class="line">        &quot;base_topic&quot;: &quot;/mindlab/device&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md732"></a>
5. I2C Bus Configuration</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;i2c_bus_module&quot;,</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;config&quot;: {</div>
<div class="line">        &quot;instance_name&quot;: &quot;i2c_bus_0&quot;,</div>
<div class="line">        &quot;port&quot;: 0,</div>
<div class="line">        &quot;sda_pin&quot;: 21,</div>
<div class="line">        &quot;scl_pin&quot;: 22,</div>
<div class="line">        &quot;clk_speed_hz&quot;: 100000</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md733"></a>
6. Relay Configuration</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;relay_module&quot;,</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;config&quot;: {</div>
<div class="line">        &quot;instance_name&quot;: &quot;main_light&quot;,</div>
<div class="line">        &quot;pin&quot;: 23,</div>
<div class="line">        &quot;active_low&quot;: true</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md734"></a>
კონფიგურაციის Parsing</h1>
<h2><a class="anchor" id="autotoc_md735"></a>
Private Data Structure</h2>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">char</span> instance_name[32];</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Configuration parameters from JSON</span></div>
<div class="line">    <span class="keywordtype">int</span> gpio_pin;</div>
<div class="line">    <span class="keywordtype">bool</span> default_enabled;</div>
<div class="line">    <span class="keywordtype">char</span> init_text[64];</div>
<div class="line">    uint32_t read_interval_ms;</div>
<div class="line">    <span class="keywordtype">float</span> temperature_offset;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Runtime variables</span></div>
<div class="line">    TaskHandle_t task_handle;</div>
<div class="line">    <span class="keywordtype">bool</span> task_suspended;</div>
<div class="line">    <span class="comment">// hardware handles...</span></div>
<div class="line">} module_private_data_t;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md736"></a>
Configuration Parsing Function</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t parse_module_config(<span class="keyword">const</span> cJSON *config, module_private_data_t *module_private_data) {</div>
<div class="line">    <span class="keywordflow">if</span> (!config || !module_private_data) {</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Parse integer values</span></div>
<div class="line">    cJSON *gpio_pin = cJSON_GetObjectItem(config, <span class="stringliteral">&quot;gpio_pin&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (cJSON_IsNumber(gpio_pin)) {</div>
<div class="line">        module_private_data-&gt;gpio_pin = gpio_pin-&gt;valueint;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;gpio_pin not found, using default: %d&quot;</span>, DEFAULT_GPIO_PIN);</div>
<div class="line">        module_private_data-&gt;gpio_pin = DEFAULT_GPIO_PIN;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Parse boolean values</span></div>
<div class="line">    cJSON *default_enabled = cJSON_GetObjectItem(config, <span class="stringliteral">&quot;default_enabled&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (cJSON_IsBool(default_enabled)) {</div>
<div class="line">        module_private_data-&gt;default_enabled = cJSON_IsTrue(default_enabled);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;default_enabled not found, using default: false&quot;</span>);</div>
<div class="line">        module_private_data-&gt;default_enabled = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Parse string values</span></div>
<div class="line">    cJSON *init_text = cJSON_GetObjectItem(config, <span class="stringliteral">&quot;init_text&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (cJSON_IsString(init_text)) {</div>
<div class="line">        strncpy(module_private_data-&gt;init_text, init_text-&gt;valuestring, <span class="keyword">sizeof</span>(module_private_data-&gt;init_text) - 1);</div>
<div class="line">        module_private_data-&gt;init_text[<span class="keyword">sizeof</span>(module_private_data-&gt;init_text) - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;init_text not found, using default&quot;</span>);</div>
<div class="line">        strncpy(module_private_data-&gt;init_text, <span class="stringliteral">&quot;Default Text&quot;</span>, <span class="keyword">sizeof</span>(module_private_data-&gt;init_text) - 1);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Parse float values</span></div>
<div class="line">    cJSON *temperature_offset = cJSON_GetObjectItem(config, <span class="stringliteral">&quot;temperature_offset&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (cJSON_IsNumber(temperature_offset)) {</div>
<div class="line">        module_private_data-&gt;temperature_offset = (float)temperature_offset-&gt;valuedouble;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;temperature_offset not found, using default: 0.0&quot;</span>);</div>
<div class="line">        module_private_data-&gt;temperature_offset = 0.0;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md737"></a>
Default Values</h1>
<h2><a class="anchor" id="autotoc_md738"></a>
Constants Definition</h2>
<div class="fragment"><div class="line"><span class="comment">// Default configuration values</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_GPIO_PIN           4</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_READ_INTERVAL_MS   5000</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_TASK_PRIORITY      5</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_STACK_SIZE         4096</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_INIT_TEXT          &quot;MindLab ESP32&quot;</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_TEMPERATURE_OFFSET 0.0</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_HUMIDITY_OFFSET    0.0</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md739"></a>
Fallback Logic</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t apply_default_config(module_private_data_t *module_private_data) {</div>
<div class="line">    <span class="comment">// Apply defaults if config parsing failed</span></div>
<div class="line">    module_private_data-&gt;gpio_pin = DEFAULT_GPIO_PIN;</div>
<div class="line">    module_private_data-&gt;read_interval_ms = DEFAULT_READ_INTERVAL_MS;</div>
<div class="line">    module_private_data-&gt;default_enabled = <span class="keyword">false</span>;</div>
<div class="line">    module_private_data-&gt;temperature_offset = DEFAULT_TEMPERATURE_OFFSET;</div>
<div class="line">    strncpy(module_private_data-&gt;init_text, DEFAULT_INIT_TEXT, <span class="keyword">sizeof</span>(module_private_data-&gt;init_text) - 1);</div>
<div class="line">    </div>
<div class="line">    ESP_LOGW(TAG, <span class="stringliteral">&quot;Applied default configuration&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md740"></a>
Runtime Configuration Changes</h1>
<h2><a class="anchor" id="autotoc_md741"></a>
Reconfiguration Support</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t module_reconfigure(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *module, <span class="keyword">const</span> cJSON *new_config) {</div>
<div class="line">    <span class="keywordflow">if</span> (!module || !new_config) {</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    module_private_data_t *module_private_data = (module_private_data_t *)module-&gt;<a class="code hl_variable" href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">private_data</a>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Parse new configuration</span></div>
<div class="line">    esp_err_t ret = parse_module_config(new_config, module_private_data);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to parse new configuration&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Apply new configuration</span></div>
<div class="line">    ret = apply_new_configuration(module_private_data);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to apply new configuration&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    ESP_LOGI(TAG, <span class="stringliteral">&quot;Module reconfigured successfully&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
<div class="ttc" id="astructmodule__t_html"><div class="ttname"><a href="structmodule__t.html">module_t</a></div><div class="ttdoc">მოდულის ძირითადი სტრუქტურა, რომელიც განსაზღვრავს ფრეიმვორქის მოდულის კონტრაქტს.</div><div class="ttdef"><b>Definition</b> base_module.h:133</div></div>
<div class="ttc" id="astructmodule__t_html_a2e4e556e94d9d5402250b0524a7c0196"><div class="ttname"><a href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">module_t::private_data</a></div><div class="ttdeci">void * private_data</div><div class="ttdoc">მაჩვენებელი მოდულის შიდა მონაცემებზე.</div><div class="ttdef"><b>Definition</b> base_module.h:157</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md742"></a>
Configuration Validation</h1>
<h2><a class="anchor" id="autotoc_md743"></a>
Input Validation</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t validate_module_config(<span class="keyword">const</span> module_private_data_t *module_private_data) {</div>
<div class="line">    <span class="comment">// Validate GPIO pin</span></div>
<div class="line">    <span class="keywordflow">if</span> (module_private_data-&gt;gpio_pin &lt; 0 || module_private_data-&gt;gpio_pin &gt; 39) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid GPIO pin: %d&quot;</span>, module_private_data-&gt;gpio_pin);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Validate intervals</span></div>
<div class="line">    <span class="keywordflow">if</span> (module_private_data-&gt;read_interval_ms &lt; 100 || module_private_data-&gt;read_interval_ms &gt; 60000) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid read interval: %lu ms&quot;</span>, module_private_data-&gt;read_interval_ms);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Validate string lengths</span></div>
<div class="line">    <span class="keywordflow">if</span> (strlen(module_private_data-&gt;init_text) == 0) {</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;Empty init_text, using default&quot;</span>);</div>
<div class="line">        strncpy((<span class="keywordtype">char</span> *)module_private_data-&gt;init_text, DEFAULT_INIT_TEXT, <span class="keyword">sizeof</span>(module_private_data-&gt;init_text) - 1);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md744"></a>
Configuration Access Patterns</h1>
<h2><a class="anchor" id="autotoc_md745"></a>
Using Config Manager</h2>
<div class="fragment"><div class="line"><span class="comment">// მოდულის კონფიგურაცია იღება modules მასივიდან type-ის მიხედვით</span></div>
<div class="line"><span class="comment">// Config Manager ავტომატურად პოულობს შესაბამის მოდულს</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get configuration value from module config</span></div>
<div class="line"><span class="keywordtype">char</span> broker_url[128];</div>
<div class="line">esp_err_t ret = fmw_config_get_string(<span class="stringliteral">&quot;mqtt_module.config.broker_uri&quot;</span>, </div>
<div class="line">                                      broker_url, <span class="keyword">sizeof</span>(broker_url));</div>
<div class="line"><span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">    strncpy(broker_url, DEFAULT_BROKER_URL, <span class="keyword">sizeof</span>(broker_url) - 1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get integer value from module config</span></div>
<div class="line"><span class="keywordtype">int</span> update_interval;</div>
<div class="line">ret = fmw_config_get_int(<span class="stringliteral">&quot;dht22_module.config.update_interval_sec&quot;</span>, &amp;update_interval);</div>
<div class="line"><span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">    update_interval = DEFAULT_UPDATE_INTERVAL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get global configuration</span></div>
<div class="line"><span class="keywordtype">char</span> device_prefix[32];</div>
<div class="line">ret = fmw_config_get_string(<span class="stringliteral">&quot;global_config.device.id.prefix&quot;</span>, </div>
<div class="line">                           device_prefix, <span class="keyword">sizeof</span>(device_prefix));</div>
<div class="line"><span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">    strncpy(device_prefix, <span class="stringliteral">&quot;MINDLAB&quot;</span>, <span class="keyword">sizeof</span>(device_prefix) - 1);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md746"></a>
აკრძალული პრაქტიკები</h1>
<p>❌ <b>არ გავაკეთოთ:</b></p>
<div class="fragment"><div class="line"><span class="comment">// Hardcoded values in code</span></div>
<div class="line"><span class="preprocessor">#define DISPLAY_WIDTH  128    </span><span class="comment">// Should be in config!</span></div>
<div class="line"><span class="preprocessor">#define SENSOR_PIN     4      </span><span class="comment">// Should be in config!</span></div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER    &quot;mqtt://broker.example.com&quot;  </span><span class="comment">// Should be in config!</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Magic numbers in code</span></div>
<div class="line">ssd1306_init(display_width, display_height);  <span class="comment">// Width and height should come from config</span></div>
<div class="line">gpio_set_level(gpio_pin, active_level);   <span class="comment">// GPIO pin should come from config</span></div>
</div><!-- fragment --><p>✅ <b>ყოველთვის გავაკეთოთ:</b></p>
<div class="fragment"><div class="line"><span class="comment">// All parameters from configuration</span></div>
<div class="line">ssd1306_init(module_private_data-&gt;display_width, module_private_data-&gt;display_height);</div>
<div class="line">gpio_set_level(module_private_data-&gt;gpio_pin, module_private_data-&gt;active_level);</div>
<div class="line">mqtt_connect(module_private_data-&gt;broker_url, module_private_data-&gt;client_id);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md747"></a>
Configuration Categories</h1>
<h2><a class="anchor" id="autotoc_md748"></a>
1. Hardware Parameters</h2>
<ul>
<li>GPIO pins</li>
<li>I2C addresses</li>
<li>SPI frequencies</li>
<li>UART baud rates</li>
</ul>
<h2><a class="anchor" id="autotoc_md749"></a>
2. Timing Parameters</h2>
<ul>
<li>Task intervals</li>
<li>Timeouts</li>
<li>Retry delays</li>
<li>Watchdog periods</li>
</ul>
<h2><a class="anchor" id="autotoc_md750"></a>
3. Display Parameters</h2>
<ul>
<li>Screen dimensions</li>
<li>Font sizes</li>
<li>Default text</li>
<li>Brightness levels</li>
</ul>
<h2><a class="anchor" id="autotoc_md751"></a>
4. Network Parameters</h2>
<ul>
<li>MQTT broker URLs</li>
<li>WiFi credentials</li>
<li>Connection timeouts</li>
<li>QoS levels</li>
</ul>
<h2><a class="anchor" id="autotoc_md752"></a>
5. Sensor Parameters</h2>
<ul>
<li>Calibration offsets</li>
<li>Filtering settings</li>
<li>Sampling rates</li>
<li>Threshold values</li>
</ul>
<h1><a class="anchor" id="autotoc_md753"></a>
შეჯამება</h1>
<ol type="1">
<li><b>ყველაფერი</b> <code>system_config.json</code>-ში</li>
<li><b>არაფერი</b> hardcoded კოდში</li>
<li><b>ყოველთვის</b> validation და default values</li>
<li><b>მხარდაჭერა</b> runtime reconfiguration-ის</li>
<li><b>ნათელი</b> error handling და logging </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
