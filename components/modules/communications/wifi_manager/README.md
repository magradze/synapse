# ­ЪЊХ рЃЏрЃЮрЃЊрЃБрЃџрЃў `wifi_manager`

## 1. ­ЪЊю рЃЏрЃўрЃЏрЃЮрЃ«рЃўрЃџрЃЋрЃљ

**рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў:** `wifi_manager`  
**рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ:** `communications`  
**рЃЋрЃћрЃарЃАрЃўрЃљ:** 2.0.0  
**рЃљрЃЋрЃбрЃЮрЃарЃў:** рЃњрЃўрЃЮрЃарЃњрЃў рЃЏрЃљрЃњрЃарЃљрЃФрЃћ & Synapse AI Assistant

`wifi_manager` рЃљрЃарЃўрЃА Synapse Framework-рЃўрЃА рЃцрЃБрЃюрЃЊрЃљрЃЏрЃћрЃюрЃбрЃБрЃарЃў рЃАрЃљрЃЎрЃЮрЃЏрЃБрЃюрЃўрЃЎрЃљрЃфрЃўрЃЮ рЃЏрЃЮрЃЊрЃБрЃџрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА WiFi рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃАрЃарЃБрЃџрЃцрЃљрЃАрЃЮрЃЋрЃљрЃю рЃЏрЃљрЃарЃЌрЃЋрЃљрЃА. рЃЏрЃўрЃАрЃў рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃљрЃЏрЃЮрЃфрЃљрЃюрЃћрЃЉрЃўрЃљ:

- **рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў рЃЏрЃљрЃарЃЌрЃЋрЃљ:** рЃерЃћрЃюрЃљрЃ«рЃБрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃЌ (credentials) рЃЦрЃАрЃћрЃџрЃЌрЃљрЃю рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў рЃЊрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃљ.
- **рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃљрЃдрЃЊрЃњрЃћрЃюрЃљ:** рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃњрЃљрЃгрЃДрЃЋрЃћрЃбрЃўрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў, рЃЏрЃўрЃАрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃА рЃЏрЃфрЃЊрЃћрЃџрЃЮрЃЉрЃљ рЃћрЃЦрЃАрЃърЃЮрЃюрЃћрЃюрЃфрЃўрЃљрЃџрЃБрЃарЃў backoff рЃАрЃбрЃарЃљрЃбрЃћрЃњрЃўрЃўрЃЌ.
- **Provisioning-рЃЌрЃљрЃю рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ:** рЃљрЃ«рЃљрЃџрЃў рЃЦрЃАрЃћрЃџрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ рЃЊрЃљ рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ `provisioning` рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃЊрЃљрЃю.
- **рЃАрЃўрЃАрЃбрЃћрЃЏрЃБрЃарЃў рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃфрЃўрЃљ:** рЃАрЃ«рЃЋрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃА рЃўрЃюрЃцрЃЮрЃарЃЏрЃўрЃарЃћрЃЉрЃљ WiFi рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃАрЃбрЃљрЃбрЃБрЃАрЃўрЃА рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃ«рЃћрЃЉ (`CONNECTED`, `DISCONNECTED`, `IP_ASSIGNED`).
- **CLI рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ:** рЃАрЃарЃБрЃџрЃў, рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃбрЃўрЃБрЃџрЃў рЃЏрЃљрЃарЃЌрЃЋрЃљ рЃЊрЃљ рЃЊрЃўрЃљрЃњрЃюрЃЮрЃАрЃбрЃўрЃЎрЃљ рЃАрЃћрЃарЃўрЃБрЃџрЃў рЃЎрЃЮрЃюрЃАрЃЮрЃџрЃўрЃЊрЃљрЃю.

## 2. ­ЪЈЌ№ИЈ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃърЃарЃўрЃюрЃфрЃўрЃърЃћрЃЉрЃў

- **Event-driven рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ:** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃЦрЃбрЃўрЃБрЃарЃљрЃЊ рЃўрЃДрЃћрЃюрЃћрЃЉрЃА `Event Bus`-рЃА. рЃўрЃА рЃарЃЮрЃњрЃЮрЃарЃф **рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА** рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА рЃАрЃљрЃЎрЃБрЃЌрЃљрЃарЃў рЃАрЃбрЃљрЃбрЃБрЃАрЃўрЃА рЃерЃћрЃАрЃљрЃ«рЃћрЃЉ, рЃўрЃАрЃћ **рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА** рЃАрЃ«рЃЋрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃА (рЃЏрЃљрЃњ., `provisioning`, `system_manager`) рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА.
- **рЃЏрЃЊрЃњрЃарЃљрЃЊрЃЮрЃЉрЃљ (Persistence):** рЃЦрЃАрЃћрЃџрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў (SSID рЃЊрЃљ рЃърЃљрЃарЃЮрЃџрЃў) рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃЊ рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ **NVS (Non-Volatile Storage)** рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃљрЃерЃў, рЃарЃљрЃф рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА, рЃарЃЮрЃЏ рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃЏ рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃерЃћрЃФрЃџрЃЮрЃА рЃЦрЃАрЃћрЃџрЃЌрЃљрЃю рЃЊрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃљ.
- **рЃцрЃЮрЃюрЃБрЃарЃў рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃћрЃЉрЃў:** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃћрЃДрЃарЃЊрЃюрЃЮрЃЉрЃљ ESP-IDF-рЃўрЃА `event loop` рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃА рЃЊрЃљ FreeRTOS рЃбрЃљрЃўрЃЏрЃћрЃарЃћрЃЉрЃА, рЃарЃљрЃЌрЃљ рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃўрЃА рЃДрЃЋрЃћрЃџрЃљ рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃљ рЃљрЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃБрЃџрЃљрЃЊ, рЃцрЃЮрЃюрЃБрЃа рЃарЃћрЃЪрЃўрЃЏрЃерЃў рЃерЃћрЃАрЃарЃБрЃџрЃЊрЃћрЃА.
- **рЃЊрЃћрЃЎрЃљрЃърЃџрЃўрЃюрЃњрЃў (Decoupling):** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃа рЃљрЃарЃўрЃА рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа рЃЊрЃљрЃЏрЃЮрЃЎрЃўрЃЊрЃћрЃЉрЃБрЃџрЃў `command_router`-рЃќрЃћ. рЃўрЃА рЃўрЃДрЃћрЃюрЃћрЃЉрЃА `FMW_EVENT_SYSTEM_START_COMPLETE` рЃўрЃЋрЃћрЃюрЃЌрЃА, рЃарЃљрЃЌрЃљ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљ рЃЏрЃЮрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЏрЃљрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃарЃљрЃф рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃћрЃЉрЃљ, рЃарЃЮрЃЏ `command_router`-рЃўрЃА рЃАрЃћрЃарЃЋрЃўрЃАрЃў рЃБрЃЎрЃЋрЃћ рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃўрЃљ.

## 3. РџЎ№ИЈ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃљрЃЉрЃљрЃќрЃўрЃАрЃЮ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ рЃ«рЃЊрЃћрЃЉрЃљ `system_config.json` рЃцрЃљрЃўрЃџрЃерЃў, рЃЌрЃБрЃЏрЃфрЃљ рЃЏрЃўрЃАрЃў рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃўрЃА рЃБрЃЏрЃћрЃбрЃћрЃАрЃЮрЃЉрЃљ рЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ `Kconfig`-рЃўрЃА (`menuconfig`) рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃўрЃЌ.

**`system_config.json` рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```json
{
    "type": "wifi_manager",
    "enabled": true,
    "config": {
        "instance_name": "main_wifi"
    }
}
```

**`Kconfig` рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў (`idf.py menuconfig`):**

`Component config` -> `Synapse Framework` -> `Modules` -> `WiFi Manager` рЃЏрЃћрЃюрЃўрЃБрЃерЃў рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљрЃЌ рЃЊрЃљрЃљрЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃўрЃарЃЮрЃЌ:

- **Reconnect Attempts:** рЃ«рЃћрЃџрЃљрЃ«рЃљрЃџрЃў рЃЊрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃўрЃА рЃЏрЃфрЃЊрЃћрЃџрЃЮрЃЉрЃћрЃЉрЃўрЃА рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ.
- **Reconnect Delay:** рЃАрЃљрЃгрЃДрЃўрЃАрЃў рЃЊрЃљрЃДрЃЮрЃЋрЃюрЃћрЃЉрЃљ рЃ«рЃћрЃџрЃљрЃ«рЃљрЃџрЃў рЃЊрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃўрЃАрЃљрЃА.
- **NVS Namespace:** NVS-рЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃАрЃљрЃЊрЃљрЃф рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў.

## 4. ­ЪЊб рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃў (Events)

### рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃБрЃџрЃў рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃў

`wifi_manager` рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃќрЃћрЃф рЃАрЃ«рЃЋрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃА рЃерЃћрЃБрЃФрЃџрЃўрЃљрЃЌ рЃњрЃљрЃЏрЃЮрЃгрЃћрЃарЃљ:

| рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў | рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў (Payload) | рЃљрЃдрЃгрЃћрЃарЃљ |
|:---|:---|:---|
| `WIFI_EVENT_CONNECTED` | `NULL` | рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃБрЃЎрЃљрЃЋрЃерЃўрЃарЃЊрЃљ WiFi рЃЦрЃАрЃћрЃџрЃА. |
| `WIFI_EVENT_DISCONNECTED` | `NULL` | рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃЏ рЃЊрЃљрЃЎрЃљрЃарЃњрЃљ рЃЎрЃљрЃЋрЃерЃўрЃарЃў WiFi рЃЦрЃАрЃћрЃџрЃЌрЃљрЃю. |
| `WIFI_EVENT_IP_ASSIGNED` | `esp_netif_ip_info_t*` | рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃЏ рЃЏрЃўрЃўрЃдрЃЮ IP рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃў DHCP рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃАрЃњрЃљрЃю. |
| `WIFI_CREDENTIALS_NOT_FOUND` | `NULL` | NVS-рЃерЃў рЃЋрЃћрЃа рЃЏрЃЮрЃўрЃФрЃћрЃЉрЃюрЃљ рЃерЃћрЃюрЃљрЃ«рЃБрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў, рЃАрЃљрЃГрЃўрЃарЃЮрЃљ provisioning. |

### рЃњрЃљрЃЏрЃЮрЃгрЃћрЃарЃўрЃџрЃў рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃў

`wifi_manager` рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА рЃерЃћрЃЏрЃЊрЃћрЃњ рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА:

| рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў | рЃљрЃдрЃгрЃћрЃарЃљ |
|:---|:---|
| `PROV_CREDENTIALS_RECEIVED` | рЃЏрЃўрЃўрЃдрЃЮ рЃљрЃ«рЃљрЃџрЃў WiFi рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў `provisioning` рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃАрЃњрЃљрЃю. |
| `FMW_EVENT_SYSTEM_START_COMPLETE` | рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ, рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ CLI рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљ. |

## 5. Рїе№ИЈ CLI рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃў (Command Line Interface)

рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃА `wifi` рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃўрЃФрЃџрЃћрЃЋрЃљ WiFi-рЃА рЃАрЃарЃБрЃџрЃў рЃЏрЃљрЃарЃЌрЃЋрЃўрЃАрЃљ рЃЊрЃљ рЃЊрЃўрЃљрЃњрЃюрЃЮрЃАрЃбрЃўрЃЎрЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА.

| рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ | рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃў | рЃљрЃдрЃгрЃћрЃарЃљ |
|:---|:---|:---|
| `wifi status` | - | Рё╣№ИЈ рЃњрЃљрЃЏрЃЮрЃљрЃЦрЃЋрЃА рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ: рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃАрЃбрЃљрЃбрЃБрЃАрЃў, SSID, RSSI, IP, MAC рЃЊрЃљ Hostname. |
| `wifi scan` | - | ­ЪЊА рЃљрЃАрЃЎрЃљрЃюрЃћрЃарЃћрЃЉрЃА рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃљрЃЦрЃЋрЃА рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃў WiFi рЃЦрЃАрЃћрЃџрЃћрЃЉрЃўрЃА рЃАрЃўрЃљ. |
| `wifi connect` | `<ssid> <password>` | ­ЪћЌ рЃфрЃЊрЃўрЃџрЃЮрЃЉрЃА рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџ рЃЦрЃАрЃћрЃџрЃЌрЃљрЃю рЃЊрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃљрЃА рЃЊрЃљ рЃўрЃюрЃљрЃ«рЃљрЃЋрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃА NVS-рЃерЃў. |
| `wifi disconnect` | - | ­Ъћї рЃгрЃДрЃЋрЃћрЃбрЃА рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ WiFi рЃЎрЃљрЃЋрЃерЃўрЃарЃА. |
| `wifi enable` | - | РюЁ рЃарЃЌрЃљрЃЋрЃА `wifi_manager` рЃЏрЃЮрЃЊрЃБрЃџрЃА. |
| `wifi disable` | - | РЮї рЃЌрЃўрЃерЃљрЃЋрЃА `wifi_manager` рЃЏрЃЮрЃЊрЃБрЃџрЃА рЃЊрЃљ рЃгрЃДрЃЋрЃћрЃбрЃА рЃЎрЃљрЃЋрЃерЃўрЃарЃА. |
| `wifi erase_creds` | - | ­ЪЌЉ№ИЈ рЃерЃџрЃўрЃА NVS-рЃерЃў рЃерЃћрЃюрЃљрЃ«рЃБрЃџ рЃДрЃЋрЃћрЃџрЃљ WiFi рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃА. |
| `wifi set_hostname` | `<name> [--reconnect]` | ­ЪЊЮ рЃфрЃЋрЃџрЃўрЃА рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃўрЃА Hostname-рЃА. `--reconnect` рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃўрЃЌ рЃЊрЃљрЃБрЃДрЃЮрЃЋрЃюрЃћрЃЉрЃџрЃўрЃЋ рЃњрЃљрЃюрЃљрЃљрЃ«рЃџрЃћрЃЉрЃА рЃЎрЃљрЃЋрЃерЃўрЃарЃА. |
| `wifi set_power_save` | `<off\|min\|max>` | ­ЪћІ рЃљрЃДрЃћрЃюрЃћрЃЉрЃА WiFi-рЃА рЃћрЃюрЃћрЃарЃњрЃўрЃўрЃА рЃЊрЃљрЃќрЃЮрЃњрЃЋрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃА. |

## 6. ­ЪњА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў

рЃгрЃљрЃарЃЏрЃЮрЃЋрЃўрЃЊрЃњрЃўрЃюрЃЮрЃЌ, рЃарЃЮрЃЏ `mqtt_module`-рЃА рЃАрЃБрЃарЃА рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃЊрЃљрЃЏрЃДрЃљрЃарЃћрЃЉрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЏрЃљрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃарЃљрЃф рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ рЃЏрЃўрЃўрЃдрЃћрЃЉрЃА IP рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃА.

**`mqtt_module.c`-рЃерЃў:**

```c
// 1. init рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃерЃў, рЃњрЃљрЃЏрЃЮрЃЋрЃўрЃгрЃћрЃарЃЮрЃЌ рЃАрЃљрЃГрЃўрЃарЃЮ рЃўрЃЋрЃћрЃюрЃЌрЃќрЃћ
static esp_err_t mqtt_module_init(module_t *self) {
    // ...
    fmw_event_bus_subscribe("WIFI_EVENT_IP_ASSIGNED", self);
    // ...
    return ESP_OK;
}

// 2. рЃЊрЃљрЃЋрЃљрЃЏрЃБрЃерЃљрЃЮрЃЌ рЃўрЃЋрЃћрЃюрЃЌрЃў handle_event рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃерЃў
static void mqtt_module_handle_event(module_t *self, const char *event_name, void *event_data) {
    if (strcmp(event_name, "WIFI_EVENT_IP_ASSIGNED") == 0) {
        ESP_LOGI(TAG, "WiFi is connected and has an IP. Starting MQTT connection...");
        
        // рЃљрЃЦ рЃЋрЃўрЃгрЃДрЃћрЃЉрЃЌ MQTT рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃЊрЃљрЃЏрЃДрЃљрЃарЃћрЃЉрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљрЃА
        start_mqtt_connection(); 
    }
    
    // рЃљрЃа рЃЊрЃљрЃњрЃЋрЃљрЃЋрЃўрЃгрЃДрЃЊрЃћрЃА wrapper-рЃўрЃА рЃњрЃљрЃЌрЃљрЃЋрЃўрЃАрЃБрЃцрЃџрЃћрЃЉрЃљ
    if (event_data) {
        fmw_event_data_release((event_data_wrapper_t *)event_data);
    }
}
