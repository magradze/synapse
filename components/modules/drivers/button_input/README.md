# ­Ъћў рЃЏрЃЮрЃЊрЃБрЃџрЃў: `button_input`

**­ЪЌѓ№ИЈ рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ:** `drivers`  
**Рюњ№ИЈ рЃљрЃЋрЃбрЃЮрЃарЃў:** Giorgi Magradze & Synapse AI Expert  
**­Ъћќ рЃЋрЃћрЃарЃАрЃўрЃљ:** 1.0.0

## 1. ­ЪЊю рЃЏрЃўрЃЏрЃЮрЃ«рЃўрЃџрЃЋрЃљ

`button_input` рЃљрЃарЃўрЃА Synapse Framework-рЃўрЃА **рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃерЃћрЃбрЃљрЃюрЃўрЃА (User Input) рЃцрЃБрЃюрЃЊрЃљрЃЏрЃћрЃюрЃбрЃБрЃарЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў**. рЃўрЃА рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЏрЃљрЃарЃбрЃўрЃЋ, рЃАрЃљрЃўрЃЏрЃћрЃЊрЃЮ рЃЊрЃљ рЃЏрЃЮрЃЦрЃюрЃўрЃџ рЃЏрЃћрЃЦрЃљрЃюрЃўрЃќрЃЏрЃА рЃљрЃърЃљрЃарЃљрЃбрЃБрЃарЃБрЃџрЃў, рЃбрЃљрЃЦрЃбрЃўрЃџрЃБрЃарЃў рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃўрЃА рЃЊрЃљрЃАрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃџрЃљрЃЊ.

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃљрЃЏрЃЮрЃфрЃљрЃюрЃљрЃљ, рЃЊрЃљрЃљрЃцрЃўрЃЦрЃАрЃўрЃарЃЮрЃА рЃдрЃўрЃџрЃљрЃЎрЃќрЃћ рЃЊрЃљрЃГрЃћрЃарЃљ GPIO рЃерЃћрЃцрЃћрЃарЃ«рЃћрЃЉрЃћрЃЉрЃўрЃА (Interrupts) рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ, рЃЏрЃЮрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃА рЃАрЃўрЃњрЃюрЃљрЃџрЃўрЃА "рЃњрЃљрЃгрЃЏрЃћрЃюрЃЊрЃљ" (Debouncing) рЃЊрЃљ рЃерЃћрЃЏрЃЊрЃћрЃњ, `Event Bus`-рЃќрЃћ рЃњрЃљрЃЏрЃЮрЃљрЃЦрЃЋрЃћрЃДрЃюрЃЮрЃА рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџрЃў `FMW_EVENT_BUTTON_PRESSED` рЃўрЃЋрЃћрЃюрЃЌрЃў. рЃћрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА рЃљрЃФрЃџрЃћрЃЋрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа рЃАрЃ«рЃЋрЃљ рЃюрЃљрЃгрЃўрЃџрЃА (рЃЏрЃљрЃњ., `ssd1 ЯфЅ6_oled_display`), рЃарЃћрЃљрЃњрЃўрЃарЃћрЃЉрЃљ рЃЏрЃЮрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃА рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃцрЃўрЃќрЃўрЃЎрЃБрЃа рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃфрЃўрЃљрЃќрЃћ рЃўрЃАрЃћ, рЃарЃЮрЃЏ рЃљрЃа рЃўрЃДрЃЮрЃА рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа рЃЊрЃљрЃЏрЃЮрЃЎрЃўрЃЊрЃћрЃЉрЃБрЃџрЃў рЃљрЃърЃљрЃарЃљрЃбрЃБрЃарЃБрЃџ рЃЊрЃћрЃбрЃљрЃџрЃћрЃЉрЃќрЃћ.

## 2. ­ЪЈЏ№ИЈ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃърЃарЃўрЃюрЃфрЃўрЃърЃћрЃЉрЃў

- **Event Producer:** ­ЪЊб рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃўрЃА рЃАрЃБрЃцрЃЌрЃљ "рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃўрЃА рЃЏрЃгрЃљрЃарЃЏрЃЮрЃћрЃЉрЃћрЃџрЃў". рЃЏрЃўрЃАрЃў рЃћрЃарЃЌрЃљрЃЊрЃћрЃарЃЌрЃў рЃњрЃљрЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў рЃљрЃарЃўрЃА `FMW_EVENT_BUTTON_PRESSED` рЃўрЃЋрЃћрЃюрЃЌрЃў.
- **рЃерЃћрЃцрЃћрЃарЃ«рЃћрЃЉрЃћрЃЉрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџрЃў:** РџА№ИЈ рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃћрЃцрЃћрЃЦрЃбрЃБрЃарЃЮрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃДрЃћрЃюрЃћрЃЉрЃА GPIO ISR-рЃћрЃЉрЃА (Interrupt Service Routines) рЃдрЃўрЃџрЃљрЃЎрЃўрЃА рЃЊрЃљрЃГрЃћрЃарЃўрЃА рЃЏрЃЮрЃЏрЃћрЃюрЃбрЃўрЃА рЃЊрЃљрЃАрЃљрЃцрЃўрЃЦрЃАрЃўрЃарЃћрЃЉрЃџрЃљрЃЊ.
- **рЃљрЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃБрЃџрЃў рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃљ:** ­Ъћё ISR-рЃў рЃљрЃарЃўрЃА рЃБрЃЎрЃўрЃЊрЃБрЃарЃћрЃАрЃљрЃЊ рЃАрЃгрЃарЃљрЃцрЃў Рђћ рЃўрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљрЃА FreeRTOS рЃарЃўрЃњрЃерЃў. рЃДрЃЋрЃћрЃџрЃљ "рЃЏрЃФрЃўрЃЏрЃћ" рЃАрЃљрЃЏрЃБрЃерЃљрЃЮ, рЃЏрЃљрЃЌ рЃерЃЮрЃарЃўрЃА Debouncing рЃЊрЃљ рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃљ, рЃАрЃарЃБрЃџрЃЊрЃћрЃЉрЃљ рЃњрЃљрЃЏрЃЮрЃДрЃЮрЃцрЃўрЃџ, рЃЊрЃљрЃЉрЃљрЃџрЃў рЃърЃарЃўрЃЮрЃарЃўрЃбрЃћрЃбрЃўрЃА рЃбрЃљрЃАрЃЎрЃерЃў.
- **Debouncing:** ­ЪЏА№ИЈ рЃЕрЃљрЃерЃћрЃюрЃћрЃЉрЃБрЃџрЃў рЃљрЃЦрЃЋрЃА рЃЏрЃљрЃарЃбрЃўрЃЋрЃў, рЃЊрЃарЃЮрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџрЃў Debouncing рЃЏрЃћрЃЦрЃљрЃюрЃўрЃќрЃЏрЃў, рЃарЃљрЃЌрЃљ рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃљрЃЋрЃўрЃфрЃўрЃџрЃЮрЃЌ рЃдрЃўрЃџрЃљрЃЎрЃўрЃА рЃћрЃарЃЌрЃў рЃЊрЃљрЃГрЃћрЃарЃўрЃА рЃЏрЃарЃљрЃЋрЃљрЃџрЃ»рЃћрЃарЃљрЃЊ рЃАрЃўрЃњрЃюрЃљрЃџрЃљрЃЊ рЃљрЃдрЃЦрЃЏрЃљ.
- **рЃЏрЃЮрЃЦрЃюрЃўрЃџрЃў рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ:** РџЎ№ИЈ рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃАрЃарЃБрЃџрЃљрЃЊ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃўрЃарЃћрЃЉрЃљрЃЊрЃўрЃљ `config.json`-рЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃўрЃЌ, рЃарЃљрЃф рЃўрЃФрЃџрЃћрЃЋрЃљ рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃўрЃА рЃдрЃўрЃџрЃљрЃЎрЃўрЃА, рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа GPIO рЃърЃўрЃюрЃќрЃћ рЃЏрЃўрЃћрЃарЃЌрЃћрЃЉрЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА.

## 3. РџЎ№ИЈ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ (`config.json`)

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ рЃ«рЃЊрЃћрЃЉрЃљ `buttons` рЃЏрЃљрЃАрЃўрЃЋрЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃўрЃЌ, рЃАрЃљрЃЊрЃљрЃф рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃў рЃљрЃдрЃгрЃћрЃарЃА рЃћрЃарЃЌ рЃдрЃўрЃџрЃљрЃЎрЃА.

**рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```json
[
  {
    "type": "button_input",
    "enabled": true,
    "config": {
      "instance_name": "main_buttons",
      "buttons": [
        {
          "name": "UP",
          "gpio_pin": 34,
          "active_level": 0
        },
        {
          "name": "DOWN",
          "gpio_pin": 35,
          "active_level": 0
        },
        {
          "name": "OK",
          "gpio_pin": 32,
          "active_level": 0
        }
      ]
    }
  }
]
```

**`buttons` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў:**

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ |
| :--- | :--- | :--- | :---: |
| `name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃдрЃўрЃџрЃљрЃЎрЃўрЃА рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў рЃАрЃљрЃ«рЃћрЃџрЃў (рЃЏрЃљрЃњ., "UP", "OK"). рЃћрЃА рЃАрЃљрЃ«рЃћрЃџрЃў рЃњрЃљрЃўрЃњрЃќрЃљрЃЋрЃюрЃћрЃЉрЃљ рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА `payload`-рЃерЃў. | РюЁ |
| `gpio_pin` | рЃарЃўрЃфрЃ«рЃЋрЃў | GPIO рЃърЃўрЃюрЃўрЃА рЃюрЃЮрЃЏрЃћрЃарЃў, рЃарЃЮрЃЏрЃћрЃџрЃќрЃћрЃф рЃдрЃўрЃџрЃљрЃЎрЃўрЃљ рЃЏрЃўрЃћрЃарЃЌрЃћрЃЉрЃБрЃџрЃў. | РюЁ |
| `active_level` | рЃарЃўрЃфрЃ«рЃЋрЃў | рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃЊрЃЮрЃюрЃћ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃљрЃГрЃћрЃарЃўрЃџ рЃЏрЃЊрЃњрЃЮрЃЏрЃљрЃарЃћрЃЮрЃЉрЃљрЃЊ рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ. `0` = Active-Low (pull-up), `1` = Active-High (pull-down). | РЮї (Default: `0`) |

## 4. ­ЪЊб рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃБрЃџрЃў рЃўрЃЋрЃћрЃюрЃЌрЃў

- **рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў:** `FMW_EVENT_BUTTON_PRESSED`
- **Payload-рЃўрЃА рЃбрЃўрЃърЃў:** `fmw_button_payload_t`
- **Payload-рЃўрЃА рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃў (рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў):**

  ```c
  // fmw_button_payload_t payload;
  // payload.button_name = "UP";
  ```

## 5. ­Ъћї рЃЏрЃўрЃћрЃарЃЌрЃћрЃЉрЃўрЃА рЃАрЃЦрЃћрЃЏрЃљ

рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃўрЃљ **рЃерЃўрЃЊрЃљ Pull-up рЃарЃћрЃќрЃўрЃАрЃбрЃЮрЃарЃћрЃЉрЃўрЃА** рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ (`active_level: 0` рЃарЃћрЃЪрЃўрЃЏрЃерЃў). рЃдрЃўрЃџрЃљрЃЎрЃў рЃБрЃюрЃЊрЃљ рЃерЃћрЃћрЃарЃЌрЃЊрЃћрЃА рЃерЃћрЃЏрЃЊрЃћрЃњрЃюрЃљрЃўрЃарЃљрЃЊ:

- **рЃћрЃарЃЌрЃў рЃцрЃћрЃ«рЃў:** ESP32-рЃўрЃА **GND** рЃърЃўрЃюрЃќрЃћ.
- **рЃЏрЃћрЃЮрЃарЃћ рЃцрЃћрЃ«рЃў:** ESP32-рЃўрЃА рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃА **GPIO** рЃърЃўрЃюрЃќрЃћ.

**рЃДрЃБрЃарЃљрЃЊрЃдрЃћрЃЉрЃљ:** ESP32-рЃўрЃА рЃќрЃЮрЃњрЃўрЃћрЃарЃЌ рЃърЃўрЃюрЃА (рЃЏрЃљрЃњ., GPIO 34, 35) рЃљрЃа рЃњрЃљрЃљрЃЕрЃюрЃўрЃљ рЃерЃўрЃЊрЃљ pull-up/pull-down рЃарЃћрЃќрЃўрЃАрЃбрЃЮрЃарЃћрЃЉрЃў. рЃљрЃЏ рЃърЃўрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃАрЃљрЃА, рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ **рЃњрЃљрЃарЃћ 10k╬Е Pull-up рЃарЃћрЃќрЃўрЃАрЃбрЃЮрЃарЃўрЃА** рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ GPIO рЃърЃўрЃюрЃАрЃљ рЃЊрЃљ 3.3V-рЃА рЃерЃЮрЃарЃўрЃА.

```mermaid
graph TD
    subgraph ESP32
        P1(3.3V)
        P2(GPIO 34)
        P3(GND)
    end

    subgraph Button Circuit
        R1("10k╬Е Pull-up")
        B1("Button")
    end

    P1 -- to --> R1
    R1 -- to --> P2
    P2 -- to --> B1_Pin1
    B1_Pin2 -- to --> P3

    style P1 fill:#D2042D,stroke:#fff,color:#fff
    style P3 fill:#333,stroke:#fff,color:#fff
```

рЃЊрЃўрЃљрЃњрЃарЃљрЃЏрЃљ рЃљрЃАрЃљрЃ«рЃљрЃЋрЃА рЃњрЃљрЃарЃћ Pull-up рЃарЃћрЃќрЃўрЃАрЃбрЃЮрЃарЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљрЃА GPIO 34-рЃўрЃАрЃЌрЃЋрЃўрЃА.
