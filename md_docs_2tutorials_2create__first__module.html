<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Synapse ESP Framework: პირველი საკუთარი მოდულის შექმნა (v2.0)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Synapse ESP Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2tutorials_2create__first__module.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">პირველი საკუთარი მოდულის შექმნა (v2.0)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2037"></a> </p>
<h1><a class="anchor" id="autotoc_md2038"></a>
მიზანი</h1>
<p>ეს სახელმძღვანელო გაჩვენებთ, როგორ შექმნათ ახალი, სრულფასოვანი მოდული Synapse ESP Framework-ში. ჩვენ გამოვიყენებთ <code>create_module.py</code> სკრიპტს, რათა ავტომატურად დავაგენერიროთ მოდულის ჩონჩხი და შემდეგ შევავსოთ ის საბაზისო ლოგიკით. ეს გაკვეთილი ასევე მოიცავს სერვისის რეგისტრაციის ახალ, საუკეთესო პრაქტიკას.</p>
<h1><a class="anchor" id="autotoc_md2039"></a>
1. საჭიროების განსაზღვრა</h1>
<ul>
<li><b>ამოცანა:</b> შევქმნათ მარტივი "მისალმების" მოდული, სახელად <code>greeter_module</code>, რომელიც ამჯერად იქნება Service Provider-იც.</li>
<li><b>ფუნქციონალი:</b><ol type="1">
<li><code>start</code> ფაზაში, <code>System Timer</code> სერვისის გამოყენებით, დაგეგმოს პერიოდული ივენთი <code>GREETING_TIMER_TICK</code>.</li>
<li>როდესაც მიიღებს ამ ივენთს, <code>Event Bus</code>-ზე გამოაქვეყნოს ახალი, საკუთარი ივენთი <code>GREETING_MESSAGE_READY</code> <code>payload</code>-ით.</li>
<li>დაარეგისტრიროს <code>greet</code> CLI ბრძანება.</li>
<li>**(ახალი)** დაარეგისტრიროს საკუთარი Service API, რომელსაც ექნება ერთი ფუნქცია: <code>get_greeting_text()</code>.</li>
</ol>
</li>
<li><b>კატეგორია:</b> <code>utilities</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md2040"></a>
2. მოდულის ჩონჩხის გენერაცია</h1>
<p>ხელით ფაილების შექმნის ნაცვლად, ჩვენ გამოვიყენებთ <code>create_module.py</code> სკრიპტს.</p>
<ol type="1">
<li>გახსენით ტერმინალი პროექტის root დირექტორიაში.</li>
<li><p class="startli">გაუშვით სკრიპტი ინტერაქტიულ რეჟიმში:</p>
<div class="fragment"><div class="line">python3 tools/create_module.py</div>
</div><!-- fragment --></li>
<li>უპასუხეთ კითხვებს შემდეგნაირად:<ul>
<li><b>შეიყვანეთ მოდულის სრული სახელი:</b> <code>Greeter Module</code></li>
<li><b>აირჩიეთ კატეგორია:</b> <code>utilities</code></li>
<li><b>აირჩიეთ მოდულის არქეტიპი:</b> <code>Event &amp; Service &amp; Command</code> (რადგან ჩვენი მოდული სამივე ფუნქციონალს მოიცავს).</li>
<li>დანარჩენ კითხვებს შეგიძლიათ დაეთანხმოთ (Enter).</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md2041"></a>
3. კონფიგურაცია</h1>
<ol type="1">
<li><p class="startli"><b>Runtime კონფიგურაცია:</b> გახსენით ახლად შექმნილი <code>greeter_module/config.json</code> და შეავსეთ ის:</p>
<div class="fragment"><div class="line">[</div>
<div class="line">  {</div>
<div class="line">    &quot;type&quot;: &quot;greeter_module&quot;,</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;config&quot;: {</div>
<div class="line">      &quot;instance_name&quot;: &quot;main_greeter&quot;,</div>
<div class="line">      &quot;greeting_text&quot;: &quot;Hello from your first module!&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">]</div>
</div><!-- fragment --></li>
<li><b>Build-დროის კონფიგურაცია:</b> გაუშვით <code>idf.py menuconfig</code>, გადადით <code>Component config</code> -&gt; <code>Synapse Framework</code> -&gt; <code>Modules</code> -&gt; <code>Greeter Module</code> და დარწმუნდით, რომ მოდული ჩართულია (<code>[*] Enable Greeter Module</code>).</li>
</ol>
<h1><a class="anchor" id="autotoc_md2042"></a>
4. კოდის იმპლემენტაცია</h1>
<p>ახლა შევავსოთ გენერირებული ფაილები ჩვენი ლოგიკით.</p>
<h3><a class="anchor" id="autotoc_md2043"></a>
**4.1. ინტერფეისის შექმნა (&lt;tt&gt;greeter_interface.h&lt;/tt&gt;)**</h3>
<p>რადგან ჩვენი მოდული Service Provider-ია, მას სჭირდება საჯარო "კონტრაქტი". შევქმნათ ახალი ფაილი: <code>components/interfaces/include/greeter_interface.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef GREETER_INTERFACE_H</span></div>
<div class="line"><span class="preprocessor">#define GREETER_INTERFACE_H</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="synapse_8h.html">synapse.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    esp_err_t (*get_greeting_text)(<span class="keywordtype">void</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> **out_text);</div>
<div class="line">} greeter_api_t;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// GREETER_INTERFACE_H</span></div>
<div class="ttc" id="asynapse_8h_html"><div class="ttname"><a href="synapse_8h.html">synapse.h</a></div><div class="ttdoc">Synapse ESP Framework - The Main Public Header.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2044"></a>
**4.2. მოდულის იმპლემენტაცია (&lt;tt&gt;greeter_module.c&lt;/tt&gt;)**</h3>
<p>განვაახლოთ <code>greeter_module.c</code> ფაილის შიგთავსი.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="synapse_8h.html">synapse.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;greeter_module.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;greeter_interface.h&quot;</span> <span class="comment">// &lt;&lt;&lt; ახალი ინტერფეისი</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="logging_8h.html#af160fa445a164fd78ca93d8127dc7f90">DEFINE_COMPONENT_TAG</a>(<span class="stringliteral">&quot;GREETER_MODULE&quot;</span>, LOG_COLOR_GREEN);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event names</span></div>
<div class="line"><span class="preprocessor">#define GREETING_TIMER_TICK &quot;GREETING_TIMER_TICK&quot;</span></div>
<div class="line"><span class="preprocessor">#define GREETING_MESSAGE_READY &quot;GREETING_MESSAGE_READY&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Private Data</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">char</span> instance_name[32];</div>
<div class="line">    <span class="keywordtype">char</span> greeting_text[64];</div>
<div class="line">    <a class="code hl_struct" href="structsynapse__job__t.html">synapse_job_handle_t</a> greeting_job; <span class="comment">// &lt;&lt;&lt; ვიყენებთ Task Pool-ს</span></div>
<div class="line">} greeter_private_data_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Forward Declarations</span></div>
<div class="line"><span class="keyword">static</span> esp_err_t greeter_module_init(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self);</div>
<div class="line"><span class="keyword">static</span> esp_err_t greeter_module_start(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> greeter_module_deinit(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> greeter_module_handle_event(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self, <span class="keyword">const</span> <span class="keywordtype">char</span> *event_name, <span class="keywordtype">void</span> *event_data);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> greeting_job_callback(<span class="keywordtype">void</span> *context); <span class="comment">// &lt;&lt;&lt; ახალი job callback</span></div>
<div class="line"><span class="comment">// API Function</span></div>
<div class="line"><span class="keyword">static</span> esp_err_t greeter_api_get_text(<span class="keywordtype">void</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> **out_text);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Service API table</span></div>
<div class="line"><span class="keyword">static</span> greeter_api_t s_greeter_api = {</div>
<div class="line">    .get_greeting_text = greeter_api_get_text</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create Function</span></div>
<div class="line"><a class="code hl_struct" href="structmodule__t.html">module_t</a> *greeter_module_create(<span class="keyword">const</span> cJSON *config) {</div>
<div class="line">    <a class="code hl_struct" href="structmodule__t.html">module_t</a> *<span class="keyword">module</span> = (module_t *)calloc(1, sizeof(module_t));</div>
<div class="line">    greeter_private_data_t *private_data = (greeter_private_data_t *)calloc(1, <span class="keyword">sizeof</span>(greeter_private_data_t));</div>
<div class="line">    <span class="keywordflow">if</span> (!module || !private_data) { <span class="comment">/* ... error handling ... */</span> <span class="keywordflow">return</span> NULL; }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">module</span>-&gt;private_data = private_data;</div>
<div class="line">    <span class="keyword">module</span>-&gt;current_config = cJSON_Duplicate(config, true);</div>
<div class="line">    <span class="keywordflow">if</span> (!module-&gt;current_config) { <span class="comment">/* ... error handling ... */</span> <span class="keywordflow">return</span> NULL; }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> cJSON *config_node = cJSON_GetObjectItem(config, <span class="stringliteral">&quot;config&quot;</span>);</div>
<div class="line">    <span class="comment">// Using synapse_utils for safe parsing</span></div>
<div class="line">    <a class="code hl_function" href="synapse__utils_8h.html#a240c9bec50dd32c0be839ab6a4d5decc">synapse_config_get_string_from_node</a>(TAG, config_node, <span class="stringliteral">&quot;instance_name&quot;</span>, private_data-&gt;instance_name, <span class="keyword">sizeof</span>(private_data-&gt;instance_name));</div>
<div class="line">    <a class="code hl_function" href="synapse__utils_8h.html#a240c9bec50dd32c0be839ab6a4d5decc">synapse_config_get_string_from_node</a>(TAG, config_node, <span class="stringliteral">&quot;greeting_text&quot;</span>, private_data-&gt;greeting_text, <span class="keyword">sizeof</span>(private_data-&gt;greeting_text));</div>
<div class="line">    snprintf(module-&gt;name, <span class="keyword">sizeof</span>(module-&gt;name), <span class="stringliteral">&quot;%s&quot;</span>, private_data-&gt;instance_name);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">module</span>-&gt;base.init = greeter_module_init;</div>
<div class="line">    <span class="keyword">module</span>-&gt;base.start = greeter_module_start;</div>
<div class="line">    <span class="keyword">module</span>-&gt;base.deinit = greeter_module_deinit;</div>
<div class="line">    <span class="keyword">module</span>-&gt;base.handle_event = greeter_module_handle_event;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Register the service in the create phase</span></div>
<div class="line">    esp_err_t ret = <a class="code hl_function" href="service__locator_8h.html#a0a6e5781926f6d6160cab16cf48334b4">synapse_service_register_with_status</a>(</div>
<div class="line">        module-&gt;name, SYNAPSE_SERVICE_TYPE_CUSTOM_API, &amp;s_greeter_api, <a class="code hl_enumvalue" href="service__status_8h.html#ad0a7280c0097dc51b4e04d31ae802196a1367c7073a72d7521e6974c02a76d505">SERVICE_STATUS_REGISTERED</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        greeter_module_deinit(module);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">module</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// API Implementation</span></div>
<div class="line"><span class="keyword">static</span> esp_err_t greeter_api_get_text(<span class="keywordtype">void</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> **out_text) {</div>
<div class="line">    <a class="code hl_struct" href="structmodule__t.html">module_t</a> *self = (<a class="code hl_struct" href="structmodule__t.html">module_t</a> *)context;</div>
<div class="line">    greeter_private_data_t *p_data = (greeter_private_data_t *)self-&gt;<a class="code hl_variable" href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">private_data</a>;</div>
<div class="line">    *out_text = p_data-&gt;greeting_text;</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Job Callback</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> greeting_job_callback(<span class="keywordtype">void</span> *context) {</div>
<div class="line">    <a class="code hl_struct" href="structmodule__t.html">module_t</a> *self = (<a class="code hl_struct" href="structmodule__t.html">module_t</a> *)context;</div>
<div class="line">    greeter_private_data_t *p_data = (greeter_private_data_t *)self-&gt;<a class="code hl_variable" href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">private_data</a>;</div>
<div class="line">    ESP_LOGI(TAG, <span class="stringliteral">&quot;Posting greeting message from &#39;%s&#39;&quot;</span>, self-&gt;name);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Post event with payload</span></div>
<div class="line">    <span class="keywordtype">char</span> *payload = strdup(p_data-&gt;greeting_text);</div>
<div class="line">    <a class="code hl_struct" href="structevent__data__wrapper__t.html">event_data_wrapper_t</a> *wrapper;</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="event__data__wrapper_8h.html#a7e7afc7b7e7d96ee15905b61d8836cb1">synapse_event_data_wrap</a>(payload, free, &amp;wrapper) == ESP_OK) {</div>
<div class="line">        <a class="code hl_function" href="event__bus_8h.html#a4be3ec71e70f06b05b780b9883094387">synapse_event_bus_post</a>(GREETING_MESSAGE_READY, wrapper);</div>
<div class="line">        <a class="code hl_function" href="event__data__wrapper_8h.html#acbfc3de4d3a066b2adf4d8033f7cb994">synapse_event_data_release</a>(wrapper);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Init Function</span></div>
<div class="line"><span class="keyword">static</span> esp_err_t greeter_module_init(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self) {</div>
<div class="line">    ESP_LOGI(TAG, <span class="stringliteral">&quot;&#39;%s&#39; initializing...&quot;</span>, self-&gt;<a class="code hl_variable" href="structmodule__t.html#ab9b6f71a2c7831d471692dbe25afaa14">name</a>);</div>
<div class="line">    <a class="code hl_function" href="event__bus_8h.html#a4966efcc89039732d2764e0637da8bbd">synapse_event_bus_subscribe</a>(SYNAPSE_EVENT_SYSTEM_START_COMPLETE, self);</div>
<div class="line">    self-&gt;<a class="code hl_variable" href="structmodule__t.html#a521c1f2803108c52ea071a5d44f3f8a2">status</a> = <a class="code hl_enumvalue" href="base__module_8h.html#a36f9e7c6bebb796ae91a95e61b7ee65fa479aebdf242458d0bb49d35842edad87">MODULE_STATUS_INITIALIZED</a>;</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start Function</span></div>
<div class="line"><span class="keyword">static</span> esp_err_t greeter_module_start(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self) {</div>
<div class="line">    ESP_LOGI(TAG, <span class="stringliteral">&quot;&#39;%s&#39; starting...&quot;</span>, self-&gt;<a class="code hl_variable" href="structmodule__t.html#ab9b6f71a2c7831d471692dbe25afaa14">name</a>);</div>
<div class="line">    greeter_private_data_t *p_data = (greeter_private_data_t *)self-&gt;<a class="code hl_variable" href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">private_data</a>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Schedule a job using the Task Pool Manager</span></div>
<div class="line">    p_data-&gt;greeting_job = <a class="code hl_function" href="task__pool__manager_8h.html#a431a85109a972dfe31d5c2a7167c8f0b">synapse_task_pool_schedule_job</a>(greeting_job_callback, self, 5000, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!p_data-&gt;greeting_job) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to schedule greeting job!&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_FAIL;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    self-&gt;status = <a class="code hl_enumvalue" href="base__module_8h.html#a36f9e7c6bebb796ae91a95e61b7ee65faee77b0ed7b64d925cf09eacdf4bc1c4c">MODULE_STATUS_RUNNING</a>;</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event Handler for CLI registration</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> greeter_module_handle_event(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self, <span class="keyword">const</span> <span class="keywordtype">char</span> *event_name, <span class="keywordtype">void</span> *event_data) {</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(event_name, SYNAPSE_EVENT_SYSTEM_START_COMPLETE) == 0) {</div>
<div class="line">        <span class="comment">// Your CLI registration logic from the old file goes here</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (event_data) {</div>
<div class="line">        <a class="code hl_function" href="event__data__wrapper_8h.html#acbfc3de4d3a066b2adf4d8033f7cb994">synapse_event_data_release</a>((<a class="code hl_struct" href="structevent__data__wrapper__t.html">event_data_wrapper_t</a> *)event_data);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Deinit Function</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> greeter_module_deinit(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *self) {</div>
<div class="line">    <span class="keywordflow">if</span> (!self) <span class="keywordflow">return</span>;</div>
<div class="line">    greeter_private_data_t *p_data = (greeter_private_data_t *)self-&gt;<a class="code hl_variable" href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">private_data</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (p_data &amp;&amp; p_data-&gt;greeting_job) {</div>
<div class="line">        <a class="code hl_function" href="task__pool__manager_8h.html#a4f4a978a64cf383da083abae40a3f323">synapse_task_pool_cancel_job</a>(p_data-&gt;greeting_job);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="event__bus_8h.html#aad4a2793a40d367c4463bd46dd5418c8">synapse_event_bus_unsubscribe</a>(SYNAPSE_EVENT_SYSTEM_START_COMPLETE, self);</div>
<div class="line">    synapse_service_unregister(self-&gt;<a class="code hl_variable" href="structmodule__t.html#ab9b6f71a2c7831d471692dbe25afaa14">name</a>);</div>
<div class="line">    <span class="comment">// ... unregister command ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (self-&gt;<a class="code hl_variable" href="structmodule__t.html#a5a1305713cce543522141d618ca463da">current_config</a>) cJSON_Delete(self-&gt;<a class="code hl_variable" href="structmodule__t.html#a5a1305713cce543522141d618ca463da">current_config</a>);</div>
<div class="line">    free(self-&gt;<a class="code hl_variable" href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">private_data</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// CLI Command handler code from your old file...</span></div>
<div class="ttc" id="abase__module_8h_html_a36f9e7c6bebb796ae91a95e61b7ee65fa479aebdf242458d0bb49d35842edad87"><div class="ttname"><a href="base__module_8h.html#a36f9e7c6bebb796ae91a95e61b7ee65fa479aebdf242458d0bb49d35842edad87">MODULE_STATUS_INITIALIZED</a></div><div class="ttdeci">@ MODULE_STATUS_INITIALIZED</div><div class="ttdoc">The module is initialized but not running (e.g., its task is suspended).</div><div class="ttdef"><b>Definition</b> base_module.h:38</div></div>
<div class="ttc" id="abase__module_8h_html_a36f9e7c6bebb796ae91a95e61b7ee65faee77b0ed7b64d925cf09eacdf4bc1c4c"><div class="ttname"><a href="base__module_8h.html#a36f9e7c6bebb796ae91a95e61b7ee65faee77b0ed7b64d925cf09eacdf4bc1c4c">MODULE_STATUS_RUNNING</a></div><div class="ttdeci">@ MODULE_STATUS_RUNNING</div><div class="ttdoc">The module is running and fully operational.</div><div class="ttdef"><b>Definition</b> base_module.h:39</div></div>
<div class="ttc" id="aevent__bus_8h_html_a4966efcc89039732d2764e0637da8bbd"><div class="ttname"><a href="event__bus_8h.html#a4966efcc89039732d2764e0637da8bbd">synapse_event_bus_subscribe</a></div><div class="ttdeci">esp_err_t synapse_event_bus_subscribe(const char *event_name, struct module_t *module)</div><div class="ttdoc">არეგისტრირებს მოდულს, როგორც კონკრეტული ივენთის გამომწერს.</div><div class="ttdef"><b>Definition</b> event_bus.c:367</div></div>
<div class="ttc" id="aevent__bus_8h_html_a4be3ec71e70f06b05b780b9883094387"><div class="ttname"><a href="event__bus_8h.html#a4be3ec71e70f06b05b780b9883094387">synapse_event_bus_post</a></div><div class="ttdeci">esp_err_t synapse_event_bus_post(const char *event_name, struct event_data_wrapper_t *data_wrapper)</div><div class="ttdoc">აქვეყნებს ივენთს Event Bus-ზე ასინქრონულად.</div><div class="ttdef"><b>Definition</b> event_bus.c:331</div></div>
<div class="ttc" id="aevent__bus_8h_html_aad4a2793a40d367c4463bd46dd5418c8"><div class="ttname"><a href="event__bus_8h.html#aad4a2793a40d367c4463bd46dd5418c8">synapse_event_bus_unsubscribe</a></div><div class="ttdeci">esp_err_t synapse_event_bus_unsubscribe(const char *event_name, struct module_t *module)</div><div class="ttdoc">აუქმებს მოდულის გამოწერას კონკრეტულ ივენთზე. ★★★ (ახალი) ★★★</div><div class="ttdef"><b>Definition</b> event_bus.c:427</div></div>
<div class="ttc" id="aevent__data__wrapper_8h_html_a7e7afc7b7e7d96ee15905b61d8836cb1"><div class="ttname"><a href="event__data__wrapper_8h.html#a7e7afc7b7e7d96ee15905b61d8836cb1">synapse_event_data_wrap</a></div><div class="ttdeci">esp_err_t synapse_event_data_wrap(const void *payload, void(*free_fn)(void *payload), event_data_wrapper_t **wrapper_out)</div><div class="ttdoc">ქმნის ახალ &quot;შეფუთულ&quot; მონაცემთა ობიექტს (wrapper) და ამყარებს საწყის მფლობელობას.</div><div class="ttdef"><b>Definition</b> event_data_wrapper.c:21</div></div>
<div class="ttc" id="aevent__data__wrapper_8h_html_acbfc3de4d3a066b2adf4d8033f7cb994"><div class="ttname"><a href="event__data__wrapper_8h.html#acbfc3de4d3a066b2adf4d8033f7cb994">synapse_event_data_release</a></div><div class="ttdeci">esp_err_t synapse_event_data_release(event_data_wrapper_t *wrapper)</div><div class="ttdoc">ამცირებს wrapper-ის მფლობელების (references) რაოდენობას ერთით.</div><div class="ttdef"><b>Definition</b> event_data_wrapper.c:75</div></div>
<div class="ttc" id="alogging_8h_html_af160fa445a164fd78ca93d8127dc7f90"><div class="ttname"><a href="logging_8h.html#af160fa445a164fd78ca93d8127dc7f90">DEFINE_COMPONENT_TAG</a></div><div class="ttdeci">#define DEFINE_COMPONENT_TAG(component_name, color)</div><div class="ttdoc">Defines a local, static, color-coded TAG variable for logging.</div><div class="ttdef"><b>Definition</b> logging.h:60</div></div>
<div class="ttc" id="aservice__locator_8h_html_a0a6e5781926f6d6160cab16cf48334b4"><div class="ttname"><a href="service__locator_8h.html#a0a6e5781926f6d6160cab16cf48334b4">synapse_service_register_with_status</a></div><div class="ttdeci">esp_err_t synapse_service_register_with_status(const char *service_name, synapse_service_type_t service_type, service_handle_t service_handle, service_status_t initial_status)</div><div class="ttdoc">Registers a new service with a specific initial status. (NEW)</div><div class="ttdef"><b>Definition</b> service_locator.c:145</div></div>
<div class="ttc" id="aservice__status_8h_html_ad0a7280c0097dc51b4e04d31ae802196a1367c7073a72d7521e6974c02a76d505"><div class="ttname"><a href="service__status_8h.html#ad0a7280c0097dc51b4e04d31ae802196a1367c7073a72d7521e6974c02a76d505">SERVICE_STATUS_REGISTERED</a></div><div class="ttdeci">@ SERVICE_STATUS_REGISTERED</div><div class="ttdoc">The service has been created and registered, but not yet initialized.</div><div class="ttdef"><b>Definition</b> service_status.h:25</div></div>
<div class="ttc" id="astructevent__data__wrapper__t_html"><div class="ttname"><a href="structevent__data__wrapper__t.html">event_data_wrapper_t</a></div><div class="ttdoc">ზოგადი &quot;შეფუთვა&quot; (wrapper) ნებისმიერი ივენთის მონაცემებისთვის.</div><div class="ttdef"><b>Definition</b> event_data_wrapper.h:31</div></div>
<div class="ttc" id="astructmodule__t_html"><div class="ttname"><a href="structmodule__t.html">module_t</a></div><div class="ttdoc">The primary structure defining a framework module.</div><div class="ttdef"><b>Definition</b> base_module.h:136</div></div>
<div class="ttc" id="astructmodule__t_html_a2e4e556e94d9d5402250b0524a7c0196"><div class="ttname"><a href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">module_t::private_data</a></div><div class="ttdeci">void * private_data</div><div class="ttdoc">A pointer to the module's internal, private data structure.</div><div class="ttdef"><b>Definition</b> base_module.h:160</div></div>
<div class="ttc" id="astructmodule__t_html_a521c1f2803108c52ea071a5d44f3f8a2"><div class="ttname"><a href="structmodule__t.html#a521c1f2803108c52ea071a5d44f3f8a2">module_t::status</a></div><div class="ttdeci">module_status_t status</div><div class="ttdoc">The current operational status of the module.</div><div class="ttdef"><b>Definition</b> base_module.h:139</div></div>
<div class="ttc" id="astructmodule__t_html_a5a1305713cce543522141d618ca463da"><div class="ttname"><a href="structmodule__t.html#a5a1305713cce543522141d618ca463da">module_t::current_config</a></div><div class="ttdeci">cJSON * current_config</div><div class="ttdoc">A pointer to the module's current configuration object. The module owns this memory.</div><div class="ttdef"><b>Definition</b> base_module.h:140</div></div>
<div class="ttc" id="astructmodule__t_html_ab9b6f71a2c7831d471692dbe25afaa14"><div class="ttname"><a href="structmodule__t.html#ab9b6f71a2c7831d471692dbe25afaa14">module_t::name</a></div><div class="ttdeci">char name[CONFIG_SYNAPSE_MODULE_NAME_MAX_LENGTH]</div><div class="ttdoc">The unique instance name of the module.</div><div class="ttdef"><b>Definition</b> base_module.h:137</div></div>
<div class="ttc" id="astructsynapse__job__t_html"><div class="ttname"><a href="structsynapse__job__t.html">synapse_job_t</a></div><div class="ttdef"><b>Definition</b> task_pool_manager.c:22</div></div>
<div class="ttc" id="asynapse__utils_8h_html_a240c9bec50dd32c0be839ab6a4d5decc"><div class="ttname"><a href="synapse__utils_8h.html#a240c9bec50dd32c0be839ab6a4d5decc">synapse_config_get_string_from_node</a></div><div class="ttdeci">bool synapse_config_get_string_from_node(const char *tag, const cJSON *json_node, const char *key, char *dest, size_t dest_size)</div><div class="ttdoc">Safely retrieves a string value from a cJSON object.</div><div class="ttdef"><b>Definition</b> synapse_utils.c:30</div></div>
<div class="ttc" id="atask__pool__manager_8h_html_a431a85109a972dfe31d5c2a7167c8f0b"><div class="ttname"><a href="task__pool__manager_8h.html#a431a85109a972dfe31d5c2a7167c8f0b">synapse_task_pool_schedule_job</a></div><div class="ttdeci">synapse_job_handle_t synapse_task_pool_schedule_job(synapse_job_cb job_function, void *user_context, uint32_t interval_ms, bool is_periodic)</div><div class="ttdoc">Schedules a new job for execution by the task pool.</div><div class="ttdef"><b>Definition</b> task_pool_manager.c:88</div></div>
<div class="ttc" id="atask__pool__manager_8h_html_a4f4a978a64cf383da083abae40a3f323"><div class="ttname"><a href="task__pool__manager_8h.html#a4f4a978a64cf383da083abae40a3f323">synapse_task_pool_cancel_job</a></div><div class="ttdeci">esp_err_t synapse_task_pool_cancel_job(synapse_job_handle_t handle)</div><div class="ttdoc">Cancels a previously scheduled job.</div><div class="ttdef"><b>Definition</b> task_pool_manager.c:117</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2045"></a>
5. ტესტირება</h1>
<ol type="1">
<li><b>ააწყვეთ და ჩაწერეთ firmware:</b> <code>idf.py build flash monitor</code></li>
<li><b>დააკვირდით ლოგებს:</b> ყოველ 5 წამში უნდა დაინახოთ <code>Posting greeting message...</code>.</li>
<li><b>გამოიყენეთ CLI:</b> <code>greet main_greeter</code> ბრძანებამ უნდა იმუშაოს.</li>
<li>**(ახალი)** სხვა მოდულიდან (მაგალითად, სატესტო მოდულიდან) შეგიძლიათ გამოიძახოთ <code>synapse_service_get("main_greeter")</code> და შემდეგ მისი <code>get_greeting_text</code> API ფუნქცია.</li>
</ol>
<hr  />
<p>თუ შეგექმნათ პრობლემა, იხილეთ <a href="../troubleshooting/">troubleshooting</a> დოკუმენტაცია. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
