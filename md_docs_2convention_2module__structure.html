<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Synapse ESP Framework: მოდულის სტრუქტურის კონვენცია</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Synapse ESP Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2convention_2module__structure.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">მოდულის სტრუქტურის კონვენცია</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1361"></a> <b>სტატუსი:</b> უმკაცრესი მოთხოვნა (Mandatory) <b>ვერსია:</b> 2.0.0</p>
<h1><a class="anchor" id="autotoc_md1362"></a>
1. 📜 მიმოხილვა</h1>
<p>ეს დოკუმენტი განსაზღვრავს Synapse Framework-ის მოდულების ფაილური და კოდის სტრუქტურის <b>ერთიან, სავალდებულო სტანდარტს</b>. ამ კონვენციის ზედმიწევნით დაცვა უზრუნველყოფს კოდის ერთგვაროვნებას, ამარტივებს ავტომატური ინსტრუმენტების (<code>create_module.py</code>, CMake სკრიპტები) მუშაობას და აჩქარებს ახალი დეველოპერების ადაპტაციას.</p>
<h1><a class="anchor" id="autotoc_md1363"></a>
2. 📂 საქაღალდის სტრუქტურა</h1>
<h2><a class="anchor" id="autotoc_md1364"></a>
2.1. სტანდარტული მოდულის სტრუქტურა</h2>
<p>ყველა მოდული უნდა მისდევდეს შემდეგ იერარქიას. ფაილები, რომლებიც მონიშნულია <code>(არასავალდებულო)</code>-თი, იქმნება მხოლოდ საჭიროების შემთხვევაში, მოდულის არქეტიპიდან გამომდინარე.</p>
<div class="fragment"><div class="line">components/modules/{category}/{module_name}/</div>
<div class="line">├── CMakeLists.txt</div>
<div class="line">├── Kconfig</div>
<div class="line">├── module.json</div>
<div class="line">├── config.json</div>
<div class="line">├── README.md</div>
<div class="line">├── include/</div>
<div class="line">│   └── {module_name}.h</div>
<div class="line">└── src/</div>
<div class="line">    ├── {module_name}_internal.h</div>
<div class="line">    ├── {module_name}.c</div>
<div class="line">    ├── {module_name}_api.c      # (არასავალდებულო, თუ აქვს Service API)</div>
<div class="line">    ├── {module_name}_cmd.c      # (არასავალდებულო, თუ აქვს CLI ბრძანებები)</div>
<div class="line">    └── {module_name}_events.c   # (არასავალდებულო, თუ ამუშავებს ივენთებს)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1365"></a>
2.2. კატეგორიები</h2>
<p>მოდულები უნდა განთავსდეს შესაბამის კატეგორიის დირექტორიაში <code>components/modules/</code>-ის ქვეშ:</p>
<div class="fragment"><div class="line">actuators/ communications/ displays/ drivers/ provisioning/ security/ sensors/ storage/ system/ testing/ utilities/</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1366"></a>
3. 📄 ფაილების დანიშნულება და შინაარსი</h1>
<h2><a class="anchor" id="autotoc_md1367"></a>
3.1. &lt;tt&gt;src/&lt;/tt&gt; დირექტორიის დანაწევრება</h2>
<p>მოდულის კოდის წაკითხვადობისა და მართვადობის გასაუმჯობესებლად, <code>src</code> დირექტორიაში კოდი იყოფა ლოგიკური პასუხისმგებლობების მიხედვით:</p>
<ul>
<li>**<code>{module_name}.c</code> (დირიჟორი):** მთავარი ფაილი. ის პასუხისმგებელია მოდულის სიცოცხლის ციკლზე (<code>_create</code>, <code>_init</code>, <code>_start</code>, <code>_deinit</code>) და, როგორც წესი, შეიცავს მოდულის მთავარ ტასკს.</li>
<li>**<code>{module_name}_internal.h</code> (შიდა კონტრაქტი):** <b>კრიტიკულად მნიშვნელოვანი ფაილი.</b> ეს არის მოდულის <b>პრივატული ჰედერი</b>. ის შეიცავს <code>private_data</code> სტრუქტურის დეკლარაციას და ყველა იმ ფუნქციის <code>Forward Declaration</code>-ს, რომლებიც <code>src</code> დირექტორიის სხვადასხვა <code>.c</code> ფაილებს შორის უნდა გაზიარდეს.</li>
<li>**<code>{module_name}_api.c</code>:** (არასავალდებულო) შეიცავს მოდულის მიერ მოწოდებული <code>Service API</code>-ს ფუნქციების იმპლემენტაციას.</li>
<li>**<code>{module_name}_cmd.c</code>:** (არასავალდებულო) შეიცავს <code>Command Router</code>-ისთვის განკუთვნილი CLI ბრძანებების <code>handler</code> ფუნქციების იმპლემენტაციას.</li>
<li>**<code>{module_name}_events.c</code>:** (არასავალდებულო) შეიცავს <code>Event Bus</code>-იდან მიღებული ივენთების და/ან ESP-IDF-ის სისტემური ივენთების დამმუშავებელ ფუნქციებს.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1368"></a>
3.2. კონფიგურაციის ფაილები</h2>
<ul>
<li>**<code>config.json</code>:** განსაზღვრავს მოდულის <b>default runtime კონფიგურაციას</b>. ის უნდა შეიცავდეს JSON მასივს, რომლის თითოეული ელემენტი აღწერს მოდულის ერთ ინსტანციას. ეს ფაილი ავტომატურად ერთიანდება სისტემის საერთო კონფიგურაციაში.</li>
<li>**<code>module.json</code>:** შეიცავს მოდულის მეტამონაცემებს build-სისტემისთვის (<code>name</code>, <code>version</code>, <code>init_function</code>, <code>init_level</code> და ა.შ.).</li>
<li>**<code>Kconfig</code>:** განსაზღვრავს build-დროის კონფიგურაციის პარამეტრებს, რომლებიც ხელმისაწვდომია <code>idf.py menuconfig</code>-ში. მთავარი პარამეტრია <code>CONFIG_MODULE_{MODULE_NAME_UPPER}_ENABLED</code>, რომელიც რთავს ან თიშავს მოდულის კომპილაციას.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1369"></a>
3.3. დოკუმენტაცია</h2>
<ul>
<li>**<code>README.md</code>:** მოდულის დეტალური დოკუმენტაცია. უნდა შეიცავდეს მიმოხილვას, არქიტექტურულ პრინციპებს, კონფიგურაციის პარამეტრების აღწერას, Service API-ს, ივენთების, CLI ბრძანებების და გამოყენების მაგალითების სექციებს.</li>
<li>**<code>include/{module_name}.h</code>:** საჯარო ჰედერი. უნდა შეიცავდეს მხოლოდ <code>_create</code> factory ფუნქციის დეკლარაციას და Doxygen-ის სტილის დოკუმენტაციას.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1370"></a>
3.4. კოდის სტრუქტურა (&lt;tt&gt;_create&lt;/tt&gt; ფუნქცია)</h2>
<p>მოდულის <code>_create</code> ფუნქცია არის მისი მთავარი "შესასვლელი წერტილი". მან უნდა დაიცვას შემდეგი ლოგიკური თანმიმდევრობა:</p>
<ol type="1">
<li><b>მეხსიერების გამოყოფა:</b> <code>calloc</code>-ით გამოიყოფა მეხსიერება <code><a class="el" href="structmodule__t.html" title="The primary structure defining a framework module.">module_t</a></code> და <code>private_data_t</code> სტრუქტურებისთვის.</li>
<li><b>კონფიგურაციის დუბლირება:</b> <code>cJSON_Duplicate</code>-ით იქმნება გადაცემული კონფიგურაციის დამოუკიდებელი ასლი.</li>
<li><b>დამოკიდებულებების რუკის მინიჭება:</b> <code>module-&gt;dependency_map</code>-ს ენიჭება <code>static const <a class="el" href="structmodule__dependency__t.html" title="Describes a single service dependency for a module.">module_dependency_t</a></code> მასივის მისამართი.</li>
<li><b>კონფიგურაციის პარსინგი:</b> გამოიძახება <code>parse_config</code> ფუნქცია.</li>
<li><b>სახელის მინიჭება:</b> <code>snprintf</code>-ით <code>module-&gt;name</code>-ს ენიჭება <code>instance_name</code>.</li>
<li><b>სერვისის რეგისტრაცია:</b> (თუ მოდული <code>Service Provider</code>-ია) <code>synapse_service_register_with_status</code>-ით ხდება სერვისის რეგისტრაცია.</li>
<li>**<code>base</code> ფუნქციების მინიჭება:** <code>module-&gt;base</code> სტრუქტურის ველებს ენიჭება შესაბამისი <code>lifecycle</code> ფუნქციების მისამართები.</li>
</ol>
<p><b>ახალი, არასავალდებულო <code>debug_print</code> ფუნქცია:</b></p>
<ul>
<li><code>base</code> სტრუქტურას დაემატა <code>debug_print</code> ფუნქციის მაჩვენებელი.</li>
<li>თუ მოდულს სურს, ჰქონდეს <code>modules --info</code> ბრძანების მხარდაჭერა, მან უნდა მოახდინოს ამ ფუნქციის იმპლემენტაცია და მიანიჭოს ის <code>_create</code> ფუნქციაში.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1371"></a>
4. &lt;tt&gt;CMakeLists.txt&lt;/tt&gt;-ის სტრუქტურა</h1>
<p>Synapse Framework-ი იყენებს **"ჭკვიანი" პირობითი კომპილაციის** მექანიზმს, რათა უზრუნველყოს, რომ <code>menuconfig</code>-ში გამორთული მოდულები არ მოხვდნენ საბოლოო firmware-ში. ყველა მოდულის <code>CMakeLists.txt</code> ფაილი უნდა მისდევდეს ამ სტანდარტულ შაბლონს.</p>
<div class="fragment"><div class="line"># {Module Name} CMake Configuration</div>
<div class="line"># Author: {Author Name}</div>
<div class="line"># Version: {Version}</div>
<div class="line"> </div>
<div class="line"># SMART CONDITIONAL COMPILATION SYSTEM:</div>
<div class="line"># 1. If the CONFIG variable does not exist yet (configure stage), register with a placeholder.</div>
<div class="line"># 2. If the CONFIG variable exists and is enabled, register with full functionality.</div>
<div class="line"># 3. If the CONFIG variable exists and is disabled, register an empty placeholder.</div>
<div class="line"> </div>
<div class="line">if(DEFINED CONFIG_MODULE_{MODULE_NAME_UPPER}_ENABLED)</div>
<div class="line">    # CONFIG variable exists - check its value</div>
<div class="line">    if(CONFIG_MODULE_{MODULE_NAME_UPPER}_ENABLED)</div>
<div class="line">        # Module is ENABLED - full registration</div>
<div class="line">        message(STATUS &quot;{Module Name}: ENABLED - Compiling with full functionality&quot;)</div>
<div class="line">        idf_component_register(</div>
<div class="line">            SRCS</div>
<div class="line">                &quot;src/{module_name}.c&quot;</div>
<div class="line">                &quot;src/{module_name}_api.c&quot;    # Add/remove files as needed</div>
<div class="line">                &quot;src/{module_name}_cmd.c&quot;</div>
<div class="line">                &quot;src/{module_name}_events.c&quot;</div>
<div class="line">            INCLUDE_DIRS &quot;include&quot;</div>
<div class="line">            REQUIRES</div>
<div class="line">                synapse # Provides all core framework APIs</div>
<div class="line">                # Add other public interface dependencies here (e.g., storage_interface)</div>
<div class="line">            PRIV_REQUIRES</div>
<div class="line">                json</div>
<div class="line">                # Add other private dependencies here (e.g., esp_wifi)</div>
<div class="line">        )</div>
<div class="line">    else()</div>
<div class="line">        # Module is DISABLED - register an empty placeholder</div>
<div class="line">        message(STATUS &quot;{Module Name}: DISABLED - Compiling an empty placeholder&quot;)</div>
<div class="line">        </div>
<div class="line">        # Create an empty source file to prevent CMake from failing</div>
<div class="line">        set(EMPTY_SOURCE_CONTENT &quot;// {module_name} disabled by Kconfig\n&quot;)</div>
<div class="line">        file(WRITE &quot;${CMAKE_CURRENT_BINARY_DIR}/empty_{module_name}.c&quot; &quot;${EMPTY_SOURCE_CONTENT}&quot;)</div>
<div class="line">        </div>
<div class="line">        idf_component_register(</div>
<div class="line">            SRCS &quot;${CMAKE_CURRENT_BINARY_DIR}/empty_{module_name}.c&quot;</div>
<div class="line">            INCLUDE_DIRS &quot;include&quot;  # Header is still needed for the factory</div>
<div class="line">            REQUIRES synapse</div>
<div class="line">        )</div>
<div class="line">    endif()</div>
<div class="line">else()</div>
<div class="line">    # CONFIG variable does not exist yet (configure stage) - temporary registration</div>
<div class="line">    message(STATUS &quot;{Module Name}: CONFIGURE STAGE - Registering temporarily&quot;)</div>
<div class="line">    idf_component_register(</div>
<div class="line">        SRCS &quot;src/{module_name}.c&quot; # Register at least one file</div>
<div class="line">        INCLUDE_DIRS &quot;include&quot;</div>
<div class="line">        REQUIRES synapse</div>
<div class="line">    )</div>
<div class="line">endif()</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1372"></a>
5. ❌ აკრძალული პრაქტიკები</h1>
<ul>
<li><b>არასდროს:</b><ul>
<li>სხვა მოდულის <code>.h</code> ან <code>_internal.h</code> ფაილის პირდაპირი <code>#include</code>.</li>
<li><code>src</code> დირექტორიაში ქვედირექტორიების შექმნა.</li>
<li><code>_create</code> ფუნქციაში გადაცემული <code>config</code> ობიექტის დუბლირება (<code>cJSON_Duplicate</code>).</li>
<li><code>synapse_service_get()</code>-ის გამოძახება <code>_init</code> ფუნქციაში იმ დამოკიდებულებებისთვის, რომელთა ინექციაც შესაძლებელია <code>dependency_map</code>-ით.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1373"></a>
6. ✅ საუკეთესო პრაქტიკები</h1>
<ul>
<li><b>ყოველთვის:</b><ul>
<li>გამოიყენეთ <code>create_module.py</code> სკრიპტი ახალი მოდულის ჩონჩხის შესაქმნელად.</li>
<li>აღწერეთ სერვისებზე დამოკიდებულებები <code>dependency_map</code>-ის საშუალებით.</li>
<li><code>_deinit</code> ფუნქციამ უნდა გაათავისუფლოს <code>module-&gt;current_config</code> და <code>private_data</code>.</li>
<li>დაიცავით Doxygen-ის სტანდარტი ყველა ჰედერ ფაილსა და საჯარო ფუნქციაში.</li>
<li>(არასავალდებულო) დააიმპლემენტეთ <code>debug_print</code> ფუნქცია, რათა გაამარტივოთ მოდულის დიაგნოსტიკა CLI-დან. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
