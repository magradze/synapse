# კონვენციების ავტომატური შემმოწმებელი (`check_conventions.py`)

## 1. შესავალი

ეს დოკუმენტი აღწერს `check_conventions.py` სკრიპტის დანიშნულებას, გამოყენების წესებს და მის როლს Synapse Framework-ის კოდის ხარისხის ავტომატურ კონტროლში. ეს სკრიპტი წარმოადგენს პროექტის "კონსტიტუციის" – ჩვენი კონვენციების – ციფრულ მცველს.

მისი მთავარი მიზანია, დაზოგოს დეველოპერებისა და მიმომხილველების (reviewers) დრო და უზრუნველყოს, რომ ყველა ცვლილება პროექტში ავტომატურად შეესაბამებოდეს დადგენილ სტანდარტებს.

## 2. რას ამოწმებს სკრიპტი?

სკრიპტი ავტომატურად ამოწმებს პროექტის `components/modules/` საქაღალდეში არსებულ ყველა მოდულს შემდეგი კრიტერიუმების მიხედვით:

#### ✅ **სტრუქტურული მთლიანობა:**

- ამოწმებს, რომ ყველა მოდულს აქვს სავალდებულო ფაილები: `CMakeLists.txt`, `module.json`, `README.md`.
- დარწმუნდება, რომ არსებობს `include/{module_name}.h` და `src/` საქაღალდე მინიმუმ ერთი `.c` ფაილით.

#### ✅ **ლოგირების სტანდარტი:**

- ამოწმებს, რომ ყველა `.c` ფაილში გამოყენებულია ლოგირების ტეგი `DEFINE_COMPONENT_TAG(...)`-ის მეშვეობით.

#### ✅ **დოკუმენტაციის ხარისხი:**

- ამოწმებს, რომ `.h` ფაილებში ყველა public (გარე გამოყენების) ფუნქციას აქვს Doxygen-ის სტილის (`/** ... */`) კომენტარი.

#### ✅ **მოდულების იზოლაცია (ყველაზე მნიშვნელოვანი შემოწმება):**

- კრძალავს ერთი მოდულიდან მეორის ჰედერ ფაილის პირდაპირ ჩართვას (`#include "another_module.h"`). ეს უზრუნველყოფს, რომ კომუნიკაცია მხოლოდ Service Locator-ით ან Event Bus-ით განხორციელდეს.

## 3. როგორ გამოვიყენოთ ლოკალურად?

სანამ Pull Request-ს შექმნით, რეკომენდებულია, სკრიპტი ლოკალურად გაუშვათ, რათა დარწმუნდეთ, რომ თქვენი ცვლილებები კონვენციებს არ არღვევს.

პროექტის მთავარი საქაღალდიდან შეასრულეთ შემდეგი ბრძანება:

```bash
python3 tools/check_conventions.py
```

#### შედეგების ინტერპრეტაცია

- **წარმატება:** თუ ყველაფერი რიგზეა, ტერმინალში გამოჩნდება მწვანე შეტყობინება:

    ```
    ==================================================
    შესანიშნავია! ყველა კონვენცია დაცულია.
    ==================================================
    ```

- **შეცდომა:** თუ რომელიმე კონვენცია დარღვეულია, ტერმინალში გამოჩნდება წითელი შეტყობინება, სადაც დეტალურად იქნება აღწერილი პრობლემა, ფაილის ადგილმდებარეობა და ხაზის ნომერი.

    **მაგალითი:**

    ```
    [ERROR] components/modules/sensors/new_sensor/src/new_sensor.c: ფაილს აკლია `DEFINE_COMPONENT_TAG(...)`.
    [ERROR] components/modules/display/ssd1306/include/ssd1306.h:112: Public ფუნქციას 'ssd1306_api_draw_pixel' აკლია Doxygen კომენტარი.
    [ERROR] components/modules/sensors/dht22/src/dht22.c:25: აკრძალული/დაუშვებელი include: `relay_module.h`
    
    ==================================================
    შემოწმება დასრულდა შეცდომებით. სულ აღმოჩენილია: 3 პრობლემა.
    ==================================================
    ```

## 4. ინტეგრაცია GitHub Actions-თან (ავტომატური შემოწმება)

ეს სკრიპტი ინტეგრირებულია ჩვენს CI/CD პროცესში `.github/workflows/conventions-check.yml` ფაილის მეშვეობით.

**როგორ მუშაობს?**

1. როდესაც თქვენ ქმნით ან აახლებთ Pull Request-ს, GitHub Actions ავტომატურად ეშვება.
2. ის იძახებს `check_conventions.py` სკრიპტს.
3. თუ სკრიპტი ერთ შეცდომას მაინც აღმოაჩენს, workflow ფიქსირდება როგორც **"Failed"** (წითელი X ნიშანი PR-ის გვერდზე).
4. თქვენ შეგიძლიათ დააჭიროთ "Details" ბმულს და ნახოთ ლოგი, სადაც დეტალურად იქნება აღწერილი ყველა პრობლემა.

**მნიშვნელოვანია:** Pull Request-ი ვერ გაერთიანდება (merge) მთავარ ტოტში, სანამ კონვენციების შემოწმება წარმატებით არ დასრულდება.

## 5. როგორ გამოვასწოროთ გავრცელებული შეცდომები?

თუ სკრიპტმა შეცდომა დააფიქსირა, მიჰყევით ტერმინალში გამოტანილ ინსტრუქციას:

| შეცდომა | გამოსწორების გზა |
| :--- | :--- |
| `აკლია აუცილებელი ფაილები` | შექმენით შესაბამისი ფაილი ან საქაღალდე მითითებულ ადგილას. |
| `აკლია DEFINE_COMPONENT_TAG` | დაამატეთ `DEFINE_COMPONENT_TAG("MODULE_NAME");` თქვენი `.c` ფაილის დასაწყისში. |
| `აკლია Doxygen კომენტარი` | დაამატეთ `/** ... */` სტილის კომენტარი მითითებული public ფუნქციის წინ `.h` ფაილში. |
| `აკრძალული/დაუშვებელი include` | წაშალეთ სხვა მოდულის პირდაპირი `#include` და გამოიყენეთ კომუნიკაციის სტანდარტული პატერნები (Service Locator ან Event Bus). |

---

თუ გაგიჩნდათ დამატებითი კითხვები ან შეგექმნათ პრობლემა, რომელსაც ეს დოკუმენტი არ ფარავს, გთხოვთ, მიმართოთ გუნდის პასუხისმგებელ პირს.
