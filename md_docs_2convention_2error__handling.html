<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Synapse ESP Framework: Error Handling-ის წესები</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Synapse ESP Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2convention_2error__handling.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Error Handling-ის წესები</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1299"></a> </p>
<h1><a class="anchor" id="autotoc_md1300"></a>
ძირითადი პრინციპები</h1>
<h2><a class="anchor" id="autotoc_md1301"></a>
1. ESP Error Codes გამოყენება</h2>
<ul>
<li><b>ყოველთვის</b> გამოვიყენოთ <code>esp_err_t</code> return type</li>
<li><b>ყოველთვის</b> დავაბრუნოთ <code>ESP_OK</code> წარმატების შემთხვევაში</li>
<li><b>ყოველთვის</b> გამოვიყენოთ სტანდარტული ESP error codes</li>
</ul>
<h2><a class="anchor" id="autotoc_md1302"></a>
2. Comprehensive Error Checking</h2>
<ul>
<li><b>ყველა</b> function call-ი უნდა იყოს checked</li>
<li><b>ყველა</b> pointer parameter უნდა იყოს validated</li>
<li><b>ყველა</b> resource allocation უნდა იყოს checked</li>
</ul>
<h1><a class="anchor" id="autotoc_md1303"></a>
Standard Error Codes</h1>
<h2><a class="anchor" id="autotoc_md1304"></a>
Framework-Specific Errors</h2>
<div class="fragment"><div class="line"><span class="comment">// components/core/include/framework_errors.h</span></div>
<div class="line"><span class="preprocessor">#define ESP_ERR_SYNAPSE_BASE                    0x8000</span></div>
<div class="line"><span class="preprocessor">#define ESP_ERR_SYNAPSE_MODULE_NOT_FOUND       (ESP_ERR_SYNAPSE_BASE + 1)</span></div>
<div class="line"><span class="preprocessor">#define ESP_ERR_SYNAPSE_SERVICE_NOT_REGISTERED (ESP_ERR_SYNAPSE_BASE + 2)</span></div>
<div class="line"><span class="preprocessor">#define ESP_ERR_SYNAPSE_INVALID_MODULE_STATE   (ESP_ERR_SYNAPSE_BASE + 3)</span></div>
<div class="line"><span class="preprocessor">#define ESP_ERR_SYNAPSE_CONFIG_PARSE_FAILED    (ESP_ERR_SYNAPSE_BASE + 4)</span></div>
<div class="line"><span class="preprocessor">#define ESP_ERR_SYNAPSE_RESOURCE_BUSY          (ESP_ERR_SYNAPSE_BASE + 5)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1305"></a>
Common ESP Error Codes</h2>
<div class="fragment"><div class="line">ESP_OK                    <span class="comment">// Success</span></div>
<div class="line">ESP_ERR_INVALID_ARG       <span class="comment">// Invalid argument</span></div>
<div class="line">ESP_ERR_INVALID_STATE     <span class="comment">// Invalid state</span></div>
<div class="line">ESP_ERR_NOT_FOUND         <span class="comment">// Resource not found</span></div>
<div class="line">ESP_ERR_NO_MEM           <span class="comment">// Out of memory</span></div>
<div class="line">ESP_ERR_TIMEOUT          <span class="comment">// Operation timeout</span></div>
<div class="line">ESP_ERR_NOT_SUPPORTED    <span class="comment">// Operation not supported</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1306"></a>
Error Handling Patterns</h1>
<h2><a class="anchor" id="autotoc_md1307"></a>
1. Parameter Validation</h2>
<div class="fragment"><div class="line">esp_err_t ssd1306_api_write_text(<span class="keyword">const</span> <span class="keywordtype">char</span> *text, uint8_t line) {</div>
<div class="line">    <span class="comment">// Validate parameters first</span></div>
<div class="line">    <span class="keywordflow">if</span> (!text) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Text parameter is NULL&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (line &gt;= MAX_LINES) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid line number: %d (max: %d)&quot;</span>, line, MAX_LINES - 1);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (!global_ssd1306_instance) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Module not initialized&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_STATE;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Continue with implementation...</span></div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1308"></a>
2. Resource Allocation Checking</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t create_module_resources(module_private_data_t *module_private_data) {</div>
<div class="line">    <span class="keywordflow">if</span> (!module_private_data) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Private data pointer is NULL&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    module_private_data-&gt;command_queue = xQueueCreate(COMMAND_QUEUE_SIZE, <span class="keyword">sizeof</span>(command_t));</div>
<div class="line">    <span class="keywordflow">if</span> (!module_private_data-&gt;command_queue) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to create command queue&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_NO_MEM;</div>
<div class="line">    }</div>
<div class="line">    module_private_data-&gt;state_mutex = xSemaphoreCreateMutex();</div>
<div class="line">    <span class="keywordflow">if</span> (!module_private_data-&gt;state_mutex) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to create state mutex&quot;</span>);</div>
<div class="line">        vQueueDelete(module_private_data-&gt;command_queue);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_NO_MEM;</div>
<div class="line">    }</div>
<div class="line">    BaseType_t ret = xTaskCreate(module_task, <span class="stringliteral">&quot;module_task&quot;</span>, STACK_SIZE, </div>
<div class="line">                                 module_private_data, TASK_PRIORITY, &amp;module_private_data-&gt;task_handle);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != pdPASS) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to create task&quot;</span>);</div>
<div class="line">        vSemaphoreDelete(module_private_data-&gt;state_mutex);</div>
<div class="line">        vQueueDelete(module_private_data-&gt;command_queue);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_NO_MEM;</div>
<div class="line">    }</div>
<div class="line">    ESP_LOGI(TAG, <span class="stringliteral">&quot;Module resources created successfully&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1309"></a>
3. Service Locator Error Handling</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t get_i2c_service(<a class="code hl_struct" href="structi2c__bus__api__t.html">i2c_bus_api_t</a> **api) {</div>
<div class="line">    <span class="keywordflow">if</span> (!api) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;API pointer is NULL&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Get service from Service Locator</span></div>
<div class="line">    service_handle_t service = synapse_service_get(<span class="stringliteral">&quot;i2c_bus&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!service) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;I2C bus service not found&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_SYNAPSE_SERVICE_NOT_REGISTERED;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Verify service type</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *service_type = synapse_service_get_type(<span class="stringliteral">&quot;i2c_bus&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!service_type || strcmp(service_type, <span class="stringliteral">&quot;i2c_bus_api&quot;</span>) != 0) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid service type for I2C bus: %s&quot;</span>, </div>
<div class="line">                 service_type ? service_type : <span class="stringliteral">&quot;NULL&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_SYNAPSE_INVALID_MODULE_STATE;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    *api = (<a class="code hl_struct" href="structi2c__bus__api__t.html">i2c_bus_api_t</a> *)service;</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
<div class="ttc" id="astructi2c__bus__api__t_html"><div class="ttname"><a href="structi2c__bus__api__t.html">i2c_bus_api_t</a></div><div class="ttdoc">The public Service API structure for the I2C Bus module.</div><div class="ttdef"><b>Definition</b> i2c_bus_interface.h:29</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1310"></a>
4. Configuration Parsing Error Handling</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t parse_display_config(<span class="keyword">const</span> cJSON *config, display_config_t *display_config) {</div>
<div class="line">    <span class="keywordflow">if</span> (!config || !display_config) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid parameters for config parsing&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Parse width with validation</span></div>
<div class="line">    cJSON *width_json = cJSON_GetObjectItem(config, <span class="stringliteral">&quot;width&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!cJSON_IsNumber(width_json)) {</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;Width not found in config, using default: %d&quot;</span>, DEFAULT_WIDTH);</div>
<div class="line">        display_config-&gt;width = DEFAULT_WIDTH;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordtype">int</span> width = width_json-&gt;valueint;</div>
<div class="line">        <span class="keywordflow">if</span> (width &lt;= 0 || width &gt; MAX_DISPLAY_WIDTH) {</div>
<div class="line">            ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid display width: %d (must be 1-%d)&quot;</span>, width, MAX_DISPLAY_WIDTH);</div>
<div class="line">            <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">        }</div>
<div class="line">        display_config-&gt;width = width;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Parse height with validation</span></div>
<div class="line">    cJSON *height_json = cJSON_GetObjectItem(config, <span class="stringliteral">&quot;height&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!cJSON_IsNumber(height_json)) {</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;Height not found in config, using default: %d&quot;</span>, DEFAULT_HEIGHT);</div>
<div class="line">        display_config-&gt;height = DEFAULT_HEIGHT;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordtype">int</span> height = height_json-&gt;valueint;</div>
<div class="line">        <span class="keywordflow">if</span> (height &lt;= 0 || height &gt; MAX_DISPLAY_HEIGHT) {</div>
<div class="line">            ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid display height: %d (must be 1-%d)&quot;</span>, height, MAX_DISPLAY_HEIGHT);</div>
<div class="line">            <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">        }</div>
<div class="line">        display_config-&gt;height = height;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    ESP_LOGI(TAG, <span class="stringliteral">&quot;Display config parsed: %dx%d&quot;</span>, display_config-&gt;width, display_config-&gt;height);</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1311"></a>
5. Hardware Operation Error Handling</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t write_display_data(<a class="code hl_struct" href="structssd1306__private__data__t.html">ssd1306_private_data_t</a> *ssd1306_data, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> len) {</div>
<div class="line">    <span class="keywordflow">if</span> (!ssd1306_data || !data || len == 0) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Invalid parameters for display write&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_struct" href="structi2c__bus__api__t.html">i2c_bus_api_t</a> *i2c_api;</div>
<div class="line">    esp_err_t ret = get_i2c_service(&amp;i2c_api);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to get I2C service: %s&quot;</span>, esp_err_to_name(ret));</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">int</span> retry_count = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (retry_count &lt; MAX_RETRIES) {</div>
<div class="line">        ret = i2c_api-&gt;<a class="code hl_variable" href="structi2c__bus__api__t.html#a3140f136900ac2717859b19eed32fffb">write</a>(ssd1306_data-&gt;i2c_handle, ssd1306_data-&gt;i2c_address, data, len);</div>
<div class="line">        <span class="keywordflow">if</span> (ret == ESP_OK) {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;I2C write failed (attempt %d/%d): %s&quot;</span>, </div>
<div class="line">                 retry_count + 1, MAX_RETRIES, esp_err_to_name(ret));</div>
<div class="line">        retry_count++;</div>
<div class="line">        <span class="keywordflow">if</span> (retry_count &lt; MAX_RETRIES) {</div>
<div class="line">            vTaskDelay(pdMS_TO_TICKS(RETRY_DELAY_MS));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;I2C write failed after %d attempts: %s&quot;</span>, </div>
<div class="line">                 MAX_RETRIES, esp_err_to_name(ret));</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">}</div>
<div class="ttc" id="astructi2c__bus__api__t_html_a3140f136900ac2717859b19eed32fffb"><div class="ttname"><a href="structi2c__bus__api__t.html#a3140f136900ac2717859b19eed32fffb">i2c_bus_api_t::write</a></div><div class="ttdeci">esp_err_t(* write)(void *context, uint8_t device_address, const uint8_t *write_data, size_t data_size)</div><div class="ttdoc">Writes data to a specific I2C device on the bus.</div><div class="ttdef"><b>Definition</b> i2c_bus_interface.h:38</div></div>
<div class="ttc" id="astructssd1306__private__data__t_html"><div class="ttname"><a href="structssd1306__private__data__t.html">ssd1306_private_data_t</a></div><div class="ttdef"><b>Definition</b> ssd1306_driver.c:45</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1312"></a>
Cleanup and Resource Management</h1>
<h2><a class="anchor" id="autotoc_md1313"></a>
1. Proper Cleanup on Errors</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t module_init_with_cleanup(<a class="code hl_struct" href="structmodule__t.html">module_t</a> *module) {</div>
<div class="line">    <span class="keywordflow">if</span> (!module) {</div>
<div class="line">        <span class="keywordflow">return</span> ESP_ERR_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">    module_private_data_t *module_private_data = (module_private_data_t *)module-&gt;<a class="code hl_variable" href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">private_data</a>;</div>
<div class="line">    esp_err_t ret;</div>
<div class="line">    ret = init_hardware(module_private_data);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Hardware initialization failed: %s&quot;</span>, esp_err_to_name(ret));</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup_and_exit;</div>
<div class="line">    }</div>
<div class="line">    ret = create_resources(module_private_data);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Resource creation failed: %s&quot;</span>, esp_err_to_name(ret));</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup_hardware;</div>
<div class="line">    }</div>
<div class="line">    ret = register_service(module_private_data);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Service registration failed: %s&quot;</span>, esp_err_to_name(ret));</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup_resources;</div>
<div class="line">    }</div>
<div class="line">    ESP_LOGI(TAG, <span class="stringliteral">&quot;Module initialized successfully&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">cleanup_resources:</div>
<div class="line">    cleanup_resources(module_private_data);</div>
<div class="line">cleanup_hardware:</div>
<div class="line">    cleanup_hardware(module_private_data);</div>
<div class="line">cleanup_and_exit:</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="ttc" id="astructmodule__t_html"><div class="ttname"><a href="structmodule__t.html">module_t</a></div><div class="ttdoc">The primary structure defining a framework module.</div><div class="ttdef"><b>Definition</b> base_module.h:136</div></div>
<div class="ttc" id="astructmodule__t_html_a2e4e556e94d9d5402250b0524a7c0196"><div class="ttname"><a href="structmodule__t.html#a2e4e556e94d9d5402250b0524a7c0196">module_t::private_data</a></div><div class="ttdeci">void * private_data</div><div class="ttdoc">A pointer to the module's internal, private data structure.</div><div class="ttdef"><b>Definition</b> base_module.h:176</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1314"></a>
2. Resource Cleanup Functions</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> cleanup_module_resources(module_private_data_t *module_private_data) {</div>
<div class="line">    <span class="keywordflow">if</span> (!module_private_data) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (module_private_data-&gt;task_handle) {</div>
<div class="line">        vTaskDelete(module_private_data-&gt;task_handle);</div>
<div class="line">        module_private_data-&gt;task_handle = NULL;</div>
<div class="line">        ESP_LOGI(TAG, <span class="stringliteral">&quot;Task deleted&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (module_private_data-&gt;command_queue) {</div>
<div class="line">        vQueueDelete(module_private_data-&gt;command_queue);</div>
<div class="line">        module_private_data-&gt;command_queue = NULL;</div>
<div class="line">        ESP_LOGI(TAG, <span class="stringliteral">&quot;Command queue deleted&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (module_private_data-&gt;state_mutex) {</div>
<div class="line">        vSemaphoreDelete(module_private_data-&gt;state_mutex);</div>
<div class="line">        module_private_data-&gt;state_mutex = NULL;</div>
<div class="line">        ESP_LOGI(TAG, <span class="stringliteral">&quot;State mutex deleted&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (module_private_data-&gt;i2c_handle) {</div>
<div class="line">        <a class="code hl_struct" href="structi2c__bus__api__t.html">i2c_bus_api_t</a> *i2c_api;</div>
<div class="line">        <span class="keywordflow">if</span> (get_i2c_service(&amp;i2c_api) == ESP_OK) {</div>
<div class="line">            i2c_api-&gt;release_handle(module_private_data-&gt;i2c_handle);</div>
<div class="line">        }</div>
<div class="line">        module_private_data-&gt;i2c_handle = NULL;</div>
<div class="line">        ESP_LOGI(TAG, <span class="stringliteral">&quot;I2C handle released&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1315"></a>
Logging Standards</h1>
<h2><a class="anchor" id="autotoc_md1316"></a>
1. Error Levels</h2>
<div class="fragment"><div class="line">ESP_LOGE(TAG, <span class="stringliteral">&quot;Critical error occurred: %s&quot;</span>, esp_err_to_name(ret));  <span class="comment">// Errors</span></div>
<div class="line">ESP_LOGW(TAG, <span class="stringliteral">&quot;Warning: using default value&quot;</span>);                       <span class="comment">// Warnings  </span></div>
<div class="line">ESP_LOGI(TAG, <span class="stringliteral">&quot;Module initialized successfully&quot;</span>);                    <span class="comment">// Info</span></div>
<div class="line">ESP_LOGD(TAG, <span class="stringliteral">&quot;Debug: processing command %d&quot;</span>, cmd_id);              <span class="comment">// Debug</span></div>
<div class="line">ESP_LOGV(TAG, <span class="stringliteral">&quot;Verbose: internal state changed&quot;</span>);                   <span class="comment">// Verbose</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1317"></a>
2. Error Context Information</h2>
<div class="fragment"><div class="line">ESP_LOGE(TAG, <span class="stringliteral">&quot;Failed to create module &#39;%s&#39;: %s&quot;</span>, </div>
<div class="line">         instance_name, esp_err_to_name(ret));</div>
<div class="line"> </div>
<div class="line">ESP_LOGE(TAG, <span class="stringliteral">&quot;I2C write failed - addr: 0x%02X, len: %d, error: %s&quot;</span>, </div>
<div class="line">         i2c_address, data_len, esp_err_to_name(ret));</div>
<div class="line"> </div>
<div class="line">ESP_LOGE(TAG, <span class="stringliteral">&quot;Configuration parsing failed for key &#39;%s&#39;: %s&quot;</span>, </div>
<div class="line">         config_key, esp_err_to_name(ret));</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1318"></a>
Error Recovery Strategies</h1>
<h2><a class="anchor" id="autotoc_md1319"></a>
1. Retry Logic</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t operation_with_retry(operation_params_t *params) {</div>
<div class="line">    esp_err_t ret;</div>
<div class="line">    <span class="keywordtype">int</span> attempts = 0;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        ret = perform_operation(params);</div>
<div class="line">        <span class="keywordflow">if</span> (ret == ESP_OK) {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        attempts++;</div>
<div class="line">        ESP_LOGW(TAG, <span class="stringliteral">&quot;Operation failed (attempt %d/%d): %s&quot;</span>, </div>
<div class="line">                 attempts, MAX_RETRY_ATTEMPTS, esp_err_to_name(ret));</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (attempts &lt; MAX_RETRY_ATTEMPTS) {</div>
<div class="line">            vTaskDelay(pdMS_TO_TICKS(RETRY_DELAY_MS));</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (attempts &lt; MAX_RETRY_ATTEMPTS);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (ret != ESP_OK) {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Operation failed after %d attempts&quot;</span>, MAX_RETRY_ATTEMPTS);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1320"></a>
2. Graceful Degradation</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> esp_err_t initialize_display_with_fallback(<a class="code hl_struct" href="structssd1306__private__data__t.html">ssd1306_private_data_t</a> *ssd1306_data) {</div>
<div class="line">    esp_err_t ret;</div>
<div class="line">    ret = init_display_primary_mode(ssd1306_data);</div>
<div class="line">    <span class="keywordflow">if</span> (ret == ESP_OK) {</div>
<div class="line">        ESP_LOGI(TAG, <span class="stringliteral">&quot;Display initialized in primary mode&quot;</span>);</div>
<div class="line">        ssd1306_data-&gt;display_mode = DISPLAY_MODE_PRIMARY;</div>
<div class="line">        <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">    }</div>
<div class="line">    ESP_LOGW(TAG, <span class="stringliteral">&quot;Primary mode failed: %s, trying fallback mode&quot;</span>, esp_err_to_name(ret));</div>
<div class="line">    ret = init_display_fallback_mode(ssd1306_data);</div>
<div class="line">    <span class="keywordflow">if</span> (ret == ESP_OK) {</div>
<div class="line">        ESP_LOGI(TAG, <span class="stringliteral">&quot;Display initialized in fallback mode&quot;</span>);</div>
<div class="line">        ssd1306_data-&gt;display_mode = DISPLAY_MODE_FALLBACK;</div>
<div class="line">        <span class="keywordflow">return</span> ESP_OK;</div>
<div class="line">    }</div>
<div class="line">    ESP_LOGE(TAG, <span class="stringliteral">&quot;Both primary and fallback initialization failed&quot;</span>);</div>
<div class="line">    ssd1306_data-&gt;display_mode = DISPLAY_MODE_DISABLED;</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1321"></a>
შეჯამება</h1>
<ol type="1">
<li><b>ყოველთვის</b> გამოვიყენოთ <code>esp_err_t</code> return codes</li>
<li><b>ყოველთვის</b> დავაბრუნოთ <code>ESP_OK</code> წარმატების შემთხვევაში</li>
<li><b>ყველა</b> parameter უნდა იყოს validated</li>
<li><b>ყველა</b> resource allocation უნდა იყოს checked</li>
<li><b>ყოველთვის</b> გავაკეთოთ proper cleanup on errors</li>
<li><b>ყოველთვის</b> გამოვიყენოთ descriptive error logging</li>
<li><b>Implement</b> retry logic და graceful degradation where appropriate </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
