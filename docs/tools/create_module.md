# ­Ъџђ `create_module.py`: Synapse рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃбрЃЮрЃарЃў (v3.0)

## 1. ­ЪЊІ рЃарЃљ рЃљрЃарЃўрЃА `create_module.py`?

`create_module.py` рЃљрЃарЃўрЃА **рЃЏрЃФрЃџрЃљрЃЋрЃарЃў, рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃбрЃўрЃБрЃџрЃў рЃАрЃЎрЃарЃўрЃърЃбрЃў**, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф **рЃАрЃарЃБрЃџрЃљрЃЊ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃўрЃќрЃћрЃЉрЃБрЃџрЃљрЃЊ** рЃЦрЃЏрЃюрЃўрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЕрЃЮрЃюрЃЕрЃ«рЃА Synapse Framework-рЃўрЃАрЃЌрЃЋрЃўрЃА. рЃўрЃА рЃўрЃДрЃћрЃюрЃћрЃЉрЃА **рЃљрЃарЃЦрЃћрЃбрЃўрЃърЃћрЃЉрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџ рЃЏрЃўрЃЊрЃњрЃЮрЃЏрЃљрЃА**, рЃарЃљрЃЌрЃљ рЃЊрЃљрЃљрЃњрЃћрЃюрЃћрЃарЃўрЃарЃЮрЃА рЃљрЃарЃљ рЃБрЃЉрЃарЃљрЃџрЃЮрЃЊ рЃфрЃљрЃарЃўрЃћрЃџрЃў рЃцрЃљрЃўрЃџрЃћрЃЉрЃў, рЃљрЃарЃљрЃЏрЃћрЃЊ рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃљрЃЏрЃЮрЃфрЃљрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА рЃњрЃљрЃЏрЃќрЃљрЃЊрЃћрЃЉрЃБрЃџрЃў, рЃАрЃљрЃБрЃЎрЃћрЃЌрЃћрЃАрЃЮ рЃърЃарЃљрЃЦрЃбрЃўрЃЎрЃћрЃЉрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџрЃў рЃЎрЃЮрЃЊрЃўрЃА рЃерЃљрЃЉрЃџрЃЮрЃюрЃћрЃЉрЃў.

рЃћрЃА рЃўрЃюрЃАрЃбрЃарЃБрЃЏрЃћрЃюрЃбрЃў рЃЊрЃћрЃЋрЃћрЃџрЃЮрЃърЃЏрЃћрЃюрЃбрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃА **рЃљрЃЕрЃЦрЃљрЃарЃћрЃЉрЃА**, **рЃљрЃЏрЃфрЃўрЃарЃћрЃЉрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃўрЃА рЃарЃўрЃАрЃЎрЃА** рЃЊрЃљ рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА, рЃарЃЮрЃЏ рЃДрЃЋрЃћрЃџрЃљ рЃљрЃ«рЃљрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃюрЃЋрЃћ рЃАрЃарЃБрЃџрЃљрЃЊ рЃерЃћрЃћрЃАрЃљрЃЉрЃљрЃЏрЃћрЃЉрЃљ рЃцрЃарЃћрЃўрЃЏрЃЋрЃЮрЃарЃЦрЃўрЃА рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљрЃАрЃљ рЃЊрЃљ рЃЎрЃЮрЃюрЃЋрЃћрЃюрЃфрЃўрЃћрЃЉрЃА.

## 2. ­Ъј» рЃарЃљрЃА рЃљрЃЎрЃћрЃЌрЃћрЃЉрЃА?

### РюЁ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃцрЃљрЃўрЃџрЃћрЃЉрЃў (7 рЃцрЃљрЃўрЃџрЃў)

1. **`module.json`**: рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЏрЃћрЃбрЃљрЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў (`name`, `init_function`, `init_level` рЃЊрЃљ рЃљ.рЃе.).
2. **`config.json`**: **(рЃљрЃ«рЃљрЃџрЃў!)** рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА default runtime рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃерЃљрЃЉрЃџрЃЮрЃюрЃў.
3. **`CMakeLists.txt`**: рЃњрЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃћрЃЉрЃБрЃџрЃў, рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџрЃў build-рЃАрЃЎрЃарЃўрЃърЃбрЃў.
4. **`Kconfig`**: рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЕрЃљрЃарЃЌрЃЋрЃљ/рЃњрЃљрЃЏрЃЮрЃарЃЌрЃЋрЃўрЃА рЃЊрЃљ build-рЃЊрЃарЃЮрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў `menuconfig`-рЃўрЃАрЃЌрЃЋрЃўрЃА.
5. **`README.md`**: рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃўрЃА рЃерЃљрЃЉрЃџрЃЮрЃюрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЏрЃЮрЃарЃњрЃћрЃЉрЃБрЃџрЃўрЃљ рЃљрЃарЃЕрЃћрЃБрЃџ рЃљрЃарЃЦрЃћрЃбрЃўрЃърЃќрЃћ.
6. **`include/{module_name}.h`**: Public API-рЃА рЃ░рЃћрЃЊрЃћрЃарЃў, рЃљрЃарЃЦрЃћрЃбрЃўрЃърЃўрЃА рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃАрЃў рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃўрЃЌ.
7. **`src/{module_name}.c`**: рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃўрЃА рЃцрЃљрЃўрЃџрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃерЃћрЃўрЃфрЃљрЃЋрЃА рЃЏрЃќрЃљ рЃЎрЃЮрЃЊрЃА рЃљрЃарЃЕрЃћрЃБрЃџрЃў рЃљрЃарЃЦрЃћрЃбрЃўрЃърЃўрЃАрЃЌрЃЋрЃўрЃА рЃЊрЃљ рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃўрЃА рЃАрЃгрЃЮрЃа рЃърЃарЃљрЃЦрЃбрЃўрЃЎрЃљрЃА.

### РюЁ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ

- ­ЪћД **Build рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЏрЃўрЃћрЃа рЃљрЃдрЃЏрЃЮрЃЕрЃћрЃюрЃљ**: `idf.py menuconfig`-рЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃАрЃљрЃА, build-рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃърЃЮрЃБрЃџрЃЮрЃЉрЃА рЃљрЃ«рЃљрЃџ рЃЏрЃЮрЃЊрЃБрЃџрЃА рЃЊрЃљ рЃљрЃЏрЃљрЃбрЃћрЃЉрЃА рЃЏрЃўрЃА `Kconfig` рЃцрЃљрЃўрЃџрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃЏрЃћрЃюрЃўрЃБрЃерЃў.
- ­ЪћД **рЃърЃўрЃарЃЮрЃЉрЃўрЃЌрЃў рЃЎрЃЮрЃЏрЃърЃўрЃџрЃљрЃфрЃўрЃљ**: рЃЎрЃЮрЃЊрЃў рЃЎрЃЮрЃЏрЃърЃўрЃџрЃўрЃарЃЊрЃћрЃЉрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃЏ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў, рЃЌрЃБ рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃЕрЃљрЃарЃЌрЃБрЃџрЃўрЃљ `menuconfig`-рЃерЃў, рЃарЃљрЃф рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА firmware-рЃўрЃА рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃа рЃќрЃЮрЃЏрЃљрЃА.

## 3. ­ЪЏа№ИЈ рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃћрЃЉрЃў

рЃАрЃЎрЃарЃўрЃърЃбрЃА рЃљрЃЦрЃЋрЃА рЃЮрЃарЃў рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃў: **рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃбрЃўрЃБрЃџрЃў** рЃЊрЃљ **рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃ«рЃљрЃќрЃўрЃА**.

### 3.1. рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃбрЃўрЃБрЃџрЃў рЃарЃћрЃЪрЃўрЃЏрЃў (рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў)

```bash
python3 tools/create_module.py
```

### 3.2. рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃ«рЃљрЃќрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃў (рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃўрЃќрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА)

```bash
python3 tools/create_module.py "OTA Updater" -c system -a service_provider -d "Handles Over-the-Air updates" --init_level 50 --deps "esp_http_client,esp_https_ota"
```

## 4. ­ЪЈЏ№ИЈ рЃљрЃарЃЦрЃћрЃбрЃўрЃърЃћрЃЉрЃў (Archetypes)

рЃљрЃарЃЦрЃћрЃбрЃўрЃърЃў рЃњрЃљрЃюрЃАрЃљрЃќрЃдрЃЋрЃарЃљрЃЋрЃА, рЃЌрЃБ рЃарЃљ рЃбрЃўрЃърЃўрЃА рЃЎрЃЮрЃЊрЃўрЃА рЃерЃљрЃЉрЃџрЃЮрЃюрЃў рЃЊрЃљрЃњрЃћрЃюрЃћрЃарЃўрЃарЃЊрЃћрЃЉрЃљ.

| рЃљрЃарЃЕрЃћрЃЋрЃљрЃюрЃў | рЃљрЃарЃЦрЃћрЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ |
| :--- | :--- | :--- |
| `[0]` | **Basic** | рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃерЃљрЃЉрЃџрЃЮрЃюрЃў |
| `[1]` | **Event Producer** | рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА (рЃЏрЃљрЃњ., рЃАрЃћрЃюрЃАрЃЮрЃарЃў) |
| `[2]` | **Service Provider** | рЃљрЃгрЃЋрЃЊрЃўрЃА API-рЃА (рЃЏрЃљрЃњ., рЃЊрЃарЃљрЃўрЃЋрЃћрЃарЃў) |
| `[3]` | **Command Handler** | рЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃА CLI рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃА |
| `[4]` | **Event & Service** | рЃ░рЃўрЃЉрЃарЃўрЃЊрЃБрЃџрЃў |
| `[5]` | **Event & Command** | рЃ░рЃўрЃЉрЃарЃўрЃЊрЃБрЃџрЃў |
| `[6]` | **Service & Command** | рЃ░рЃўрЃЉрЃарЃўрЃЊрЃБрЃџрЃў |

## 5. ­Ъћё рЃАрЃарЃБрЃџрЃў рЃАрЃљрЃЏрЃБрЃерЃљрЃЮ рЃърЃарЃЮрЃфрЃћрЃАрЃў (Workflow)

1. **рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃфрЃўрЃљ:**

    ```bash
    python3 tools/create_module.py
    ```

2. **рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ (`menuconfig`):**

    ```bash
    idf.py menuconfig
    ```

    рЃњрЃљрЃЊрЃљрЃЊрЃўрЃЌ `Component config` -> `Synapse Framework` -> `Modules` рЃЊрЃљ рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃўрЃЌ, рЃарЃЮрЃЏ рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃљрЃ«рЃљрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃЕрЃљрЃарЃЌрЃБрЃџрЃўрЃљ.

3. **Runtime рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ:**
    - рЃњрЃљрЃ«рЃАрЃћрЃюрЃўрЃЌ рЃљрЃ«рЃџрЃљрЃЊ рЃЊрЃљрЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў `config.json` рЃцрЃљрЃўрЃџрЃў.
    - рЃерЃћрЃљрЃЋрЃАрЃћрЃЌ рЃўрЃА рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА рЃАрЃљрЃГрЃўрЃарЃЮ рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃўрЃЌ (рЃЏрЃљрЃњ., `instance_name`, `pin` рЃЊрЃљ рЃљ.рЃе.).

4. **рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃА рЃљрЃњрЃћрЃЉрЃљ:**

    ```bash
    idf.py build
    ```

5. **рЃЎрЃЮрЃЊрЃўрЃА рЃерЃћрЃЋрЃАрЃћрЃЉрЃљ:**
    - рЃњрЃљрЃ«рЃАрЃћрЃюрЃўрЃЌ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў `.c` рЃЊрЃљ `.h` рЃцрЃљрЃўрЃџрЃћрЃЉрЃў.
    - рЃерЃћрЃљрЃЋрЃАрЃћрЃЌ `TODO` рЃЎрЃЮрЃЏрЃћрЃюрЃбрЃљрЃарЃћрЃЉрЃўрЃЌ рЃЏрЃЮрЃюрЃўрЃерЃюрЃБрЃџрЃў рЃљрЃЊрЃњрЃўрЃџрЃћрЃЉрЃў рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃўрЃЌ.

## 6. ­Ъџе рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃћрЃЉрЃў

- **рЃЎрЃЮрЃюрЃЋрЃћрЃюрЃфрЃўрЃћрЃЉрЃў:** рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃЎрЃЮрЃЊрЃў рЃАрЃарЃБрЃџрЃљрЃЊ рЃўрЃфрЃљрЃЋрЃА рЃцрЃарЃћрЃўрЃЏрЃЋрЃЮрЃарЃЦрЃўрЃА рЃЊрЃљрЃАрЃљрЃ«рЃћрЃџрЃћрЃЉрЃўрЃА, рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃўрЃА рЃЊрЃљ рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃЎрЃЮрЃюрЃЋрЃћрЃюрЃфрЃўрЃћрЃЉрЃА.
- **рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ:** **(рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃўрЃљ)** рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў `_create` рЃЊрЃљ `_deinit` рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў рЃБрЃЎрЃЋрЃћ рЃерЃћрЃўрЃфрЃљрЃЋрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃА (`module->current_config`) рЃЏрЃцрЃџрЃЮрЃЉрЃћрЃџрЃЮрЃЉрЃўрЃА рЃљрЃдрЃћрЃЉрЃўрЃА рЃЊрЃљ рЃњрЃљрЃЌрЃљрЃЋрЃўрЃАрЃБрЃцрЃџрЃћрЃЉрЃўрЃА рЃАрЃгрЃЮрЃа рЃџрЃЮрЃњрЃўрЃЎрЃљрЃА.

---

## ­Ъј» рЃерЃћрЃ»рЃљрЃЏрЃћрЃЉрЃљ

**`create_module.py`** рЃљрЃарЃўрЃА **рЃАрЃгрЃарЃљрЃцрЃў, рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃЊрЃљ "рЃГрЃЎрЃЋрЃўрЃљрЃюрЃў"** рЃњрЃќрЃљ Synapse Framework-рЃўрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃЦрЃЏрЃюрЃћрЃџрЃљрЃЊ. рЃўрЃА:

РюЁ **рЃљрЃЕрЃЦрЃљрЃарЃћрЃЉрЃА рЃЊрЃћрЃЋрЃћрЃџрЃЮрЃърЃЏрЃћрЃюрЃбрЃА** рЃарЃљрЃЊрЃўрЃЎрЃљрЃџрЃБрЃарЃљрЃЊ.
РюЁ **рЃњрЃљрЃЏрЃЮрЃарЃўрЃфрЃ«рЃљрЃЋрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃА** рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃўрЃА рЃљрЃарЃфрЃЮрЃЊрЃюрЃўрЃЌ.
РюЁ **рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЎрЃЮрЃюрЃАрЃўрЃАрЃбрЃћрЃюрЃбрЃБрЃарЃЮрЃЉрЃљрЃА** рЃДрЃЋрЃћрЃџрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃА рЃерЃЮрЃарЃўрЃА.

**рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЌ рЃўрЃА рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА**, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃўрЃгрЃДрЃћрЃЉрЃЌ рЃљрЃ«рЃљрЃџ рЃЏрЃЮрЃЊрЃБрЃџрЃќрЃћ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљрЃА! ­Ъџђ
