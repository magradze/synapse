# ­Ъџђ create_module.py: Synapse рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃбрЃЮрЃарЃў (v2.0)

## ­ЪЊІ рЃарЃљ рЃљрЃарЃўрЃА create_module.py?

`create_module.py` рЃљрЃарЃўрЃА **рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃў, рЃЏрЃФрЃџрЃљрЃЋрЃарЃў рЃАрЃЎрЃарЃўрЃърЃбрЃў**, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф **рЃАрЃарЃБрЃџрЃљрЃЊ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ** рЃЦрЃЏрЃюрЃўрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЕрЃЮрЃюрЃЕрЃ«рЃА Synapse Framework-рЃўрЃА **рЃљрЃ«рЃљрЃџрЃў рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃўрЃАрЃЌрЃЋрЃўрЃА**. рЃўрЃА рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃА рЃДрЃЋрЃћрЃџрЃљ рЃАрЃљрЃГрЃўрЃарЃЮ рЃцрЃљрЃўрЃџрЃА, рЃАрЃгрЃЮрЃарЃў рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃўрЃЌ, рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃА рЃърЃарЃЮрЃбрЃЮрЃбрЃўрЃърЃћрЃЉрЃўрЃЌ рЃЊрЃљ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃЌ, рЃарЃљрЃф рЃЊрЃћрЃЋрЃћрЃџрЃЮрЃърЃЏрЃћрЃюрЃбрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃА рЃљрЃЕрЃЦрЃљрЃарЃћрЃЉрЃА рЃЊрЃљ рЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃћрЃЉрЃА.

## ­Ъј» рЃарЃљрЃА рЃљрЃЎрЃћрЃЌрЃћрЃЉрЃА?

### РюЁ рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃў рЃцрЃљрЃўрЃџрЃћрЃЉрЃў (5 рЃцрЃљрЃўрЃџрЃў)

1. **`module.json`** - рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЏрЃћрЃбрЃљрЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў (рЃАрЃљрЃ«рЃћрЃџрЃў, рЃЋрЃћрЃарЃАрЃўрЃљ, рЃљрЃЋрЃбрЃЮрЃарЃў, рЃерЃћрЃЏрЃЦрЃЏрЃюрЃћрЃџрЃў рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ).
2. **`CMakeLists.txt`** - рЃњрЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃћрЃЉрЃБрЃџрЃў, рЃърЃўрЃарЃЮрЃЉрЃўрЃЌрЃў рЃЎрЃЮрЃЏрЃърЃўрЃџрЃљрЃфрЃўрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ.
3. **`Kconfig`** - рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЕрЃљрЃарЃЌрЃЋрЃљ/рЃњрЃљрЃЏрЃЮрЃарЃЌрЃЋрЃўрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ `menuconfig`-рЃўрЃАрЃЌрЃЋрЃўрЃА.
4. **`include/{module_name}.h`** - Public API-рЃА Header рЃцрЃљрЃўрЃџрЃў.
5. **`src/{module_name}.c`** - Source рЃцрЃљрЃўрЃџрЃў `base_module` рЃўрЃюрЃбрЃћрЃарЃцрЃћрЃўрЃАрЃўрЃА рЃАрЃарЃБрЃџрЃў, рЃЏрЃќрЃљ рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃўрЃЌ.

### РюЁ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ

- ­ЪћД **Build рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЏрЃўрЃћрЃа рЃљрЃдрЃЏрЃЮрЃЕрЃћрЃюрЃљ** - `idf.py reconfigure` рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃАрЃљрЃА, build-рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃърЃЮрЃБрЃџрЃЮрЃЉрЃА рЃљрЃ«рЃљрЃџ рЃЏрЃЮрЃЊрЃБрЃџрЃА.
- ­ЪћД **Kconfig-рЃерЃў рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ** - рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА `Kconfig` рЃцрЃљрЃўрЃџрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃћрЃарЃЌрЃЋрЃћрЃЉрЃљ рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљрЃерЃў.
- ­ЪћД **рЃърЃўрЃарЃЮрЃЉрЃўрЃЌрЃў рЃЎрЃЮрЃЏрЃърЃўрЃџрЃљрЃфрЃўрЃљ** - рЃЎрЃЮрЃЊрЃў рЃЎрЃЮрЃЏрЃърЃўрЃџрЃўрЃарЃЊрЃћрЃЉрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃЏ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў, рЃЌрЃБ рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃЕрЃљрЃарЃЌрЃБрЃџрЃўрЃљ `menuconfig`-рЃерЃў.

## ­ЪЏа№ИЈ рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљ

### 1. рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃАрЃўрЃюрЃбрЃљрЃЦрЃАрЃў

```bash
python3 scripts/create_module.py "рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃАрЃљрЃ«рЃћрЃџрЃў" --category <рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ> --description "рЃЏрЃЮрЃЎрЃџрЃћ рЃљрЃдрЃгрЃћрЃарЃљ"
```

### 2. рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃћрЃЉрЃў

#### ­ЪЊА WiFi рЃЏрЃЮрЃЊрЃБрЃџрЃў

```bash
python3 scripts/create_module.py "WiFi Manager" --category comms --description "WiFi рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ"
```

#### ­ЪїА№ИЈ рЃбрЃћрЃЏрЃърЃћрЃарЃљрЃбрЃБрЃарЃўрЃА рЃАрЃћрЃюрЃАрЃЮрЃарЃў

```bash
python3 scripts/create_module.py "DHT22 Temperature Sensor" --category sensors --description "рЃбрЃћрЃЏрЃърЃћрЃарЃљрЃбрЃБрЃарЃўрЃАрЃљ рЃЊрЃљ рЃбрЃћрЃюрЃўрЃљрЃюрЃЮрЃЉрЃўрЃА рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ"
```

#### ­ЪЊ║ рЃЊрЃўрЃАрЃърЃџрЃћрЃўрЃА рЃЊрЃарЃљрЃўрЃЋрЃћрЃарЃў

```bash
python3 scripts/create_module.py "OLED Display" --category displays --description "SSD1306 OLED рЃЊрЃўрЃАрЃърЃџрЃћрЃўрЃА рЃЊрЃарЃљрЃўрЃЋрЃћрЃарЃў" --author "рЃерЃћрЃюрЃў рЃАрЃљрЃ«рЃћрЃџрЃў"
```

### 3. рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃљрЃарЃњрЃБрЃЏрЃћрЃюрЃбрЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃў |
| :--- | :--- | :--- | :--- |
| `name` | `"WiFi Manager"` | рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃў, рЃљрЃЊрЃљрЃЏрЃўрЃљрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА рЃњрЃљрЃАрЃљрЃњрЃћрЃЉрЃў рЃАрЃљрЃ«рЃћрЃџрЃў. рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃЏрЃљрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃљрЃЊрЃљрЃўрЃДрЃЋрЃљрЃюрЃА `snake_case`-рЃерЃў (`wifi_manager`). | РюЁ |
| `--category` | `-c` | рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ. | РюЁ |
| `--description` | `-d` | рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЏрЃЮрЃЎрЃџрЃћ, рЃћрЃарЃЌрЃАрЃўрЃбрЃДрЃЋрЃўрЃљрЃюрЃў рЃљрЃдрЃгрЃћрЃарЃљ. | РюЁ |
| `--author` | | рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃљрЃЋрЃбрЃЮрЃарЃў. рЃЌрЃБ рЃљрЃа рЃЏрЃўрЃБрЃЌрЃўрЃЌрЃћрЃЉрЃЌ, рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃА Git-рЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃА. | РЮї |

### 4. рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃў рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃћрЃЉрЃў

- `utils` (рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ)
- `comms` (рЃЎрЃЮрЃЏрЃБрЃюрЃўрЃЎрЃљрЃфрЃўрЃљ)
- `sensors` (рЃАрЃћрЃюрЃАрЃЮрЃарЃћрЃЉрЃў)
- `displays` (рЃЊрЃўрЃАрЃърЃџрЃћрЃћрЃЉрЃў)
- `storage` (рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃљ)
- `security` (рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃљ)
- `testing` (рЃАрЃљрЃбрЃћрЃАрЃбрЃЮ)

## ­ЪЈЌ№ИЈ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ рЃЊрЃљ рЃџрЃЮрЃњрЃўрЃЎрЃљ (рЃљрЃ«рЃљрЃџрЃў)

### 1. ­ЪДа рЃърЃўрЃарЃЮрЃЉрЃўрЃЌрЃў рЃЎрЃЮрЃЏрЃърЃўрЃџрЃљрЃфрЃўрЃљ (рЃњрЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃћрЃЉрЃБрЃџрЃў)

рЃФрЃЋрЃћрЃџрЃў, 3-рЃћрЃбрЃљрЃърЃўрЃљрЃюрЃў CMake рЃџрЃЮрЃњрЃўрЃЎрЃљ рЃЕрЃљрЃюрЃљрЃфрЃЋрЃџрЃЊрЃљ рЃЉрЃћрЃЋрЃарЃљрЃЊ рЃЏрЃљрЃарЃбрЃўрЃЋрЃў рЃЊрЃљ рЃњрЃљрЃАрЃљрЃњрЃћрЃЉрЃў рЃърЃўрЃарЃЮрЃЉрЃўрЃЌ:

```cmake
# РюЁ рЃљрЃ«рЃљрЃџрЃў, рЃњрЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃћрЃЉрЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ:
if(CONFIG_MODULE_WIFI_MANAGER_ENABLED)
    idf_component_register(
        SRCS "src/wifi_manager.c"
        INCLUDE_DIRS "include"
        REQUIRES
            core
            interfaces
    )
endif()
```

### 2. ­ЪЊЂ рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃў рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ

рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ рЃБрЃфрЃЋрЃџрЃћрЃџрЃўрЃљ, рЃЏрЃљрЃњрЃарЃљрЃЏ рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃў рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃўрЃљ:

```bash
components/modules/{category}/{module_name}/
РћюРћђРћђ CMakeLists.txt        # рЃљрЃ«рЃљрЃџрЃў, рЃЏрЃљрЃарЃбрЃўрЃЋрЃў рЃџрЃЮрЃњрЃўрЃЎрЃўрЃЌ
РћюРћђРћђ Kconfig               # рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЕрЃљрЃарЃЌрЃЋрЃљ/рЃњрЃљрЃЏрЃЮрЃарЃЌрЃЋрЃўрЃА рЃЮрЃцрЃфрЃўрЃљ
РћюРћђРћђ module.json           # рЃЏрЃћрЃбрЃљрЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў (init_function-рЃўрЃЌ)
РћюРћђРћђ include/
Рћѓ   РћћРћђРћђ {module_name}.h   # Public API (create рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃЌ)
РћћРћђРћђ src/
    РћћРћђРћђ {module_name}.c   # рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ (рЃљрЃ«рЃљрЃџрЃў рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃўрЃЌ)
```

### 3. ­ЪћЌ Base Module Interface (рЃЎрЃарЃўрЃбрЃўрЃЎрЃБрЃџрЃљрЃЊ рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃў)

рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃ«рЃџрЃљ рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃўрЃарЃћрЃЉрЃА `base_module.h`-рЃўрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџ, "рЃЉрЃарЃбрЃДрЃћрЃџ" рЃўрЃюрЃбрЃћрЃарЃцрЃћрЃўрЃАрЃА:

```c
// рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃерЃћрЃЏрЃЦрЃЏрЃюрЃћрЃџрЃў рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ (Public)
module_t *{module_name}_create(const cJSON *config);

// Base Module рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў (Private)
static esp_err_t {module_name}_init(module_t *self);
static esp_err_t {module_name}_start(module_t *self);
static void {module_name}_deinit(module_t *self); // рЃДрЃБрЃарЃљрЃЊрЃдрЃћрЃЉрЃљ: рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА void!
static void {module_name}_handle_event(module_t *self, const char* event_name, void* event_data); // рЃДрЃБрЃарЃљрЃЊрЃдрЃћрЃЉрЃљ: рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА void!
```

### 4. ­ЪјЏ№ИЈ рЃ«рЃћрЃџрЃўрЃЌ рЃЏрЃЮрЃарЃњрЃћрЃЉрЃљ (рЃљрЃ«рЃљрЃџрЃў рЃърЃљрЃбрЃћрЃарЃюрЃў)

рЃФрЃЋрЃћрЃџрЃў, рЃЕрЃљрЃЊрЃњрЃЏрЃБрЃџрЃў `struct`-рЃћрЃЉрЃўрЃА рЃюрЃљрЃфрЃЋрЃџрЃљрЃЊ, рЃљрЃ«рЃџрЃљ рЃЋрЃўрЃДрЃћрЃюрЃћрЃЉрЃЌ `private_data` рЃърЃљрЃбрЃћрЃарЃюрЃА:

```c
// 1. рЃњрЃљрЃљрЃцрЃљрЃарЃЌрЃЮрЃЋрЃћрЃЌ рЃърЃарЃўрЃЋрЃљрЃбрЃБрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ:
typedef struct {
    // TODO: рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћрЃЌ рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЏрЃЊрЃњрЃЮрЃЏрЃљрЃарЃћрЃЮрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА рЃАрЃљрЃГрЃўрЃарЃЮ рЃЋрЃћрЃџрЃћрЃЉрЃў.
    int sensor_pin;
    TaskHandle_t sensor_task_handle;
    float last_reading;
} my_sensor_private_data_t;

// 2. рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЌ рЃўрЃА `_create` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃерЃў:
module_t* my_sensor_create(const cJSON *config) {
    // ...
    my_sensor_private_data_t *private_data = calloc(1, sizeof(my_sensor_private_data_t));
    module->private_data = private_data;
    // ...
    // рЃгрЃљрЃўрЃЎрЃўрЃЌрЃ«рЃћрЃЌ рЃърЃўрЃюрЃў рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃЊрЃљрЃю рЃЊрЃљ рЃерЃћрЃўрЃюрЃљрЃ«рЃћрЃЌ private_data->sensor_pin-рЃерЃў
}

// 3. рЃЏрЃўрЃўрЃдрЃћрЃЌ рЃгрЃЋрЃЊрЃЮрЃЏрЃљ рЃАрЃ«рЃЋрЃљ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃерЃў:
static esp_err_t my_sensor_init(module_t* self) {
    my_sensor_private_data_t *p_data = (my_sensor_private_data_t*)self->private_data;
    // рЃљрЃ«рЃџрЃљ рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљрЃЌ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃЮрЃЌ p_data->sensor_pin
}
```

## ­Ъћё рЃАрЃарЃБрЃџрЃў Workflow (рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃў)

### 1. рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ

```bash
python3 scripts/create_module.py "My New Sensor" --category sensors --description "рЃљрЃ«рЃљрЃџрЃў рЃАрЃћрЃюрЃАрЃЮрЃарЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ"
```

### 2. рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА reconfigure

```bash
idf.py reconfigure
```

**рЃарЃљ рЃ«рЃЊрЃћрЃЉрЃљ:**

- Build-рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ **рЃљрЃдрЃЏрЃЮрЃљрЃЕрЃћрЃюрЃА** рЃљрЃ«рЃљрЃџ рЃЏрЃЮрЃЊрЃБрЃџрЃА `module.json`-рЃўрЃА рЃЏрЃћрЃерЃЋрЃћрЃЮрЃЉрЃўрЃЌ.
- **рЃљрЃЏрЃљрЃбрЃћрЃЉрЃА** рЃЏрЃўрЃА `Kconfig` рЃцрЃљрЃўрЃџрЃА `menuconfig`-рЃерЃў.

### 3. рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ

```bash
idf.py menuconfig
```

**рЃАрЃљрЃЊ рЃюрЃљрЃ«рЃљрЃЋрЃЌ:** `Component config` Рєњ `My New Sensor Module Configuration`

### 4. Build

```bash
idf.py build
```

**рЃарЃљ рЃ«рЃЊрЃћрЃЉрЃљ:**

- рЃЌрЃБ рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃЕрЃљрЃарЃЌрЃБрЃџрЃўрЃљ: рЃЎрЃЮрЃЏрЃърЃўрЃџрЃўрЃарЃЊрЃћрЃЉрЃљ рЃАрЃарЃБрЃџрЃў рЃЎрЃЮрЃЊрЃў.
- рЃЌрЃБ рЃњрЃљрЃЏрЃЮрЃарЃЌрЃБрЃџрЃўрЃљ: `CMakeLists.txt`-рЃерЃў рЃљрЃарЃАрЃћрЃЉрЃБрЃџрЃў `if` рЃърЃўрЃарЃЮрЃЉрЃљ рЃљрЃа рЃАрЃарЃБрЃџрЃЊрЃћрЃЉрЃљ рЃЊрЃљ рЃЎрЃЮрЃЊрЃў рЃљрЃа рЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ build-рЃерЃў.

## ­Ъџе рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃћрЃЉрЃў (рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџрЃў)

### РюЁ рЃарЃљрЃф рЃБрЃюрЃЊрЃљ рЃњрЃљрЃ«рЃАрЃЮрЃЋрЃЊрЃћрЃЌ

1. **рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА рЃњрЃљрЃБрЃерЃЋрЃўрЃЌ `idf.py reconfigure`** рЃљрЃ«рЃљрЃџрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ.
2. **рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў (`name`) рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА рЃЉрЃарЃГрЃДрЃљрЃџрЃћрЃЉрЃерЃў**, рЃЌрЃБ рЃўрЃА рЃћрЃарЃЌрЃќрЃћ рЃЏрЃћрЃб рЃАрЃўрЃбрЃДрЃЋрЃљрЃА рЃерЃћрЃўрЃфрЃљрЃЋрЃА.
3. **`handle_event` рЃЊрЃљ `deinit` рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃћрЃю `void`**-рЃА. рЃљрЃа рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃЮрЃЌ `return ESP_OK`.
4. **Header рЃцрЃљрЃўрЃџрЃў рЃАрЃљрЃГрЃўрЃарЃЮрЃљ**, рЃарЃљрЃЌрЃљ System Manager-рЃЏрЃљ рЃерЃћрЃФрЃџрЃЮрЃА `_create` рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃА рЃњрЃљрЃЏрЃЮрЃФрЃљрЃ«рЃћрЃЉрЃљ.
5. **рЃДрЃЋрЃћрЃџрЃљ рЃарЃћрЃАрЃБрЃарЃАрЃў рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЌрЃљрЃЋрЃўрЃАрЃБрЃцрЃџрЃЊрЃћрЃА `_deinit` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃерЃў**: `private_data`, `mutex`, `current_config` рЃЊрЃљ рЃљ.рЃе.

### РЮї рЃЕрЃЋрЃћрЃБрЃџрЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃў

1. **`reconfigure`-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃбрЃЮрЃЋрЃћрЃЉрЃљ** Рєњ Build-рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃЋрЃћрЃа рЃ«рЃћрЃЊрЃљрЃЋрЃА рЃљрЃ«рЃљрЃџ рЃЏрЃЮрЃЊрЃБрЃџрЃА.
2. **`handle_event`-рЃерЃў `esp_err_t`-рЃўрЃА рЃЊрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃљ** Рєњ рЃњрЃљрЃЏрЃЮрЃўрЃгрЃЋрЃћрЃЋрЃА рЃЎрЃЮрЃЏрЃърЃўрЃџрЃљрЃфрЃўрЃўрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљрЃА.
3. **`module.json`-рЃўрЃА рЃгрЃљрЃерЃџрЃљ рЃљрЃю рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃў `init_function`** Рєњ рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃЋрЃћрЃа рЃЕрЃљрЃўрЃбрЃЋрЃўрЃарЃЌрЃћрЃЉрЃљ.
4. **`private_data`-рЃАрЃЌрЃЋрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃЮрЃцрЃўрЃџрЃў рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃўрЃА рЃљрЃа рЃњрЃљрЃЌрЃљрЃЋрЃўрЃАрЃБрЃцрЃџрЃћрЃЉрЃљ `_deinit`-рЃерЃў** Рєњ рЃњрЃљрЃЏрЃЮрЃўрЃгрЃЋрЃћрЃЋрЃА Memory Leak-рЃА.

## ­ЪДф рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃЏрЃћрЃЌрЃЮрЃЊрЃћрЃЉрЃў

рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃЏрЃћрЃЌрЃЮрЃЊрЃћрЃЉрЃў рЃўрЃњрЃўрЃЋрЃћ рЃарЃЕрЃћрЃЉрЃљ, рЃЏрЃљрЃњрЃарЃљрЃЏ рЃДрЃБрЃарЃљрЃЊрЃдрЃћрЃЉрЃљ рЃЏрЃўрЃљрЃЦрЃфрЃўрЃћрЃЌ рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃБрЃџ `Kconfig` рЃЏрЃћрЃюрЃўрЃБрЃА рЃЊрЃљ `CMake` рЃџрЃЮрЃњрЃўрЃЎрЃљрЃА.

## ­ЪЊі рЃњрЃљрЃюрЃАрЃ«рЃЋрЃљрЃЋрЃћрЃЉрЃљ рЃАрЃ«рЃЋрЃљ рЃАрЃўрЃАрЃбрЃћрЃЏрЃћрЃЉрЃўрЃАрЃњрЃљрЃю

| рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ | Manual (рЃФрЃЋрЃћрЃџрЃў) | create_module.py (рЃљрЃ«рЃљрЃџрЃў) |
| :--- | :--- | :--- |
| рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ | рЃ«рЃћрЃџрЃўрЃЌ 5 рЃцрЃљрЃўрЃџрЃў | РюЁ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў |
| Interface рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ | рЃ«рЃћрЃџрЃўрЃЌ рЃЎрЃЮрЃЊрЃўрЃА рЃгрЃћрЃарЃљ | РюЁ рЃЏрЃќрЃљ, рЃАрЃгрЃЮрЃарЃў рЃерЃљрЃЉрЃџрЃЮрЃюрЃў |
| рЃърЃўрЃарЃЮрЃЉрЃўрЃЌрЃў рЃЎрЃЮрЃЏрЃърЃўрЃџрЃљрЃфрЃўрЃљ | рЃарЃЌрЃБрЃџрЃў, 3-рЃћрЃбрЃљрЃърЃўрЃљрЃюрЃў CMake | РюЁ рЃЏрЃљрЃарЃбрЃўрЃЋрЃў `if` рЃърЃўрЃарЃЮрЃЉрЃљ |
| Kconfig рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ | рЃ«рЃћрЃџрЃўрЃЌ рЃарЃћрЃЊрЃљрЃЦрЃбрЃўрЃарЃћрЃЉрЃљ | РюЁ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў |
| рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃўрЃА рЃарЃўрЃАрЃЎрЃў | рЃЏрЃљрЃдрЃљрЃџрЃў | РюЁ рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў |
| рЃЊрЃљрЃ«рЃљрЃарЃ»рЃБрЃџрЃў рЃЊрЃарЃЮ | 20-30 рЃгрЃБрЃЌрЃў | РюЁ **10 рЃгрЃљрЃЏрЃў** |

---

## ­Ъј» рЃерЃћрЃ»рЃљрЃЏрЃћрЃЉрЃљ

**create_module.py** рЃљрЃарЃўрЃА **рЃАрЃгрЃарЃљрЃцрЃў, рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃЊрЃљ рЃЌрЃљрЃюрЃљрЃЏрЃћрЃЊрЃарЃЮрЃЋрЃћ** рЃњрЃќрЃљ Synapse Framework-рЃўрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃЦрЃЏрЃюрЃћрЃџрЃљрЃЊ. рЃўрЃА:

РюЁ **рЃљрЃЕрЃЦрЃљрЃарЃћрЃЉрЃА рЃЊрЃћрЃЋрЃћрЃџрЃЮрЃърЃЏрЃћрЃюрЃбрЃА** рЃарЃљрЃЊрЃўрЃЎрЃљрЃџрЃБрЃарЃљрЃЊ.
РюЁ **рЃњрЃљрЃЏрЃЮрЃарЃўрЃфрЃ«рЃљрЃЋрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃА** рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃўрЃА рЃљрЃарЃфрЃЮрЃЊрЃюрЃўрЃЌ.
РюЁ **рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЎрЃЮрЃюрЃАрЃўрЃАрЃбрЃћрЃюрЃбрЃБрЃарЃЮрЃЉрЃљрЃА** рЃДрЃЋрЃћрЃџрЃљ рЃЏрЃЮрЃЊрЃБрЃџрЃА рЃерЃЮрЃарЃўрЃА.
РюЁ **рЃАрЃарЃБрЃџрЃљрЃЊ рЃЌрЃљрЃЋрЃАрЃћрЃЉрЃљрЃЊрЃўрЃљ** рЃБрЃљрЃ«рЃџрЃћрЃА рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљрЃАрЃЌрЃљрЃю.

**рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЌ рЃўрЃА рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА**, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃўрЃгрЃДрЃћрЃЉрЃЌ рЃљрЃ«рЃљрЃџ рЃЏрЃЮрЃЊрЃБрЃџрЃќрЃћ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљрЃА! ­Ъџђ
