# გავრცელებული პრობლემები და გადაჭრის გზები (Common Issues & Solutions)

## მიზანი

ეს დოკუმენტი აღწერს Synapse Framework-ის გამოყენებისას ყველაზე ხშირად წარმოქმნილ პრობლემებს, მათი დიაგნოსტიკისა და გადაჭრის გზებს naming/structure კონვენციების დაცვით.

---

## 1. ბილდის შეცდომები

### პრობლემა: მოდული არ იბილდება
- **შესაძლო მიზეზი:** მოდული არ არის ჩართული Kconfig-ში ან არასწორადაა მითითებული CMakeLists.txt-ში
- **გადაჭრა:**
  - გადაამოწმეთ, რომ მოდული ჩართულია Kconfig-ში
  - გადაამოწმეთ CMakeLists.txt-ში INCLUDE_DIRS და REQUIRES პარამეტრები

### პრობლემა: include file not found
- **შესაძლო მიზეზი:** include დირექტორია არ არის მითითებული CMakeLists.txt-ში
- **გადაჭრა:**
  - დაამატეთ "include" INCLUDE_DIRS-ში

---

## 2. კონფიგურაციის პრობლემები

### პრობლემა: მოდული არ ინიციალიზდება
- **შესაძლო მიზეზი:** system_config.json-ში არასწორადაა მითითებული instance_name ან პარამეტრები
- **გადაჭრა:**
  - გადაამოწმეთ instance_name და ყველა აუცილებელი პარამეტრი
  - გამოიყენეთ synapse_config_get_* API-ები

### პრობლემა: default მნიშვნელობები არ მუშაობს
- **შესაძლო მიზეზი:** parse_module_config ფუნქციაში არასწორადაა აღწერილი fallback ლოგიკა
- **გადაჭრა:**
  - გადაამოწმეთ parse_module_config ფუნქცია და გამოიყენეთ სწორი default მნიშვნელობები

---

## 3. კომუნიკაციის პრობლემები

### პრობლემა: Event Bus-ზე მოვლენები არ ვრცელდება
- **შესაძლო მიზეზი:** მოდული არ არის გამოწერილი შესაბამის event-ზე
- **გადაჭრა:**
  - გამოიყენეთ event_bus_subscribe სწორი event_id-ით

### პრობლემა: Service Locator-ით API არ იძებნება
- **შესაძლო მიზეზი:** სერვისი არ არის რეგისტრირებული ან instance_name არასწორია
- **გადაჭრა:**
  - გადაამოწმეთ synapse_service_register და synapse_service_get გამოძახებები

---

## 4. ლოგირების და შეცდომების დიაგნოსტიკა

### პრობლემა: ლოგები არ ჩანს
- **შესაძლო მიზეზი:** DEFINE_COMPONENT_TAG არ არის გამოყენებული ან log level დაბალია
- **გადაჭრა:**
  - გამოიყენეთ DEFINE_COMPONENT_TAG ყველა მოდულში
  - გადაამოწმეთ log level პარამეტრები

### პრობლემა: შეცდომის კოდი არ იკითხება
- **შესაძლო მიზეზი:** esp_err_to_name არ გამოიყენება
- **გადაჭრა:**
  - ყველა ESP_LOGE-ში გამოიყენეთ esp_err_to_name(ret)

---

## 5. Runtime პრობლემები

### პრობლემა: მოდული არ რეაგირებს enable/disable-ზე
- **შესაძლო მიზეზი:** enable/disable API არასწორადაა იმპლემენტირებული ან არ ხდება სტატუსის განახლება
- **გადაჭრა:**
  - გადაამოწმეთ enable/disable ფუნქციები და სტატუსის განახლება

### პრობლემა: რესურსების გაჟონვა (memory leak)
- **შესაძლო მიზეზი:** deinit ან cleanup ფუნქციები არ არის სრულად იმპლემენტირებული
- **გადაჭრა:**
  - დაამატეთ ყველა გამოყოფილი რესურსის გათავისუფლება deinit-ში

---

### პრობლემა: სისტემის კრახი `Stack Overflow in task Tmr Svc` შეცდომით

- **შესაძლო მიზეზი:** სისტემური ტაიმერის `callback` ფუნქციის კონტექსტიდან (მაგ., `Event Handler`-ში) ხდება რესურს-ინტენსიური ან ბლოკირებადი ფუნქციის (მაგ., `esp_wifi_connect`, მენიუს აგება) გამოძახება. `Tmr Svc` ტასკს აქვს შეზღუდული ზომის სტეკი, რომელიც ამ ოპერაციებისთვის არ არის განკუთვნილი.
- **გადაჭრა:**
  - შექმენით გამოყოფილი, საკუთარი FreeRTOS ტასკი იმ მოდულისთვის, რომელიც "მძიმე" ოპერაციას ასრულებს.
  - `Event Handler`-მა არ უნდა შეასრულოს ოპერაცია პირდაპირ. მან უნდა გაგზავნოს ბრძანება ახლად შექმნილი ტასკის რიგში (Queue).
  - "მძიმე" ლოგიკა უნდა შესრულდეს გამოყოფილი ტასკის კონტექსტში, რომელსაც საკმარისად დიდი სტეკი ექნება.

### პრობლემა: სისტემის კრახი `LoadProhibited` ან `assert failed: heap_caps_free`

- **შესაძლო მიზეზი:** მეხსიერების კორუფცია, რომელიც ხშირად გამოწვეულია არასწორი Dependency Injection-ით ან მეხსიერების გაჟონვით (Memory Leak).
- **გადაჭრა:**
  - **Dependency Injection:** დარწმუნდით, რომ მოდული, რომელსაც სერვისის ინექცია სჭირდება, სწორად აცხადებს `dependency_map`-ს და მისი `private_data` სტრუქტურა შეესაბამება `map`-ში აღწერილ `offset`-ებს.
  - **Memory Leak:** გადაამოწმეთ ყველა `malloc`/`calloc`-ის გამოძახება. დარწმუნდით, რომ ყველა გამოყოფილ მეხსიერებაზე სრულდება `free` (ან შესაბამისი `_free` ფუნქცია). განსაკუთრებული ყურადღება მიაქციეთ `Event Bus`-ით გადაცემულ `payload`-ებს და დარწმუნდით, რომ `synapse_event_data_release` ყოველთვის გამოიძახება.

---

## 6. დამატებითი რჩევები
- გამოიყენეთ [logging_standards.md](../convention/logging_standards.md) და [error_handling.md](../convention/error_handling.md)
- ყველა ცვლილება და პრობლემა აღწერეთ [faq.md](../structure/faq.md)-ში
- მიმართეთ გუნდის დოკუმენტაციის პასუხისმგებელ პირს რთული შემთხვევებისას

---

დამატებითი პრობლემების შემთხვევაში იხილეთ სხვა troubleshooting დოკუმენტები ან გახსენით issue პროექტის რეპოზიტორიაში.

