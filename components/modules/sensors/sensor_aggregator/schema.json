{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Sensor Aggregator Config Schema",
    "description": "Defines the structure for a sensor_aggregator config.json entry.",
    "type": "object",
    "properties": {
        "type": { "const": "sensor_aggregator" },
        "enabled": { "type": "boolean" },
        "config": {
            "type": "object",
            "properties": {
                "instance_name": { "type": "string", "minLength": 1 },
                "aggregation_strategy": { "type": "string", "enum": ["time_window", "on_trigger"] },
                "aggregation_period_sec": { "type": "integer", "minimum": 1 },
                "sensors_to_aggregate": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "event_name": { "type": "string" },
                            "json_key": { "type": "string" },
                            "aggregation_mode": { "type": "string", "enum": ["avg", "min", "max", "last"] },
                            "valid_range": {
                                "type": "object",
                                "properties": {
                                    "min": { "type": "number" },
                                    "max": { "type": "number" }
                                }
                            }
                        },
                        "required": ["event_name", "json_key"]
                    }
                }
            },
            "required": ["instance_name", "sensors_to_aggregate"]
        }
    },
    "required": ["type", "config"]
}