menu "Storage Manager"

    config MODULE_STORAGE_MANAGER_ENABLED
        bool "Enable Storage Manager Module"
        default y
        help
            Enables the Storage Manager module for centralized data persistence.
            This module provides a unified API for various storage backends like
            NVS, SPIFFS, and SD Cards.

    if MODULE_STORAGE_MANAGER_ENABLED

        # --- General Configuration ---
        config STORAGE_MANAGER_DEFAULT_INSTANCE_NAME
            string "Default Instance Name"
            default "main_storage"
            help
                Default instance name for the Storage Manager service registration.

        config STORAGE_MANAGER_INSTANCE_NAME_MAX_LEN
            int "Maximum Instance Name Length"
            default 32
            range 8 64
            help
                Maximum buffer size for the module's instance name string.

        # --- Backend Selection ---
        choice STORAGE_MANAGER_BACKEND
            prompt "Storage Backend"
            default STORAGE_BACKEND_NVS
            help
                Select the primary storage backend for the Storage Manager service.
                - NVS: Best for small key-value configuration data.
                - SPIFFS: A simple filesystem on the internal flash, good for web assets or logs.
                - SD_CARD: For large files and high-capacity storage, requires an SD card.

            config STORAGE_BACKEND_NVS
                bool "NVS (Non-Volatile Storage)"

            config STORAGE_BACKEND_SPIFFS
                bool "SPIFFS Filesystem"

            config STORAGE_BACKEND_SD_CARD
                bool "SD Card"
        endchoice

         # --- SPIFFS Specific Configuration ---
        menu "SPIFFS Configuration"
            depends on STORAGE_BACKEND_SPIFFS

            # ★★★ შესწორება: დაემატა MOUNT_POINT SPIFFS-ისთვის ★★★
            config STORAGE_SPIFFS_MOUNT_POINT
                string "SPIFFS Mount Point"
                default "/spiffs"
                help
                    The virtual filesystem (VFS) path where the SPIFFS partition will be mounted.

            config STORAGE_SPIFFS_PARTITION_LABEL
                string "SPIFFS Partition Label"
                default "spiffs"
                help
                    The label of the SPIFFS partition as defined in your partition table.

            config STORAGE_SPIFFS_MAX_FILES
                int "Maximum open files"
                default 5
                help
                    The maximum number of files that can be open simultaneously.

            config STORAGE_SPIFFS_FORMAT_IF_MOUNT_FAILED
                bool "Format if mount fails"
                default y
                help
                    If enabled, the SPIFFS partition will be formatted if it cannot be mounted.
                    This is useful for initial setup but may cause data loss on a corrupted partition.

        endmenu # SPIFFS Configuration

        # --- SD Card Specific Configuration ---
        menu "SD Card Configuration"
            depends on STORAGE_BACKEND_SD_CARD

            config STORAGE_SD_CARD_MOUNT_POINT
                string "SD Card Mount Point"
                default "/sdcard"
                help
                    The virtual filesystem (VFS) path where the SD card will be mounted.

            choice STORAGE_SD_INTERFACE
                prompt "SD Card Interface"
                default STORAGE_SD_INTERFACE_SPI
                help
                    Select the communication protocol for the SD card.

                config STORAGE_SD_INTERFACE_SPI
                    bool "SPI"

                config STORAGE_SD_INTERFACE_SDMMC
                    bool "SDMMC (1-bit or 4-bit)"
            endchoice

            # --- SPI Interface Settings ---
            if STORAGE_SD_INTERFACE_SPI

                config STORAGE_SD_SPI_HOST
                    int "SPI Host"
                    default 1 # VSPI_HOST
                    range 1 2
                    help
                        Select the SPI host peripheral to use (e.g., 1 for VSPI, 2 for HSPI).

                config STORAGE_SD_PIN_MISO
                    int "MISO Pin"
                    default 19
                    help
                        GPIO pin number for the MISO (Master In, Slave Out) signal.

                config STORAGE_SD_PIN_MOSI
                    int "MOSI Pin"
                    default 23
                    help
                        GPIO pin number for the MOSI (Master Out, Slave In) signal.

                config STORAGE_SD_PIN_CLK
                    int "CLK Pin"
                    default 18
                    help
                        GPIO pin number for the SCLK (Serial Clock) signal.

                config STORAGE_SD_PIN_CS
                    int "CS Pin"
                    default 5
                    help
                        GPIO pin number for the CS (Chip Select) signal.

            endif # STORAGE_SD_INTERFACE_SPI

            # --- SDMMC Interface Settings (for future expansion) ---
            if STORAGE_SD_INTERFACE_SDMMC
                # Here you would add configs for SDMMC pins (CMD, CLK, D0, D1, D2, D3)
                # This is left as an example for future implementation.
                config STORAGE_SD_SDMMC_UNSUPPORTED
                    bool "SDMMC is not yet fully configured in this Kconfig"
                    default y
            endif # STORAGE_SD_INTERFACE_SDMMC

        endmenu # SD Card Configuration

    endif # MODULE_STORAGE_MANAGER_ENABLED

endmenu