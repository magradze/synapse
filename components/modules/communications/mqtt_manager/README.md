# РўЂ№ИЈ рЃЏрЃЮрЃЊрЃБрЃџрЃў `mqtt_manager`

## 1. ­ЪЊю рЃЏрЃўрЃЏрЃЮрЃ«рЃўрЃџрЃЋрЃљ

**рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў:** `mqtt_manager`  
**рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ:** `communication`  
**рЃЋрЃћрЃарЃАрЃўрЃљ:** 1.2.0  
**рЃљрЃЋрЃбрЃЮрЃарЃў:** Synapse Framework Team

`mqtt_manager` рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃўрЃА Synapse Framework-рЃўрЃА рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў **рЃАрЃљрЃЎрЃЮрЃЏрЃБрЃюрЃўрЃЎрЃљрЃфрЃўрЃЮ рЃ«рЃўрЃЊрЃў** рЃњрЃљрЃарЃћ рЃАрЃљрЃЏрЃДрЃљрЃарЃЮрЃАрЃЌрЃљрЃю MQTT рЃърЃарЃЮрЃбрЃЮрЃЎрЃЮрЃџрЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃўрЃЌ. рЃўрЃА рЃљрЃа рЃљрЃарЃўрЃА рЃБрЃЉрЃарЃљрЃџрЃЮрЃЊ MQTT рЃЎрЃџрЃўрЃћрЃюрЃбрЃў; рЃўрЃА рЃљрЃарЃўрЃА **рЃўрЃюрЃбрЃћрЃџрЃћрЃЦрЃбрЃБрЃљрЃџрЃБрЃарЃў рЃерЃБрЃљрЃЏрЃљрЃЋрЃљрЃџрЃў**, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃАрЃарЃБрЃџрЃљрЃЊ рЃўрЃюрЃбрЃћрЃњрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃўрЃљ рЃцрЃарЃћрЃўрЃЏрЃЋрЃЮрЃарЃЦрЃўрЃА рЃўрЃќрЃЮрЃџрЃўрЃарЃћрЃЉрЃБрЃџ, рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљрЃАрЃЌрЃљрЃю.

рЃЏрЃўрЃАрЃў рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃљрЃЏрЃЮрЃфрЃљрЃюрЃћрЃЉрЃўрЃљ:

- **­Ъїљ рЃАрЃљрЃўрЃЏрЃћрЃЊрЃЮ рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ:** WiFi рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃЊрЃљрЃЏрЃДрЃљрЃарЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃБрЃЎрЃљрЃЋрЃерЃўрЃарЃЊрЃћрЃЉрЃљ MQTT рЃЉрЃарЃЮрЃЎрЃћрЃарЃА рЃЊрЃљ рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃАрЃбрЃљрЃЉрЃўрЃџрЃБрЃарЃЮрЃЉрЃљрЃА `Last Will and Testament` (LWT) рЃЏрЃћрЃЦрЃљрЃюрЃўрЃќрЃЏрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ.
- **­Ъєћ рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў рЃўрЃЊрЃћрЃюрЃбрЃўрЃцрЃўрЃЎрЃљрЃфрЃўрЃљ:** рЃўрЃДрЃћрЃюрЃћрЃЉрЃА `Device Identity Service`-рЃА, рЃарЃљрЃЌрЃљ рЃерЃћрЃЦрЃЏрЃюрЃљрЃА рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў `ClientID` рЃЊрЃљ рЃЌрЃћрЃЏрЃћрЃЉрЃўрЃА (topics) рЃўрЃћрЃарЃљрЃарЃЦрЃўрЃљ рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА.
- **РъА№ИЈ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃњрЃљрЃЊрЃљрЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ (Command Forwarding):** рЃўрЃдрЃћрЃЉрЃА рЃЊрЃўрЃАрЃбрЃљрЃюрЃфрЃўрЃБрЃа рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃА рЃАрЃърЃћрЃфрЃўрЃљрЃџрЃБрЃарЃў MQTT рЃЌрЃћрЃЏрЃўрЃЊрЃљрЃю рЃЊрЃљ "рЃЌрЃљрЃарЃњрЃЏрЃюрЃўрЃА" рЃЏрЃљрЃЌ рЃцрЃарЃћрЃўрЃЏрЃЋрЃЮрЃарЃЦрЃўрЃА рЃерЃўрЃЊрЃљ `FMW_EVENT_EXECUTE_COMMAND_STRING` рЃўрЃЋрЃћрЃюрЃЌрЃљрЃЊ, рЃўрЃАрЃћ рЃарЃЮрЃЏ рЃљрЃа "рЃўрЃфрЃўрЃА" рЃљрЃЏ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃерЃўрЃюрЃљрЃљрЃарЃАрЃў.
- **РгЁ№ИЈ рЃАрЃбрЃљрЃбрЃБрЃАрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃљ (Status Publishing):** рЃБрЃАрЃЏрЃћрЃюрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃерЃўрЃЊрЃљ, рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџ рЃАрЃбрЃљрЃбрЃБрЃАрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА (рЃЏрЃљрЃњ., `FMW_EVENT_WIFI_STATUS_READY`) рЃЊрЃљ рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА рЃЏрЃљрЃЌ рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃА, рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџ MQTT рЃЌрЃћрЃЏрЃћрЃЉрЃќрЃћ.

## 2. ­ЪЈЏ№ИЈ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃърЃарЃўрЃюрЃфрЃўрЃърЃћрЃЉрЃў

рЃћрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃўрЃА рЃцрЃарЃћрЃўрЃЏрЃЋрЃЮрЃарЃЦрЃўрЃА рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃцрЃўрЃџрЃЮрЃАрЃЮрЃцрЃўрЃўрЃА рЃўрЃЊрЃћрЃљрЃџрЃБрЃарЃў рЃњрЃљрЃюрЃАрЃљрЃ«рЃўрЃћрЃарЃћрЃЉрЃљ.

- **рЃАрЃарЃБрЃџрЃў рЃЊрЃћрЃЎрЃљрЃърЃџрЃўрЃюрЃњрЃў (Total Decoupling):** `mqtt_manager`-рЃЏрЃљ **рЃљрЃарЃљрЃцрЃћрЃарЃў рЃўрЃфрЃўрЃА** `relay_module`-рЃўрЃА, `wifi_manager`-рЃўрЃА рЃљрЃю рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃў рЃАрЃ«рЃЋрЃљ рЃцрЃБрЃюрЃЦрЃфрЃўрЃЮрЃюрЃљрЃџрЃБрЃарЃў рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃерЃўрЃЊрЃљ рЃџрЃЮрЃњрЃўрЃЎрЃўрЃА рЃерЃћрЃАрЃљрЃ«рЃћрЃЉ. рЃўрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃдрЃћрЃЉрЃА рЃЊрЃљ рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃўрЃќрЃћрЃЉрЃБрЃџ рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃћрЃЉрЃА.
- **рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў (Service Consumer):** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃўрЃА рЃАрЃ«рЃЋрЃљ рЃцрЃБрЃюрЃЊрЃљрЃЏрЃћрЃюрЃбрЃБрЃарЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃўрЃА рЃљрЃЦрЃбрЃўрЃБрЃарЃў рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў:
  - `Device Identity Service`: рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў ID-рЃАрЃљ рЃЊрЃљ рЃЌрЃћрЃЏрЃћрЃЉрЃўрЃА рЃЏрЃўрЃАрЃљрЃдрЃћрЃЉрЃљрЃЊ.
- **рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ:** рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЌрЃўрЃЌрЃЦрЃЏрЃўрЃА рЃДрЃЋрЃћрЃџрЃљ рЃЏрЃЮрЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃљ рЃљрЃарЃўрЃА рЃарЃћрЃљрЃЦрЃфрЃўрЃљ `Event Bus`-рЃќрЃћ рЃЏрЃЮрЃЏрЃ«рЃЊрЃљрЃа рЃўрЃЋрЃћрЃюрЃЌрЃќрЃћ. рЃўрЃА рЃљрЃа рЃўрЃдрЃћрЃЉрЃА рЃњрЃљрЃЊрЃљрЃгрЃДрЃЋрЃћрЃбрЃўрЃџрЃћрЃЉрЃћрЃЉрЃА, рЃљрЃарЃљрЃЏрЃћрЃЊ рЃарЃћрЃљрЃњрЃўрЃарЃћрЃЉрЃА.
- **"рЃўрЃЋрЃћрЃюрЃЌрЃў-рЃЌрЃћрЃЏрЃўрЃА рЃарЃБрЃЎрЃљ" (Event-to-Topic Map):** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃДрЃћрЃюрЃћрЃЉрЃА рЃерЃўрЃЊрЃљ "рЃарЃБрЃЎрЃљрЃА", рЃарЃљрЃЌрЃљ рЃўрЃфрЃЮрЃЊрЃћрЃА, рЃарЃЮрЃЏрЃћрЃџрЃў рЃерЃўрЃЊрЃљ рЃўрЃЋрЃћрЃюрЃЌрЃў рЃарЃЮрЃЏрЃћрЃџ рЃњрЃљрЃарЃћ MQTT рЃЌрЃћрЃЏрЃљрЃќрЃћ рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃљрЃЦрЃЋрЃћрЃДрЃюрЃЮрЃА. рЃћрЃА рЃ«рЃЊрЃўрЃА рЃАрЃбрЃљрЃбрЃБрЃАрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљрЃА рЃфрЃћрЃюрЃбрЃарЃљрЃџрЃўрЃќрЃћрЃЉрЃБрЃџрЃА рЃЊрЃљ рЃљрЃЊрЃЋрЃўрЃџрЃљрЃЊ рЃњрЃљрЃцрЃљрЃарЃЌрЃЮрЃћрЃЉрЃљрЃЊрЃА.

## 3. РџЎ№ИЈ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ рЃ«рЃЊрЃћрЃЉрЃљ `system_config.json` рЃцрЃљрЃўрЃџрЃерЃў.

**рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**

```json
{
    "type": "mqtt_manager",
    "enabled": true,
    "config": {
        "instance_name": "main_mqtt_broker",
        "broker_uri": "mqtts://your-broker.com:8883",
        "username": "your-username",
        "password": "your-password",
        "base_topic_prefix": "synapse/devices",
        "lwt_topic": "lwt",
        "lwt_message": "{\"status\":\"offline\"}",
        "lwt_qos": 1,
        "lwt_retain": true
    }
}
```

**рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў:**

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ |
| :--- | :--- | :--- | :---: |
| `instance_name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃўрЃюрЃАрЃбрЃљрЃюрЃфрЃўрЃўрЃА рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў рЃАрЃљрЃ«рЃћрЃџрЃў. | РюЁ |
| `broker_uri` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | MQTT рЃЉрЃарЃЮрЃЎрЃћрЃарЃўрЃА рЃАрЃарЃБрЃџрЃў рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃў (рЃЏрЃљрЃњ., `mqtt://` рЃљрЃю `mqtts://`). | РюЁ |
| `username` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў рЃљрЃЋрЃЌрЃћрЃюрЃбрЃўрЃцрЃўрЃЎрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА. | РЮї |
| `password` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃърЃљрЃарЃЮрЃџрЃў рЃљрЃЋрЃЌрЃћрЃюрЃбрЃўрЃцрЃўрЃЎрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА. | РЮї |
| `base_topic_prefix` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃЌрЃћрЃЏрЃћрЃЉрЃўрЃА рЃАрЃљрЃЉрЃљрЃќрЃўрЃАрЃЮ рЃърЃарЃћрЃцрЃўрЃЦрЃАрЃў. | РЮї (Default: `synapse/devices`) |
| `lwt_topic` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | Last Will and Testament (LWT) рЃЌрЃћрЃЏрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў. | РЮї (Default: `lwt`) |
| `lwt_message` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | LWT рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃњрЃљрЃўрЃњрЃќрЃљрЃЋрЃюрЃћрЃЉрЃљ рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃњрЃљрЃгрЃДрЃЋрЃћрЃбрЃўрЃАрЃљрЃА. | РЮї (Default: `{"status":"offline"}`) |
| `lwt_qos` | рЃарЃўрЃфрЃ«рЃЋрЃў | LWT рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃўрЃА QoS рЃЊрЃЮрЃюрЃћ. | РЮї (Default: `1`) |
| `lwt_retain` | boolean | LWT рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃўрЃА `retain` рЃцрЃџрЃљрЃњрЃў. | РЮї (Default: `true`) |

## 4. ­ЪЊА MQTT рЃЌрЃћрЃЏрЃћрЃЉрЃўрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ (Topic Structure)

рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃДрЃћрЃюрЃћрЃЉрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃўрЃарЃћрЃЉрЃБрЃџ, рЃўрЃћрЃарЃљрЃарЃЦрЃўрЃБрЃџ рЃЌрЃћрЃЏрЃћрЃЉрЃА, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф **рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃЊрЃћрЃЉрЃљ** build-рЃўрЃА рЃЊрЃарЃЮрЃА `module.json` рЃцрЃљрЃўрЃџрЃћрЃЉрЃерЃў рЃљрЃдрЃгрЃћрЃарЃўрЃџрЃў `mqtt_interface` рЃАрЃћрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ.

**рЃАрЃљрЃЉрЃљрЃќрЃўрЃАрЃЮ рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ:** `synapse/devices/{device_id}/{sub_topic}`

**рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў (`device_id` = `5C013B7246E4`):**

- **РъА№ИЈ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃЏрЃўрЃАрЃљрЃдрЃћрЃЉрЃљрЃЊ (Inbound):**
  - **рЃЌрЃћрЃЏрЃљ:** `synapse/devices/5C013B7246E4/cmd/in`
  - **рЃљрЃдрЃгрЃћрЃарЃљ:** рЃћрЃА рЃљрЃарЃўрЃА рЃћрЃарЃЌрЃљрЃЊрЃћрЃарЃЌрЃў рЃЌрЃћрЃЏрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф `mqtt_manager` рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃЏрЃўрЃАрЃљрЃдрЃћрЃЉрЃљрЃЊ.
  - **Payload:** рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў, рЃЏрЃљрЃњ., `"led set 255 0 0"`.

- **РгЁ№ИЈ рЃАрЃбрЃљрЃбрЃБрЃАрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃАрЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃџрЃљрЃЊ (Outbound):**
  - **рЃЌрЃћрЃЏрЃљ:** `synapse/devices/5C013B7246E4/state/wifi/status`
  - **рЃљрЃдрЃгрЃћрЃарЃљ:** рЃљрЃЏ рЃЌрЃћрЃЏрЃљрЃќрЃћ рЃЦрЃЋрЃћрЃДрЃюрЃЊрЃћрЃЉрЃљ WiFi-рЃА рЃАрЃбрЃљрЃбрЃБрЃАрЃў, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф `wifi_manager` рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА `FMW_EVENT_WIFI_STATUS_READY` рЃўрЃЋрЃћрЃюрЃЌрЃА.
  - **Payload:** `{"connection_status": "Connected", "ssid": "MyHomeWiFi", ...}`
  - **рЃЌрЃћрЃЏрЃљ:** `synapse/devices/5C013B7246E4/state/device/info`
  - **рЃљрЃдрЃгрЃћрЃарЃљ:** рЃљрЃЏ рЃЌрЃћрЃЏрЃљрЃќрЃћ рЃЦрЃЋрЃћрЃДрЃюрЃЊрЃћрЃЉрЃљ рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃўрЃА рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф `device_identity_service` рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА `FMW_EVENT_DEVICE_INFO_READY` рЃўрЃЋрЃћрЃюрЃЌрЃА.
  - **Payload:** `{"device_id": "5C013B7246E4", ...}`

- **­Ъћ┤ LWT (Last Will and Testament):**
  - **рЃЌрЃћрЃЏрЃљ:** `synapse/devices/5C013B7246E4/lwt`
  - **Payload:** `{"status": "offline"}`

## 5. ­ЪДа рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ

### 5.1. `init` рЃцрЃљрЃќрЃљ

1. **рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃћрЃЌ `WIFI_EVENT_IP_ASSIGNED` рЃўрЃЋрЃћрЃюрЃЌрЃќрЃћ:** рЃћрЃА рЃљрЃарЃўрЃА рЃАрЃўрЃњрЃюрЃљрЃџрЃў, рЃарЃЮрЃЏ рЃЏрЃќрЃљрЃЊ рЃЋрЃљрЃарЃЌ MQTT рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃАрЃЌрЃЋрЃўрЃА.
2. **рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃћрЃЌ рЃДрЃЋрЃћрЃџрЃљ рЃАрЃбрЃљрЃбрЃБрЃАрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃќрЃћ:** `init` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃњрЃљрЃЊрЃўрЃА `event_topic_map` рЃЏрЃљрЃАрЃўрЃЋрЃА рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА рЃДрЃЋрЃћрЃџрЃљ рЃўрЃЦ рЃљрЃдрЃгрЃћрЃарЃўрЃџ рЃўрЃЋрЃћрЃюрЃЌрЃА (рЃЏрЃљрЃњ., `FMW_EVENT_WIFI_STATUS_READY`, `FMW_EVENT_DEVICE_INFO_READY`).

### 5.2. `handle_event` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ

рЃћрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃљрЃарЃўрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА "рЃњрЃБрЃџрЃў".

- **рЃЌрЃБ рЃўрЃЋрЃћрЃюрЃЌрЃў рЃљрЃарЃўрЃА `WIFI_EVENT_IP_ASSIGNED`:**
  - рЃўрЃгрЃДрЃћрЃЉрЃА MQTT рЃЎрЃџрЃўрЃћрЃюрЃбрЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃўрЃАрЃљ рЃЊрЃљ рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃЊрЃљрЃЏрЃДрЃљрЃарЃћрЃЉрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃА.
- **рЃЌрЃБ рЃўрЃЋрЃћрЃюрЃЌрЃў рЃљрЃарЃўрЃА `event_topic_map`-рЃерЃў рЃљрЃдрЃгрЃћрЃарЃўрЃџрЃў рЃарЃЮрЃЏрЃћрЃџрЃўрЃЏрЃћ рЃАрЃ«рЃЋрЃљ рЃўрЃЋрЃћрЃюрЃЌрЃў:**
    1. рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА, рЃљрЃарЃўрЃА рЃЌрЃБ рЃљрЃарЃљ MQTT рЃЎрЃџрЃўрЃћрЃюрЃбрЃў рЃЊрЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃБрЃџрЃў.
    2. рЃърЃЮрЃБрЃџрЃЮрЃЉрЃА рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃА MQTT рЃЌрЃћрЃЏрЃўрЃА рЃерЃљрЃЉрЃџрЃЮрЃюрЃА "рЃарЃБрЃЎрЃўрЃЊрЃљрЃю".
    3. `MQTT_BUILD_TOPIC` рЃЏрЃљрЃЎрЃарЃЮрЃАрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ рЃљрЃњрЃћрЃЉрЃА рЃАрЃарЃБрЃџ рЃЌрЃћрЃЏрЃљрЃА `device_id`-рЃўрЃА рЃЕрЃљрЃАрЃЏрЃўрЃЌ.
    4. рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА `payload`-рЃА (рЃарЃЮрЃЏрЃћрЃџрЃўрЃф JSON рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃўрЃљ) рЃљрЃЏ рЃЌрЃћрЃЏрЃљрЃќрЃћ.

### 5.3. `mqtt_event_handler_cb` (ESP-IDF-рЃўрЃА callback)

- **`MQTT_EVENT_CONNECTED`:**
  - `MQTT_BUILD_TOPIC`-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ рЃљрЃњрЃћрЃЉрЃА рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃЌрЃћрЃЏрЃљрЃА (`.../cmd/in`).
  - рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА `esp_mqtt_client_subscribe`-рЃА рЃљрЃЏ рЃЌрЃћрЃЏрЃљрЃќрЃћ.
- **`MQTT_EVENT_DATA` (рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃЏрЃЮрЃЋрЃўрЃЊрЃљ):**
  - рЃћрЃА рЃљрЃарЃўрЃА **CLI Command Forwarder**-рЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ.
  - рЃўрЃдрЃћрЃЉрЃА рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџ `payload`-рЃА (рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃА).
  - рЃцрЃБрЃЌрЃљрЃЋрЃА рЃЏрЃљрЃА `fmw_command_payload_t`-рЃерЃў.
  - рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА `FMW_EVENT_EXECUTE_COMMAND_STRING` рЃўрЃЋрЃћрЃюрЃЌрЃА.

## 6. ­ЪњА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў (рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ-рЃърЃљрЃАрЃБрЃ«рЃўрЃА рЃфрЃўрЃЎрЃџрЃў)

1. **­Ъњ╗ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў (Postman/MQTT рЃЎрЃџрЃўрЃћрЃюрЃбрЃў):**
    - **рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА:** `synapse/devices/+/state/#` (рЃарЃЮрЃЏ рЃЏрЃўрЃўрЃдрЃЮрЃА рЃДрЃЋрЃћрЃџрЃљ рЃАрЃбрЃљрЃбрЃБрЃАрЃў).
    - **рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА:**
        - **Topic:** `synapse/devices/5C013B7246E4/cmd/in`
        - **Payload:** `"wifi status"`

2. **РџЎ№ИЈ рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ (Synapse Framework):**
    - `mqtt_manager` рЃўрЃдрЃћрЃЉрЃА рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА рЃЊрЃљ рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃА `Command Router`-рЃерЃў.
    - `command_router` рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА `wifi_manager`-рЃўрЃА `cmd_handler`-рЃА.
    - `wifi_manager` рЃљрЃњрЃарЃЮрЃЋрЃћрЃЉрЃА рЃАрЃбрЃљрЃбрЃБрЃАрЃА, рЃЦрЃЏрЃюрЃўрЃА JSON-рЃА рЃЊрЃљ рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА `FMW_EVENT_WIFI_STATUS_READY` рЃўрЃЋрЃћрЃюрЃЌрЃА.
    - `mqtt_manager` рЃўрЃдрЃћрЃЉрЃА `FMW_EVENT_WIFI_STATUS_READY` рЃўрЃЋрЃћрЃюрЃЌрЃА.

3. **­Ъњ╗ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў (Postman/MQTT рЃЎрЃџрЃўрЃћрЃюрЃбрЃў):**
    - **рЃўрЃдрЃћрЃЉрЃА рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљрЃА:**
        - **Topic:** `synapse/devices/5C013B7246E4/state/wifi/status`
        - **Payload:** `{"connection_status":"Connected", ...}`

## 7. РЮЌ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃћрЃЉрЃў

- **рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃљ:** рЃарЃћрЃљрЃџрЃБрЃа рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃерЃў, рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЌ `mqtts://` (TLS) рЃЊрЃљ рЃФрЃџрЃўрЃћрЃарЃў `username`/`password`.
- **`init_level`:** рЃљрЃЏ рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА `init_level` (`45`) рЃЎрЃарЃўрЃбрЃўрЃЎрЃБрЃџрЃўрЃљ. рЃўрЃА рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА `wifi_manager`-рЃўрЃА (`40`) рЃЊрЃљ `device_identity_service`-рЃўрЃА (`20`) рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃарЃљрЃЌрЃљ рЃЏрЃљрЃЌрЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃў рЃ«рЃћрЃџрЃЏрЃўрЃАрЃљрЃгрЃЋрЃЊрЃЮрЃЏрЃў рЃўрЃДрЃЮрЃА.
