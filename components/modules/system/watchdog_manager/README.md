# áƒ›áƒáƒ“áƒ£áƒšáƒ˜: Watchdog Manager

## 1. áƒ›áƒ˜áƒ›áƒáƒ®áƒ˜áƒšáƒ•áƒ

**áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜:** `watchdog_manager`  
**áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ:** `system`  
**áƒ•áƒ”áƒ áƒ¡áƒ˜áƒ:** 1.0.0  
**áƒáƒ•áƒ¢áƒáƒ áƒ˜:** Synapse Framework Team

`Watchdog Manager` áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ áƒ˜áƒ¡ Synapse Framework-áƒ˜áƒ¡ áƒ—áƒ•áƒ˜áƒ—áƒáƒ¦áƒ“áƒ’áƒ”áƒœáƒ˜áƒ¡ áƒ“áƒ áƒ¡áƒáƒ˜áƒ›áƒ”áƒ“áƒáƒáƒ‘áƒ˜áƒ¡ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒ™áƒáƒ›áƒáƒáƒœáƒ”áƒœáƒ¢áƒ˜. áƒ›áƒ˜áƒ¡áƒ˜ áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒáƒ›áƒáƒªáƒáƒœáƒáƒ, áƒ“áƒáƒ˜áƒªáƒ•áƒáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ áƒáƒ áƒáƒ’áƒ áƒáƒ›áƒ£áƒšáƒ˜ áƒ£áƒ–áƒ áƒ£áƒœáƒ•áƒ”áƒšáƒ§áƒáƒ¤áƒ˜áƒ¡ áƒ’áƒáƒ­áƒ”áƒ“áƒ•áƒ˜áƒ¡áƒ’áƒáƒœ (software freeze/hang).

áƒ¢áƒ áƒáƒ“áƒ˜áƒªáƒ˜áƒ£áƒšáƒ˜ watchdog-áƒ”áƒ‘áƒ˜áƒ¡áƒ’áƒáƒœ áƒ’áƒáƒœáƒ¡áƒ®áƒ•áƒáƒ•áƒ”áƒ‘áƒ˜áƒ—, áƒ áƒáƒ›áƒšáƒ”áƒ‘áƒ˜áƒª áƒ£áƒ‘áƒ áƒáƒšáƒáƒ“ áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ£áƒšáƒáƒ“ "áƒ˜áƒ™áƒ•áƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒáƒœ", áƒ”áƒ¡ áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ®áƒ“áƒ”áƒœáƒ¡ **"áƒ­áƒ™áƒ•áƒ˜áƒáƒœáƒ˜" áƒáƒœáƒ£ áƒáƒáƒšáƒ˜áƒ™áƒáƒªáƒ˜áƒáƒ–áƒ” áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ£áƒšáƒ˜ (application-aware)** watchdog-áƒ˜áƒ¡ áƒ˜áƒ›áƒáƒšáƒ”áƒ›áƒ”áƒœáƒ¢áƒáƒªáƒ˜áƒáƒ¡. áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒáƒ•áƒ¡ ESP-IDF-áƒ˜áƒ¡ Task Watchdog Timer-áƒ¡ (TWDT) áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ˜áƒ› áƒ¨áƒ”áƒ›áƒ—áƒ®áƒ•áƒ”áƒ•áƒáƒ¨áƒ˜, áƒ—áƒ£ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ **áƒ§áƒ•áƒ”áƒšáƒ** áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒáƒ“ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜ áƒ™áƒáƒ›áƒáƒáƒœáƒ”áƒœáƒ¢áƒ˜ áƒ’áƒáƒ›áƒáƒ áƒ—áƒ£áƒšáƒáƒ“ áƒ“áƒ áƒ“áƒ áƒáƒ£áƒšáƒáƒ“ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ¡.

## 2. áƒ¬áƒ˜áƒœáƒáƒáƒ˜áƒ áƒáƒ‘áƒ”áƒ‘áƒ˜ áƒ“áƒ `menuconfig`

áƒáƒ› áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ ESP-IDF-áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒáƒ¨áƒ˜ (`menuconfig`) áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜ áƒáƒ¤áƒªáƒ˜áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ:

1. **Task Watchdog Timer (TWDT):**
    * áƒ’áƒ–áƒ: `Component config` â†’ `ESP System Settings`
    * áƒáƒ¤áƒªáƒ˜áƒ: `[*] Initialize Task Watchdog Timer on startup` (`CONFIG_ESP_TASK_WDT_INIT`)
    * áƒáƒ¤áƒªáƒ˜áƒ: `Task Watchdog timeout period (seconds)` (`CONFIG_ESP_TASK_WDT_TIMEOUT_S`) - áƒ”áƒ¡ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ£áƒ¤áƒ áƒ áƒ“áƒ˜áƒ“áƒ˜, áƒ•áƒ˜áƒ“áƒ áƒ” áƒ©áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ `check_interval_sec`.

## 3. áƒáƒ áƒ¥áƒ˜áƒ¢áƒ”áƒ¥áƒ¢áƒ£áƒ áƒ£áƒšáƒ˜ áƒáƒ áƒ˜áƒœáƒªáƒ˜áƒáƒ”áƒ‘áƒ˜

* **áƒ’áƒáƒœáƒáƒ¬áƒ˜áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜ "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒ" (Distributed Heartbeat):** áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ  áƒ”áƒ§áƒ áƒ“áƒœáƒáƒ‘áƒ áƒ”áƒ áƒ— áƒªáƒ”áƒœáƒ¢áƒ áƒáƒšáƒ£áƒ  áƒ¢áƒáƒ¡áƒ™áƒ¡. áƒáƒ›áƒ˜áƒ¡ áƒœáƒáƒªáƒ•áƒšáƒáƒ“, áƒ˜áƒ¡ áƒ”áƒšáƒáƒ“áƒ”áƒ‘áƒ "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒ˜áƒ¡" áƒ¡áƒ˜áƒ’áƒœáƒáƒšáƒ”áƒ‘áƒ¡ áƒ¡áƒ®áƒ•áƒáƒ“áƒáƒ¡áƒ®áƒ•áƒ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡áƒ’áƒáƒœ. Watchdog-áƒ˜ "áƒ˜áƒ™áƒ•áƒ”áƒ‘áƒ”áƒ‘áƒ" áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ›áƒáƒ¨áƒ˜áƒœ, áƒ áƒáƒªáƒ áƒ§áƒ•áƒ”áƒšáƒ áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡áƒ’áƒáƒœ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ áƒ¡áƒ˜áƒ’áƒœáƒáƒšáƒ˜.
* **Service-driven:** áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ¬áƒ•áƒ“áƒ˜áƒ¡ `watchdog_api_t` áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ¡, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡ áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ”áƒ‘áƒáƒ¡ áƒáƒ«áƒšáƒ”áƒ•áƒ¡, áƒ“áƒáƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒáƒœ áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ áƒ˜ áƒ—áƒáƒ•áƒ˜, áƒ áƒáƒ’áƒáƒ áƒª "áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜" áƒ™áƒáƒ›áƒáƒáƒœáƒ”áƒœáƒ¢áƒ˜ áƒ“áƒ áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ£áƒšáƒáƒ“ áƒ’áƒáƒáƒ’áƒ–áƒáƒ•áƒœáƒáƒœ "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒ".
* **Event-driven:** áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒ’áƒáƒ›áƒáƒ˜áƒ¬áƒ”áƒ áƒ¡ `SYSTEM_HEALTH_ALERT` áƒ˜áƒ•áƒ”áƒœáƒ—áƒ¡. áƒ—áƒ£ `Health Monitor`-áƒ˜áƒ¡áƒ’áƒáƒœ áƒ›áƒ˜áƒ˜áƒ¦áƒ”áƒ‘áƒ¡ áƒ’áƒáƒ›áƒáƒ£áƒ¡áƒ¬áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ˜áƒ¡ áƒ¡áƒ˜áƒ’áƒœáƒáƒšáƒ¡, áƒ›áƒáƒ¡ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒ áƒ›áƒ˜áƒ–áƒáƒœáƒ›áƒ˜áƒ›áƒáƒ áƒ—áƒ£áƒšáƒáƒ“ áƒ¨áƒ”áƒ¬áƒ§áƒ•áƒ˜áƒ¢áƒáƒ¡ Watchdog-áƒ˜áƒ¡ "áƒ™áƒ•áƒ”áƒ‘áƒ", áƒ áƒáƒ—áƒ áƒ’áƒáƒ›áƒáƒ˜áƒ¬áƒ•áƒ˜áƒáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒ áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ.
* **áƒ¤áƒ”áƒœáƒ”áƒ‘áƒáƒ“ áƒ“áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜ áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒšáƒáƒ‘áƒ:**
    1. **ESP-IDF TWDT:** áƒ“áƒáƒ‘áƒáƒšáƒ˜ áƒ“áƒáƒœáƒ˜áƒ¡ áƒ¢áƒáƒ˜áƒ›áƒ”áƒ áƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ˜áƒ¬áƒ•áƒ”áƒ•áƒ¡ áƒáƒáƒáƒ áƒáƒ¢áƒ£áƒ áƒ£áƒš áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒáƒ¡.
    2. **`watchdog_manager`:** áƒ›áƒáƒ¦áƒáƒšáƒ˜ áƒ“áƒáƒœáƒ˜áƒ¡ áƒšáƒáƒ’áƒ˜áƒ™áƒ, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ¡, "áƒ•áƒáƒ­áƒáƒ›áƒáƒ—" áƒ—áƒ£ áƒáƒ áƒ TWDT-áƒ¡.
    3. **áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ˜:** áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒ”áƒšáƒœáƒ˜ áƒáƒ áƒ˜áƒáƒœ, áƒ“áƒ áƒáƒ£áƒšáƒáƒ“ áƒ’áƒáƒáƒ’áƒ–áƒáƒ•áƒœáƒáƒœ áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ áƒ˜ "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒ".

## 4. áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ

áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ áƒ®áƒ“áƒ”áƒ‘áƒ `system_config.json` áƒ¤áƒáƒ˜áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ”áƒ‘áƒ˜áƒ—.

**áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜:**

```json
{
    "type": "watchdog_manager",
    "enabled": true,
    "config": {
        "instance_name": "main_watchdog",
        "check_interval_ms": 2000,
        "heartbeat_timeout_ms": 5000
    }
}
```

**áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜:**

| áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜ | áƒ¢áƒ˜áƒáƒ˜ | áƒáƒ¦áƒ¬áƒ”áƒ áƒ | áƒ¡áƒáƒ•áƒáƒšáƒ“áƒ”áƒ‘áƒ£áƒšáƒ | Default |
|:---|:---|:---|:---:|:---|
| `instance_name` | áƒ¡áƒ¢áƒ áƒ˜áƒ¥áƒáƒœáƒ˜ | áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ˜áƒœáƒ¡áƒ¢áƒáƒœáƒªáƒ˜áƒ˜áƒ¡ áƒ£áƒœáƒ˜áƒ™áƒáƒšáƒ£áƒ áƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜. | âŒ | `main_watchdog`|
| `check_interval_ms` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ˜áƒœáƒ¢áƒ”áƒ áƒ•áƒáƒšáƒ˜ (áƒ›áƒ˜áƒšáƒ˜áƒ¬áƒáƒ›áƒ”áƒ‘áƒ¨áƒ˜), áƒ áƒ áƒ¡áƒ˜áƒ®áƒ¨áƒ˜áƒ áƒ˜áƒ—áƒáƒª áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒš "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒ”áƒ‘áƒ¡". | âŒ | `2000` |
| `heartbeat_timeout_ms` | áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜ | áƒ›áƒáƒ¥áƒ¡áƒ˜áƒ›áƒáƒšáƒ£áƒ áƒ˜ áƒ“áƒ áƒ (áƒ›áƒ˜áƒšáƒ˜áƒ¬áƒáƒ›áƒ”áƒ‘áƒ¨áƒ˜), áƒ áƒáƒ›áƒšáƒ˜áƒ¡ áƒ’áƒáƒœáƒ›áƒáƒ•áƒšáƒáƒ‘áƒáƒ¨áƒ˜áƒª áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒ”áƒšáƒáƒ“áƒ”áƒ‘áƒ "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒáƒ¡" áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ™áƒáƒ›áƒáƒáƒœáƒ”áƒœáƒ¢áƒ˜áƒ¡áƒ’áƒáƒœ. | âŒ | `5000` |

## 5. Service API (`watchdog_api_t`)

áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ”áƒ‘áƒ¡ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒáƒ— áƒ›áƒ˜áƒ˜áƒ¦áƒáƒœ áƒ¬áƒ•áƒ“áƒáƒ›áƒ Watchdog áƒ›áƒ”áƒœáƒ”áƒ¯áƒ”áƒ áƒ˜áƒ¡ API-áƒ–áƒ” `Service Locator`-áƒ˜áƒ¡ áƒ›áƒ”áƒ¨áƒ•áƒ”áƒáƒ‘áƒ˜áƒ—. áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜: `FMW_SERVICE_TYPE_WATCHDOG_API`.

**API áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜:**

* **`esp_err_t register_heartbeat(const char *module_name);`**  
  áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒ›áƒáƒ“áƒ£áƒšáƒ¡, áƒ áƒáƒ’áƒáƒ áƒª áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒš áƒ™áƒáƒ›áƒáƒáƒœáƒ”áƒœáƒ¢áƒ¡. áƒáƒ›áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’, `watchdog_manager` áƒ“áƒáƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ¡ áƒáƒ› áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡áƒ’áƒáƒœ "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒ˜áƒ¡" áƒšáƒáƒ“áƒ˜áƒœáƒ¡. áƒ”áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ›áƒáƒ˜áƒ«áƒáƒ®áƒáƒ¡ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ›áƒ áƒ›áƒáƒ“áƒ£áƒšáƒ›áƒ áƒ—áƒáƒ•áƒ˜áƒ¡ `init` áƒáƒœ `start` áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ¨áƒ˜.

* **`esp_err_t send_heartbeat(const char *module_name);`**  
  áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ£áƒšáƒáƒ“ áƒ˜áƒ«áƒáƒ®áƒ”áƒ‘áƒ¡ áƒáƒ› áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ¡, áƒ áƒáƒ—áƒ áƒáƒ›áƒªáƒœáƒáƒ¡ `watchdog_manager`-áƒ¡, áƒ áƒáƒ› áƒ˜áƒ¡ "áƒªáƒáƒªáƒ®áƒáƒšáƒ˜áƒ" áƒ“áƒ áƒ’áƒáƒ›áƒáƒ áƒ—áƒ£áƒšáƒáƒ“ áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡.

* **`esp_err_t unregister_heartbeat(const char *module_name);`**  
  áƒ¨áƒšáƒ˜áƒ¡ áƒ›áƒáƒ“áƒ£áƒšáƒ¡ áƒ›áƒáƒœáƒ˜áƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜áƒ¡ áƒ¡áƒ˜áƒ˜áƒ“áƒáƒœ. áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ›áƒáƒ˜áƒ«áƒáƒ®áƒáƒ¡ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ `deinit` áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ›.

## 6. áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜

* **`WATCHDOG_HEARTBEAT_MISSED`**
  * **áƒ áƒáƒ“áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ§áƒœáƒ“áƒ”áƒ‘áƒ:** áƒ áƒáƒ“áƒ”áƒ¡áƒáƒª áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒ›áƒ” áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒ•áƒ”áƒ  áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒ¡ "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒáƒ¡" `heartbeat_timeout_ms`-áƒ˜áƒ¡ áƒ’áƒáƒœáƒ›áƒáƒ•áƒšáƒáƒ‘áƒáƒ¨áƒ˜.
  * **Payload (cJSON áƒ¡áƒ¢áƒ áƒ˜áƒ¥áƒáƒœáƒ˜):** `{"module_name":"main_mqtt_client"}`

* **`WATCHDOG_TRIGGERED_REBOOT`**
  * **áƒ áƒáƒ“áƒ˜áƒ¡ áƒ¥áƒ•áƒ”áƒ§áƒœáƒ“áƒ”áƒ‘áƒ:** áƒ áƒáƒ“áƒ”áƒ¡áƒáƒª áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ¡ "áƒ™áƒ•áƒ”áƒ‘áƒáƒ¡" áƒ“áƒ áƒ”áƒ›áƒ–áƒáƒ“áƒ”áƒ‘áƒ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ¡áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒáƒ“.
  * **Payload (cJSON áƒ¡áƒ¢áƒ áƒ˜áƒ¥áƒáƒœáƒ˜):** `{"reason":"Heartbeat missed from main_mqtt_client"}`

## 7. ğŸ’¡ áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜

áƒ¬áƒáƒ áƒ›áƒáƒ•áƒ˜áƒ“áƒ’áƒ˜áƒœáƒáƒ—, `mqtt_client` áƒ›áƒáƒ“áƒ£áƒšáƒ˜ áƒáƒ áƒ˜áƒ¡ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒ™áƒáƒ›áƒáƒáƒœáƒ”áƒœáƒ¢áƒ˜.

**1. áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ (`mqtt_client.c`-áƒ¨áƒ˜):**

```c
// mqtt_client_init áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ¨áƒ˜
service_handle_t handle = fmw_service_get("main_watchdog");
if (handle) {
    watchdog_api_t *wd_api = (watchdog_api_t *)handle;
    wd_api->register_heartbeat("main_mqtt_client");
}
```

**2. "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒ˜áƒ¡" áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ (`mqtt_client.c`-áƒ¨áƒ˜):**

```c
// MQTT áƒ¢áƒáƒ¡áƒ™áƒ˜áƒ¡ áƒ›áƒ—áƒáƒ•áƒáƒ  áƒªáƒ˜áƒ™áƒšáƒ¨áƒ˜, áƒ§áƒáƒ•áƒ”áƒšáƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒáƒáƒ”áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’
void mqtt_task() {
    while(1) {
        // ... áƒáƒ™áƒ”áƒ—áƒ”áƒ‘áƒ¡ áƒ—áƒáƒ•áƒ˜áƒ¡ áƒ¡áƒáƒ¥áƒ›áƒ”áƒ¡ ...
        
        // áƒ•áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒ— "áƒ’áƒ£áƒšáƒ˜áƒ¡áƒªáƒ”áƒ›áƒáƒ¡"
        service_handle_t handle = fmw_service_get("main_watchdog");
        if (handle) {
            watchdog_api_t *wd_api = (watchdog_api_t *)handle;
            wd_api->send_heartbeat("main_mqtt_client");
        }
        
        vTaskDelay(pdMS_TO_TICKS(1000));
    }
}
```

áƒ—áƒ£ `mqtt_task` áƒ’áƒáƒ˜áƒ­áƒ”áƒ“áƒ”áƒ‘áƒ, `send_heartbeat` áƒáƒ¦áƒáƒ  áƒ’áƒáƒ›áƒáƒ˜áƒ«áƒáƒ®áƒ”áƒ‘áƒ, `watchdog_manager` áƒáƒ›áƒáƒ¡ áƒ“áƒáƒáƒ¤áƒ˜áƒ¥áƒ¡áƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒ“áƒ áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒáƒ•áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒáƒ¡.
