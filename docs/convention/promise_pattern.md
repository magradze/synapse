# asynchronous рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃўрЃА рЃърЃљрЃбрЃћрЃарЃюрЃў (Promise Pattern)

**рЃАрЃбрЃљрЃбрЃБрЃАрЃў:** рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў (Recommended)
**рЃљрЃЋрЃбрЃЮрЃарЃў:** Synapse Framework Team

## 1. ­Ъј» рЃЏрЃўрЃќрЃљрЃюрЃў

рЃћрЃА рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃў рЃљрЃдрЃгрЃћрЃарЃА Synapse Framework-рЃерЃў рЃљрЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃБрЃџрЃў "рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ-рЃърЃљрЃАрЃБрЃ«рЃўрЃА" (Request-Response) рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃўрЃА рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџ рЃърЃљрЃбрЃћрЃарЃюрЃА, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџрЃўрЃљ **Promise** (рЃЊрЃљрЃърЃўрЃарЃћрЃЉрЃўрЃА) рЃЎрЃЮрЃюрЃфрЃћрЃцрЃфрЃўрЃљрЃќрЃћ. рЃљрЃЏ рЃърЃљрЃбрЃћрЃарЃюрЃўрЃА рЃЏрЃўрЃќрЃљрЃюрЃўрЃљ, рЃЕрЃљрЃљрЃюрЃљрЃфрЃЋрЃџрЃЮрЃА рЃарЃЌрЃБрЃџрЃў, рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ рЃБрЃцрЃарЃЮ рЃАрЃБрЃцрЃЌрЃљ, рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљрЃЊрЃў рЃЊрЃљ рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃљрЃЊ рЃњрЃљрЃЏрЃљрЃарЃЌрЃБрЃџрЃў рЃЎрЃЮрЃЊрЃўрЃЌ.

рЃћрЃА рЃърЃљрЃбрЃћрЃарЃюрЃў рЃўрЃЊрЃћрЃљрЃџрЃБрЃарЃўрЃљ рЃўрЃЏ рЃАрЃфрЃћрЃюрЃљрЃарЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃћрЃарЃЌрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў (рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў, Consumer) рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљрЃА рЃЏрЃћрЃЮрЃарЃћ рЃЏрЃЮрЃЊрЃБрЃџрЃЌрЃљрЃю (рЃАрЃћрЃарЃЋрЃўрЃАрЃў, Provider) рЃЊрЃљ рЃћрЃџрЃЮрЃЊрЃћрЃЉрЃљ рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџ, рЃћрЃарЃЌрЃ»рЃћрЃарЃљрЃЊ рЃърЃљрЃАрЃБрЃ«рЃА.

## 2. ­Ъцћ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ: рЃарЃљрЃбрЃЮрЃЏ рЃњрЃЋрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ Promise-рЃћрЃЉрЃў?

рЃгрЃљрЃарЃЏрЃЮрЃЋрЃўрЃЊрЃњрЃўрЃюрЃЮрЃЌ рЃЎрЃџрЃљрЃАрЃўрЃЎрЃБрЃарЃў рЃАрЃфрЃћрЃюрЃљрЃарЃў: `ui_manager`-рЃА рЃАрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ `wifi_manager`-рЃўрЃАрЃњрЃљрЃю рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ рЃАрЃбрЃљрЃбрЃБрЃАрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ. `Event Bus`-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ, рЃърЃарЃЮрЃфрЃћрЃАрЃў рЃљрЃАрЃћ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃБрЃарЃћрЃЉрЃљ:

1. `ui_manager` рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА `EXECUTE_COMMAND` рЃўрЃЋрЃћрЃюрЃЌрЃА `payload`-рЃўрЃЌ `"wifi status --silent"`.
2. `wifi_manager` рЃўрЃдрЃћрЃЉрЃА рЃљрЃЏ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљрЃА, рЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃА рЃЏрЃљрЃА рЃЊрЃљ рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА рЃърЃљрЃАрЃБрЃ«рЃА **рЃАрЃ«рЃЋрЃљ** рЃўрЃЋрЃћрЃюрЃЌрЃўрЃЌ: `FMW_EVENT_WIFI_STATUS_READY`.
3. `ui_manager`-рЃА рЃљрЃЦрЃЋрЃА рЃфрЃљрЃџрЃЎрЃћ рЃџрЃЮрЃњрЃўрЃЎрЃљ `handle_event` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃерЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃБрЃАрЃЏрЃћрЃюрЃА `FMW_EVENT_WIFI_STATUS_READY` рЃўрЃЋрЃћрЃюрЃЌрЃА рЃЊрЃљ рЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃА рЃърЃљрЃАрЃБрЃ«рЃА.

**рЃАрЃўрЃАрЃБрЃАрЃбрЃћрЃћрЃЉрЃў:**

- **рЃњрЃљрЃцрЃљрЃюрЃбрЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ:** рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃА рЃњрЃљрЃњрЃќрЃљрЃЋрЃюрЃљ рЃЊрЃљ рЃърЃљрЃАрЃБрЃ«рЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ рЃ«рЃЊрЃћрЃЉрЃљ рЃЎрЃЮрЃЊрЃўрЃА рЃАрЃ«рЃЋрЃљрЃЊрЃљрЃАрЃ«рЃЋрЃљ, рЃћрЃарЃЌрЃЏрЃљрЃюрЃћрЃЌрЃЌрЃљрЃю рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃљрЃЊ рЃЊрЃљрЃБрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃћрЃџ рЃюрЃљрЃгрЃўрЃџрЃћрЃЉрЃерЃў.
- **рЃЎрЃЮрЃюрЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃЊрЃљрЃЎрЃљрЃарЃњрЃЋрЃљ:** рЃарЃЌрЃБрЃџрЃўрЃљ рЃўрЃЏрЃўрЃА рЃЏрЃўрЃЎрЃЋрЃџрЃћрЃЋрЃљ, рЃЌрЃБ рЃарЃЮрЃЏрЃћрЃџрЃў рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ рЃарЃЮрЃЏрЃћрЃџ рЃърЃљрЃАрЃБрЃ«рЃА рЃерЃћрЃћрЃАрЃљрЃЉрЃљрЃЏрЃћрЃЉрЃљ.
- **"рЃ«рЃЏрЃљрЃБрЃарЃў" `Event Bus`-рЃќрЃћ:** `FMW_EVENT_WIFI_STATUS_READY` рЃўрЃњрЃќрЃљрЃЋрЃюрЃћрЃЉрЃљ рЃДрЃЋрЃћрЃџрЃљрЃАрЃЌрЃљрЃю, рЃЏрЃљрЃерЃўрЃюрЃљрЃф рЃЎрЃў, рЃЌрЃБ рЃўрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ `ui_manager`-рЃА рЃАрЃГрЃўрЃарЃЊрЃћрЃЉрЃЮрЃЊрЃљ.

## 3. ­ЪњА рЃњрЃљрЃЊрЃљрЃгрЃДрЃЋрЃћрЃбрЃљ: Promise рЃърЃљрЃбрЃћрЃарЃюрЃў

Promise рЃърЃљрЃбрЃћрЃарЃюрЃў рЃљрЃЏ рЃърЃарЃЮрЃфрЃћрЃАрЃА рЃњрЃљрЃарЃЊрЃљрЃЦрЃЏрЃюрЃўрЃА. `Promise` рЃљрЃарЃўрЃА рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃгрЃљрЃарЃЏрЃЮрЃљрЃЊрЃњрЃћрЃюрЃА **рЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃерЃў рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃљрЃЊрЃў рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃўрЃА рЃерЃћрЃЊрЃћрЃњрЃА**.

**рЃљрЃ«рЃљрЃџрЃў рЃАрЃљрЃЏрЃБрЃерЃљрЃЮ рЃърЃарЃЮрЃфрЃћрЃАрЃў:**

1. `ui_manager` рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА `wifi_manager`-рЃўрЃА API рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃА: `wifi_api_get_status_async()`.
2. `wifi_manager` рЃЏрЃЮрЃЏрЃћрЃюрЃбрЃљрЃџрЃБрЃарЃљрЃЊ рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА `promise_handle_t` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃА (рЃфрЃљрЃарЃўрЃћрЃџ "рЃДрЃБрЃЌрЃА").
3. `ui_manager` рЃљрЃЏ "рЃДрЃБрЃЌрЃќрЃћ" рЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃА рЃЮрЃа `callback` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃА:
    - `then()`: рЃарЃљ рЃБрЃюрЃЊрЃљ рЃЏрЃЮрЃ«рЃЊрЃћрЃА, рЃЌрЃБ рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃљ **рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ** рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃћрЃЉрЃљ.
    - `catch()`: рЃарЃљ рЃБрЃюрЃЊрЃљ рЃЏрЃЮрЃ«рЃЊрЃћрЃА, рЃЌрЃБ рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃљ **рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃЌ** рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃћрЃЉрЃљ.
4. рЃарЃЮрЃЊрЃћрЃАрЃљрЃф `wifi_manager`-рЃў рЃЊрЃљрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА рЃАрЃбрЃљрЃбрЃБрЃАрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљрЃА, рЃўрЃА "рЃљрЃЋрЃАрЃћрЃЉрЃА" рЃљрЃЏ "рЃДрЃБрЃЌрЃА" рЃерЃћрЃЊрЃћрЃњрЃўрЃЌ, рЃарЃљрЃф рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃўрЃгрЃЋрЃћрЃЋрЃА `ui_manager`-рЃўрЃА рЃЏрЃўрЃћрЃа рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў `then()` `callback`-рЃўрЃА рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃљрЃА.

**рЃАрЃљрЃарЃњрЃћрЃЉрЃћрЃџрЃў:**

- **рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃЎрЃљрЃЋрЃерЃўрЃарЃў:** рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ, рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ рЃЊрЃљ рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ рЃЌрЃљрЃЋрЃЏрЃЮрЃДрЃарЃўрЃџрЃўрЃљ рЃћрЃарЃЌ, рЃЎрЃЮрЃЏрЃърЃљрЃЦрЃбрЃБрЃа рЃЎрЃЮрЃЊрЃўрЃА рЃЉрЃџрЃЮрЃЎрЃерЃў.
- **рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљрЃЊрЃЮрЃЉрЃљ:** рЃЎрЃЮрЃЊрЃў рЃ«рЃЊрЃћрЃЉрЃљ рЃЉрЃћрЃЋрЃарЃљрЃЊ рЃБрЃцрЃарЃЮ рЃўрЃюрЃбрЃБрЃўрЃфрЃўрЃБрЃарЃў рЃЊрЃљ рЃљрЃЊрЃЋрЃўрЃџрЃљрЃЊ рЃњрЃљрЃАрЃљрЃњрЃћрЃЉрЃў.
- **рЃЏрЃўрЃќрЃљрЃюрЃЏрЃўрЃЏрЃљрЃарЃЌрЃБрЃџрЃў рЃЎрЃЮрЃЏрЃБрЃюрЃўрЃЎрЃљрЃфрЃўрЃљ:** рЃърЃљрЃАрЃБрЃ«рЃў рЃЏрЃўрЃћрЃгрЃЮрЃЊрЃћрЃЉрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃЏрЃљрЃА, рЃЋрЃўрЃюрЃф рЃўрЃА рЃЏрЃЮрЃўрЃЌрЃ«рЃЮрЃЋрЃљ.

## 4. РџЎ№ИЈ рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ?

рЃцрЃарЃћрЃўрЃЏрЃЋрЃЮрЃарЃЦрЃўрЃА рЃЉрЃўрЃарЃЌрЃЋрЃерЃў рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА **`Promise Manager`** рЃЎрЃЮрЃЏрЃърЃЮрЃюрЃћрЃюрЃбрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃљрЃЏ рЃърЃарЃЮрЃфрЃћрЃАрЃА рЃЏрЃљрЃарЃЌрЃљрЃЋрЃА:

- **`fmw_promise_create()`:** рЃАрЃћрЃарЃЋрЃўрЃАрЃў (рЃЏрЃљрЃњ., `wifi_manager`) рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА рЃљрЃЏ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃА, рЃарЃљрЃЌрЃљ рЃерЃћрЃЦрЃЏрЃюрЃљрЃА рЃљрЃ«рЃљрЃџрЃў, `PENDING` (рЃЏрЃЮрЃЏрЃџрЃЮрЃЊрЃўрЃюрЃћ) рЃЏрЃЊрЃњрЃЮрЃЏрЃљрЃарЃћрЃЮрЃЉрЃљрЃерЃў рЃЏрЃДрЃЮрЃцрЃў `Promise`.
- **`fmw_promise_then()` / `fmw_promise_catch()`:** рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў (рЃЏрЃљрЃњ., `ui_manager`) рЃљрЃЏ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃўрЃЌ рЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃА рЃЌрЃљрЃЋрЃўрЃА `callback`-рЃћрЃЉрЃА.
- **`fmw_promise_resolve()` / `fmw_promise_reject()`:** рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃАрЃћрЃарЃЋрЃўрЃАрЃў рЃЊрЃљрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃљрЃА, рЃўрЃА рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА рЃљрЃЏ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃўрЃЊрЃљрЃю рЃћрЃарЃЌ-рЃћрЃарЃЌрЃА.
- **`Promise Manager Task`:** `resolve` рЃљрЃю `reject` рЃњрЃљрЃЏрЃЮрЃФрЃљрЃ«рЃћрЃЉрЃўрЃАрЃљрЃА, `Promise Manager`-рЃў рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃА `Promise`-рЃА рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃЌрЃљрЃЋрЃўрЃА рЃерЃўрЃЊрЃљ рЃарЃўрЃњрЃерЃў. рЃЏрЃўрЃАрЃў рЃњрЃљрЃЏрЃЮрЃДрЃЮрЃцрЃўрЃџрЃў FreeRTOS рЃбрЃљрЃАрЃЎрЃў рЃўрЃдрЃћрЃЉрЃА рЃљрЃЏ `Promise`-рЃА рЃЊрЃљ рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ, рЃўрЃќрЃЮрЃџрЃўрЃарЃћрЃЉрЃБрЃџ рЃЎрЃЮрЃюрЃбрЃћрЃЦрЃАрЃбрЃерЃў рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃЏрЃўрЃћрЃа рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџ `callback` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃА.

## 5. ­ЪЊЮ рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃърЃљрЃбрЃћрЃарЃюрЃў

### 5.1. рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃЏрЃЮрЃЏрЃгрЃЮрЃЊрЃћрЃЉрЃџрЃўрЃА рЃЏрЃ«рЃљрЃарЃћ (Provider - рЃЏрЃљрЃњ., `wifi_manager`)

1. **API-рЃА рЃЊрЃћрЃЎрЃџрЃљрЃарЃўрЃарЃћрЃЉрЃљ (`wifi_interface.h`):**

    ```c
    #include "promise_manager.h" // рЃАрЃљрЃГрЃўрЃарЃЮрЃљ promise_handle_t-рЃАрЃЌрЃЋрЃўрЃА

    typedef struct {
        // ... рЃАрЃ«рЃЋрЃљ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў ...
        promise_handle_t (*get_status_async)(void* context);
    } wifi_api_t;
    ```

2. **API-рЃА рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ (`wifi_manager.c`):**

    ```c
    #include "promise_manager_internal.h" // рЃАрЃљрЃГрЃўрЃарЃЮрЃљ fmw_promise_create-рЃАрЃЌрЃЋрЃўрЃА

    static promise_handle_t wifi_api_get_status_async(void* context) {
        // 1. рЃерЃћрЃЋрЃЦрЃЏрЃюрЃљрЃЌ рЃљрЃ«рЃљрЃџрЃў "рЃЊрЃљрЃърЃўрЃарЃћрЃЉрЃљ"
        promise_handle_t promise = fmw_promise_create();
        if (!promise) {
            return NULL;
        }

        // 2. рЃњрЃљрЃЋрЃљрЃњрЃќрЃљрЃЋрЃюрЃЮрЃЌ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃЕрЃЋрЃћрЃюрЃА рЃерЃўрЃЊрЃљ рЃбрЃљрЃАрЃЎрЃерЃў,
        //    рЃЌрЃљрЃю рЃњрЃљрЃЊрЃљрЃЋрЃфрЃћрЃЌ promise-рЃўрЃА handle.
        wifi_internal_cmd_t cmd = {
            .type = CMD_GET_STATUS,
            .promise_handle = promise
        };
        xQueueSend(private_data->command_queue, &cmd, 0);

        // 3. рЃЊрЃљрЃЋрЃљрЃЉрЃарЃБрЃюрЃЮрЃЌ "рЃЊрЃљрЃърЃўрЃарЃћрЃЉрЃљ" рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃА
        return promise;
    }
    ```

3. **Promise-рЃўрЃА рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃљ (`wifi_task`-рЃерЃў):**

    ```c
    // wifi_task-рЃерЃў, рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃАрЃбрЃљрЃбрЃБрЃАрЃў рЃЏрЃќрЃљрЃЊ рЃўрЃЦрЃюрЃћрЃЉрЃљ...
    wifi_status_t* status_data = malloc(sizeof(wifi_status_t));
    // ... рЃерЃћрЃЋрЃљрЃЋрЃАрЃЮрЃЌ status_data ...

    // рЃерЃћрЃЋрЃљрЃАрЃарЃБрЃџрЃЮрЃЌ "рЃЊрЃљрЃърЃўрЃарЃћрЃЉрЃљ"
    fmw_promise_resolve(cmd.promise_handle, status_data, free);
    ```

### 5.2. рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃЏрЃ«рЃљрЃарЃћ (Consumer - рЃЏрЃљрЃњ., `ui_manager`)

```c
// ui_manager.c

// Callback рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА
static void on_wifi_status_ready(void* result_data, void* user_context) {
    wifi_status_t* status = (wifi_status_t*)result_data;
    ESP_LOGI(TAG, "Promise resolved! WiFi RSSI: %d", status->rssi);
    // рЃљрЃЦ рЃЏрЃЮрЃ«рЃЊрЃћрЃЉрЃљ UI-рЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃљ
}

// Callback рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА
static void on_wifi_status_failed(void* error_data, void* user_context) {
    ESP_LOGE(TAG, "Promise rejected! Could not get WiFi status.");
}

// рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃА рЃњрЃљрЃњрЃќрЃљрЃЋрЃюрЃљ
void request_wifi_update() {
    promise_handle_t p = private_data->wifi_service->api->get_status_async(private_data->wifi_service->context);
    
    if (p) {
        fmw_promise_then(p, on_wifi_status_ready, private_data);
        fmw_promise_catch(p, on_wifi_status_failed, private_data);
    }
}
```

## 6. РюЁ рЃарЃЮрЃЊрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЋрЃўрЃДрЃћрЃюрЃЮрЃЌ Promise рЃЊрЃљ рЃарЃЮрЃЊрЃўрЃА Event Bus?

| рЃАрЃфрЃћрЃюрЃљрЃарЃў | рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў рЃърЃљрЃбрЃћрЃарЃюрЃў | рЃарЃљрЃбрЃЮрЃЏ? |
| :--- | :--- | :--- |
| рЃћрЃарЃЌрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃЌрЃ«рЃЮрЃЋрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃА рЃЏрЃћрЃЮрЃарЃўрЃАрЃњрЃљрЃю рЃЊрЃљ рЃћрЃџрЃЮрЃЊрЃћрЃЉрЃљ **рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџ рЃърЃљрЃАрЃБрЃ«рЃА**. | **Promise** | рЃърЃўрЃарЃЊрЃљрЃърЃўрЃарЃў, рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃЎрЃљрЃЋрЃерЃўрЃарЃў рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљрЃАрЃљ рЃЊрЃљ рЃърЃљрЃАрЃБрЃ«рЃА рЃерЃЮрЃарЃўрЃА. |
| рЃћрЃарЃЌрЃў рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА **рЃќрЃЮрЃњрЃљрЃЊ рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљрЃА** (рЃЏрЃљрЃњ., "WiFi рЃњрЃљрЃўрЃЌрЃўрЃерЃљ"), рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ **рЃЉрЃћрЃЋрЃарЃЏрЃљ** (рЃљрЃю рЃљрЃарЃфрЃћрЃарЃЌрЃЏрЃљ) рЃЏрЃЮрЃЊрЃБрЃџрЃЏрЃљ рЃЏрЃЮрЃўрЃАрЃЏрЃўрЃюрЃЮрЃА. | **Event Bus** | рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃўрЃќрЃЮрЃџрЃљрЃфрЃўрЃљ. рЃњрЃљрЃЏрЃЮрЃЏрЃњрЃќрЃљрЃЋрЃюрЃЏрЃљ рЃљрЃа рЃўрЃфрЃўрЃА, рЃЋрЃўрЃю рЃБрЃАрЃЏрЃћрЃюрЃА. |
| рЃАрЃљрЃГрЃўрЃарЃЮрЃљ рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃўрЃА рЃерЃћрЃЊрЃћрЃњрЃўрЃА (рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃљ/рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ) рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃљ рЃћрЃарЃЌ рЃЎрЃЮрЃЊрЃўрЃА рЃЉрЃџрЃЮрЃЎрЃерЃў. | **Promise** | `then()` рЃЊрЃљ `catch()` рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃўрЃарЃћрЃЉрЃБрЃџ рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃљрЃА. |
| рЃАрЃўрЃАрЃбрЃћрЃЏрЃБрЃарЃў, "Broadcast" рЃбрЃўрЃърЃўрЃА рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃћрЃЉрЃў (рЃЏрЃљрЃњ., `SYSTEM_START_COMPLETE`). | **Event Bus** | рЃўрЃЊрЃћрЃљрЃџрЃБрЃарЃўрЃљ рЃцрЃљрЃарЃЌрЃЮ рЃљрЃБрЃЊрЃўрЃбрЃЮрЃарЃўрЃўрЃАрЃЌрЃЋрЃўрЃА рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃўрЃА рЃњрЃљрЃАрЃљрЃЋрЃарЃфрЃћрЃџрЃћрЃЉрЃџрЃљрЃЊ. |
