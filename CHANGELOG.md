# ცვლილებების ისტორია (Changelog)

## [v2.4.0] - 2025-07-02

### ✨ ახალი ფუნქციონალი

- **დაემატა Watchdog Manager მოდული:** შეიქმნა ახალი სისტემური მოდული, რომელიც უზრუნველყოფს სისტემის დაცვას პროგრამული გაჭედვისგან "ჭკვიანი" მონიტორინგის მეშვეობით.
  - **აპლიკაციაზე მორგებული Watchdog:** მოდული იყენებს ESP-IDF-ის Task Watchdog Timer-ს (TWDT), მაგრამ "კვებავს" მას მხოლოდ იმ შემთხვევაში, თუ ყველა რეგისტრირებული კრიტიკული მოდული გამართულად მუშაობს.
  - **"გულისცემის" (Heartbeat) მექანიზმი:** სხვა მოდულებს შეუძლიათ დაარეგისტრირონ საკუთარი თავი და პერიოდულად გააგზავნონ "გულისცემის" სიგნალი. თუ რომელიმე მოდული შეწყვეტს სიგნალის გაგზავნას, Watchdog-ი გამოიწვევს სისტემის გადატვირთვას.
  - **Service API:** ამატებს `FMW_SERVICE_TYPE_WATCHDOG_API` სერვისს, რომელიც სხვა მოდულებს საშუალებას აძლევს, მართონ თავიანთი რეგისტრაცია და "გულისცემის" გაგზავნა.
  - **კონფიგურირებადობა:** მოდულის შემოწმების ინტერვალი და "გულისცემის" ტაიმაუტი იმართება `system_config.json`-იდან.

### 🐛 შეცდომების გასწორება

- **გასწორდა TWDT-ის ორმაგი ინიციალიზაციის პრობლემა:** `watchdog_manager`-ის `init` ფუნქცია ახლა კორექტულად ამოწმებს, არის თუ არა Task Watchdog Timer-ი უკვე ინიციალიზებული სისტემის მიერ (`menuconfig`-იდან), რაც თავიდან აცილებს `ESP_ERR_INVALID_STATE` შეცდომას და სისტემის კრაშს.

---
## [v2.3.0] - 2025-07-02

### ✨ ახალი ფუნქციონალი

- **დაემატა OTA Update Manager მოდული:** შეიქმნა ახალი სისტემური მოდული, რომელიც უზრუნველყოფს უსაფრთხო და საიმედო Over-the-Air (OTA) firmware განახლებას.
  - **Service API:** ამატებს `FMW_SERVICE_TYPE_OTA_API` სერვისს, რომელიც სხვა მოდულებს საშუალებას აძლევს, დაიწყონ განახლების პროცესი URL-ის მითითებით.
  - **სისტემური ინტეგრაცია:** განახლების დაწყებამდე, `Health Monitor`-ის მეშვეობით ამოწმებს სისტემის რესურსებს (თავისუფალი მეხსიერება).
  - **ვიზუალური უკუკავშირი:** `RGB LED Indicator`-ის გამოყენებით, მომხმარებელს აწვდის ვიზუალურ ინფორმაციას განახლების პროცესის სტატუსის შესახებ (დაწყება, წარმატება, შეცდომა).
  - **ივენთებზე დაფუძნებული მუშაობა:** აქვეყნებს `OTA_STARTED`, `OTA_SUCCESS`, `OTA_FAILED` ივენთებს, რაც სხვა მოდულებს საშუალებას აძლევს, რეაგირება მოახდინონ განახლების პროცესის სხვადასხვა ეტაპზე.
  - **უსაფრთხოება:** მხარს უჭერს განახლებას HTTPS-ით და იყენებს ESP-IDF-ის ჩაშენებულ სერტიფიკატების ნაკრებს.

### 🏗️ ინფრასტრუქტურა

- **დაემატა საჯარო ინტერფეისები:** შეიქმნა `health_interface.h` და `rgb_led_interface.h` ფაილები `components/interfaces` დირექტორიაში, რაც უზრუნველყოფს შესაბამისი მოდულების API-ების იზოლირებულ და სტანდარტულ გამოყენებას Service Locator-ის მეშვეობით.

## [v2.2.0] - 2025-07-01

### ✨ ახალი ფუნქციონალი

- **დაემატა Health Monitor მოდული:** შეიქმნა ახალი სისტემური მოდული, რომელიც უზრუნველყოფს სისტემის ჯანმრთელობის მონიტორინგს.
  - **მეხსიერების კონტროლი:** პერიოდულად ამოწმებს თავისუფალი ოპერატიული მეხსიერების (Heap) რაოდენობას და აგენერირებს `SYSTEM_HEALTH_ALERT` ივენთს, თუ ის დაეცემა კონფიგურაციით განსაზღვრულ ზღვარზე დაბლა.
  - **ტასკების სტეკის მონიტორინგი:** ამოწმებს ყველა აქტიური ტასკის სტეკის გამოყენების მაჩვენებელს (High Water Mark) და აგენერირებს alert-ს კრიტიკული ზღვარის გადაცდომისას.
  - **დიაგნოსტიკური API:** ამატებს `FMW_SERVICE_TYPE_HEALTH_API` სერვისს, რომელიც სხვა მოდულებს საშუალებას აძლევს, მოითხოვონ სისტემის ჯანმრთელობის სრული რეპორტი JSON ფორმატში.
  - **გაფართოებადი არქიტექტურა:** გააჩნია მექანიზმი, რომლითაც სხვა მოდულებს შეუძლიათ დაარეგისტრირონ საკუთარი, აპლიკაციისთვის სპეციფიკური შემოწმების ფუნქციები.

### 🐛 შეცდომების გასწორება

- **გასწორდა FreeRTOS სტატისტიკის ფუნქციების ლინკირების პრობლემა:** მოგვარდა `undefined reference to uxTaskGetSystemState` შეცდომა `menuconfig`-ში `CONFIG_FREERTOS_USE_TRACE_FACILITY`-ის ჩართვით და კოდის შესაბამისი მოდიფიკაციით, ESP-IDF v5.4.1-ის სპეციფიკის გათვალისწინებით.

## [v2.1.1] - 2025-07-01

### 🐛 შეცდომების გასწორება

- **გასწორდა NVS-დან მონაცემების წაკითხვის შეცდომა:** მოგვარდა კრიტიკული შეცდომა `wifi_manager`-ში, რომლის დროსაც WiFi-ს მონაცემები არასწორად იკითხებოდა NVS მეხსიერებიდან მოწყობილობის გადატვირთვის შემდეგ. პრობლემა გამოწვეული იყო მეხსიერების არასწორი მართვით. `load_credentials_from_nvs` ფუნქცია გადაკეთდა უფრო მტკიცე, დაცვით მექანიზმზე, რომელიც იყენებს დროებით ბუფერებს და `memcpy`-ს მონაცემთა მთლიანობის უზრუნველსაყოფად.
- **გაუმჯობესდა Reconnect-Provisioning ციკლი:** `ble_provisioning` მოდული ახლა კორექტულად ამუშავებს `PROV_START_REQUESTED` ივენთს, რაც საშუალებას აძლევს მას, ხელახლა დაიწყოს provisioning პროცესი WiFi-სთან დაკავშირების მრავალჯერადი წარუმატებელი მცდელობის შემდეგ. ამით სრულდება აღდგენის სრული და გამართული ციკლი.

### ✨ ახალი ფუნქციონალი

- **დაკავშირების მცდელობების ლიმიტი და Provisioning-ზე გადასვლა:** `wifi_manager`-ს დაემატა დაკავშირების მცდელობების კონფიგურირებადი ლიმიტი (`CONFIG_WIFI_MANAGER_MAX_RECONNECT_ATTEMPTS`). ლიმიტის ამოწურვის შემდეგ, მოდული ავტომატურად შლის არასწორ მონაცემებს NVS-დან და ითხოვს provisioning პროცესის დაწყებას, რაც მომხმარებელს საშუალებას აძლევს, მარტივად განაახლოს WiFi-ს პარამეტრები.

---

## [v2.1.0] - 2025-06-30

### ✨ ახალი ფუნქციონალი

- **მოდულების ინიციალიზაციის პრიორიტეტიზაცია:** დაინერგა მოდულების დალაგების მტკიცე მექანიზმი `init_level` პარამეტრის საფუძველზე. `Module Registry` ახლა ავტომატურად ალაგებს ყველა რეგისტრირებულ მოდულს მათი `init_level`-ის მიხედვით ინიციალიზაციამდე, რაც უზრუნველყოფს, რომ დაბალი `init_level`-ის მქონე (მაღალი პრიორიტეტის) მოდულები პირველები გაეშვან. ეს ხსნის დამოკიდებულებას `system_config.json`-ში მოდულების თანმიმდევრობაზე.
- **RGB LED ინდიკატორის გაუმჯობესება:** `rgb_led_indicator` მოდულს დაემატა `PULSE` (პულსაციის) ეფექტის მხარდაჭერა. ივენთების დამუშავება ახლა ხდება ცხრილზე დაფუძნებული მიდგომით, რაც კოდს უფრო მასშტაბირებადს და წაკითხვადს ხდის. `release_control` API ახლა კორექტულად აღადგენს სისტემის ბოლო ცნობილ მდგომარეობას.

### 🐛 შეცდომების გასწორება

- **გასწორდა Race Condition მოდულების ინიციალიზაციისას:** მოგვარდა კრიტიკული დროის ფაქტორით გამოწვეული პრობლემა, როდესაც მოდულები (მაგ., `rgb_led_indicator`) აცდენდნენ სისტემის ადრეულ ივენთებს (მაგ., `WIFI_CREDENTIALS_NOT_FOUND`), რადგან მათი ინიციალიზაცია ხდებოდა ივენთის გამომქვეყნებელი მოდულის შემდეგ. `init_level`-ზე დაფუძნებული დალაგება უზრუნველყოფს ინიციალიზაციის სწორ თანმიმდევრობას.
- **გასწორდა LEDC დრაივერის გამოყენება:** `rgb_led_indicator` მოდულის კოდი შეიცვალა ისე, რომ LEDC არხების ინიციალიზაცია ხდება მხოლოდ ერთხელ, `init` ფუნქციაში. ამან აღმოფხვრა `GPIO is not usable, maybe conflict with others` გაფრთხილება და უზრუნველყო LED ეფექტების გლუვი, უწყვეტი მუშაობა.
- **გასწორდა `qsort`-ის შედარების ფუნქციის ლოგიკა:** გასწორდა მაჩვენებლების ტიპების კონვერტაცია `compare_modules_by_init_level` ფუნქციაში, მოდულების მასივის სწორად დალაგების უზრუნველსაყოფად.

### ♻️ რეფაქტორინგი

- **`init_level`-ის მართვის ცენტრალიზაცია:** `init_level`-ის დაყენების პასუხისმგებლობა ახლა დელეგირებულია თითოეული მოდულის `_create` ფუნქციაზე, რომელიც კითხულობს მნიშვნელობას შესაბამისი `module.json`-იდან (გაერთიანებული `config` ობიექტის მეშვეობით). ეს მოდულის პრიორიტეტს ხდის თვითკმარს და დამოუკიდებელს `system_config.json`-ისგან.
- **გაუმჯობესდა ივენთების დამუშავება `rgb_led_indicator`-ში:** `if-else` ბრძანებების ჯაჭვი ჩანაცვლდა `static event_map` ცხრილით, რაც უზრუნველყოფს "ივენთი-ბრძანება" კავშირების უფრო სუფთა და ადვილად მართვად იმპლემენტაციას.
