{
  "firmware": {
    "version": "3.5.0",
    "description": "Implemented Service Locator pattern for I2C bus decoupling."
  },
  "global_config": {
    "device.id.prefix": "Synapse"
  },
  "modules": [
    {
      "type": "wifi_manager",
      "enabled": true,
      "config": {
        "instance_name": "main_wifi_manager"
      }
    },
    {
      "type": "ble_provisioning",
      "enabled": true,
      "config": {
        "instance_name": "main_ble_provisioning"
      }
    },
    {
      "type": "logger_module",
      "enabled": true,
      "config": {
        "instance_name": "main_logger"
      }
    },
    {
      "type": "rgb_led_indicator",
      "enabled": true,
      "config": {
          "instance_name": "status_led",
          "red_pin": 18,
          "green_pin": 19,
          "blue_pin": 5,
          "is_common_anode": true
      }
    },
    {
      "type": "health_monitor",
      "enabled": true,
      "config": {
          "instance_name": "health_monitor",
          "check_interval_sec": 60,
          "thresholds": {
              "min_free_heap_kb": 40,
              "task_stack_watermark_percent": 90
          }
      }
    },
    {
      "type": "ota_update_manager",
      "enabled": true,
      "config": {
          "instance_name": "main_ota_manager",
          "server_cert_pem_start": "-----BEGIN CERTIFICATE-----\n...",
          "pre_check_min_heap_kb": 80
      }
    },
    {
      "type": "watchdog_manager",
      "enabled": true,
      "config": {
          "instance_name": "main_watchdog",
          "check_interval_ms": 2000,
          "heartbeat_timeout_ms": 5000
      }
    },
    {
      "type": "command_router",
      "enabled": true,
      "config": {
        "instance_name": "main_cmd_router",
        "enable_serial_shell": true,
        "serial_shell_prompt": "SYNAPSE> "
      }
    },
    {
      "type": "storage_manager",
      "enabled": true,
      "config": {
        "instance_name": "main_storage"
      }
    },
    {
      "type": "system_timer",
      "enabled": true,
      "config": {
        "instance_name": "main_timer_service"
      }
    },
    {
      "type": "timer_test",
      "enabled": true,
      "config": {
        "instance_name": "main_timer_test"
      }
    },
    {
      "type": "alarms_manager",
      "enabled": true,
      "config": {
          "instance_name": "main_alarms_manager",
          "alarms": [
              {
                  "name": "LowMemoryAlert",
                  "trigger_event": "SYSTEM_HEALTH_ALERT",
                  "condition_payload_key": "alert_type",
                  "condition_payload_value": "LOW_HEAP_MEMORY",
                  "actions": [
                      { "type": "log_critical", "message": "Critical: Low heap memory detected!" },
                      { "type": "set_led", "service_name": "status_led", "r": 255, "g": 0, "b": 0 }
                  ]
              },
              {
                  "name": "WiFiDisconnectLoop",
                  "trigger_event": "WIFI_EVENT_DISCONNECTED",
                  "threshold_count": 5,
                  "time_window_sec": 300,
                  "actions": [
                      { "type": "log_critical", "message": "WiFi disconnected 5 times in 5 minutes. Rebooting system." },
                      { "type": "reboot_system", "delay_ms": 1000 }
                  ]
              }
          ]
      }
    },
    {
      "type": "device_identity_service",
      "enabled": true,
      "config": {
          "instance_name": "main_identity_service"
      }
    },
    {
      "type": "mqtt_manager",
      "enabled": true,
      "config": {
          "instance_name": "main_mqtt_broker",
          "broker_uri": "mqtt://192.168.1.160:1883",
          "username": "",
          "password": "",
          "base_topic_prefix": "synapse/devices",
          "lwt_topic": "lwt",
          "lwt_message": "{\"status\":\"offline\"}",
          "lwt_qos": 1,
          "lwt_retain": true
      }
    },
    {
      "type": "connectivity_watchdog",
      "enabled": true,
      "config": {
        "instance_name": "main_conn_watchdog",
        "grace_period_sec": 30,
        "check_interval_sec": 60,
        "layers": [
          {
            "type": "MQTT",
            "timeout_sec": 300,
            "actions": [
                { "on_failure_count": 1, "do": "log_warning", "message": "MQTT connection lost." },
                { "on_failure_count": 3, "do": "reconnect_mqtt" },
                { "on_failure_count": 5, "do": "trigger_alarm", "alarm_name": "CriticalMQTTLost" }
            ]
          },
          {
            "type": "PING",
            "target": "8.8.8.8",
            "timeout_sec": 600,
            "actions": [
                { "on_failure_count": 2, "do": "reconnect_wifi" },
                { "on_failure_count": 4, "do": "reboot_system", "delay_ms": 5000 }
            ]
          }
        ]
      }
    },
    {
      "type": "self_test_manager",
      "enabled": true,
      "config": {
        "instance_name": "selftest",
        "storage_service_instance": "main_storage"
      }
    }
  ]
}