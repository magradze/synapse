# ­Ъћў рЃЏрЃЮрЃЊрЃБрЃџрЃў: `button_input`

**­ЪЌѓ№ИЈ рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ:** `drivers`  
**Рюњ№ИЈ рЃљрЃЋрЃбрЃЮрЃарЃў:** Synapse Framework Team  
**­Ъћќ рЃЋрЃћрЃарЃАрЃўрЃљ:** 2.0.0

## 1. ­ЪЊю рЃЏрЃўрЃЏрЃЮрЃ«рЃўрЃџрЃЋрЃљ

`button_input` рЃљрЃарЃўрЃА Synapse Framework-рЃўрЃА **рЃБрЃюрЃўрЃЋрЃћрЃарЃАрЃљрЃџрЃБрЃарЃў, рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃерЃћрЃбрЃљрЃюрЃўрЃА (User Input) рЃЏрЃЮрЃЊрЃБрЃџрЃў**. рЃўрЃА рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃћрЃарЃЌрЃўрЃљрЃю, рЃАрЃљрЃўрЃЏрЃћрЃЊрЃЮ рЃЊрЃљ рЃЏрЃЮрЃЦрЃюрЃўрЃџ рЃЏрЃћрЃЦрЃљрЃюрЃўрЃќрЃЏрЃА рЃљрЃърЃљрЃарЃљрЃбрЃБрЃарЃБрЃџрЃў, рЃбрЃљрЃЦрЃбрЃўрЃџрЃБрЃарЃў рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃўрЃА рЃЊрЃљрЃАрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃџрЃљрЃЊ, рЃЏрЃўрЃБрЃ«рЃћрЃЊрЃљрЃЋрЃљрЃЊ рЃўрЃЏрЃўрЃАрЃљ, рЃўрЃАрЃўрЃюрЃў рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа ESP32-рЃўрЃА GPIO рЃърЃўрЃюрЃћрЃЉрЃќрЃћрЃљ рЃЏрЃўрЃћрЃарЃЌрЃћрЃЉрЃБрЃџрЃў, рЃЌрЃБ I/O рЃњрЃљрЃЏрЃцрЃљрЃарЃЌрЃЮрЃћрЃЉрЃћрЃџ рЃЕрЃўрЃърЃќрЃћ, рЃарЃЮрЃњрЃЮрЃарЃўрЃфрЃљрЃљ `MCP23017`.

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃљрЃЏрЃЮрЃфрЃљрЃюрЃљрЃљ, рЃЊрЃљрЃљрЃцрЃўрЃЦрЃАрЃўрЃарЃЮрЃА рЃдрЃўрЃџрЃљрЃЎрЃќрЃћ рЃЊрЃљрЃГрЃћрЃарЃљ, рЃЏрЃЮрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃА рЃАрЃўрЃњрЃюрЃљрЃџрЃўрЃА "рЃњрЃљрЃгрЃЏрЃћрЃюрЃЊрЃљ" (Debouncing) рЃЊрЃљ рЃерЃћрЃЏрЃЊрЃћрЃњ, `Event Bus`-рЃќрЃћ рЃњрЃљрЃЏрЃЮрЃљрЃЦрЃЋрЃћрЃДрЃюрЃЮрЃА рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџрЃў `FMW_EVENT_BUTTON_PRESSED` рЃўрЃЋрЃћрЃюрЃЌрЃў. рЃћрЃА рЃАрЃарЃБрЃџрЃљрЃЊ рЃљрЃЉрЃАрЃбрЃарЃљрЃњрЃўрЃарЃћрЃЉрЃА рЃљрЃърЃљрЃарЃљрЃбрЃБрЃарЃБрЃџ рЃЊрЃћрЃбрЃљрЃџрЃћрЃЉрЃА рЃЊрЃљ рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА рЃљрЃФрЃџрЃћрЃЋрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа рЃАрЃ«рЃЋрЃљ рЃюрЃљрЃгрЃўрЃџрЃА (рЃЏрЃљрЃњ., `ui_manager`), рЃарЃћрЃљрЃњрЃўрЃарЃћрЃЉрЃљ рЃЏрЃЮрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃА рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃцрЃўрЃќрЃўрЃЎрЃБрЃа рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃфрЃўрЃљрЃќрЃћ.

## 2. ­ЪЈЏ№ИЈ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃърЃарЃўрЃюрЃфрЃўрЃърЃћрЃЉрЃў

- **рЃЮрЃарЃЏрЃљрЃњрЃў рЃарЃћрЃЪрЃўрЃЏрЃў (Dual Mode):** РџЎ№ИЈ рЃЏрЃЮрЃЊрЃБрЃџрЃА рЃерЃћрЃБрЃФрЃџрЃўрЃљ рЃўрЃЏрЃБрЃерЃљрЃЮрЃА рЃЮрЃа, рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃЌ рЃЏрЃљрЃарЃЌрЃЋрЃљрЃЊ рЃарЃћрЃЪрЃўрЃЏрЃерЃў:
  1. **`GPIO` рЃарЃћрЃЪрЃўрЃЏрЃў:** рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃў рЃЏрЃўрЃћрЃарЃЌрЃћрЃЉрЃБрЃџрЃўрЃљ рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа ESP32-рЃўрЃА GPIO рЃърЃўрЃюрЃћрЃЉрЃќрЃћ. рЃљрЃЏ рЃарЃћрЃЪрЃўрЃЏрЃерЃў, рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃДрЃћрЃюрЃћрЃЉрЃА **GPIO рЃерЃћрЃцрЃћрЃарЃ«рЃћрЃЉрЃћрЃЉрЃА (Interrupts)** рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃћрЃцрЃћрЃЦрЃбрЃБрЃарЃЮрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА.
  2. **`Expander` рЃарЃћрЃЪрЃўрЃЏрЃў:** рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃў рЃЏрЃўрЃћрЃарЃЌрЃћрЃЉрЃБрЃџрЃўрЃљ `MCP23017` I/O рЃњрЃљрЃЏрЃцрЃљрЃарЃЌрЃЮрЃћрЃЉрЃћрЃџрЃќрЃћ. рЃљрЃЏ рЃарЃћрЃЪрЃўрЃЏрЃерЃў, рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃДрЃћрЃюрЃћрЃЉрЃА **рЃърЃћрЃарЃўрЃЮрЃЊрЃБрЃџ рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљрЃА (Polling)** рЃЊрЃљ `mcp23017_io_expander` рЃАрЃћрЃарЃЋрЃўрЃАрЃА.
- **Event Producer:** ­ЪЊб рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃўрЃА рЃАрЃБрЃцрЃЌрЃљ "рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃўрЃА рЃЏрЃгрЃљрЃарЃЏрЃЮрЃћрЃЉрЃћрЃџрЃў". рЃЏрЃўрЃАрЃў рЃћрЃарЃЌрЃљрЃЊрЃћрЃарЃЌрЃў рЃњрЃљрЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў рЃљрЃарЃўрЃА `FMW_EVENT_BUTTON_PRESSED` рЃўрЃЋрЃћрЃюрЃЌрЃў.
- **рЃљрЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃБрЃџрЃў рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃљ:** ­Ъћё рЃЮрЃарЃўрЃЋрЃћ рЃарЃћрЃЪрЃўрЃЏрЃерЃў, рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃўрЃА рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ рЃЊрЃљ рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃљ рЃ«рЃЊрЃћрЃЉрЃљ рЃњрЃљрЃЏрЃЮрЃДрЃЮрЃцрЃўрЃџ, рЃЊрЃљрЃЉрЃљрЃџрЃў рЃърЃарЃўрЃЮрЃарЃўрЃбрЃћрЃбрЃўрЃА FreeRTOS рЃбрЃљрЃАрЃЎрЃерЃў, рЃарЃљрЃЌрЃљ рЃљрЃа рЃЊрЃљрЃўрЃЉрЃџрЃЮрЃЎрЃЮрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃАрЃ«рЃЋрЃљ рЃЎрЃЮрЃЏрЃърЃЮрЃюрЃћрЃюрЃбрЃћрЃЉрЃў.
- **Debouncing:** ­ЪЏА№ИЈ рЃЕрЃљрЃерЃћрЃюрЃћрЃЉрЃБрЃџрЃў рЃљрЃЦрЃЋрЃА рЃАрЃљрЃўрЃЏрЃћрЃЊрЃЮ, рЃЊрЃарЃЮрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџрЃў Debouncing рЃЏрЃћрЃЦрЃљрЃюрЃўрЃќрЃЏрЃў, рЃарЃљрЃЌрЃљ рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃљрЃЋрЃўрЃфрЃўрЃџрЃЮрЃЌ рЃдрЃўрЃџрЃљрЃЎрЃўрЃА рЃћрЃарЃЌрЃў рЃЊрЃљрЃГрЃћрЃарЃўрЃА рЃЏрЃарЃљрЃЋрЃљрЃџрЃ»рЃћрЃарЃљрЃЊ рЃАрЃўрЃњрЃюрЃљрЃџрЃљрЃЊ рЃљрЃдрЃЦрЃЏрЃљ.
- **рЃарЃћрЃАрЃБрЃарЃАрЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ:** `GPIO` рЃарЃћрЃЪрЃўрЃЏрЃерЃў, рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃўрЃДрЃћрЃюрЃћрЃЉрЃА `Resource Manager`-рЃА рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃАрЃў рЃърЃўрЃюрЃћрЃЉрЃўрЃА рЃћрЃЦрЃАрЃЎрЃџрЃБрЃќрЃўрЃБрЃарЃљрЃЊ рЃЊрЃљрЃАрЃљрЃЎрЃљрЃЋрЃћрЃЉрЃџрЃљрЃЊ.

## 3. РџЎ№ИЈ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ (`config.json`)

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃЦрЃфрЃћрЃЋрЃљ рЃЊрЃљ рЃарЃћрЃЪрЃўрЃЏрЃў рЃАрЃарЃБрЃџрЃљрЃЊ рЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ `config.json` рЃцрЃљрЃўрЃџрЃўрЃЊрЃљрЃю.

### 3.1. рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ `GPIO` рЃарЃћрЃЪрЃўрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА

```json
[
  {
    "type": "button_input",
    "enabled": true,
    "config": {
      "instance_name": "main_buttons",
      "control_type": "gpio",
      "buttons": [
        {
          "name": "UP",
          "gpio_pin": 26,
          "active_level": 0
        },
        {
          "name": "DOWN",
          "gpio_pin": 27,
          "active_level": 0
        }
      ]
    }
  }
]
```

### 3.2. рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ `Expander` рЃарЃћрЃЪрЃўрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА

```json
[
  {
    "type": "button_input",
    "enabled": true,
    "config": {
      "instance_name": "main_buttons",
      "control_type": "expander",
      "expander_service": "main_io_expander",
      "buttons": [
        {
          "name": "UP",
          "expander_pin": 13,
          "active_level": 0
        },
        {
          "name": "DOWN",
          "expander_pin": 14,
          "active_level": 0
        },
        {
          "name": "OK",
          "expander_pin": 15,
          "active_level": 0
        }
      ]
    }
  }
]
```

### 3.3. рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ |
| :--- | :--- | :--- | :---: |
| `instance_name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў рЃАрЃљрЃ«рЃћрЃџрЃў. | РюЁ |
| `control_type` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃЏрЃБрЃерЃљрЃЮрЃЉрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃў. рЃерЃћрЃАрЃљрЃФрЃџрЃЮ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃћрЃЉрЃў: `"gpio"` рЃљрЃю `"expander"`. | РЮї (Default: `"gpio"`) |
| `expander_service` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃўрЃЏ `mcp23017_io_expander` рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃЮрЃА. | `expander` рЃарЃћрЃЪрЃўрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА |
| `buttons` | рЃЏрЃљрЃАрЃўрЃЋрЃў | рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃўрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃЏрЃљрЃАрЃўрЃЋрЃў. | РюЁ |

**`buttons` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў:**

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ |
| :--- | :--- | :--- | :---: |
| `name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃдрЃўрЃџрЃљрЃЎрЃўрЃА рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў рЃАрЃљрЃ«рЃћрЃџрЃў (рЃЏрЃљрЃњ., "UP", "OK"). | РюЁ |
| `gpio_pin` | рЃарЃўрЃфрЃ«рЃЋрЃў | GPIO рЃърЃўрЃюрЃўрЃА рЃюрЃЮрЃЏрЃћрЃарЃў. | `gpio` рЃарЃћрЃЪрЃўрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА |
| `expander_pin` | рЃарЃўрЃфрЃ«рЃЋрЃў | рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃърЃўрЃюрЃўрЃА рЃюрЃЮрЃЏрЃћрЃарЃў `MCP23017`-рЃќрЃћ (0-15). | `expander` рЃарЃћрЃЪрЃўрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА |
| `active_level` | рЃарЃўрЃфрЃ«рЃЋрЃў | рЃџрЃЮрЃњрЃўрЃЎрЃБрЃарЃў рЃЊрЃЮрЃюрЃћ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃљрЃГрЃћрЃарЃўрЃџ рЃЏрЃЊрЃњрЃЮрЃЏрЃљрЃарЃћрЃЮрЃЉрЃљрЃЊ рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ (`0`=LOW, `1`=HIGH). | РЮї (Default: `0`) |

## 4. ­ЪЊб рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃБрЃџрЃў рЃўрЃЋрЃћрЃюрЃЌрЃў

- **рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў:** `FMW_EVENT_BUTTON_PRESSED`
- **Payload-рЃўрЃА рЃбрЃўрЃърЃў:** `fmw_button_payload_t`
- **Payload-рЃўрЃА рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃў (рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў):**

  ```c
  // fmw_button_payload_t payload;
  // snprintf(payload.button_name, sizeof(payload.button_name), "UP");
  ```

## 5. ­Ъћї рЃЏрЃўрЃћрЃарЃЌрЃћрЃЉрЃўрЃА рЃАрЃЦрЃћрЃЏрЃљ

рЃЮрЃарЃўрЃЋрЃћ рЃарЃћрЃЪрЃўрЃЏрЃерЃў, `active_level: 0` рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃдрЃўрЃџрЃљрЃЎрЃў рЃБрЃюрЃЊрЃљ рЃерЃћрЃћрЃарЃЌрЃЊрЃћрЃА **рЃърЃўрЃюрЃАрЃљ** рЃЊрЃљ **GND**-рЃА рЃерЃЮрЃарЃўрЃА. рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃарЃЌрЃљрЃЋрЃА рЃерЃўрЃЊрЃљ pull-up рЃарЃћрЃќрЃўрЃАрЃбрЃЮрЃарЃћрЃЉрЃА (рЃарЃЮрЃњрЃЮрЃарЃф GPIO-рЃАрЃЌрЃЋрЃўрЃА, рЃўрЃАрЃћ MCP23017-рЃАрЃЌрЃЋрЃўрЃА).

**рЃДрЃБрЃарЃљрЃЊрЃдрЃћрЃЉрЃљ:** ESP32-рЃўрЃА рЃќрЃЮрЃњрЃўрЃћрЃарЃЌ рЃърЃўрЃюрЃА (рЃЏрЃљрЃњ., GPIO 34, 35) рЃљрЃа рЃњрЃљрЃљрЃЕрЃюрЃўрЃљ рЃерЃўрЃЊрЃљ pull-up рЃарЃћрЃќрЃўрЃАрЃбрЃЮрЃарЃћрЃЉрЃў. рЃљрЃЏ рЃърЃўрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃАрЃљрЃА, рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ **рЃњрЃљрЃарЃћ 10k╬Е Pull-up рЃарЃћрЃќрЃўрЃАрЃбрЃЮрЃарЃўрЃА** рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ.
