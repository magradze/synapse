# ­ЪїА№ИЈ рЃЏрЃЮрЃЊрЃБрЃџрЃў: `sensor_aggregator`

**­ЪЌѓ№ИЈ рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ:** `sensors`  
**Рюњ№ИЈ рЃљрЃЋрЃбрЃЮрЃарЃў:** Synapse Framework Team  
**­Ъћќ рЃЋрЃћрЃарЃАрЃўрЃљ:** 1.3.0

## 1. ­ЪЊю рЃЏрЃўрЃЏрЃЮрЃ«рЃўрЃџрЃЋрЃљ

`sensor_aggregator` рЃљрЃарЃўрЃА Synapse Framework-рЃўрЃА **рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃўрЃА рЃЊрЃљ рЃерЃћрЃњрЃарЃЮрЃЋрЃћрЃЉрЃўрЃА рЃфрЃћрЃюрЃбрЃарЃљрЃџрЃБрЃарЃў рЃЎрЃЋрЃљрЃюрЃФрЃў**. рЃЏрЃўрЃАрЃў рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃљрЃЏрЃЮрЃфрЃљрЃюрЃљрЃљ, рЃЏрЃЮрЃБрЃАрЃЏрЃўрЃюрЃЮрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў рЃљрЃарЃАрЃћрЃЉрЃБрЃџрЃў рЃАрЃ«рЃЋрЃљрЃЊрЃљрЃАрЃ«рЃЋрЃљ рЃАрЃћрЃюрЃАрЃЮрЃарЃўрЃА рЃЏрЃўрЃћрЃа рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃБрЃџ рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА, рЃЏрЃЮрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃА рЃЏрЃљрЃЌрЃў **рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃљ**, **рЃЊрЃљрЃљрЃЏрЃБрЃерЃљрЃЮрЃА** рЃЊрЃљ **рЃљрЃњрЃарЃћрЃњрЃўрЃарЃћрЃЉрЃљ** рЃњрЃљрЃБрЃЎрЃћрЃЌрЃЮрЃА рЃћрЃарЃЌ, рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃўрЃарЃћрЃЉрЃБрЃџ "рЃЎрЃљрЃЊрЃарЃерЃў" (snapshot), рЃЊрЃљ рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃњрЃљрЃюрЃАрЃљрЃќрЃдрЃЋрЃарЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ, рЃњрЃљрЃЏрЃЮрЃљрЃЦрЃЋрЃћрЃДрЃюрЃЮрЃА рЃћрЃарЃЌрЃўрЃљрЃюрЃў, "рЃњрЃљрЃГрЃЎрЃЋрЃўрЃљрЃюрЃћрЃЉрЃБрЃџрЃў" рЃарЃћрЃърЃЮрЃарЃбрЃў.

рЃћрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃгрЃДрЃЋрЃћрЃбрЃА рЃЮрЃа рЃцрЃБрЃюрЃЊрЃљрЃЏрЃћрЃюрЃбрЃБрЃа рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљрЃА:

1. **рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃАрЃўрЃГрЃљрЃарЃЉрЃћ:** рЃўрЃЏрЃўрЃА рЃюрЃљрЃфрЃЋрЃџрЃљрЃЊ, рЃарЃЮрЃЏ рЃЏрЃарЃљрЃЋрЃљрЃџрЃЏрЃљ рЃАрЃћрЃюрЃАрЃЮрЃарЃЏрЃљ рЃфрЃљрЃџ-рЃфрЃљрЃџрЃЎрЃћ рЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЮрЃА `Event Bus` рЃЊрЃљ рЃЦрЃАрЃћрЃџрЃў "рЃюрЃћрЃЊрЃџрЃў" рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃЌ, рЃљрЃњрЃарЃћрЃњрЃљрЃбрЃЮрЃарЃў рЃЦрЃЏрЃюрЃўрЃА рЃћрЃарЃЌрЃўрЃљрЃю, рЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃўрЃќрЃћрЃЉрЃБрЃџ рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃюрЃљрЃЎрЃљрЃЊрЃА.
2. **рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃљрЃарЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃљ:** рЃЌрЃБ рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ рЃЎрЃљрЃЋрЃерЃўрЃарЃњрЃљрЃарЃћрЃерЃћрЃљ, рЃљрЃњрЃарЃћрЃњрЃљрЃбрЃЮрЃарЃў **рЃљрЃа рЃЎрЃљрЃарЃњрЃљрЃЋрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃА**, рЃљрЃарЃљрЃЏрЃћрЃЊ рЃўрЃюрЃљрЃ«рЃљрЃЋрЃА рЃЏрЃљрЃЌ рЃџрЃЮрЃЎрЃљрЃџрЃБрЃа рЃцрЃљрЃўрЃџрЃБрЃа рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў рЃЊрЃљ рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃАрЃЌрЃљрЃюрЃљрЃЋрЃћ рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃЊрЃљрЃњрЃарЃЮрЃЋрЃўрЃџ рЃарЃћрЃърЃЮрЃарЃбрЃћрЃЉрЃА.

рЃћрЃА рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃџрЃЮрЃЉрЃћрЃЉрЃў рЃЏрЃљрЃА рЃљрЃЦрЃфрЃћрЃЋрЃА **Edge Computing-рЃўрЃА рЃЏрЃФрЃџрЃљрЃЋрЃа рЃЎрЃЋрЃљрЃюрЃФрЃљрЃЊ**, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃЌрЃљ рЃ«рЃљрЃарЃўрЃАрЃ«рЃА, рЃћрЃцрЃћрЃЦрЃбрЃБрЃарЃЮрЃЉрЃљрЃА рЃЊрЃљ рЃАрЃљрЃўрЃЏрЃћрЃЊрЃЮрЃЮрЃЉрЃљрЃА.

## 2. ­ЪЈЏ№ИЈ рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃърЃарЃўрЃюрЃфрЃўрЃърЃћрЃЉрЃў

- **Event-driven рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ:** рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃарЃўрЃА рЃАрЃБрЃцрЃЌрЃљ "рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃў рЃЊрЃљ рЃЏрЃгрЃљрЃарЃЏрЃЮрЃћрЃЉрЃћрЃџрЃў". рЃўрЃА рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљрЃерЃў рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџ рЃАрЃћрЃюрЃАрЃЮрЃарЃћрЃЉрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА рЃЊрЃљ рЃљрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃА рЃћрЃарЃЌ, рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџ, рЃцрЃарЃћрЃўрЃЏрЃЋрЃЮрЃарЃЦрЃўрЃА рЃЊрЃЮрЃюрЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃА: `FMW_EVENT_AGGREGATED_SENSOR_REPORT`.
- **рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃЌ рЃЏрЃљрЃарЃЌрЃБрЃџрЃў рЃџрЃЮрЃњрЃўрЃЎрЃљ:** рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃЦрЃфрЃћрЃЋрЃљ рЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ `system_config.json` рЃцрЃљрЃўрЃџрЃўрЃЊрЃљрЃю. рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ рЃњрЃљрЃюрЃАрЃљрЃќрЃдрЃЋрЃарЃљрЃЋрЃА, рЃЌрЃБ рЃарЃЮрЃЏрЃћрЃџ рЃАрЃћрЃюрЃАрЃЮрЃарЃћрЃЉрЃА рЃБрЃюрЃЊрЃљ рЃБрЃАрЃЏрЃўрЃюрЃЮрЃА, рЃарЃљ рЃАрЃбрЃарЃљрЃбрЃћрЃњрЃўрЃўрЃЌ рЃЊрЃљ рЃарЃљ рЃарЃћрЃЪрЃўрЃЏрЃўрЃЌ рЃЏрЃЮрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃљрЃњрЃарЃћрЃњрЃљрЃфрЃўрЃљ рЃЊрЃљ рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃљ.
- **рЃЏрЃЊрЃњрЃарЃљрЃЊрЃў рЃЉрЃБрЃцрЃћрЃарЃўрЃќрЃљрЃфрЃўрЃљ (Persistence):** `FMW_EVENT_CONNECTIVITY_LOST` рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃўрЃАрЃљрЃА, рЃЏрЃЮрЃЊрЃБрЃџрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃљрЃЊрЃљрЃЊрЃўрЃА offline рЃарЃћрЃЪрЃўрЃЏрЃерЃў рЃЊрЃљ рЃўрЃДрЃћрЃюрЃћрЃЉрЃА `Storage Manager` рЃАрЃћрЃарЃЋрЃўрЃАрЃА (SPIFFS рЃљрЃю SD Card backend-рЃўрЃЌ), рЃарЃљрЃЌрЃљ рЃерЃћрЃўрЃюрЃљрЃ«рЃЮрЃА рЃарЃћрЃърЃЮрЃарЃбрЃћрЃЉрЃў рЃџрЃЮрЃЎрЃљрЃџрЃБрЃарЃљрЃЊ. `FMW_EVENT_CONNECTIVITY_ESTABLISHED` рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃўрЃАрЃљрЃА, рЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃДрЃЋрЃћрЃџрЃљ рЃЊрЃљрЃњрЃарЃЮрЃЋрЃўрЃџ рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃА.
- **рЃАрЃљрЃерЃБрЃљрЃџрЃЮ рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃўрЃА рЃЊрЃЮрЃюрЃћ (`init_level: 48`):** рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃЊрЃћрЃЉрЃљ рЃАрЃўрЃАрЃбрЃћрЃЏрЃБрЃарЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃўрЃА (рЃЏрЃљрЃњ., `system_timer`, `storage_manager`) рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃЏрЃљрЃњрЃарЃљрЃЏ рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃўрЃА рЃЊрЃЮрЃюрЃўрЃА рЃАрЃћрЃюрЃАрЃЮрЃарЃћрЃЉрЃўрЃА рЃЏрЃЮрЃЊрЃБрЃџрЃћрЃЉрЃљрЃЏрЃЊрЃћ.

## 3. РџЎ№ИЈ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ (`system_config.json`)

рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃЦрЃфрЃћрЃЋрЃљ рЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ рЃЏрЃўрЃАрЃў рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃЌ.

```json
{
    "type": "sensor_aggregator",
    "enabled": true,
    "config": {
        "instance_name": "main_aggregator",
        "aggregation_strategy": "time_window",
        "aggregation_period_sec": 60,
        "sensors_to_aggregate": [
            {
                "event_name": "SENSOR_DATA_TEMPERATURE",
                "json_key": "temperature",
                "aggregation_mode": "avg",
                "valid_range": { "min": -40.0, "max": 85.0 }
            },
            {
                "event_name": "SENSOR_DATA_HUMIDITY",
                "json_key": "humidity",
                "aggregation_mode": "last"
            },
            {
                "event_name": "SENSOR_DATA_LIGHT",
                "json_key": "light_lux",
                "aggregation_mode": "max"
            }
        ]
    }
}
```

### 3.1. рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ |
| :--- | :--- | :--- | :---: |
| `instance_name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў рЃАрЃљрЃ«рЃћрЃџрЃў. | РюЁ |
| `aggregation_strategy` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃљрЃњрЃарЃћрЃњрЃљрЃфрЃўрЃўрЃА рЃАрЃбрЃарЃљрЃбрЃћрЃњрЃўрЃљ: `"time_window"` рЃљрЃю `"on_trigger"`. | РюЁ |
| `aggregation_period_sec` | рЃарЃўрЃфрЃ«рЃЋрЃў | рЃЊрЃарЃЮрЃўрЃА рЃцрЃљрЃюрЃ»рЃљрЃарЃљ рЃгрЃљрЃЏрЃћрЃЉрЃерЃў (`time_window` рЃАрЃбрЃарЃљрЃбрЃћрЃњрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА). | `time_window`-рЃАрЃЌрЃЋрЃўрЃА |
| `trigger_event` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃњрЃљрЃЏрЃЮрЃЏрЃгрЃЋрЃћрЃЋрЃў рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў (`on_trigger` рЃАрЃбрЃарЃљрЃбрЃћрЃњрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА). | `on_trigger`-рЃўрЃАрЃЌрЃЋрЃўрЃА |
| `sensors_to_aggregate` | рЃЏрЃљрЃАрЃўрЃЋрЃў | рЃАрЃћрЃюрЃАрЃЮрЃарЃћрЃЉрЃўрЃА рЃАрЃўрЃљ, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃАрЃљрЃф рЃЏрЃЮрЃЊрЃБрЃџрЃў "рЃБрЃАрЃЏрЃћрЃюрЃА". | РюЁ |

### 3.2. `sensors_to_aggregate` рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў

| рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃў | рЃбрЃўрЃърЃў | рЃљрЃдрЃгрЃћрЃарЃљ | Default |
| :--- | :--- | :--- | :--- |
| `event_name` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃўрЃЏ рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф рЃБрЃюрЃЊрЃљ рЃЏрЃЮрЃБрЃАрЃЏрЃўрЃюрЃЮрЃА. | - (рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ) |
| `json_key` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃБрЃџрЃў рЃўрЃЦрЃюрЃћрЃЉрЃљ рЃАрЃљрЃЉрЃЮрЃџрЃЮрЃЮ JSON рЃарЃћрЃърЃЮрЃарЃбрЃерЃў. | - (рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ) |
| `aggregation_mode` | рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў | рЃљрЃњрЃарЃћрЃњрЃљрЃфрЃўрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃў. | `"last"` |
| `valid_range` | рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃў | рЃЊрЃљрЃАрЃљрЃерЃЋрЃћрЃЉрЃў рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃћрЃЉрЃўрЃА рЃЊрЃўрЃљрЃърЃљрЃќрЃЮрЃюрЃў. рЃерЃћрЃўрЃфрЃљрЃЋрЃА `min` рЃЊрЃљ `max` рЃЋрЃћрЃџрЃћрЃЉрЃА. | - (рЃљрЃарЃљрЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮ) |

#### **`aggregation_mode`-рЃўрЃА рЃерЃћрЃАрЃљрЃФрЃџрЃЮ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃћрЃЉрЃў:**

- **`"last"`** (Default): рЃарЃћрЃърЃЮрЃарЃбрЃерЃў рЃерЃћрЃЋрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ **рЃЉрЃЮрЃџрЃЮ** рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃў рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљ рЃЊрЃарЃЮрЃўрЃА рЃцрЃљрЃюрЃ»рЃарЃўрЃА рЃњрЃљрЃюрЃЏрЃљрЃЋрЃџрЃЮрЃЉрЃљрЃерЃў.
- **`"avg"`**: рЃарЃћрЃърЃЮрЃарЃбрЃерЃў рЃерЃћрЃЋрЃљ рЃЊрЃарЃЮрЃўрЃА рЃцрЃљрЃюрЃ»рЃарЃўрЃА рЃњрЃљрЃюрЃЏрЃљрЃЋрЃџрЃЮрЃЉрЃљрЃерЃў рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃў рЃДрЃЋрЃћрЃџрЃљ рЃЋрЃљрЃџрЃўрЃЊрЃБрЃарЃў рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃўрЃА **рЃАрЃљрЃерЃБрЃљрЃџрЃЮ рЃљрЃарЃўрЃЌрЃЏрЃћрЃбрЃўрЃЎрЃБрЃџрЃў**.
- **`"min"`**: рЃарЃћрЃърЃЮрЃарЃбрЃерЃў рЃерЃћрЃЋрЃљ рЃЊрЃарЃЮрЃўрЃА рЃцрЃљрЃюрЃ»рЃарЃўрЃА рЃњрЃљрЃюрЃЏрЃљрЃЋрЃџрЃЮрЃЉрЃљрЃерЃў рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃў **рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў** рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљ.
- **`"max"`**: рЃарЃћрЃърЃЮрЃарЃбрЃерЃў рЃерЃћрЃЋрЃљ рЃЊрЃарЃЮрЃўрЃА рЃцрЃљрЃюрЃ»рЃарЃўрЃА рЃњрЃљрЃюрЃЏрЃљрЃЋрЃџрЃЮрЃЉрЃљрЃерЃў рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃў **рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў** рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљ.

## 4. ­ЪЊб рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃЊрЃћрЃџрЃў

- **рЃерЃћрЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃў рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃў:**
  - **рЃАрЃћрЃюрЃАрЃЮрЃарЃБрЃџрЃў рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃў:** рЃћрЃџрЃЮрЃЊрЃћрЃЉрЃљ рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА, рЃарЃЮрЃЏрЃћрЃџрЃЌрЃљ `payload` рЃљрЃарЃўрЃА JSON рЃАрЃбрЃарЃўрЃЦрЃЮрЃюрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃерЃћрЃўрЃфрЃљрЃЋрЃА `"value"` рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃА.
  - **рЃЎрЃљрЃЋрЃерЃўрЃарЃўрЃА рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃў:** рЃњрЃљрЃЏрЃЮрЃўрЃгрЃћрЃарЃА `FMW_EVENT_CONNECTIVITY_ESTABLISHED` рЃЊрЃљ `FMW_EVENT_CONNECTIVITY_LOST` рЃўрЃЋрЃћрЃюрЃЌрЃћрЃЉрЃА, рЃарЃљрЃЌрЃљ рЃЏрЃљрЃарЃЌрЃЮрЃА offline рЃЉрЃБрЃцрЃћрЃарЃўрЃќрЃљрЃфрЃўрЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃў.
- **рЃњрЃљрЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃў рЃўрЃЋрЃћрЃюрЃЌрЃў:**
  - **рЃАрЃљрЃ«рЃћрЃџрЃў:** `FMW_EVENT_AGGREGATED_SENSOR_REPORT` (рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџрЃў)
  - **Payload-рЃўрЃА рЃбрЃўрЃърЃў:** `fmw_telemetry_payload_t`.
  - **`json_data` рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃў (рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў):**

    ```json
    {"timestamp":1678886400,"temperature":23.5,"humidity":55.2,"light_lux":350}
    ```

## 5. ­ЪњА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў рЃЊрЃљ рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃљ

рЃљрЃЏ рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃАрЃарЃБрЃџрЃцрЃљрЃАрЃЮрЃЋрЃљрЃюрЃў рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃЕрЃЋрЃћрЃю рЃЋрЃўрЃДрЃћрЃюрЃћрЃЉрЃЌ `sensor_simulator` рЃЏрЃЮрЃЊрЃБрЃџрЃА.

1. **рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ:** рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃўрЃЌ, рЃарЃЮрЃЏ `sensor_simulator`, `sensor_aggregator` рЃЊрЃљ `mqtt_manager` рЃЕрЃљрЃарЃЌрЃБрЃџрЃўрЃљ рЃЊрЃљ рЃАрЃгрЃЮрЃарЃљрЃЊ рЃљрЃарЃўрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў. `storage_manager`-рЃўрЃАрЃЌрЃЋрЃўрЃА рЃљрЃарЃЕрЃћрЃБрЃџрЃў рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА `SPIFFS` рЃљрЃю `SD Card` backend-рЃў.
2. **Offline рЃАрЃфрЃћрЃюрЃљрЃарЃўрЃА рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃљ:**
    - рЃњрЃљрЃЌрЃўрЃерЃћрЃЌ MQTT рЃЉрЃарЃЮрЃЎрЃћрЃарЃў рЃљрЃю WiFi рЃгрЃЋрЃЊрЃЮрЃЏрЃўрЃА рЃгрЃћрЃарЃбрЃўрЃџрЃў.
    - рЃЊрЃљрЃљрЃЎрЃЋрЃўрЃарЃЊрЃўрЃЌ рЃџрЃЮрЃњрЃћрЃЉрЃА: `SENSOR_AGGR` рЃЊрЃљрЃўрЃгрЃДрЃћрЃЉрЃА рЃарЃћрЃърЃЮрЃарЃбрЃћрЃЉрЃўрЃА рЃцрЃљрЃўрЃџрЃБрЃа рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў рЃерЃћрЃюрЃљрЃ«рЃЋрЃљрЃА (`Buffering report to filesystem`).
3. **Online рЃАрЃфрЃћрЃюрЃљрЃарЃўрЃА рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃљ:**
    - рЃљрЃдрЃљрЃЊрЃњрЃўрЃюрЃћрЃЌ рЃЎрЃљрЃЋрЃерЃўрЃарЃў (рЃЕрЃљрЃарЃЌрЃћрЃЌ MQTT рЃЉрЃарЃЮрЃЎрЃћрЃарЃў).
    - рЃЊрЃљрЃљрЃЎрЃЋрЃўрЃарЃЊрЃўрЃЌ рЃџрЃЮрЃњрЃћрЃЉрЃА: `SENSOR_AGGR` рЃЊрЃљрЃЉрЃћрЃГрЃЊрЃљрЃЋрЃА `Connectivity established. Flushing buffered reports.` рЃЊрЃљ рЃЊрЃљрЃўрЃгрЃДрЃћрЃЉрЃА рЃерЃћрЃюрЃљрЃ«рЃБрЃџрЃў рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА MQTT-рЃерЃў рЃњрЃљрЃњрЃќрЃљрЃЋрЃюрЃљрЃА.
    - рЃЊрЃљрЃљрЃЎрЃЋрЃўрЃарЃЊрЃўрЃЌ MQTT рЃЎрЃџрЃўрЃћрЃюрЃбрЃА: рЃЌрЃЦрЃЋрЃћрЃю рЃЏрЃўрЃўрЃдрЃћрЃЉрЃЌ рЃ»рЃћрЃа рЃЊрЃљрЃњрЃарЃЮрЃЋрЃўрЃџ, рЃерЃћрЃЏрЃЊрЃћрЃњ рЃЎрЃў "рЃфрЃЮрЃфрЃ«рЃљрЃџ" рЃарЃћрЃърЃЮрЃарЃбрЃћрЃЉрЃА.

## 6. ­Ъџђ рЃАрЃљрЃЏрЃЮрЃЏрЃљрЃЋрЃџрЃЮ рЃњрЃљрЃюрЃЋрЃўрЃЌрЃљрЃарЃћрЃЉрЃўрЃА рЃърЃћрЃарЃАрЃърЃћрЃЦрЃбрЃўрЃЋрЃћрЃЉрЃў

рЃљрЃЏ рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃЮрЃюрЃљрЃџрЃў рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃЎрЃўрЃЊрЃћрЃЋ рЃБрЃцрЃарЃЮ рЃњрЃљрЃцрЃљрЃарЃЌрЃЮрЃЋрЃЊрЃћрЃА:

- **­Ъћё рЃЎрЃЮрЃЏрЃърЃџрЃћрЃЦрЃАрЃБрЃарЃў рЃбрЃарЃўрЃњрЃћрЃарЃћрЃЉрЃў:** рЃарЃћрЃърЃЮрЃарЃбрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЦрЃЋрЃћрЃДрЃюрЃћрЃЉрЃљ рЃарЃљрЃЏрЃЊрЃћрЃюрЃўрЃЏрЃћ рЃўрЃЋрЃћрЃюрЃЌрЃўрЃА рЃЎрЃЮрЃЏрЃЉрЃўрЃюрЃљрЃфрЃўрЃўрЃЌ (`AND`/`OR` рЃџрЃЮрЃњрЃўрЃЎрЃљ).
- **­ЪДЕ рЃЋрЃўрЃарЃбрЃБрЃљрЃџрЃБрЃарЃў рЃАрЃћрЃюрЃАрЃЮрЃарЃћрЃЉрЃў:** рЃљрЃ«рЃљрЃџрЃў, рЃЋрЃўрЃарЃбрЃБрЃљрЃџрЃБрЃарЃў рЃЏрЃћрЃбрЃарЃўрЃЎрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃљ (рЃЏрЃљрЃњ., "рЃюрЃљрЃЏрЃўрЃА рЃгрЃћрЃарЃбрЃўрЃџрЃў").
- **­Ъцќ AI/ML рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ:** рЃерЃћрЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃюрЃљрЃЎрЃљрЃЊрЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃў рЃљрЃюрЃЮрЃЏрЃљрЃџрЃўрЃћрЃЉрЃўрЃА рЃљрЃдрЃЏрЃЮрЃАрЃљрЃЕрЃћрЃюрЃљрЃЊ.
- **­ЪјЏ№ИЈ рЃЊрЃўрЃюрЃљрЃЏрЃўрЃБрЃарЃў рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ:** рЃљрЃњрЃарЃћрЃњрЃљрЃфрЃўрЃўрЃА рЃгрЃћрЃАрЃћрЃЉрЃўрЃА рЃерЃћрЃфрЃЋрЃџрЃљ рЃЊрЃўрЃАрЃбрЃљрЃюрЃфрЃўрЃБрЃарЃљрЃЊ, MQTT рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃЏрЃћрЃерЃЋрЃћрЃЮрЃЉрЃўрЃЌ.
